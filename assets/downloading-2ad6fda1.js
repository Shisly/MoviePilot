import{P as N}from"./index-b14a1063.js";import{a as $}from"./index-57fabd3c.js";import{_ as U}from"./NoDataFound.vue_vue_type_script_setup_true_lang-4c78e798.js";import{d as b,r as p,j as s,o,f as _,i as c,m as n,ag as A,J as C,t as y,n as x,ab as E,az as F,A as I,ai as G,_ as m,I as R,G as H,z as J,ax as M,al as O,c as V,a2 as q,L as S,U as K,E as Q}from"./index-0997a18b.js";const W=b({__name:"DownloadingCard",props:{info:Object},setup(k){var L;const e=k,r=p(!0);function d(){var a;return((a=e.info)==null?void 0:a.progress)??0}function g(){var a,l;return`↑ ${(a=e.info)==null?void 0:a.upspeed}/s ↓ ${(l=e.info)==null?void 0:l.dlspeed}/s`}const t=p(((L=e.info)==null?void 0:L.state)==="downloading"),w=p(!1);function v(){w.value=!0}function u(){return w.value?"text-white":""}async function f(){var l;const a=t.value?"stop":"start";try{(await $.get(`download/${a}/${(l=e.info)==null?void 0:l.hash}`)).success&&(t.value=!t.value)}catch(h){console.error(h)}}async function j(){var a;try{await $.delete(`download/${(a=e.info)==null?void 0:a.hash}`),r.value=!1}catch(l){console.error(l)}}return(a,l)=>{var h;return s(r)?(o(),_(J,{key:(h=e.info)==null?void 0:h.hash},{image:c(()=>{var i;return[n(A,{src:(i=e.info)==null?void 0:i.media.image,"aspect-ratio":"2/3",cover:"",class:"brightness-50",onLoad:v},null,8,["src"])]}),default:c(()=>[n(E,{class:x(["break-words whitespace-normal",u()])},{default:c(()=>{var i,D,T,B,P,z;return[C(y(((i=e.info)==null?void 0:i.media.title)||((D=e.info)==null?void 0:D.name))+" "+y((T=e.info)!=null&&T.media.episode?`${(B=e.info)==null?void 0:B.media.season} ${(P=e.info)==null?void 0:P.media.episode}`:(z=e.info)==null?void 0:z.season_episode),1)]}),_:1},8,["class"]),n(F,{class:x(["break-words whitespace-normal",u()])},{default:c(()=>{var i;return[C(y((i=e.info)==null?void 0:i.title),1)]}),_:1},8,["class"]),n(I,{class:x(["text-subtitle-1 pt-3 pb-1",u()])},{default:c(()=>[C(y(g()),1)]),_:1},8,["class"]),d()>0?(o(),_(I,{key:0,class:x(u())},{default:c(()=>[n(G,{"model-value":d()},null,8,["model-value"])]),_:1},8,["class"])):m("",!0),n(H,{class:"justify-space-between"},{default:c(()=>[n(R,{icon:`${s(t)?"mdi-pause":"mdi-play"}`,onClick:f},null,8,["icon"]),n(R,{color:"error",icon:"mdi-trash-can-outline",onClick:j})]),_:1})]),_:1})):m("",!0)}}}),X={key:0,class:"mt-12 w-full text-center text-gray-500 text-sm flex flex-col items-center"},Y={key:0,class:"grid gap-3 grid-downloading-card"},Z=b({__name:"DownloadingListView",setup(k){let e=null;const r=p([]),d=p(!1);async function g(){try{r.value=await $.get("download/"),d.value=!0}catch(v){console.error(v)}}const t=p(!1);function w(){t.value=!0,g(),t.value=!1}return M(()=>{g(),e=setInterval(()=>{g()},3e3)}),O(()=>{e&&(clearInterval(e),e=null)}),(v,u)=>(o(),V(S,null,[s(d)?m("",!0):(o(),V("div",X,[s(d)?m("",!0):(o(),_(q,{key:0,size:"48",indeterminate:"",color:"primary"}))])),n(s(N),{modelValue:s(t),"onUpdate:modelValue":u[0]||(u[0]=f=>Q(t)?t.value=f:null),onRefresh:w},{default:c(()=>[s(r).length>0?(o(),V("div",Y,[(o(!0),V(S,null,K(s(r),f=>(o(),_(W,{key:f.hash,info:f},null,8,["info"]))),128))])):m("",!0),s(r).length===0&&s(d)?(o(),_(U,{key:1,"error-code":"404","error-title":"没有任务","error-description":"正在下载的任务将会显示在这里。"})):m("",!0)]),_:1},8,["modelValue"])],64))}});const oe=b({__name:"downloading",setup(k){return(e,r)=>(o(),_(Z))}});export{oe as default};
