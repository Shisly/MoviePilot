import{_ as H}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-dfca3186.js";import{d as N,r as i,q as J,e as P,o as v,f as $,i as o,m as l,D as f,j as a,E as x,F as O,aE as q,a1 as G,c as I,U as Q,L as E,ag as W,a as X,X as Y,J as C,t as A,Y as Z,$ as ee,a0 as le,_ as L,z as M,af as te,M as ae,av as oe,A as F,P as se,O as ne,B as S,C as u,a7 as U,Q as re,R as de,G as ue,I as K,H as ie,ai as me,K as R,a5 as pe}from"./index-0997a18b.js";import{a as T}from"./index-57fabd3c.js";import{n as z}from"./index-705cb9e8.js";const fe={class:"w-full h-full"},ce=N({__name:"TmdbSelectorCard",emits:["update:modelValue","close"],setup(B,{emit:_}){const n=i([]),c=i(""),V=i(!1),m=i(null);function y(d){console.log(d),_("update:modelValue",d.tmdbid),_("close")}function g(d=""){return d?d.replace("original","w500"):""}async function b(){if(c)try{V.value=!0;const d=await T.get("media/search",{params:{title:c.value,page:1,count:20}});n.value=[];for(const t of d)n.value.push({tmdbid:t.tmdb_id||0,poster:g(t.poster_path),title:`${t.title}（${t.year}）`,overview:`<span class="text-primary">${t.type}</span> ${t.overview}`});V.value=!1}catch(d){console.error(d)}}return J(()=>{setTimeout(()=>{var d;(d=m.value)==null||d.focus()},500)}),(d,t)=>{const h=P("VSkeletonLoader");return v(),$(M,{class:"mx-auto",width:"100%"},{default:o(()=>[l(q,{flat:"",class:"p-0"},{default:o(()=>[l(f,{ref_key:"tmdbKeyword",ref:m,modelValue:a(c),"onUpdate:modelValue":t[0]||(t[0]=p=>x(c)?c.value=p:null),label:"输入名称搜索","single-line":"",placeholder:"电影或电视剧名称",variant:"solo","append-inner-icon":"mdi-magnify",flat:"",class:"mx-1",loading:a(V),"onClick:appendInner":b,onKeydown:O(b,["enter"])},null,8,["modelValue","loading","onKeydown"])]),_:1}),a(n).length>0?(v(),$(G,{key:0,lines:"three"},{default:o(()=>[(v(!0),I(E,null,Q(a(n),(p,k)=>(v(),I(E,{key:k},[l(ee,{onClick:r=>y(p)},{prepend:o(()=>[l(W,{height:"75",width:"50",src:p.poster,"aspect-ratio":"2/3",class:"object-cover rounded shadow ring-gray-500 me-3",cover:""},{placeholder:o(()=>[X("div",fe,[l(h,{class:"object-cover aspect-w-2 aspect-h-3"})])]),_:2},1032,["src"])]),default:o(()=>[l(Y,null,{default:o(()=>[C(A(p.title),1)]),_:2},1024),l(Z,{class:"mt-2",innerHTML:p.overview},null,8,["innerHTML"])]),_:2},1032,["onClick"]),k<a(n).length-1?(v(),$(le,{key:0,class:"mt-1",inset:""})):L("",!0)],64))),128))]),_:1})):L("",!0)]),_:1})}}}),be=N({__name:"ReorganizeForm",props:{path:String,target:String,logids:Array},emits:["done","close"],setup(B,{emit:_}){const n=B,c=i(Array.from({length:51},(r,e)=>e).map(r=>({title:`第 ${r} 季`,value:r}))),V=te.useToast(),m=i(!1),y=i(),g=i(!1),b=i("请稍候 ..."),d=i(0),t=ae({logid:0,path:"",target:n.target??"",tmdbid:null,season:null,type_name:"",transfer_type:"",episode_format:"",episode_detail:"",episode_part:"",episode_offset:null,min_filesize:0});oe(()=>{n.path&&(t.path=n.path),n.target&&(t.target=n.target)});function h(){b.value="请稍候 ...";const r=pe.state.auth.token;y.value=new EventSource(`/api/v1/system/progress/filetransfer?token=${r}`),y.value.onmessage=e=>{const w=JSON.parse(e.data);w&&(b.value=w.text,d.value=w.value)}}function p(){var r;(r=y.value)==null||r.close()}async function k(){if(!(!n.logids&&!n.path)){if(g.value=!0,h(),n.path)try{const r=await T.post("transfer/manual",{},{params:t});r.success?V.success(`${n.path} 整理完成！`):V.error(`${n.path} 整理失败：${r.message}！`)}catch(r){console.log(r)}else if(n.logids)for(const r of n.logids){t.logid=r;try{const e=await T.post("transfer/manual",{},{params:t});e.success||V.error(`历史记录 ${r} 重新整理失败：${e.message}！`)}catch(e){console.log(e)}}p(),g.value=!1,_("done")}}return(r,e)=>{const w=H,j=P("VBottomSheet");return v(),$(j,{scrollable:"",inset:""},{default:o(()=>{var D;return[l(M,{title:`${n.path?`整理 - ${n.path}`:`整理 - 共 ${(D=n.logids)==null?void 0:D.length} 条记录`}`,class:"rounded-t"},{default:o(()=>[l(w,{onClick:e[0]||(e[0]=s=>_("close"))}),l(F,{class:"pt-2"},{default:o(()=>[l(se,{onSubmit:ne(()=>{},["prevent"])},{default:o(()=>[l(S,null,{default:o(()=>[l(u,{cols:"12",md:"8"},{default:o(()=>[l(f,{modelValue:a(t).target,"onUpdate:modelValue":e[1]||(e[1]=s=>a(t).target=s),label:"目的路径",placeholder:"留空自动"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"4"},{default:o(()=>[l(U,{modelValue:a(t).transfer_type,"onUpdate:modelValue":e[2]||(e[2]=s=>a(t).transfer_type=s),label:"整理方式",items:[{title:"默认",value:""},{title:"移动",value:"move"},{title:"复制",value:"copy"},{title:"硬链接",value:"link"},{title:"软链接",value:"softlink"},{title:"Rclone复制",value:"rclone_copy"},{title:"Rclone移动",value:"rclone_move"}]},null,8,["modelValue"])]),_:1})]),_:1}),l(S,null,{default:o(()=>[l(u,{cols:"12",md:"4"},{default:o(()=>[l(U,{modelValue:a(t).type_name,"onUpdate:modelValue":e[3]||(e[3]=s=>a(t).type_name=s),label:"类型",items:[{title:"自动",value:""},{title:"电影",value:"电影"},{title:"电视剧",value:"电视剧"}]},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"4"},{default:o(()=>[l(f,{modelValue:a(t).tmdbid,"onUpdate:modelValue":e[4]||(e[4]=s=>a(t).tmdbid=s),disabled:a(t).type_name==="",label:"TMDBID",placeholder:"留空自动识别",rules:[a(z)],"append-inner-icon":"mdi-magnify","onClick:appendInner":e[5]||(e[5]=s=>m.value=!0)},null,8,["modelValue","disabled","rules"])]),_:1}),l(u,{cols:"12",md:"4"},{default:o(()=>[re(l(U,{modelValue:a(t).season,"onUpdate:modelValue":e[6]||(e[6]=s=>a(t).season=s),modelModifiers:{number:!0},label:"季",items:a(c)},null,8,["modelValue","items"]),[[de,a(t).type_name==="电视剧"]])]),_:1})]),_:1}),l(S,null,{default:o(()=>[l(u,{cols:"12",md:"8"},{default:o(()=>[l(f,{modelValue:a(t).episode_format,"onUpdate:modelValue":e[7]||(e[7]=s=>a(t).episode_format=s),label:"集数定位",placeholder:"使用{ep}定位集数"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"4"},{default:o(()=>[l(f,{modelValue:a(t).episode_detail,"onUpdate:modelValue":e[8]||(e[8]=s=>a(t).episode_detail=s),label:"指定集数",placeholder:"起始集,终止集，如1或1,2"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"4"},{default:o(()=>[l(f,{modelValue:a(t).episode_part,"onUpdate:modelValue":e[9]||(e[9]=s=>a(t).episode_part=s),label:"指定Part",placeholder:"如part1"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"4"},{default:o(()=>[l(f,{modelValue:a(t).episode_offset,"onUpdate:modelValue":e[10]||(e[10]=s=>a(t).episode_offset=s),modelModifiers:{number:!0},label:"集数偏移",placeholder:"如-10"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"4"},{default:o(()=>[l(f,{modelValue:a(t).min_filesize,"onUpdate:modelValue":e[11]||(e[11]=s=>a(t).min_filesize=s),modelModifiers:{number:!0},label:"最小文件大小（MB）",rules:[a(z)],placeholder:"0"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),l(ue,null,{default:o(()=>[l(K,{depressed:"",onClick:e[12]||(e[12]=s=>_("close"))},{default:o(()=>[C(" 取消 ")]),_:1}),l(ie),l(K,{variant:"tonal",onClick:k},{default:o(()=>[C(" 开始整理 ")]),_:1})]),_:1})]),_:1},8,["title"]),l(R,{modelValue:a(g),"onUpdate:modelValue":e[13]||(e[13]=s=>x(g)?g.value=s:null),scrim:!1,width:"25rem"},{default:o(()=>[l(M,{color:"primary"},{default:o(()=>[l(F,{class:"text-center"},{default:o(()=>[C(A(a(b))+" ",1),a(d)?(v(),$(me,{key:0,color:"white",class:"mb-0 mt-1","model-value":a(d)},null,8,["model-value"])):L("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(R,{modelValue:a(m),"onUpdate:modelValue":e[16]||(e[16]=s=>x(m)?m.value=s:null),width:"40rem",scrollable:""},{default:o(()=>[l(ce,{modelValue:a(t).tmdbid,"onUpdate:modelValue":e[14]||(e[14]=s=>a(t).tmdbid=s),onClose:e[15]||(e[15]=s=>m.value=!1)},null,8,["modelValue"])]),_:1},8,["modelValue"])]}),_:1})}}});export{be as _};
