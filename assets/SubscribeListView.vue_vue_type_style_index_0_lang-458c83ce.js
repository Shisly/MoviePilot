import{P as re}from"./index-df31f177.js";import{a as U}from"./index-973676b3.js";import{_ as ue}from"./NoDataFound.vue_vue_type_script_setup_true_lang-7364b069.js";import{d as X,af as de,r as _,N as ce,e as me,o as u,c as g,f as p,i as l,m as t,ag as pe,V as D,a as P,ac as fe,a2 as _e,M as N,W as Z,a0 as be,Y as Ve,t as f,j as s,ab as ve,n as C,K as R,aa as ge,B as F,z as ye,$ as m,ai as ke,A as Y,Q as xe,P as we,C as M,D as y,E as T,a8 as Ce,aw as Se,G as $e,I as q,H as Ie,F as ee,L as Le,ax as he,p as Te,a3 as Ue}from"./index-b1eeefe2.js";import{c as Be}from"./index-d2c33d5a.js";import{b as De}from"./formatters-16dfb57c.js";import{n as J}from"./index-705cb9e8.js";const Pe={class:"me-n3"},Re={class:"d-flex align-center"},Fe=X({__name:"SubscribeCard",props:{media:Object},emits:["remove","save"],setup(z,{emit:B}){var A,H;const e=z,k=de.useToast(),b=_(!1),c=_(!1),S=_([]),x=_([]),o=ce(e.media??{});o.best_version=o.best_version===1;const $=_(`${(A=e.media)!=null&&A.last_update?`${Be(((H=e.media)==null?void 0:H.last_update)||"")}前`:""}`);function w(){b.value=!0}function te(){var i,a;return((i=e.media)==null?void 0:i.type)==="电影"?"mdi-movie":((a=e.media)==null?void 0:a.type)==="电视剧"?"mdi-television-classic":"mdi-help-circle"}function j(){var i,a,d,h;return((i=e.media)==null?void 0:i.total_episode)===0?0:Math.round(((((a=e.media)==null?void 0:a.total_episode)??0)-(((d=e.media)==null?void 0:d.lack_episode)??0))/(((h=e.media)==null?void 0:h.total_episode)??1)*100)}function I(){return b.value?"white":""}function L(){return b.value?"text-white":""}async function ae(){var i;try{(await U.delete(`subscribe/${(i=e.media)==null?void 0:i.id}`)).success&&B("remove")}catch(a){console.log(a)}}async function le(){var i,a;try{(await U.get(`subscribe/search/${(i=e.media)==null?void 0:i.id}`)).success&&k.success(`${(a=e.media)==null?void 0:a.name} 提交搜索请求成功！`)}catch(d){console.log(d)}}async function se(){var i,a;c.value=!1;try{const d=await U.put("subscribe/",o);d.success?(k.success(`${(i=e.media)==null?void 0:i.name} 更新成功！`),B("remove")):k.error(`${(a=e.media)==null?void 0:a.name} 更新失败：${d.message}！`)}catch(d){console.log(d)}}async function oe(){try{const i=await U.get("site/rss");S.value=i.filter(a=>a.is_active)}catch(i){console.error(i)}}async function ne(){S.value.length||await oe();const i=S.value.map(a=>({title:a.name,value:a.id}));x.value=i.flat()}async function E(){await ne(),c.value=!0}const ie=_([{title:"编辑",value:1,props:{prependIcon:"mdi-file-edit-outline",click:E}},{title:"搜索",value:2,props:{prependIcon:"mdi-magnify",click:le}},{title:"取消订阅",value:3,props:{prependIcon:"mdi-trash-can-outline",color:"error",click:ae}}]);return(i,a)=>{var h;const d=me("IconBtn");return u(),g(N,null,[(u(),p(Y,{key:(h=e.media)==null?void 0:h.id,class:C(`${s(o).best_version?"outline-dashed outline-1":""}`),onClick:E},{image:l(()=>{var r,n;return[t(pe,{src:((r=e.media)==null?void 0:r.backdrop)||((n=e.media)==null?void 0:n.poster),"aspect-ratio":"2/3",cover:"",class:"brightness-50",onLoad:w},null,8,["src"])]}),default:l(()=>[t(ge,null,{prepend:l(()=>[t(D,{size:"1.9rem",color:I(),icon:te()},null,8,["color","icon"])]),append:l(()=>[P("div",Pe,[t(d,null,{default:l(()=>[t(D,{icon:"mdi-dots-vertical",color:I()},null,8,["color"]),t(fe,{activator:"parent","close-on-content-click":""},{default:l(()=>[t(_e,null,{default:l(()=>[(u(!0),g(N,null,Z(s(ie),(r,n)=>(u(),p(be,{key:n,variant:"plain","base-color":r.props.color,onClick:r.props.click},{prepend:l(()=>[t(D,{icon:r.props.prependIcon},null,8,["icon"])]),default:l(()=>[t(Ve,{textContent:f(r.title)},null,8,["textContent"])]),_:2},1032,["base-color","onClick"]))),128))]),_:1})]),_:1})]),_:1})])]),default:l(()=>[t(ve,{class:C(L())},{default:l(()=>{var r,n,V;return[R(f((r=e.media)==null?void 0:r.name)+" "+f(s(De)((n=e.media)!=null&&n.season?(V=e.media)==null?void 0:V.season.toString():"")),1)]}),_:1},8,["class"])]),_:1}),t(F,null,{default:l(()=>{var r;return[P("p",{class:C(["clamp-text mb-0",L()])},f((r=e.media)==null?void 0:r.description),3)]}),_:1}),t(F,{class:"d-flex justify-space-between align-center flex-wrap"},{default:l(()=>{var r,n,V,v,O,G,K,Q,W;return[P("div",Re,[t(d,{icon:"mdi-star",color:I(),class:"me-1"},null,8,["color"]),P("span",{class:C(["text-subtitle-2 me-4",L()])},f((r=e.media)==null?void 0:r.vote),3),(n=e.media)!=null&&n.total_episode?(u(),p(d,ye({key:0},e,{icon:"mdi-progress-clock",color:I(),class:"me-1"}),null,16,["color"])):m("",!0),(V=e.media)!=null&&V.season?(u(),g("span",{key:1,class:C(["text-subtitle-2 me-4",L()])},f((((v=e.media)==null?void 0:v.total_episode)||0)-(((O=e.media)==null?void 0:O.lack_episode)||0))+" / "+f((G=e.media)==null?void 0:G.total_episode),3)):m("",!0),(K=e.media)!=null&&K.username?(u(),p(d,{key:2,icon:"mdi-account",color:I(),class:"me-1"},null,8,["color"])):m("",!0),(Q=e.media)!=null&&Q.username?(u(),g("span",{key:3,class:C(["text-subtitle-2 me-4",L()])},f((W=e.media)==null?void 0:W.username),3)):m("",!0)])]}),_:1}),s($)?(u(),p(F,{key:0,class:"absolute right-0 bottom-0 d-flex align-center p-2 text-gray-300"},{default:l(()=>[t(D,{icon:"mdi-download",class:"me-1"}),R(" "+f(s($)),1)]),_:1})):m("",!0),j()>0?(u(),p(ke,{key:1,"model-value":j(),"bg-color":"success",color:"success"},null,8,["model-value"])):m("",!0)]),_:1},8,["class"])),t(Le,{modelValue:s(c),"onUpdate:modelValue":a[8]||(a[8]=r=>ee(c)?c.value=r:null),"max-width":"50rem",persistent:"",scrollable:""},{default:l(()=>{var r;return[t(Y,{title:`订阅 - ${(r=e.media)==null?void 0:r.name}`},{default:l(()=>[t(F,{class:"pt-2"},{default:l(()=>[t(xe,{onSubmit:we(()=>{},["prevent"])},{default:l(()=>[t(M,null,{default:l(()=>{var n,V;return[t(y,{cols:"12",md:"6"},{default:l(()=>[t(T,{modelValue:s(o).keyword,"onUpdate:modelValue":a[0]||(a[0]=v=>s(o).keyword=v),label:"搜索关键词"},null,8,["modelValue"])]),_:1}),((n=e.media)==null?void 0:n.type)==="电视剧"?(u(),p(y,{key:0,cols:"12",md:"3"},{default:l(()=>[t(T,{modelValue:s(o).total_episode,"onUpdate:modelValue":a[1]||(a[1]=v=>s(o).total_episode=v),label:"总集数",rules:[s(J)]},null,8,["modelValue","rules"])]),_:1})):m("",!0),((V=e.media)==null?void 0:V.type)==="电视剧"?(u(),p(y,{key:1,cols:"12",md:"3"},{default:l(()=>[t(T,{modelValue:s(o).start_episode,"onUpdate:modelValue":a[2]||(a[2]=v=>s(o).start_episode=v),label:"开始集数",rules:[s(J)]},null,8,["modelValue","rules"])]),_:1})):m("",!0)]}),_:1}),t(M,null,{default:l(()=>[t(y,{cols:"12",md:"6"},{default:l(()=>[t(T,{modelValue:s(o).include,"onUpdate:modelValue":a[3]||(a[3]=n=>s(o).include=n),label:"包含（关键字、正则式）"},null,8,["modelValue"])]),_:1}),t(y,{cols:"12",md:"6"},{default:l(()=>[t(T,{modelValue:s(o).exclude,"onUpdate:modelValue":a[4]||(a[4]=n=>s(o).exclude=n),label:"排除（关键字、正则式）"},null,8,["modelValue"])]),_:1})]),_:1}),t(M,null,{default:l(()=>[t(y,{cols:"12"},{default:l(()=>[t(Ce,{modelValue:s(o).sites,"onUpdate:modelValue":a[5]||(a[5]=n=>s(o).sites=n),items:s(x),chips:"",label:"订阅站点",multiple:""},null,8,["modelValue","items"])]),_:1})]),_:1}),t(M,null,{default:l(()=>[t(y,{cols:"12"},{default:l(()=>[t(Se,{modelValue:s(o).best_version,"onUpdate:modelValue":a[6]||(a[6]=n=>s(o).best_version=n),label:"洗版"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),t($e,null,{default:l(()=>[t(q,{onClick:a[7]||(a[7]=n=>c.value=!1)},{default:l(()=>[R(" 取消 ")]),_:1}),t(Ie),t(q,{onClick:se},{default:l(()=>[R(" 确定 ")]),_:1})]),_:1})]),_:1},8,["title"])]}),_:1},8,["modelValue"])],64)}}}),Me={key:0,class:"mt-12 w-full text-center text-gray-500 text-sm flex flex-col items-center"},Ne={key:0,class:"grid gap-3 grid-subscribe-card p-1"},Ke=X({__name:"SubscribeListView",props:{type:String},setup(z){const B=z,e=_(!1),k=_([]);async function b(){try{k.value=await U.get("subscribe/"),e.value=!0}catch(o){console.error(o)}}he(b);const c=_(!1);function S(){c.value=!0,b(),c.value=!1}const x=Te(()=>k.value.filter(o=>o.type===B.type));return(o,$)=>(u(),g(N,null,[s(e)?m("",!0):(u(),g("div",Me,[s(e)?m("",!0):(u(),p(Ue,{key:0,size:"48",indeterminate:"",color:"primary"}))])),t(s(re),{modelValue:s(c),"onUpdate:modelValue":$[0]||($[0]=w=>ee(c)?c.value=w:null),onRefresh:S},{default:l(()=>[s(x).length>0?(u(),g("div",Ne,[(u(!0),g(N,null,Z(s(x),w=>(u(),p(Fe,{key:w.id,media:w,onRemove:b,onSave:b},null,8,["media"]))),128))])):m("",!0),s(x).length===0&&s(e)?(u(),p(ue,{key:1,"error-code":"404","error-title":"没有订阅","error-description":"请通过搜索添加电影、电视剧订阅。"})):m("",!0)]),_:1},8,["modelValue"])],64))}});export{Ke as _};
