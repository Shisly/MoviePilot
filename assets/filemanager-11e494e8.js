import{b as Se,a as ie}from"./index-fcc720d1.js";import{d as Y,r as k,p as A,e as de,o as r,f,i as t,m as e,ac as he,I as D,aC as We,aS as qe,V as _,a2 as Z,c as W,W as Q,a0 as X,j as l,Y as ee,K as V,t as F,M as H,$ as I,aF as Ee,z as _e,A as q,B as O,E as z,F as N,G as ke,L as te,aD as xe,aU as Ue,aV as je,a as ae,w as le,q as Pe,P as M,a1 as ue,af as He,ae as Ge,N as Je,a3 as Ke,ag as Qe,aW as $e,Z as Ye,H as Ze,Q as Xe,C as re,D as R,a8 as ge,R as et,S as tt,ai as lt,aa as at,a6 as ve,ax as Te}from"./index-d25b67b6.js";import{_ as ye}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as nt}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-56702d5a.js";import{n as Ie}from"./index-705cb9e8.js";import{a as ot}from"./formatters-16dfb57c.js";import{_ as st}from"./MediaInfoCard.vue_vue_type_script_setup_true_lang-e98cdafd.js";const Be=x=>(Ue("data-v-eec63a69"),x=x(),je(),x),rt=Be(()=>ae("div",{class:"flex-grow-1"},null,-1)),it=Be(()=>ae("div",{class:"flex-grow-1"},null,-1)),dt=Y({__name:"Toolbar",props:{storages:Array,storage:String,path:String,endpoints:Object,axios:Object},emits:["storagechanged","pathchanged","loading","foldercreated"],setup(x,{emit:y}){const a=x,U=k(!1),b=k(""),j=A(()=>{var u,m;let c="";const i=(u=a.path)==null?void 0:u.endsWith("/"),d=(m=a.path)==null?void 0:m.split("/").filter(v=>v);return(d==null?void 0:d.map((v,$)=>(c+=v+($<d.length-1||i?"/":""),{name:v,path:c})))??[]}),w=A(()=>{var c;return(c=a.storages)==null?void 0:c.find(i=>i.code===a.storage)});function T(c){a.storage!==c&&(y("storagechanged",c),y("pathchanged",""))}function P(c){y("pathchanged",c)}function L(){const c=j.value??[],i=(c==null?void 0:c.length)===1?"/":c[c.length-2].path;P(i)}async function B(){var d,u,m;y("loading",!0);const i={url:(d=a.endpoints)==null?void 0:d.mkdir.url.replace(/{storage}/g,a.storage).replace(/{path}/g,encodeURIComponent(a.path+b.value)),method:((u=a.endpoints)==null?void 0:u.mkdir.method)||"post"};await((m=a.axios)==null?void 0:m.request(i)),U.value=!1,b.value="",y("loading",!1),y("foldercreated")}return(c,i)=>{const d=de("Icon"),u=de("IconBtn");return r(),f(xe,{flat:"",dense:""},{default:t(()=>[e(Ee,{class:"overflow-hidden"},{default:t(()=>{var m;return[(m=a.storages)!=null&&m.length||0>1?(r(),f(he,{key:0,"offset-y":""},{activator:t(({props:v})=>[e(D,We(qe(v)),{default:t(()=>[e(_,{icon:"mdi-arrow-down-drop-circle-outline"})]),_:2},1040)]),default:t(()=>[e(Z,null,{default:t(()=>[(r(!0),W(H,null,Q(x.storages,(v,$)=>{var g;return r(),f(X,{key:$,disabled:v.code===((g=l(w))==null?void 0:g.code),onClick:G=>T(v.code)},{prepend:t(()=>[e(d,{icon:v.icon},null,8,["icon"])]),default:t(()=>[e(ee,null,{default:t(()=>[V(F(v.name),1)]),_:2},1024)]),_:2},1032,["disabled","onClick"])}),128))]),_:1})]),_:1})):I("",!0),e(D,{variant:"text","input-value":x.path==="/",class:"px-1",onClick:i[0]||(i[0]=v=>P("/"))},{default:t(()=>{var v,$;return[e(_,{icon:(v=l(w))==null?void 0:v.icon,class:"mr-2"},null,8,["icon"]),V(" "+F(($=l(w))==null?void 0:$.name),1)]}),_:1},8,["input-value"]),(r(!0),W(H,null,Q(l(j),(v,$)=>(r(),f(D,{key:$,variant:"text","input-value":$===l(j).length-1,class:"px-1 d-none d-md-block",onClick:g=>P(v.path)},{default:t(()=>[e(_,{icon:" mdi-chevron-right"}),V(" "+F(v.name),1)]),_:2},1032,["input-value","onClick"]))),128))]}),_:1}),rt,l(j).length>0?(r(),f(u,{key:0,onClick:L},{default:t(()=>[e(_,{icon:"mdi-arrow-up-bold-outline"})]),_:1})):I("",!0),e(te,{modelValue:l(U),"onUpdate:modelValue":i[3]||(i[3]=m=>N(U)?U.value=m:null),"max-width":"50rem"},{activator:t(({props:m})=>[e(u,_e({title:"新建文件夹"},m),{default:t(()=>[e(_,{icon:"mdi-folder-plus-outline"})]),_:2},1040)]),default:t(()=>[e(q,{title:"新建文件夹"},{default:t(()=>[e(O,null,{default:t(()=>[e(z,{modelValue:l(b),"onUpdate:modelValue":i[1]||(i[1]=m=>N(b)?b.value=m:null),label:"名称"},null,8,["modelValue"])]),_:1}),e(ke,null,{default:t(()=>[it,e(D,{depressed:"",onClick:i[2]||(i[2]=m=>U.value=!1)},{default:t(()=>[V(" 取消 ")]),_:1}),e(D,{disabled:!l(b),depressed:"",onClick:B},{default:t(()=>[V(" 新建 ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}});const ut=ye(dt,[["__scopeId","data-v-eec63a69"]]),ct={class:"grow scroll-x"},pt=Y({__name:"Tree",props:{icons:Object,storage:String,path:String,endpoints:Object,axios:Object,refreshpending:Boolean},emits:["pathchanged","loading","refreshed"],setup(x,{emit:y}){const a=x,U=k([]),b=k([]),j=k([]),w=k("");function T(){U.value=[],j.value=[{type:"dir",path:"/",basename:"root",extension:"",name:"root",children:[],size:0}]}async function P(c){var m,v,$;y("loading",!0);const d={url:(m=a.endpoints)==null?void 0:m.list.url.replace(/{storage}/g,a.storage).replace(/{path}/g,c.path),method:((v=a.endpoints)==null?void 0:v.list.method)||"get"},u=await(($=a.axios)==null?void 0:$.request(d))??[];c.children=u.map(g=>(g.type==="dir"&&(g.children=[]),g)),y("loading",!1)}function L(c){let i="";b.value.length&&(i=b.value[0]),a.path!==i&&y("pathchanged",i)}function B(c){const i=[];for(i.push(j.value[0]);i.length>0;){const d=i.pop();if((d==null?void 0:d.path)===c)return d;if(d!=null&&d.children&&d.children.length)for(const u of d.children)i.push(u)}return null}return le(()=>a.storage,()=>{T()}),le(()=>a.path,()=>{a.path&&(b.value=[a.path],U.value.includes(a.path)||U.value.push(a.path))}),le(()=>a.refreshpending,async()=>{if(a.refreshpending&&a.path){const c=B(a.path);c&&(await P(c),y("refreshed"))}}),Pe(()=>{T()}),(c,i)=>{const d=de("VTreeview");return r(),f(q,{flat:"",width:"250","min-height":"500",class:"d-flex flex-column folders-tree-card"},{default:t(()=>[ae("div",ct,[e(d,{open:l(U),active:l(b),items:l(j),search:l(w),"load-children":P,"item-key":"path","item-text":"basename",dense:"",activatable:"",transition:"",class:"folders-tree","onUpdate:active":L},{prepend:t(({item:u,open:m})=>[u.type==="dir"?(r(),f(_,{key:0},{default:t(()=>[V(F(m?"mdi-folder-open-outline":"mdi-folder-outline"),1)]),_:2},1024)):a.icons?(r(),f(_,{key:1,icon:a.icons[u.extension.toLowerCase()]||a.icons.other},null,8,["icon"])):I("",!0)]),label:t(({item:u})=>[V(F(u.basename)+" ",1),u.type==="dir"?(r(),f(D,{key:0,icon:"",class:"ml-1",onClick:M(m=>P(u),["stop"])},{default:t(()=>[e(_,{class:"pa-0 mdi-18px",color:"grey lighten-1"},{default:t(()=>[V(" mdi-refresh ")]),_:1})]),_:2},1032,["onClick"])):I("",!0)]),_:1},8,["open","active","items","search"])]),e(ue),e(xe,{density:"compact"},{default:t(()=>[e(D,{icon:"",onClick:T},{default:t(()=>[e(_,{icon:"mdi-collapse-all-outline"})]),_:1})]),_:1})]),_:1})}}});const ft=ye(pt,[["__scopeId","data-v-5e129369"]]),Le=x=>(Ue("data-v-1805731d"),x=x(),je(),x),mt=Le(()=>ae("div",{class:"flex-grow-1"},null,-1)),gt=Le(()=>ae("div",{class:"flex-grow-1"},null,-1)),vt=Y({__name:"List",props:{icons:Object,storage:String,path:String,endpoints:Object,axios:Object,refreshpending:Boolean},emits:["loading","pathchanged","refreshed","filedeleted","renamed"],setup(x,{emit:y}){const a=x,U=He.useToast(),b=k(!0),j=Ge(),w=k(a.storage??""),T=k(a.axios??Se),P=k([]),L=k(""),B=k(!1),c=k(!1),i=k(!1),d=k("请稍候 ..."),u=k(0),m=k(),v=k(""),$=k(),g=Je({path:"",target:"",tmdbid:null,season:null,type_name:"",transfer_type:"",episode_format:"",episode_detail:"",episode_part:"",episode_offset:null,min_filesize:0}),G=k(),J=k(!1),Re=k(Array.from({length:51},(o,n)=>n).map(o=>({title:`第 ${o} 季`,value:o}))),ne=A(()=>P.value.filter(o=>o.type==="dir"&&o.basename.includes(L.value))),oe=A(()=>P.value.filter(o=>o.type==="file"&&o.basename.includes(L.value))),Ve=A(()=>{var o;return(o=a.path)==null?void 0:o.endsWith("/")}),E=A(()=>!Ve.value),be=A(()=>{var n,p;const o=(p=(n=a.path)==null?void 0:n.split(".").pop())==null?void 0:p.toLowerCase();return["png","jpg","jpeg","gif","bmp"].includes(o??"")});async function K(){var o,n;if(b.value=!0,y("loading",!0),Ve.value){const S={url:(o=a.endpoints)==null?void 0:o.list.url.replace(/{storage}/g,w.value).replace(/{path}/g,encodeURIComponent(a.path||"")),method:((n=a.endpoints)==null?void 0:n.list.method)||"get"};P.value=await T.value.request(S)??[]}y("loading",!1),b.value=!1}async function ce(o){var p,S;if(await j({title:"确认",content:`是否确认删除${o.type==="dir"?"目录":"文件"} ${o.basename}？`,confirmationText:"确认",cancellationText:"取消",dialogProps:{maxWidth:"50rem"}})){y("loading",!0);const h={url:(p=a.endpoints)==null?void 0:p.delete.url.replace(/{storage}/g,w.value).replace(/{path}/g,encodeURIComponent(o.path)),method:((S=a.endpoints)==null?void 0:S.delete.method)||"post"};await T.value.request(h),y("filedeleted"),y("loading",!1),K()}}function we(o){y("pathchanged",o)}function Fe(o){var s;if(!o)return;const n=ve.state.auth.token,S=`/api/v1/${((s=a.endpoints)==null?void 0:s.download.url.replace(/{storage}/g,w.value).replace(/{path}/g,encodeURIComponent(o))).slice(1)}&token=${n}`;window.open(S,"_blank")}function Oe(o){var S;if(!o)return"";const n=ve.state.auth.token;return`/api/v1/${((S=a.endpoints)==null?void 0:S.image.url.replace(/{storage}/g,w.value).replace(/{path}/g,encodeURIComponent(o))).slice(1)}&token=${n}`}function pe(o){$.value=o,v.value=o.name,B.value=!0}async function De(){var p,S,s,h;y("loading",!0);const n={url:(S=a.endpoints)==null?void 0:S.rename.url.replace(/{storage}/g,a.storage).replace(/{path}/g,encodeURIComponent(((p=$.value)==null?void 0:p.path)||"")).replace(/{newname}/g,encodeURIComponent(v.value)),method:((s=a.endpoints)==null?void 0:s.mkdir.method)||"post"};await((h=a.axios)==null?void 0:h.request(n)),B.value=!1,v.value="",y("loading",!1),y("renamed")}function fe(o){$.value=o,c.value=!0}async function ze(){var o;g.path=((o=$.value)==null?void 0:o.path)??"";try{c.value=!1,i.value=!0,Me(),ie.post("transfer/manual",{},{params:g}).then(n=>{var p,S;i.value=!1,Ne(),n.success?(U.success(`${(p=$.value)==null?void 0:p.name} 整理成功！`),K()):U.error(`${(S=$.value)==null?void 0:S.name} 整理失败：${n.message}！`)})}catch(n){console.log(n)}}le(()=>a.path,async()=>{P.value=[],G.value=void 0,J.value=!1,await K()}),le(()=>a.refreshpending,async()=>{a.refreshpending&&(await K(),y("refreshed"))});function Me(){d.value="请稍候 ...";const o=ve.state.auth.token;m.value=new EventSource(`/api/v1/system/progress/filetransfer?token=${o}`),m.value.onmessage=n=>{const p=JSON.parse(n.data);p&&(d.value=p.text,u.value=p.value)}}function Ne(){var o;(o=m.value)==null||o.close()}async function se(o){var n,p;try{i.value=!0,d.value=`正在识别 ${o} ...`,u.value=0,G.value=await ie.get("media/recognize_file",{params:{path:o}}),i.value=!1,G.value||U.error(`${o} 识别失败！`),J.value=!!((p=(n=G.value)==null?void 0:n.meta_info)!=null&&p.name)}catch(S){console.error(S)}}const Ce=k([{title:"识别",value:1,props:{prependIcon:"mdi-text-recognition",click:o=>{se(o.path||"")}}},{title:"重命名",value:2,props:{prependIcon:"mdi-rename",click:pe}},{title:"整理",value:3,props:{prependIcon:"mdi-folder-arrow-right",click:fe}},{title:"删除",value:4,props:{prependIcon:"mdi-delete-outline",color:"error",click:ce}}]);return Pe(()=>{K()}),(o,n)=>{const p=de("IconBtn"),S=nt;return r(),W(H,null,[e(q,{class:"d-flex flex-column"},{default:t(()=>[l(b)?(r(),f(O,{key:0,class:"text-center flex flex-col items-center"},{default:t(()=>[e(Ke,{size:"48",indeterminate:"",color:"primary"})]),_:1})):I("",!0),x.path?l(E)&&!l(be)?(r(),f(O,{key:2,class:"text-center break-all"},{default:t(()=>[V(" 文件: "+F(x.path),1)]),_:1})):l(E)&&l(be)?(r(),f(O,{key:3,class:"grow d-flex justify-center align-center"},{default:t(()=>[e(Qe,{src:Oe(x.path),"max-width":"100%","max-height":"100%"},null,8,["src"])]),_:1})):l(ne).length||l(oe).length?(r(),f(O,{key:4,class:"p-0"},{default:t(()=>[l(ne).length?(r(),f(Z,{key:0,subheader:""},{default:t(()=>[e($e,null,{default:t(()=>[V("目录")]),_:1}),(r(!0),W(H,null,Q(l(ne),(s,h)=>(r(),f(X,{key:h,class:"px-3 pe-1",onClick:C=>we(s.path)},{prepend:t(()=>[e(_,{icon:"mdi-folder-outline"})]),append:t(()=>[e(p,{class:"d-sm-none"},{default:t(()=>[e(_,{icon:"mdi-dots-vertical"}),e(he,{activator:"parent","close-on-content-click":""},{default:t(()=>[e(Z,null,{default:t(()=>[(r(!0),W(H,null,Q(l(Ce),(C,me)=>(r(),f(X,{key:me,variant:"plain","base-color":C.props.color,onClick:Ae=>C.props.click(s)},{prepend:t(()=>[e(_,{icon:C.props.prependIcon},null,8,["icon"])]),default:t(()=>[e(ee,{textContent:F(C.title)},null,8,["textContent"])]),_:2},1032,["base-color","onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024),e(p,{class:"d-none d-sm-block",onClick:M(C=>se(s.path),["stop"])},{default:t(()=>[e(_,{icon:"mdi-text-recognition"})]),_:2},1032,["onClick"]),e(p,{class:"d-none d-sm-block",onClick:M(C=>pe(s),["stop"])},{default:t(()=>[e(_,{icon:"mdi-rename"})]),_:2},1032,["onClick"]),e(p,{class:"d-none d-sm-block",onClick:M(C=>fe(s),["stop"])},{default:t(()=>[e(_,{icon:"mdi-folder-arrow-right"})]),_:2},1032,["onClick"]),e(p,{class:"d-none d-sm-block",onClick:M(C=>ce(s),["stop"])},{default:t(()=>[e(_,{icon:"mdi-delete-outline"})]),_:2},1032,["onClick"])]),default:t(()=>[e(ee,{textContent:F(s.name)},null,8,["textContent"])]),_:2},1032,["onClick"]))),128))]),_:1})):I("",!0),l(ne).length&&l(oe).length?(r(),f(ue,{key:1})):I("",!0),l(oe).length?(r(),f(Z,{key:2,subheader:""},{default:t(()=>[e($e,null,{default:t(()=>[V("文件")]),_:1}),(r(!0),W(H,null,Q(l(oe),(s,h)=>(r(),f(X,{key:h,class:"pl-3 pe-1",onClick:C=>we(s.path)},{prepend:t(()=>{var C;return[a.icons?(r(),f(_,{key:0,icon:a.icons[s.extension.toLowerCase()]||((C=a.icons)==null?void 0:C.other)},null,8,["icon"])):I("",!0)]}),append:t(()=>[e(p,{class:"d-sm-none"},{default:t(()=>[e(_,{icon:"mdi-dots-vertical"}),e(he,{activator:"parent","close-on-content-click":""},{default:t(()=>[e(Z,null,{default:t(()=>[(r(!0),W(H,null,Q(l(Ce),(C,me)=>(r(),f(X,{key:me,variant:"plain","base-color":C.props.color,onClick:Ae=>C.props.click(s)},{prepend:t(()=>[e(_,{icon:C.props.prependIcon},null,8,["icon"])]),default:t(()=>[e(ee,{textContent:F(C.title)},null,8,["textContent"])]),_:2},1032,["base-color","onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024),e(p,{class:"d-none d-sm-block",onClick:M(C=>se(s.path),["stop"])},{default:t(()=>[e(_,{icon:"mdi-text-recognition"})]),_:2},1032,["onClick"]),e(p,{class:"d-none d-sm-block",onClick:M(C=>pe(s),["stop"])},{default:t(()=>[e(_,{icon:"mdi-rename"})]),_:2},1032,["onClick"]),e(p,{class:"d-none d-sm-block",onClick:M(C=>fe(s),["stop"])},{default:t(()=>[e(_,{icon:"mdi-folder-arrow-right"})]),_:2},1032,["onClick"]),e(p,{class:"d-none d-sm-block",onClick:M(C=>ce(s),["stop"])},{default:t(()=>[e(_,{icon:"mdi-delete-outline"})]),_:2},1032,["onClick"])]),default:t(()=>[e(ee,{textContent:F(s.name)},null,8,["textContent"]),e(Ye,null,{default:t(()=>[V(F(l(ot)(s.size)),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):I("",!0)]),_:1})):l(L)?(r(),f(O,{key:5,class:"grow d-flex justify-center align-center grey--text py-5"},{default:t(()=>[V(" 没有目录或文件 ")]),_:1})):l(b)?I("",!0):(r(),f(O,{key:6,class:"grow d-flex justify-center align-center grey--text py-5"},{default:t(()=>[V(" 空目录 ")]),_:1})):(r(),f(O,{key:1,class:"grow d-flex justify-center align-center grey--text"},{default:t(()=>[V(" 选择目录或文件 ")]),_:1})),x.path?(r(),f(ue,{key:7})):I("",!0),l(b)?I("",!0):(r(),f(xe,{key:8,density:"compact",flat:"",color:"gray"},{default:t(()=>[l(E)?I("",!0):(r(),f(z,{key:0,modelValue:l(L),"onUpdate:modelValue":n[0]||(n[0]=s=>N(L)?L.value=s:null),"hide-details":"",flat:"",density:"compact",variant:"solo-filled",placeholder:"搜索 ...","prepend-inner-icon":"mdi-filter-outline",class:"me-2"},null,8,["modelValue"])),l(E)?(r(),f(Ze,{key:1})):I("",!0),l(E)?(r(),f(p,{key:2,onClick:n[1]||(n[1]=s=>se(a.path||""))},{default:t(()=>[e(_,{color:"primary"},{default:t(()=>[V(" mdi-text-recognition ")]),_:1})]),_:1})):I("",!0),l(E)?(r(),f(p,{key:3,onClick:n[2]||(n[2]=s=>Fe(a.path||""))},{default:t(()=>[e(_,{color:"primary"},{default:t(()=>[V(" mdi-download ")]),_:1})]),_:1})):I("",!0),l(E)?I("",!0):(r(),f(p,{key:4,onClick:K},{default:t(()=>[e(_,{color:"primary"},{default:t(()=>[V(" mdi-refresh ")]),_:1})]),_:1}))]),_:1}))]),_:1}),e(te,{modelValue:l(B),"onUpdate:modelValue":n[5]||(n[5]=s=>N(B)?B.value=s:null),"max-width":"50rem"},{activator:t(({props:s})=>[e(p,_e({title:"重命名"},s),{default:t(()=>[e(_,{icon:"mdi-rename-outline"})]),_:2},1040)]),default:t(()=>[e(q,{title:"重命名"},{default:t(()=>[e(O,null,{default:t(()=>[e(z,{modelValue:l(v),"onUpdate:modelValue":n[3]||(n[3]=s=>N(v)?v.value=s:null),label:"名称"},null,8,["modelValue"])]),_:1}),e(ke,null,{default:t(()=>[mt,e(D,{depressed:"",onClick:n[4]||(n[4]=s=>B.value=!1)},{default:t(()=>[V(" 取消 ")]),_:1}),e(D,{disabled:!l(v),depressed:"",onClick:De},{default:t(()=>[V(" 重命名 ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(te,{modelValue:l(c),"onUpdate:modelValue":n[17]||(n[17]=s=>N(c)?c.value=s:null),"max-width":"800",scrollable:""},{activator:t(({props:s})=>[e(p,_e({title:"整理"},s),{default:t(()=>[e(_,{icon:"mdi-folder-arrow-right-outline"})]),_:2},1040)]),default:t(()=>{var s;return[e(q,{title:`文件整理 - ${(s=l($))==null?void 0:s.name}`},{default:t(()=>[e(O,{class:"pt-2"},{default:t(()=>[e(Xe,{onSubmit:M(()=>{},["prevent"])},{default:t(()=>[e(re,null,{default:t(()=>[e(R,{cols:"12",md:"8"},{default:t(()=>[e(z,{modelValue:l(g).target,"onUpdate:modelValue":n[6]||(n[6]=h=>l(g).target=h),label:"目的路径"},null,8,["modelValue"])]),_:1}),e(R,{cols:"12",md:"4"},{default:t(()=>[e(ge,{modelValue:l(g).transfer_type,"onUpdate:modelValue":n[7]||(n[7]=h=>l(g).transfer_type=h),label:"整理方式",items:[{title:"默认",value:""},{title:"移动",value:"move"},{title:"复制",value:"copy"},{title:"硬链接",value:"link"},{title:"软链接",value:"softlink"}]},null,8,["modelValue"])]),_:1})]),_:1}),e(re,null,{default:t(()=>[e(R,{cols:"12",md:"4"},{default:t(()=>[e(ge,{modelValue:l(g).type_name,"onUpdate:modelValue":n[8]||(n[8]=h=>l(g).type_name=h),label:"类型",items:[{title:"请选择",value:""},{title:"电影",value:"电影"},{title:"电视剧",value:"电视剧"}]},null,8,["modelValue"])]),_:1}),e(R,{cols:"12",md:"4"},{default:t(()=>[e(z,{modelValue:l(g).tmdbid,"onUpdate:modelValue":n[9]||(n[9]=h=>l(g).tmdbid=h),label:"TMDBID",placeholder:"留空自动识别",rules:[l(Ie)]},null,8,["modelValue","rules"])]),_:1}),e(R,{cols:"12",md:"4"},{default:t(()=>[et(e(ge,{modelValue:l(g).season,"onUpdate:modelValue":n[10]||(n[10]=h=>l(g).season=h),modelModifiers:{number:!0},label:"季",items:l(Re)},null,8,["modelValue","items"]),[[tt,l(g).type_name==="电视剧"]])]),_:1})]),_:1}),e(re,null,{default:t(()=>[e(R,{cols:"12",md:"8"},{default:t(()=>[e(z,{modelValue:l(g).episode_format,"onUpdate:modelValue":n[11]||(n[11]=h=>l(g).episode_format=h),label:"集数定位",placeholder:"使用{ep}定位集数"},null,8,["modelValue"])]),_:1}),e(R,{cols:"12",md:"4"},{default:t(()=>[e(z,{modelValue:l(g).episode_detail,"onUpdate:modelValue":n[12]||(n[12]=h=>l(g).episode_detail=h),label:"指定集数",placeholder:"起始集,终止集，如1或1,2"},null,8,["modelValue"])]),_:1}),e(R,{cols:"12",md:"4"},{default:t(()=>[e(z,{modelValue:l(g).episode_part,"onUpdate:modelValue":n[13]||(n[13]=h=>l(g).episode_part=h),label:"指定Part",placeholder:"如part1"},null,8,["modelValue"])]),_:1}),e(R,{cols:"12",md:"4"},{default:t(()=>[e(z,{modelValue:l(g).episode_offset,"onUpdate:modelValue":n[14]||(n[14]=h=>l(g).episode_offset=h),modelModifiers:{number:!0},label:"集数偏移",placeholder:"如-10"},null,8,["modelValue"])]),_:1}),e(R,{cols:"12",md:"4"},{default:t(()=>[e(z,{modelValue:l(g).min_filesize,"onUpdate:modelValue":n[15]||(n[15]=h=>l(g).min_filesize=h),modelModifiers:{number:!0},label:"最小文件大小（MB）",rules:[l(Ie)],placeholder:"0"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(ke,null,{default:t(()=>[gt,e(D,{depressed:"",onClick:n[16]||(n[16]=h=>c.value=!1)},{default:t(()=>[V(" 取消 ")]),_:1}),e(D,{onClick:ze},{default:t(()=>[V(" 开始整理 ")]),_:1})]),_:1})]),_:1},8,["title"])]}),_:1},8,["modelValue"]),e(te,{modelValue:l(i),"onUpdate:modelValue":n[18]||(n[18]=s=>N(i)?i.value=s:null),scrim:!1,width:"400"},{default:t(()=>[e(q,{color:"primary"},{default:t(()=>[e(O,{class:"text-center"},{default:t(()=>[V(F(l(d))+" ",1),l(u)?(r(),f(lt,{key:0,color:"white",class:"mb-0 mt-1","model-value":l(u)},null,8,["model-value"])):I("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(te,{modelValue:l(J),"onUpdate:modelValue":n[20]||(n[20]=s=>N(J)?J.value=s:null),width:"800"},{default:t(()=>[e(q,null,{default:t(()=>[e(S,{onClick:n[19]||(n[19]=s=>J.value=!1)}),e(at,null,{default:t(()=>[e(st,{context:l(G)},null,8,["context"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}});const ht=ye(vt,[["__scopeId","data-v-1805731d"]]),_t=Y({__name:"FileBrowser",props:{storages:String,storage:String,path:String,tree:Boolean,endpoints:Object,axios:Object,axiosconfig:Object},emits:["pathchanged"],setup(x,{emit:y}){const a=x,U=[{name:"本地",code:"local",icon:"mdi-folder-multiple-outline"}],b={zip:"mdi-folder-zip-outline",rar:"mdi-folder-zip-outline",htm:"mdi-language-html5",html:"mdi-language-html5",js:"mdi-nodejs",json:"mdi-file-document-outline",md:"mdi-language-markdown-outline",pdf:"mdi-file-pdf",png:"mdi-file-image",jpg:"mdi-file-image",jpeg:"mdi-file-image",mp4:"mdi-filmstrip",mkv:"mdi-filmstrip",avi:"mdi-filmstrip",wmv:"mdi-filmstrip",mov:"mdi-filmstrip",txt:"mdi-file-document-outline",xls:"mdi-file-excel",other:"mdi-file-outline"},j=k(0),w=k("local"),T=k(!1),P=k(),L=A(()=>{var u;const d=(u=a.storages)==null?void 0:u.split(",");return U.filter(m=>d==null?void 0:d.includes(m.code))});function B(d){}function c(d){w.value=d}function i(d){y("pathchanged",d)}return Te(()=>{w.value=a.storage??"local",P.value=a.axios??Se.create(a.axiosconfig)}),(d,u)=>(r(),f(q,{class:"mx-auto",loading:l(j)>0},{default:t(()=>[e(ut,{path:a.path,storages:l(L),storage:l(w),endpoints:a.endpoints,axios:l(P),onStoragechanged:c,onPathchanged:i,onFoldercreated:u[0]||(u[0]=m=>T.value=!0)},null,8,["path","storages","storage","endpoints","axios"]),e(re,{"no-gutters":""},{default:t(()=>[x.tree?(r(),f(R,{key:0,sm:"auto",class:"d-none d-md-block"},{default:t(()=>[e(ft,{path:a.path,storage:l(w),icons:b,endpoints:x.endpoints,axios:l(P),refreshpending:l(T),onPathchanged:i,onLoading:B,onRefreshed:u[1]||(u[1]=m=>T.value=!1)},null,8,["path","storage","endpoints","axios","refreshpending"])]),_:1})):I("",!0),x.tree?(r(),f(ue,{key:1,vertical:""})):I("",!0),e(R,null,{default:t(()=>[e(ht,{path:a.path,storage:l(w),icons:b,endpoints:x.endpoints,axios:l(P),refreshpending:l(T),onPathchanged:i,onLoading:B,onRefreshed:u[2]||(u[2]=m=>T.value=!1),onFiledeleted:u[3]||(u[3]=m=>T.value=!0),onRenamed:u[4]||(u[4]=m=>T.value=!0)},null,8,["path","storage","endpoints","axios","refreshpending"])]),_:1})]),_:1})]),_:1},8,["loading"]))}}),kt=Y({__name:"FileBrowserView",setup(x){const y={list:{url:"/filebrowser/list?path={path}",method:"get"},mkdir:{url:"/filebrowser/mkdir?path={path}",method:"get"},delete:{url:"/filebrowser/delete?path={path}",method:"get"},download:{url:"/filebrowser/download?path={path}",method:"get"},image:{url:"/filebrowser/image?path={path}",method:"get"},rename:{url:"/filebrowser/rename?path={path}&new_name={newname}",method:"get"}},a=k("/");async function U(){var j;try{const w=await ie.get("system/env");w.success&&(a.value=((j=w.data)==null?void 0:j.DOWNLOAD_PATH)||"/"),a.value&&!a.value.endsWith("/")&&(a.value+="/")}catch(w){console.log(w)}}function b(j){a.value=j}return Te(async()=>{await U()}),(j,w)=>(r(),W("div",null,[e(_t,{storages:"local",tree:!1,path:l(a),endpoints:y,axios:l(ie),onPathchanged:b},null,8,["path","axios"])]))}}),It=Y({__name:"filemanager",setup(x){return(y,a)=>(r(),f(kt))}});export{It as default};
