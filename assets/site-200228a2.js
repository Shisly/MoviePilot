import{_ as _e}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-9ba1b878.js";import{d as ue,r as p,af as ye,M as be,q as Ne,e as pe,o as V,c as F,m as e,i as t,W as Ee,ag as Me,j as l,aa as he,ab as Ke,O as L,J as v,t as b,az as je,f as k,_ as x,A as H,V as U,a9 as O,aA as Q,a0 as qe,G as Y,I as B,z as W,P as re,B as D,C as c,D as g,F as He,H as ne,E as G,K as Z,a7 as ee,N as ge,aB as le,a as P,L as te,U as we,a3 as fe,n as Oe,ac as We,a1 as Ge,$ as Ve,X as ve,ax as Je,a2 as Xe,at as Qe,au as Ye}from"./index-d3947ac1.js";import{a as A}from"./index-b9b8a38f.js";import{f as Ze}from"./formatters-16dfb57c.js";import{r as M,n as h}from"./index-705cb9e8.js";import{E as el}from"./ExistIcon-8612d5d2.js";import{_ as ll}from"./NoDataFound.vue_vue_type_script_setup_true_lang-3af77c4b.js";import"./_plugin-vue_export-helper-c27b6911.js";const tl={class:"text-high-emphasis pt-1"},al={class:"text-sm my-1"},ol={class:"text-sm"},sl={class:"text-nowrap whitespace-nowrap"},rl={class:"me-n3"},nl=ue({__name:"SiteCard",props:{site:Object,width:String,height:String},emits:["remove","update"],setup(ae,{emit:R}){const m=ae,S=p(!1),N=p(""),_=ye.useToast(),C=p("测试"),K=p(!1),j=p("更新"),s=p(!1),$=p(!1),I=p(!1),z=p(!1),w=[{title:"标题",key:"title",sortable:!1},{title:"时间",key:"pubdate",sortable:!0},{title:"大小",key:"size",sortable:!0},{title:"做种",key:"seeders",sortable:!0},{title:"下载",key:"peers",sortable:!0},{title:"",key:"actions",sortable:!1}],d=p([]),oe=p(""),r=p(!1),ke=p(0),se=p(25),T=p({username:"",password:""}),xe=[{title:"启用",value:!0},{title:"停用",value:!1}],Ce=p(Array.from({length:50},(i,a)=>a+1).map(i=>({title:i,value:i}))),n=be(m.site??{});n.proxy=n.proxy===1,n.render=n.render===1;function $e(i){window.open(i,"_blank")}async function Ue(i){window.open(i,"_blank")}async function Se(){var i;try{N.value=(await A.get(`site/icon/${(i=m.site)==null?void 0:i.id}`)).data.icon}catch(a){console.error(a)}}async function Ie(){var i,a,y;try{C.value="测试中 ...",K.value=!0;const f=await A.get(`site/test/${(i=m.site)==null?void 0:i.id}`);f.success?_.success(`${(a=m.site)==null?void 0:a.name} 连通性测试成功，可正常使用！`):_.error(`${(y=m.site)==null?void 0:y.name} 连通性测试失败：${f.message}`),C.value="测试",K.value=!1}catch(f){console.error(f)}}async function Be(){$.value=!0}async function De(){I.value=!0}async function Te(){z.value=!0,Le()}async function ie(){var i,a,y;try{if(!T.value.username||!T.value.password)return;$.value=!1,j.value="更新中 ...",s.value=!0;const f=await A.get(`site/cookie/${(i=m.site)==null?void 0:i.id}`,{params:{username:T.value.username,password:T.value.password}});f.success?_.success(`${(a=m.site)==null?void 0:a.name} 更新Cookie & UA 成功！`):_.error(`${(y=m.site)==null?void 0:y.name} 更新失败：${f.message}`),j.value="更新",s.value=!1}catch(f){console.error(f)}}async function Pe(){var i,a,y,f;try{I.value=!1;const E=await A.delete(`site/${(i=m.site)==null?void 0:i.id}`);E.success?(_.success(`${(a=m.site)==null?void 0:a.name} 删除成功！`),R("remove")):_.error(`${(y=m.site)==null?void 0:y.name} 删除失败：${E.message}`)}catch(E){_.error(`${(f=m.site)==null?void 0:f.name} 删除失败！`),console.error(E)}}async function Ae(){var i,a,y;try{I.value=!1;const f=await A.put("site/",n);f.success?(_.success(`${(i=m.site)==null?void 0:i.name} 更新成功！`),R("update")):_.error(`${(a=m.site)==null?void 0:a.name} 更新失败：${f.message}`)}catch(f){_.error(`${(y=m.site)==null?void 0:y.name} 更新失败！`),console.error(f)}}function ze(i,a){return i===0?"text-white bg-lime-500":i<1?"text-white bg-green-500":a!==1?"text-white bg-sky-500":"text-white bg-gray-500"}async function Le(){var i;r.value=!0;try{d.value=await A.get(`site/resource/${(i=m.site)==null?void 0:i.id}`),r.value=!1}catch(a){console.error(a)}}function Fe(){var i;window.open((i=m.site)==null?void 0:i.url,"_blank")}return Ne(()=>{Se()}),(i,a)=>{const y=_e,f=pe("IconBtn"),E=pe("VDataTable");return V(),F(te,null,[e(W,{height:m.height,width:m.width,flat:!l(n).is_active,class:"overflow-hidden",onClick:De},{image:t(()=>[e(Ee,{class:"absolute right-2 bottom-2 rounded",variant:"flat",rounded:"0"},{default:t(()=>[e(Me,{src:l(N)},null,8,["src"])]),_:1})]),default:t(()=>[e(he,null,{default:t(()=>[e(Ke,{class:"font-bold",onClick:L(Fe,["stop"])},{default:t(()=>{var u;return[v(b((u=m.site)==null?void 0:u.name),1)]}),_:1},8,["onClick"]),e(je,null,{default:t(()=>{var u;return[v(b((u=m.site)==null?void 0:u.url),1)]}),_:1})]),_:1}),l(n).is_active?(V(),k(el,{key:0})):x("",!0),e(H,{class:"py-2"},{default:t(()=>[l(n).render?(V(),k(Q,{key:0,text:"浏览器仿真"},{activator:t(({props:u})=>[e(U,O({color:"primary",class:"me-2"},u,{icon:"mdi-apple-safari"}),null,16)]),_:1})):x("",!0),l(n).proxy?(V(),k(Q,{key:1,text:"代理"},{activator:t(({props:u})=>[e(U,O({color:"primary",class:"me-2"},u,{icon:"mdi-network-outline"}),null,16)]),_:1})):x("",!0),l(n).limit_interval?(V(),k(Q,{key:2,text:"流控"},{activator:t(({props:u})=>[e(U,O({color:"primary",class:"me-2"},u,{icon:"mdi-speedometer"}),null,16)]),_:1})):x("",!0),l(n).filter?(V(),k(Q,{key:3,text:"过滤"},{activator:t(({props:u})=>[e(U,O({color:"primary",class:"me-2"},u,{icon:"mdi-filter-cog-outline"}),null,16)]),_:1})):x("",!0)]),_:1}),e(qe,{class:"opacity-75",style:{"border-color":"rgba(var(--v-theme-on-background), var(--v-selected-opacity))"}}),e(Y,null,{default:t(()=>{var u;return[(u=m.site)!=null&&u.public?x("",!0):(V(),k(B,{key:0,disabled:l(s),onClick:L(Be,["stop"])},{prepend:t(()=>[e(U,{icon:"mdi-refresh"})]),default:t(()=>[v(" "+b(l(j)),1)]),_:1},8,["disabled","onClick"])),e(B,{disabled:l(K),onClick:L(Ie,["stop"])},{prepend:t(()=>[e(U,{icon:"mdi-link"})]),default:t(()=>[v(" "+b(l(C)),1)]),_:1},8,["disabled","onClick"]),e(B,{onClick:L(Te,["stop"])},{prepend:t(()=>[e(U,{icon:"mdi-web"})]),default:t(()=>[v(" 浏览 ")]),_:1},8,["onClick"])]}),_:1})]),_:1},8,["height","width","flat"]),e(Z,{modelValue:l($),"onUpdate:modelValue":a[3]||(a[3]=u=>G($)?$.value=u:null),"max-width":"50rem"},{default:t(()=>[e(W,{title:"更新站点Cookie & UA"},{default:t(()=>[e(H,null,{default:t(()=>[e(re,{onSubmit:L(()=>{},["prevent"])},{default:t(()=>[e(D,null,{default:t(()=>[e(c,{cols:"12",md:"6"},{default:t(()=>[e(g,{modelValue:l(T).username,"onUpdate:modelValue":a[0]||(a[0]=u=>l(T).username=u),label:"用户名",rules:[l(M)]},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",md:"6"},{default:t(()=>[e(g,{modelValue:l(T).password,"onUpdate:modelValue":a[1]||(a[1]=u=>l(T).password=u),label:"密码",type:l(S)?"text":"password","append-inner-icon":l(S)?"mdi-eye-off-outline":"mdi-eye-outline",rules:[l(M)],"onClick:appendInner":a[2]||(a[2]=u=>S.value=!l(S)),onKeydown:He(ie,["enter"])},null,8,["modelValue","type","append-inner-icon","rules","onKeydown"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(Y,null,{default:t(()=>[e(ne),e(B,{onClick:ie},{default:t(()=>[v(" 开始更新 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Z,{modelValue:l(I),"onUpdate:modelValue":a[16]||(a[16]=u=>G(I)?I.value=u:null),"max-width":"50rem",persistent:"",scrollable:""},{default:t(()=>{var u;return[e(W,{title:`编辑站点 - ${(u=m.site)==null?void 0:u.name}`},{default:t(()=>[e(H,{class:"pt-2"},{default:t(()=>[e(y,{onClick:a[4]||(a[4]=o=>I.value=!1)}),e(re,{onSubmit:L(()=>{},["prevent"])},{default:t(()=>[e(D,null,{default:t(()=>[e(c,{cols:"12",md:"6"},{default:t(()=>[e(g,{modelValue:l(n).url,"onUpdate:modelValue":a[5]||(a[5]=o=>l(n).url=o),label:"站点地址",rules:[l(M)]},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",md:"3"},{default:t(()=>[e(ee,{modelValue:l(n).pri,"onUpdate:modelValue":a[6]||(a[6]=o=>l(n).pri=o),label:"优先级",items:l(Ce),rules:[l(M)]},null,8,["modelValue","items","rules"])]),_:1}),e(c,{cols:"12",md:"3"},{default:t(()=>[e(ee,{modelValue:l(n).is_active,"onUpdate:modelValue":a[7]||(a[7]=o=>l(n).is_active=o),items:xe,label:"状态"},null,8,["modelValue"])]),_:1})]),_:1}),e(D,null,{default:t(()=>[e(c,{cols:"12"},{default:t(()=>[e(g,{modelValue:l(n).rss,"onUpdate:modelValue":a[8]||(a[8]=o=>l(n).rss=o),label:"RSS地址"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12"},{default:t(()=>[e(ge,{modelValue:l(n).cookie,"onUpdate:modelValue":a[9]||(a[9]=o=>l(n).cookie=o),label:"站点Cookie"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12"},{default:t(()=>[e(g,{modelValue:l(n).ua,"onUpdate:modelValue":a[10]||(a[10]=o=>l(n).ua=o),label:"站点User-Agent"},null,8,["modelValue"])]),_:1})]),_:1}),e(D,null,{default:t(()=>[e(c,{cols:"12",md:"4"},{default:t(()=>[e(g,{modelValue:l(n).limit_interval,"onUpdate:modelValue":a[11]||(a[11]=o=>l(n).limit_interval=o),label:"单位周期（秒）",rules:[l(h)]},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",md:"4"},{default:t(()=>[e(g,{modelValue:l(n).limit_seconds,"onUpdate:modelValue":a[12]||(a[12]=o=>l(n).limit_seconds=o),label:"访问次数",rules:[l(h)]},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",md:"4"},{default:t(()=>[e(g,{modelValue:l(n).limit_seconds,"onUpdate:modelValue":a[13]||(a[13]=o=>l(n).limit_seconds=o),label:"访问间隔（秒）",rules:[l(h)]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(D,null,{default:t(()=>[e(c,{cols:"12",md:"6"},{default:t(()=>[e(le,{modelValue:l(n).proxy,"onUpdate:modelValue":a[14]||(a[14]=o=>l(n).proxy=o),label:"代理"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",md:"6"},{default:t(()=>[e(le,{modelValue:l(n).render,"onUpdate:modelValue":a[15]||(a[15]=o=>l(n).render=o),label:"仿真"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(Y,null,{default:t(()=>[e(B,{color:"error",onClick:Pe},{default:t(()=>[v(" 删除 ")]),_:1}),e(ne),e(B,{onClick:Ae},{default:t(()=>[v(" 确定 ")]),_:1})]),_:1})]),_:1},8,["title"])]}),_:1},8,["modelValue"]),e(Z,{modelValue:l(z),"onUpdate:modelValue":a[19]||(a[19]=u=>G(z)?z.value=u:null),"max-width":"80rem",scrollable:""},{default:t(()=>{var u;return[e(W,{title:`浏览站点 - ${(u=m.site)==null?void 0:u.name}`},{default:t(()=>[e(y,{onClick:a[17]||(a[17]=o=>z.value=!1)}),e(H,{class:"pt-2"},{default:t(()=>[e(E,{"items-per-page":l(se),"onUpdate:itemsPerPage":a[18]||(a[18]=o=>G(se)?se.value=o:null),headers:w,items:l(d),"items-length":l(ke),search:l(oe),loading:l(r),density:"compact","item-value":"title","return-object":"","fixed-header":"","items-per-page-text":"每页条数","page-text":"{0}-{1} 共 {2} 条"},{"item.title":t(({item:o})=>{var q,J,de,me,ce;return[P("div",tl,b(o.raw.title),1),P("div",al,b(o.raw.description),1),(V(!0),F(te,null,we((q=o.raw)==null?void 0:q.labels,(X,Re)=>(V(),k(fe,{key:Re,variant:"elevated",size:"small",color:"primary",class:"me-1 mb-1"},{default:t(()=>[v(b(X),1)]),_:2},1024))),128)),((J=o.raw)==null?void 0:J.downloadvolumefactor)!==1||((de=o.raw)==null?void 0:de.uploadvolumefactor)!==1?(V(),k(fe,{key:0,class:Oe([ze((me=o.raw)==null?void 0:me.downloadvolumefactor,(ce=o.raw)==null?void 0:ce.uploadvolumefactor),"me-1 mb-1"]),variant:"elevated",size:"small"},{default:t(()=>{var X;return[v(b((X=o.raw)==null?void 0:X.volume_factor),1)]}),_:2},1032,["class"])):x("",!0)]}),"item.pubdate":t(({item:o})=>[P("div",null,b(o.raw.date_elapsed),1),P("div",ol,b(o.raw.pubdate),1)]),"item.size":t(({item:o})=>[P("div",sl,b(l(Ze)(o.raw.size)),1)]),"item.seeders":t(({item:o})=>[P("div",null,b(o.raw.seeders),1)]),"item.peers":t(({item:o})=>[P("div",null,b(o.raw.peers),1)]),"item.actions":t(({item:o})=>[P("div",rl,[e(f,null,{default:t(()=>[e(U,{icon:"mdi-dots-vertical"}),e(We,{activator:"parent","close-on-content-click":""},{default:t(()=>[e(Ge,null,{default:t(()=>{var q;return[e(Ve,{variant:"plain",onClick:J=>$e(o.raw.page_url)},{prepend:t(()=>[e(U,{icon:"mdi-information"})]),default:t(()=>[e(ve,null,{default:t(()=>[v("查看详情")]),_:1})]),_:2},1032,["onClick"]),(q=o.raw.enclosure)!=null&&q.startsWith("http")?(V(),k(Ve,{key:0,variant:"plain",onClick:J=>Ue(o.raw.enclosure)},{prepend:t(()=>[e(U,{icon:"mdi-download"})]),default:t(()=>[e(ve,null,{default:t(()=>[v("下载种子文件")]),_:1})]),_:2},1032,["onClick"])):x("",!0)]}),_:2},1024)]),_:2},1024)]),_:2},1024)])]),"no-data":t(()=>[v(" 没有数据 ")]),_:1},8,["items-per-page","items","items-length","search","loading"])]),_:1})]),_:1},8,["title"])]}),_:1},8,["modelValue"])],64)}}});const ul={key:0,class:"mt-12 w-full text-center text-gray-500 text-sm flex flex-col items-center"},il={key:1,class:"grid gap-3 grid-site-card"},dl=ue({__name:"SiteCardListView",setup(ae){const R=ye.useToast(),m=p([]),S=p(!1),N=p("新增站点"),_=p(!1),C=p(!1),K=[{title:"启用",value:!0},{title:"停用",value:!1}],j=p(Array.from({length:50},(w,d)=>d+1).map(w=>({title:w,value:w}))),s=be({id:0,url:"",pri:1,is_active:!0,cookie:"",ua:"",limit_interval:0,limit_seconds:0,limit_count:0,proxy:0,render:0,name:"",domain:""});async function $(){try{m.value=await A.get("site/"),S.value=!0}catch(w){console.error(w)}}async function I(){if(s.url){Qe(),N.value="新增中...",_.value=!0;try{const w=await A.post("site/",s);w.success?(R.success("新增站点成功"),$()):R.error(`新增站点失败：${w.message}`),C.value=!1}catch(w){console.error(w)}Ye(),N.value="新增站点",_.value=!1}}function z(){s.id=0,s.url="",s.pri=1,s.is_active=!0,s.cookie="",s.ua="",s.limit_interval=0,s.limit_seconds=0,s.limit_count=0,s.proxy=0,s.render=0,s.name="",s.domain="",C.value=!0}return Je($),(w,d)=>{const oe=_e;return V(),F(te,null,[l(S)?x("",!0):(V(),F("div",ul,[l(S)?x("",!0):(V(),k(Xe,{key:0,size:"48",indeterminate:"",color:"primary"}))])),l(m).length>0?(V(),F("div",il,[(V(!0),F(te,null,we(l(m),r=>(V(),k(nl,{key:r.id,site:r,onRemove:$,onUpdate:$},null,8,["site"]))),128))])):x("",!0),l(m).length===0&&l(S)?(V(),k(ll,{key:2,"error-code":"404","error-title":"没有站点","error-description":"已添加并支持的站点将会在这里显示。"})):x("",!0),e(Z,{modelValue:l(C),"onUpdate:modelValue":d[12]||(d[12]=r=>G(C)?C.value=r:null),"max-width":"50rem",persistent:"",scrollable:""},{activator:t(({props:r})=>[e(B,O({icon:"mdi-plus"},r,{size:"x-large",class:"fixed right-5 bottom-5"}),null,16)]),default:t(()=>[e(W,{title:"新增站点"},{default:t(()=>[e(oe,{onClick:d[0]||(d[0]=r=>C.value=!1)}),e(H,{class:"pt-2"},{default:t(()=>[e(re,{onSubmit:L(()=>{},["prevent"])},{default:t(()=>[e(D,null,{default:t(()=>[e(c,{cols:"12",md:"6"},{default:t(()=>[e(g,{modelValue:l(s).url,"onUpdate:modelValue":d[1]||(d[1]=r=>l(s).url=r),label:"站点地址",rules:[l(M)]},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",md:"3"},{default:t(()=>[e(ee,{modelValue:l(s).pri,"onUpdate:modelValue":d[2]||(d[2]=r=>l(s).pri=r),label:"优先级",items:l(j),rules:[l(M)]},null,8,["modelValue","items","rules"])]),_:1}),e(c,{cols:"12",md:"3"},{default:t(()=>[e(ee,{modelValue:l(s).is_active,"onUpdate:modelValue":d[3]||(d[3]=r=>l(s).is_active=r),items:K,label:"状态"},null,8,["modelValue"])]),_:1})]),_:1}),e(D,null,{default:t(()=>[e(c,{cols:"12"},{default:t(()=>[e(g,{modelValue:l(s).rss,"onUpdate:modelValue":d[4]||(d[4]=r=>l(s).rss=r),label:"RSS地址"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12"},{default:t(()=>[e(ge,{modelValue:l(s).cookie,"onUpdate:modelValue":d[5]||(d[5]=r=>l(s).cookie=r),label:"站点Cookie"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12"},{default:t(()=>[e(g,{modelValue:l(s).ua,"onUpdate:modelValue":d[6]||(d[6]=r=>l(s).ua=r),label:"站点User-Agent"},null,8,["modelValue"])]),_:1})]),_:1}),e(D,null,{default:t(()=>[e(c,{cols:"12",md:"4"},{default:t(()=>[e(g,{modelValue:l(s).limit_interval,"onUpdate:modelValue":d[7]||(d[7]=r=>l(s).limit_interval=r),label:"单位周期（秒）",rules:[l(h)]},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",md:"4"},{default:t(()=>[e(g,{modelValue:l(s).limit_seconds,"onUpdate:modelValue":d[8]||(d[8]=r=>l(s).limit_seconds=r),label:"访问次数",rules:[l(h)]},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",md:"4"},{default:t(()=>[e(g,{modelValue:l(s).limit_seconds,"onUpdate:modelValue":d[9]||(d[9]=r=>l(s).limit_seconds=r),label:"访问间隔（秒）",rules:[l(h)]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(D,null,{default:t(()=>[e(c,{cols:"12",md:"6"},{default:t(()=>[e(le,{modelValue:l(s).proxy,"onUpdate:modelValue":d[10]||(d[10]=r=>l(s).proxy=r),label:"代理"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",md:"6"},{default:t(()=>[e(le,{modelValue:l(s).render,"onUpdate:modelValue":d[11]||(d[11]=r=>l(s).render=r),label:"仿真"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(Y,null,{default:t(()=>[e(B,{onClick:z},{default:t(()=>[v(" 取消 ")]),_:1}),e(ne),e(B,{color:"primary",disabled:l(_),onClick:I},{default:t(()=>[v(b(l(N)),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}});const bl=ue({__name:"site",setup(ae){return(R,m)=>(V(),F("div",null,[e(dl)]))}});export{bl as default};
