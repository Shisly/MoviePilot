import{d as L,r as x,q as ve,j as t,o as n,f as C,i as f,aC as be,z as ye,W as l,a1 as w,c as r,a2 as $,M as b,an as ge,p as P,ay as xe,e as R,m as u,au as A,a as s,U as B,t as c,I as G,V,aP as ke,aQ as we,ae as $e,K as D,aR as Se,_ as U,P as Ve,aS as Ce,aT as Ee,ar as W,as as F,b as je}from"./index-6958f571.js";import{_ as Me}from"./PersonCard.vue_vue_type_style_index_0_lang-1250b934.js";import{S as Pe,_ as H}from"./MediaCardSlideView.vue_vue_type_script_setup_true_lang-c1e8b51b.js";import{_ as Te}from"./NoDataFound.vue_vue_type_style_index_0_lang-e90a023f.js";import{b as De}from"./formatters-080fb386.js";import"./MediaCard.vue_vue_type_style_index_0_lang-48d70c1f.js";import"./ExistIcon-5a3f03c2.js";import"./_plugin-vue_export-helper-c27b6911.js";const Ie=L({__name:"PersonCardSlideView",props:{apipath:String,linkurl:String,title:String},setup(T){const _=T,y=x(!1),e=x([]);async function h(){try{if(!_.apipath)return;e.value=await w.get(_.apipath),e.value.length>0&&(y.value=!0)}catch(p){console.error(p)}}return ve(h),(p,S)=>t(y)?(n(),C(Pe,be(ye({key:0},_)),{content:f(()=>[(n(!0),r(b,null,$(t(e),v=>(n(),C(Me,{key:v.id,person:v,height:"15rem",width:"10rem"},null,8,["person"]))),128))]),_:1},16)):l("",!0)}}),Be={key:0,class:"mt-12 w-full text-center text-gray-500 text-sm flex flex-col items-center"},Le={key:1,class:"max-w-8xl mx-auto px-4"},Ne={class:"vue-media-back absolute left-0 top-0 w-full h-96"},ze=s("div",{class:"vue-media-back absolute left-0 top-0 w-full h-96"},null,-1),qe={class:"media-page"},Re={class:"media-header"},Ae={class:"media-poster"},Ge={class:"w-full h-full"},Ue={class:"media-title"},We={key:0,class:"media-status"},Fe=s("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full whitespace-nowrap transition !no-underline bg-green-500 bg-opacity-80 border border-green-500 !text-green-100 hover:bg-green-500 hover:bg-opacity-100 false overflow-hidden"},[s("div",{class:"relative z-20 flex items-center false"},[s("span",null,"已入库")])],-1),He=[Fe],Ke={class:"flex flex-row items-baseline justify-start lg:justify-center"},Qe={key:0,class:"text-lg"},Je={class:"media-attributes"},Oe={key:0},Xe={key:1,class:"mx-1"},Ye={key:2},Ze={class:"media-actions"},et={class:"media-overview"},tt={class:"media-overview-left"},st={key:0,class:"tagline"},at={key:1},nt={key:2,class:"media-crew"},it=["href"],rt={key:3,class:"media-crew"},ot=["href"],lt=["href"],ct={class:"mt-6"},dt=["href"],ut={class:"inline-flex cursor-pointer items-center rounded-full bg-gray-600 px-2 py-1 text-sm text-gray-200 ring-1 ring-gray-500 transition hover:bg-gray-700"},_t=s("span",{class:"ms-1"},"TheMovieDb",-1),mt=["href"],pt={class:"inline-flex cursor-pointer items-center rounded-full bg-gray-600 px-2 py-1 text-sm text-gray-200 ring-1 ring-gray-500 transition hover:bg-gray-700"},ft=s("span",{class:"ms-1"},"豆瓣",-1),ht=["href"],vt={class:"inline-flex cursor-pointer items-center rounded-full bg-gray-600 px-2 py-1 text-sm text-gray-200 ring-1 ring-gray-500 transition hover:bg-gray-700"},bt=s("span",{class:"ms-1"},"IMDb",-1),yt=["href"],gt={class:"inline-flex cursor-pointer items-center rounded-full bg-gray-600 px-2 py-1 text-sm text-gray-200 ring-1 ring-gray-500 transition hover:bg-gray-700"},xt=s("span",{class:"ms-1"},"TheTvDb",-1),kt={key:4,class:"py-4"},wt={key:5,class:"flex w-full flex-col space-y-2"},$t={class:"flex flex-row items-center justify-between"},St={class:"font-weight-bold"},Vt={class:"absolute right-12"},Ct={key:0,class:"mt-3 w-full text-center text-gray-500 text-sm flex flex-col items-center"},Et={class:"flex flex-col justify-center divide-y divide-gray-700"},jt={class:"flex-1"},Mt={class:"flex flex-col space-y-2 lg:flex-row lg:items-center lg:space-y-0 lg:space-x-2"},Pt={class:"text-lg"},Tt={class:"flex items-center space-x-2"},Dt={class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full whitespace-nowrap cursor-default bg-gray-700 !text-gray-300"},It={key:0,class:"media-overview-right"},Bt={class:"media-facts"},Lt={key:0,class:"media-ratings"},Nt={key:1,class:"media-fact"},zt=s("span",null,"原始标题",-1),qt={class:"media-fact-value"},Rt={key:2,class:"media-fact"},At=s("span",null,"状态",-1),Gt={class:"media-fact-value"},Ut={key:3,class:"media-fact"},Wt=s("span",null,"上映日期",-1),Ft={class:"media-fact-value"},Ht={class:"flex items-center justify-end"},Kt=s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true",class:"h-4 w-4"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 15a4.5 4.5 0 004.5 4.5H18a3.75 3.75 0 001.332-7.257 3 3 0 00-3.758-3.848 5.25 5.25 0 00-10.233 2.33A4.502 4.502 0 002.25 15z"})],-1),Qt={class:"ml-1.5"},Jt={key:4,class:"media-fact"},Ot=s("span",null,"原始语言",-1),Xt={class:"media-fact-value"},Yt={key:5,class:"media-fact"},Zt=s("span",null,"出品国家",-1),es={class:"media-fact-value"},ts={class:"media-fact border-b-0"},ss=s("span",null,"制作公司",-1),as={class:"media-fact-value text-end"},ns={key:0},is={key:1},rs={key:2},os=L({__name:"MediaDetailView",props:{mediaid:String,type:String},setup(T){const _=T,y=ge.useToast(),e=x({}),h=x(!1),p=x(!1),S=x(!1),v=x({}),E=x({}),j=x({});async function K(){if(_.mediaid&&_.type){if(e.value=await w.get(`media/${_.mediaid}`,{params:{type_name:_.type}}),S.value=!0,!e.value.tmdb_id&&!e.value.douban_id)return;e.value.type==="电影"?J():O(),e.value.type==="电影"?X():Z()}}async function Q(a){if(!v.value[a])try{const i=await w.get(`tmdb/${e.value.tmdb_id}/${a}`);v.value[a]=i||[]}catch(i){console.error(i)}}async function J(){try{(await w.get("media/exists",{params:{tmdbid:e.value.tmdb_id,title:e.value.title,year:e.value.year,season:e.value.season,mtype:e.value.type}})).success&&(h.value=!0)}catch(a){console.error(a)}}async function N(a=0){try{const i=`tmdb:${e.value.tmdb_id}`;if((await w.get(`subscribe/media/${i}`,{params:{season:a}})).id)return!0}catch(i){console.error(i)}return!1}async function O(){if(e.value.type==="电视剧")try{const a=await w.post("download/notexists",e.value);a&&(a.length===0&&(h.value=!0),a.forEach(i=>{let d=0;i.episodes.length===0?d=2:i.episodes.length<i.total_episode&&(d=1),d!==2&&(h.value=!0),E.value[i.season]=d}))}catch(a){console.error(a)}}async function X(){e.value.type==="电影"&&(p.value=await N())}const Y=P(()=>{var a,i;return(i=(a=e.value)==null?void 0:a.season_info)==null?void 0:i.filter(d=>d.season_number!==0)});async function Z(){var a,i;if(e.value.type==="电视剧")try{(i=(a=e.value)==null?void 0:a.season_info)==null||i.forEach(async d=>{j.value[d.season_number??0]=await N(d.season_number)})}catch(d){console.error(d)}}async function ee(a=0){var i,d,g,o,m,M;W();try{let k=h.value?1:0;a&&(k=E.value[a]?0:1);const I=await w.post("subscribe",{name:(i=e.value)==null?void 0:i.title,type:(d=e.value)==null?void 0:d.type,year:(g=e.value)==null?void 0:g.year,tmdbid:(o=e.value)==null?void 0:o.tmdb_id,doubanid:(m=e.value)==null?void 0:m.douban_id,season:a,best_version:k});I.success&&(p.value=!0,a&&(j.value[a]=!0)),te(I.success,((M=e.value)==null?void 0:M.title)??"",a,I.message,k)}catch(k){console.error(k)}F()}function te(a,i,d,g,o){d&&(i=`${i} ${De(d.toString())}`);let m="订阅";o>0&&(m="洗版订阅"),a?y.success(`${i} 添加${m}成功！`):y.error(`${i} 添加${m}失败：${g}！`)}async function se(a){var i,d,g,o,m;W();try{const M=(i=e.value)!=null&&i.tmdb_id?`tmdb:${(d=e.value)==null?void 0:d.tmdb_id}`:`douban:${(g=e.value)==null?void 0:g.douban_id}`,k=await w.delete(`subscribe/media/${M}`,{params:{season:a}});k.success?(p.value=!1,a&&(j.value[a]=!1),y.success(`${(o=e.value)==null?void 0:o.title} 已取消订阅！`)):y.error(`${(m=e.value)==null?void 0:m.title} 取消订阅失败：${k.message}！`)}catch(M){console.error(M)}F()}function z(a=0){p.value?se(a):ee(a)}function ae(a){return a.map(i=>i.name).join("、")}function ne(){return`https://www.themoviedb.org/${_.type==="电影"?"movie":"tv"}/${e.value.tmdb_id}`}function ie(){return`https://movie.douban.com/subject/${e.value.douban_id}`}function re(){return`https://www.imdb.com/title/${e.value.imdb_id}`}function oe(){return`https://www.thetvdb.com/series/${e.value.tvdb_id}`}function le(a){return a?`https://image.tmdb.org/t/p/w500${a}`:""}function ce(a=""){return a?a.replace("original","w500"):""}const de=P(()=>{var a;return(a=e.value.production_countries)==null?void 0:a.map(i=>i.name)}),ue=P(()=>{var a;return(a=e.value.production_companies)==null?void 0:a.map(i=>i.name)});function _e(a){const i=E.value[a];return i?i===1?"warning":i===2?"error":"success":"success"}function me(a){const i=E.value[a];return i?i===1?"部分缺失":i===2?"缺失":"已存在":"已存在"}const pe=P(()=>p.value?"mdi-heart":"mdi-heart-outline"),fe=P(()=>p.value?"error":"warning");function q(a){return a.join("、")}function he(){$e.push({path:"/resource",query:{keyword:`tmdb:${e.value.tmdb_id}`,type:e.value.type}})}return xe(()=>{K()}),(a,i)=>{const d=R("VSkeletonLoader"),g=R("IconBtn");return n(),r(b,null,[t(S)?l("",!0):(n(),r("div",Be,[u(A,{size:"48",indeterminate:"",color:"primary"})])),t(e).tmdb_id||t(e).douban_id?(n(),r("div",Le,[t(e).backdrop_path?(n(),r(b,{key:0},[s("div",Ne,[u(B,{class:"h-96",src:t(e).backdrop_path,cover:""},null,8,["src"])]),ze],64)):l("",!0),s("div",qe,[s("div",Re,[s("div",Ae,[u(B,{src:ce(t(e).poster_path),cover:"",class:"object-cover aspect-w-2 aspect-h-3 ring-1 ring-gray-500"},{placeholder:f(()=>[s("div",Ge,[u(d,{class:"object-cover aspect-w-2 aspect-h-3"})])]),_:1},8,["src"])]),s("div",Ue,[t(h)?(n(),r("div",We,He)):l("",!0),s("h1",Ke,[s("span",null,c(t(e).title),1),t(e).year?(n(),r("span",Qe,"（"+c(t(e).year)+"）",1)):l("",!0)]),s("span",Je,[t(e).runtime||t(e).episode_run_time[0]?(n(),r("span",Oe,c(t(e).runtime||t(e).episode_run_time[0])+" 分钟",1)):l("",!0),(t(e).runtime||t(e).episode_run_time[0])&&t(e).genres?(n(),r("span",Xe," | ")):l("",!0),t(e).genres?(n(),r("span",Ye,c(ae(t(e).genres||[])),1)):l("",!0)])]),s("div",Ze,[t(e).tmdb_id?(n(),C(G,{key:0,variant:"tonal",color:"info",onClick:he},{prepend:f(()=>[u(V,{icon:"mdi-magnify"})]),default:f(()=>[D(" 搜索 ")]),_:1})):l("",!0),t(e).type==="电影"?(n(),C(G,{key:1,class:"ms-2",color:t(fe),variant:"tonal",onClick:i[0]||(i[0]=o=>z(0))},{prepend:f(()=>[u(V,{icon:t(pe)},null,8,["icon"])]),default:f(()=>[D(" "+c(t(p)?"已订阅":"订阅"),1)]),_:1},8,["color"])):l("",!0)])]),s("div",et,[s("div",tt,[t(e).tagline?(n(),r("div",st,c(t(e).tagline),1)):l("",!0),t(e).overview?(n(),r("h2",at," 简介 ")):l("",!0),s("p",null,c(t(e).overview),1),t(e).tmdb_id?(n(),r("ul",nt,[(n(!0),r(b,null,$(t(e).directors,o=>(n(),r("li",{key:o.id},[s("span",null,c(o.job),1),s("a",{class:"crew-name",href:`person?personid=${o.id}`,target:"_blank"},c(o.name),9,it)]))),128))])):l("",!0),!t(e).tmdb_id&&t(e).douban_id?(n(),r("ul",rt,[(n(!0),r(b,null,$(t(e).directors,o=>(n(),r("li",{key:o.id},[s("span",null,c(q(o.roles)),1),s("a",{class:"crew-name",href:`${o.url}`,target:"_blank"},c(o.name),9,ot)]))),128)),(n(!0),r(b,null,$(t(e).actors,o=>(n(),r("li",{key:o.id},[s("span",null,c(q(o.roles)),1),s("a",{class:"crew-name",href:`${o.url}`,target:"_blank"},c(o.name),9,lt)]))),128))])):l("",!0),s("div",ct,[t(e).tmdb_id?(n(),r("a",{key:0,class:"mb-2 mr-2 inline-flex last:mr-0",href:ne(),target:"_blank"},[s("div",ut,[u(V,{icon:"mdi-link"}),_t])],8,dt)):l("",!0),t(e).douban_id?(n(),r("a",{key:1,class:"mb-2 mr-2 inline-flex last:mr-0",href:ie(),target:"_blank"},[s("div",pt,[u(V,{icon:"mdi-link"}),ft])],8,mt)):l("",!0),t(e).imdb_id?(n(),r("a",{key:2,class:"mb-2 mr-2 inline-flex last:mr-0",href:re(),target:"_blank"},[s("div",vt,[u(V,{icon:"mdi-link"}),bt])],8,ht)):l("",!0),t(e).tvdb_id?(n(),r("a",{key:3,class:"mb-2 mr-2 inline-flex last:mr-0",href:oe(),target:"_blank"},[s("div",gt,[u(V,{icon:"mdi-link"}),xt])],8,yt)):l("",!0)]),t(e).type==="电视剧"&&t(e).tmdb_id?(n(),r("h2",kt," 季 ")):l("",!0),t(e).type==="电视剧"&&t(e).tmdb_id?(n(),r("div",wt,[u(ke,null,{default:f(()=>[(n(!0),r(b,null,$(t(Y),o=>(n(),C(Ee,{key:o.season_number,"onGroup:selected":m=>Q(o.season_number||0)},{default:f(()=>[u(Se,null,{default:f(()=>[s("div",$t,[s("span",St,"第 "+c(o.season_number)+" 季",1),u(U,{size:"small",class:"ms-1"},{default:f(()=>[D(c(o.episode_count)+"集 ",1)]),_:2},1024),s("div",Vt,[t(E)?(n(),C(U,{key:0,color:_e(o.season_number||0),flat:""},{default:f(()=>[D(c(me(o.season_number||0)),1)]),_:2},1032,["color"])):l("",!0),u(g,{class:"ms-1",color:t(j)[o.season_number||0]?"error":"warning",variant:"text",onClick:Ve(m=>z(o.season_number),["stop"])},{default:f(()=>[u(V,{icon:t(j)[o.season_number||0]?"mdi-heart":"mdi-heart-outline"},null,8,["icon"])]),_:2},1032,["color","onClick"])])])]),_:2},1024),u(Ce,null,{default:f(()=>[t(v)[o.season_number||0]?l("",!0):(n(),r("div",Ct,[u(A,{size:"48",indeterminate:"",color:"primary"})])),s("div",Et,[(n(!0),r(b,null,$(t(v)[o.season_number||0],m=>(n(),r("div",{key:m.episode_number,class:"flex flex-col space-y-4 py-4 xl:flex-row xl:space-y-4 xl:space-x-4"},[s("div",jt,[s("div",Mt,[s("h3",Pt,c(m.episode_number)+" - "+c(m.name),1),s("div",Tt,[s("span",Dt,c(m.air_date),1)])]),s("p",null,c(m.overview),1)]),u(B,{cover:"",class:"rounded-lg","max-width":"15rem",src:le(m.still_path||""),alt:""},null,8,["src"])]))),128))])]),_:2},1024)]),_:2},1032,["onGroup:selected"]))),128))]),_:1})])):l("",!0)]),t(e).tmdb_id?(n(),r("div",It,[s("div",Bt,[t(e).vote_average?(n(),r("div",Lt,[u(we,{modelValue:t(e).vote_average,"onUpdate:modelValue":i[1]||(i[1]=o=>t(e).vote_average=o),density:"compact",length:"10",class:"ma-2",readonly:""},null,8,["modelValue"])])):l("",!0),t(e).original_title||t(e).original_name?(n(),r("div",Nt,[zt,s("span",qt,c(t(e).original_title||t(e).original_name),1)])):l("",!0),t(e).status?(n(),r("div",Rt,[At,s("span",Gt,c(t(e).status),1)])):l("",!0),t(e).release_date||t(e).first_air_date?(n(),r("div",Ut,[Wt,s("span",Ft,[s("span",Ht,[Kt,s("span",Qt,c(t(e).release_date||t(e).first_air_date),1)])])])):l("",!0),t(e).original_language?(n(),r("div",Jt,[Ot,s("span",Xt,c(t(e).original_language),1)])):l("",!0),t(e).production_countries?(n(),r("div",Yt,[Zt,s("span",es,[(n(!0),r(b,null,$(t(de),o=>(n(),r("span",{key:o,class:"flex items-center justify-end text-end"},c(o),1))),128))])])):l("",!0),s("div",ts,[ss,s("span",as,[(n(!0),r(b,null,$(t(ue),o=>(n(),r("span",{key:o,class:"block"},c(o),1))),128))])])])])):l("",!0)]),t(e).tmdb_id?(n(),r("div",ns,[u(Ie,{apipath:`tmdb/credits/${t(e).tmdb_id}/${_.type}`,linkurl:`/credits/tmdb/credits/${t(e).tmdb_id}/${_.type}?title=演员阵容`,title:"演员阵容"},null,8,["apipath","linkurl"])])):l("",!0),t(e).tmdb_id?(n(),r("div",is,[u(H,{apipath:`tmdb/recommend/${t(e).tmdb_id}/${_.type}`,linkurl:`/browse/tmdb/recommend/${t(e).tmdb_id}/${_.type}?title=推荐`,title:"推荐"},null,8,["apipath","linkurl"])])):l("",!0),t(e).tmdb_id?(n(),r("div",rs,[u(H,{apipath:`tmdb/similar/${t(e).tmdb_id}/${_.type}`,linkurl:`/browse/tmdb/similar/${t(e).tmdb_id}/${_.type}?title=类似`,title:"类似"},null,8,["apipath","linkurl"])])):l("",!0)])])):l("",!0),!t(e).tmdb_id&&!t(e).douban_id&&t(S)?(n(),C(Te,{key:2,"error-code":"500","error-title":"出错啦！","error-description":"未识别到TMDB媒体信息。"})):l("",!0)],64)}}});const hs=L({__name:"media",setup(T){var h,p,S,v;const _=je(),y=(p=(h=_.query)==null?void 0:h.mediaid)==null?void 0:p.toString(),e=(v=(S=_.query)==null?void 0:S.type)==null?void 0:v.toString();return(E,j)=>(n(),r("div",null,[u(os,{mediaid:t(y),type:t(e)},null,8,["mediaid","type"])]))}});export{hs as default};
