import{P as S}from"./index-12c8a0ee.js";import{d as b,r as _,j as s,o,f as p,i as c,m as n,U as j,K as C,t as v,n as x,Y as N,Z as U,B as T,ai as z,W as m,I as P,G as A,A as F,a1 as $,ay as M,ag as E,c as V,au as G,M as I,a2 as H,F as K}from"./index-9a44e8f0.js";import{_ as O}from"./NoDataFound.vue_vue_type_style_index_0_lang-b5cf94e2.js";const W=b({__name:"DownloadingCard",props:{info:Object},setup(k){var D;const e=k,r=_(!0);function u(){var a;return((a=e.info)==null?void 0:a.progress)??0}function g(){var a,l;return`↑ ${(a=e.info)==null?void 0:a.upspeed}/s ↓ ${(l=e.info)==null?void 0:l.dlspeed}/s`}const t=_(((D=e.info)==null?void 0:D.state)==="downloading"),w=_(!1);function y(){w.value=!0}function d(){return w.value?"text-white":""}async function f(){var l;const a=t.value?"stop":"start";try{(await $.put(`download/${(l=e.info)==null?void 0:l.hash}/${a}`)).success&&(t.value=!t.value)}catch(h){console.error(h)}}async function R(){var a;try{await $.delete(`download/${(a=e.info)==null?void 0:a.hash}`),r.value=!1}catch(l){console.error(l)}}return(a,l)=>{var h;return s(r)?(o(),p(F,{key:(h=e.info)==null?void 0:h.hash},{image:c(()=>{var i;return[n(j,{src:(i=e.info)==null?void 0:i.media.image,"aspect-ratio":"2/3",cover:"",class:"brightness-50",onLoad:y},null,8,["src"])]}),default:c(()=>[n(N,{class:x(["break-words whitespace-normal",d()])},{default:c(()=>{var i,L,B;return[C(v(((i=e.info)==null?void 0:i.media.title)||((L=e.info)==null?void 0:L.name))+" "+v((B=e.info)==null?void 0:B.season_episode),1)]}),_:1},8,["class"]),n(U,{class:x(["break-words whitespace-normal",d()])},{default:c(()=>{var i;return[C(v((i=e.info)==null?void 0:i.title),1)]}),_:1},8,["class"]),n(T,{class:x(["text-subtitle-1 pt-3 pb-1",d()])},{default:c(()=>[C(v(g()),1)]),_:1},8,["class"]),u()>0?(o(),p(T,{key:0,class:x(d())},{default:c(()=>[n(z,{"model-value":u()},null,8,["model-value"])]),_:1},8,["class"])):m("",!0),n(A,{class:"justify-space-between"},{default:c(()=>[n(P,{icon:`${s(t)?"mdi-pause":"mdi-play"}`,onClick:f},null,8,["icon"]),n(P,{color:"error",icon:"mdi-trash-can-outline",onClick:R})]),_:1})]),_:1})):m("",!0)}}}),Y={key:0,class:"mt-12 w-full text-center text-gray-500 text-sm flex flex-col items-center"},Z={key:0,class:"grid gap-3 grid-downloading-card"},q=b({__name:"DownloadingListView",setup(k){let e=null;const r=_([]),u=_(!1);async function g(){try{r.value=await $.get("download"),u.value=!0}catch(y){console.error(y)}}const t=_(!1);function w(){t.value=!0,g(),t.value=!1}return M(()=>{g(),e=setInterval(()=>{g()},3e3)}),E(()=>{e&&(clearInterval(e),e=null)}),(y,d)=>(o(),V(I,null,[s(u)?m("",!0):(o(),V("div",Y,[s(u)?m("",!0):(o(),p(G,{key:0,size:"48",indeterminate:"",color:"primary"}))])),n(s(S),{modelValue:s(t),"onUpdate:modelValue":d[0]||(d[0]=f=>K(t)?t.value=f:null),onRefresh:w},{default:c(()=>[s(r).length>0?(o(),V("div",Z,[(o(!0),V(I,null,H(s(r),f=>(o(),p(W,{key:f.hash,info:f},null,8,["info"]))),128))])):m("",!0),s(r).length===0&&s(u)?(o(),p(O,{key:1,"error-code":"404","error-title":"没有任务","error-description":"正在下载的任务将会显示在这里。"})):m("",!0)]),_:1},8,["modelValue"])],64))}});const ee=b({__name:"downloading",setup(k){return(e,r)=>(o(),p(q))}});export{ee as default};
