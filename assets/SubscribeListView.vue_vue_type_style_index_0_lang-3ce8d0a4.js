import{P as Y}from"./index-9afe9e2d.js";import{a as P}from"./index-b9b8a38f.js";import{_ as Z}from"./NoDataFound.vue_vue_type_script_setup_true_lang-3af77c4b.js";import{d as X,af as ee,r as b,e as te,o as s,c as v,f,i as l,m as o,ag as ae,V as L,a as S,ac as se,a1 as oe,L as T,U as q,$ as le,X as re,t as p,j as n,ab as ne,n as y,J as O,aa as ie,A as D,a9 as ce,_ as m,ai as ue,z as de,E as G,ax as me,p as pe,a2 as fe}from"./index-d3947ac1.js";import{_ as _e}from"./SubscribeEditForm.vue_vue_type_script_setup_true_lang-4bbbcb5f.js";import{c as ve}from"./index-d2c33d5a.js";import{b as be}from"./formatters-16dfb57c.js";const ge={class:"me-n3"},ye={class:"d-flex align-center"},xe=X({__name:"SubscribeCard",props:{media:Object},emits:["remove","save"],setup(B,{emit:x}){var z,E;const e=B,w=ee.useToast(),_=b(!1),r=b(!1),I=b(`${(z=e.media)!=null&&z.last_update?`${ve(((E=e.media)==null?void 0:E.last_update)||"")}前`:""}`);function k(){_.value=!0}function g(){var i,t;return((i=e.media)==null?void 0:i.type)==="电影"?"mdi-movie":((t=e.media)==null?void 0:t.type)==="电视剧"?"mdi-television-classic":"mdi-help-circle"}function V(){var i,t,u,h;return((i=e.media)==null?void 0:i.total_episode)===0?0:Math.round(((((t=e.media)==null?void 0:t.total_episode)??0)-(((u=e.media)==null?void 0:u.lack_episode)??0))/(((h=e.media)==null?void 0:h.total_episode)??1)*100)}function c(){return _.value?"white":""}function C(){return _.value?"text-white":""}async function K(){var i;try{(await P.delete(`subscribe/${(i=e.media)==null?void 0:i.id}`)).success&&x("remove")}catch(t){console.log(t)}}async function Q(){var i,t;try{(await P.get(`subscribe/search/${(i=e.media)==null?void 0:i.id}`)).success&&w.success(`${(t=e.media)==null?void 0:t.name} 提交搜索请求成功！`)}catch(u){console.log(u)}}async function R(){r.value=!0}const W=b([{title:"编辑",value:1,props:{prependIcon:"mdi-file-edit-outline",click:R}},{title:"搜索",value:2,props:{prependIcon:"mdi-magnify",click:Q}},{title:"取消订阅",value:3,props:{prependIcon:"mdi-trash-can-outline",color:"error",click:K}}]);return(i,t)=>{var h,N,U;const u=te("IconBtn");return s(),v(T,null,[(s(),f(de,{key:(h=e.media)==null?void 0:h.id,class:y(`${(N=e.media)!=null&&N.best_version?"outline-dashed outline-1":""}`),onClick:R},{image:l(()=>{var a,d;return[o(ae,{src:((a=e.media)==null?void 0:a.backdrop)||((d=e.media)==null?void 0:d.poster),"aspect-ratio":"2/3",cover:"",class:"brightness-50",onLoad:k},null,8,["src"])]}),default:l(()=>[o(ie,null,{prepend:l(()=>[o(L,{size:"1.9rem",color:c(),icon:g()},null,8,["color","icon"])]),append:l(()=>[S("div",ge,[o(u,null,{default:l(()=>[o(L,{icon:"mdi-dots-vertical",color:c()},null,8,["color"]),o(se,{activator:"parent","close-on-content-click":""},{default:l(()=>[o(oe,null,{default:l(()=>[(s(!0),v(T,null,q(n(W),(a,d)=>(s(),f(le,{key:d,variant:"plain","base-color":a.props.color,onClick:a.props.click},{prepend:l(()=>[o(L,{icon:a.props.prependIcon},null,8,["icon"])]),default:l(()=>[o(re,{textContent:p(a.title)},null,8,["textContent"])]),_:2},1032,["base-color","onClick"]))),128))]),_:1})]),_:1})]),_:1})])]),default:l(()=>[o(ne,{class:y(C())},{default:l(()=>{var a,d,$;return[O(p((a=e.media)==null?void 0:a.name)+" "+p(n(be)((d=e.media)!=null&&d.season?($=e.media)==null?void 0:$.season.toString():"")),1)]}),_:1},8,["class"])]),_:1}),o(D,null,{default:l(()=>{var a;return[S("p",{class:y(["clamp-text mb-0",C()])},p((a=e.media)==null?void 0:a.description),3)]}),_:1}),o(D,{class:"d-flex justify-space-between align-center flex-wrap"},{default:l(()=>{var a,d,$,j,M,A,F,H,J;return[S("div",ye,[o(u,{icon:"mdi-star",color:c(),class:"me-1"},null,8,["color"]),S("span",{class:y(["text-subtitle-2 me-4",C()])},p((a=e.media)==null?void 0:a.vote),3),(d=e.media)!=null&&d.total_episode?(s(),f(u,ce({key:0},e,{icon:"mdi-progress-clock",color:c(),class:"me-1"}),null,16,["color"])):m("",!0),($=e.media)!=null&&$.season?(s(),v("span",{key:1,class:y(["text-subtitle-2 me-4",C()])},p((((j=e.media)==null?void 0:j.total_episode)||0)-(((M=e.media)==null?void 0:M.lack_episode)||0))+" / "+p((A=e.media)==null?void 0:A.total_episode),3)):m("",!0),(F=e.media)!=null&&F.username?(s(),f(u,{key:2,icon:"mdi-account",color:c(),class:"me-1"},null,8,["color"])):m("",!0),(H=e.media)!=null&&H.username?(s(),v("span",{key:3,class:y(["text-subtitle-2 me-4",C()])},p((J=e.media)==null?void 0:J.username),3)):m("",!0)])]}),_:1}),n(I)?(s(),f(D,{key:0,class:"absolute right-0 bottom-0 d-flex align-center p-2 text-gray-300"},{default:l(()=>[o(L,{icon:"mdi-download",class:"me-1"}),O(" "+p(n(I)),1)]),_:1})):m("",!0),V()>0?(s(),f(ue,{key:1,"model-value":V(),"bg-color":"success",color:"success"},null,8,["model-value"])):m("",!0)]),_:1},8,["class"])),o(_e,{modelValue:n(r),"onUpdate:modelValue":t[0]||(t[0]=a=>G(r)?r.value=a:null),subid:(U=e.media)==null?void 0:U.id,onRemove:t[1]||(t[1]=()=>{x("remove"),r.value=!1}),onSave:t[2]||(t[2]=()=>{x("save"),r.value=!1}),onClose:t[3]||(t[3]=a=>r.value=!1)},null,8,["modelValue","subid"])],64)}}}),ke={key:0,class:"mt-12 w-full text-center text-gray-500 text-sm flex flex-col items-center"},Ve={key:0,class:"grid gap-3 grid-subscribe-card p-1"},Te=X({__name:"SubscribeListView",props:{type:String},setup(B){const x=B,e=b(!1),w=b([]);async function _(){try{w.value=await P.get("subscribe/"),e.value=!0}catch(g){console.error(g)}}me(_);const r=b(!1);function I(){r.value=!0,_(),r.value=!1}const k=pe(()=>w.value.filter(g=>g.type===x.type));return(g,V)=>(s(),v(T,null,[n(e)?m("",!0):(s(),v("div",ke,[n(e)?m("",!0):(s(),f(fe,{key:0,size:"48",indeterminate:"",color:"primary"}))])),o(n(Y),{modelValue:n(r),"onUpdate:modelValue":V[0]||(V[0]=c=>G(r)?r.value=c:null),onRefresh:I},{default:l(()=>[n(k).length>0?(s(),v("div",Ve,[(s(!0),v(T,null,q(n(k),c=>(s(),f(xe,{key:c.id,media:c,onRemove:_,onSave:_},null,8,["media"]))),128))])):m("",!0),n(k).length===0&&n(e)?(s(),f(Z,{key:1,"error-code":"404","error-title":"没有订阅","error-description":"请通过搜索添加电影、电视剧订阅。"})):m("",!0)]),_:1},8,["modelValue"])],64))}});export{Te as _};
