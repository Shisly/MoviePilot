import{d as C,ab as B,r as u,q as I,ae as f,o as b,f as j,i as l,j as s,U as v,a1 as V,a as c,m as a,X as F,Y as T,K as g,B as U,Q as D,P as M,C as N,D as _,E as h,c as S,t as q,W as P,aH as $,I as A,n as E,A as L}from"./index-773434b7.js";import{r as w}from"./index-705cb9e8.js";const R="/assets/logo-c95d39dc.png",z={class:"auth-wrapper d-flex align-center justify-center pa-4"},H={class:"d-flex pe-0"},K={key:0,class:"text-error mt-1"},Q={class:"d-flex align-center justify-space-between flex-wrap mt-1 mb-4"},G=C({__name:"login",setup(W){const d=B(),t=u({username:"",password:"",remember:!0}),x=u(null),i=u(!1),r=u(""),p=u(""),m=u(!1);async function k(){V.get("/login/tmdb").then(o=>{p.value=o.message}).catch(o=>{console.log(o)})}function y(){if(r.value="",!t.value.username||!t.value.password)return;const o=new FormData;o.append("username",t.value.username),o.append("password",t.value.password),V.post("/login/access-token",o,{headers:{Accept:"application/json"}}).then(e=>{const n=e.access_token;d.dispatch("auth/updateToken",n),d.dispatch("auth/updateRemember",t.value.remember),f.push("/")}).catch(e=>{e.response?e.response.status===401?r.value="登录失败，请检查用户名和密码是否正确":e.response.status===403?r.value="登录失败，您没有权限访问":e.response.status===500?r.value="登录失败，服务器错误":r.value=`登录失败 ${e.response.status}，请检查用户名和密码是否正确`:r.value="登录失败，请检查网络连接"})}return I(()=>{const o=d.state.auth.token,e=d.state.auth.remember;o&&e?f.push("/"):k()}),(o,e)=>(b(),j(v,{"aspect-ratio":"4/3",src:s(p),class:"w-full h-full overflow-hidden",cover:"",onLoad:e[4]||(e[4]=n=>m.value=!0)},{default:l(()=>[c("div",z,[a(L,{class:E(["auth-card pa-7 w-full h-full",s(m)?"backdrop-blur-xl bg-white/50":""]),"max-width":"25rem",theme:s(m)?"light":""},{default:l(()=>[a(F,{class:"justify-center mb-7"},{prepend:l(()=>[c("div",H,[a(v,{src:s(R),width:"64"},null,8,["src"])])]),default:l(()=>[a(T,{class:"font-weight-semibold text-2xl text-uppercase"},{default:l(()=>[g(" MoviePilot ")]),_:1})]),_:1}),a(U,null,{default:l(()=>[a(s(D),{ref_key:"refForm",ref:x,onSubmit:M(()=>{},["prevent"])},{default:l(()=>[a(N,null,{default:l(()=>[a(_,{cols:"12"},{default:l(()=>[a(h,{modelValue:s(t).username,"onUpdate:modelValue":e[0]||(e[0]=n=>s(t).username=n),label:"用户名",type:"text",rules:[s(w)]},null,8,["modelValue","rules"])]),_:1}),a(_,{cols:"12"},{default:l(()=>[a(h,{modelValue:s(t).password,"onUpdate:modelValue":e[1]||(e[1]=n=>s(t).password=n),label:"密码",type:s(i)?"text":"password","append-inner-icon":s(i)?"mdi-eye-off-outline":"mdi-eye-outline",rules:[s(w)],"onClick:appendInner":e[2]||(e[2]=n=>i.value=!s(i))},null,8,["modelValue","type","append-inner-icon","rules"]),s(r)?(b(),S("div",K,q(s(r)),1)):P("",!0),c("div",Q,[a($,{modelValue:s(t).remember,"onUpdate:modelValue":e[3]||(e[3]=n=>s(t).remember=n),label:"保持登录",required:""},null,8,["modelValue"])]),a(A,{block:"",type:"submit",onClick:y},{default:l(()=>[g(" 登录 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["class","theme"])])]),_:1},8,["src"]))}});export{G as default};
