import{a as B}from"./index-e40242f1.js";import{_ as Y}from"./NoDataFound.vue_vue_type_script_setup_true_lang-6612df66.js";import{d as S,af as Z,r as h,o,f as c,i as t,a as D,m as l,ag as ee,n as M,j as i,X as le,aB as te,K as C,t as I,ab as ne,B as z,P as ue,A as F,e as W,c as k,W as T,M as $,z as A,k as N,aC as ce,$ as x,N as q,V as E,ac as pe,a2 as de,R as ge,S as me,a0 as fe,Y as _e,_ as ve,aa as he,G as J,I as R,H,F as G,L as K,p as Q,ax as ye,a3 as Ve,aD as Ce,aE as ke,aF as we}from"./index-3d39bc5b.js";import{_ as ae}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as xe}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-afaca0cb.js";import{i as $e}from"./index-d2c33d5a.js";const Pe=["href"],be=S({__name:"PluginAppCard",props:{plugin:Object,width:String,height:String},emits:["install"],setup(P,{emit:_}){const e=P,u=Z.useToast(),w=h(!1);async function p(){var g,d,s;try{const a=await B.get(`plugin/install/${(g=e.plugin)==null?void 0:g.id}`);a.success?(u.success(`插件 ${(d=e.plugin)==null?void 0:d.plugin_name} 安装成功！`),_("install")):u.error(`插件 ${(s=e.plugin)==null?void 0:s.plugin_name} 安装失败：${a.message}}`)}catch(a){console.error(a)}}return(g,d)=>(o(),c(F,{width:e.width,height:e.height,onClick:p},{default:t(()=>{var s;return[D("div",{class:"relative pa-4 text-center card-cover-blurred",style:te({background:`${(s=e.plugin)==null?void 0:s.plugin_color}`})},[l(le,{size:"128",class:M({shadow:i(w)})},{default:t(()=>{var a;return[l(ee,{src:`/plugin/${(a=e.plugin)==null?void 0:a.plugin_icon}`,"aspect-ratio":"4/3",cover:"",onLoad:d[0]||(d[0]=y=>w.value=!0)},null,8,["src"])]}),_:1},8,["class"])],4),l(ne,null,{default:t(()=>{var a;return[C(I((a=e.plugin)==null?void 0:a.plugin_name),1)]}),_:1}),l(z,null,{default:t(()=>{var a;return[C(I((a=e.plugin)==null?void 0:a.plugin_desc),1)]}),_:1}),l(z,null,{default:t(()=>{var a,y;return[C(" 作者："),D("a",{href:(a=e.plugin)==null?void 0:a.author_url,target:"_blank",onClick:d[1]||(d[1]=ue(()=>{},["stop"]))},I((y=e.plugin)==null?void 0:y.plugin_author),9,Pe)]}),_:1})]}),_:1},8,["width","height"]))}});const Ie=ae(be,[["__scopeId","data-v-fa0d9baf"]]),Le=S({__name:"FormRender",props:{config:Object,form:Object},setup(P){const _=P,e=h(_.config||{component:"div",text:"",props:{},content:[]}),u=h(_.form||{});return(w,p)=>{var d;const g=W("FormRender",!0);return o(),c(N(e.value.component),A(e.value.props,{modelValue:u.value[((d=e.value.props)==null?void 0:d.model)||""],"onUpdate:modelValue":p[0]||(p[0]=s=>{var a;return u.value[((a=e.value.props)==null?void 0:a.model)||""]=s})}),{default:t(()=>[C(I(e.value.text)+" ",1),(o(!0),k($,null,T(e.value.content||[],(s,a)=>{var y;return o(),c(g,{key:a,modelValue:u.value[((y=s.props)==null?void 0:y.model)||""],"onUpdate:modelValue":v=>{var j;return u.value[((j=s.props)==null?void 0:j.model)||""]=v},config:s,form:u.value},null,8,["modelValue","onUpdate:modelValue","config","form"])}),128))]),_:1},16,["modelValue"])}}}),Be=S({__name:"PageRender",props:{config:Object,handler:Boolean},setup(P){const e=h(P.config||{component:"div",text:"",html:"",props:{},content:[]});return(u,w)=>{const p=W("PageRender",!0);return o(),k($,null,[e.value.html?x("",!0):(o(),c(N(e.value.component),ce(A({key:0},e.value.props)),{default:t(()=>[C(I(e.value.text)+" ",1),(o(!0),k($,null,T(e.value.content||[],(g,d)=>(o(),c(p,{key:d,config:g},null,8,["config"]))),128))]),_:1},16)),e.value.html?(o(),c(N(e.value.component),A({key:1},e.value.props,{innerHTML:e.value.html}),null,16,["innerHTML"])):x("",!0)],64)}}}),De={class:"me-n3 absolute top-0 right-3"},Te=S({__name:"PluginCard",props:{plugin:Object,width:String,height:String},emits:["remove","save"],setup(P,{emit:_}){var X;const e=P,u=Z.useToast(),w=h(!0),p=h(!1),g=h({});let d=q([]);const s=h(!1);let a=q([]);const y=h(!1);async function v(){var m,n,L;try{const V=await B.delete(`plugin/${(m=e.plugin)==null?void 0:m.id}`);V.success?(u.success(`插件 ${(n=e.plugin)==null?void 0:n.plugin_name} 已卸载`),_("remove")):u.error(`插件 ${(L=e.plugin)==null?void 0:L.plugin_name} 卸载失败：${V.message}}`)}catch(V){console.error(V)}}async function j(){var m;try{const n=await B.get(`plugin/form/${(m=e.plugin)==null?void 0:m.id}`);n&&(d=n.conf,n.model&&(g.value=n.model))}catch(n){console.error(n)}}async function oe(){var m;try{const n=await B.get(`plugin/page/${(m=e.plugin)==null?void 0:m.id}`);n&&(a=n)}catch(n){console.error(n)}}async function se(){var m;try{const n=await B.get(`plugin/${(m=e.plugin)==null?void 0:m.id}`);$e(n)||(g.value=n)}catch(n){console.error(n)}}async function re(){var m,n,L;try{const V=await B.put(`plugin/${(m=e.plugin)==null?void 0:m.id}`,g.value);V.success?(u.success(`插件 ${(n=e.plugin)==null?void 0:n.plugin_name} 配置已保存`),p.value=!1,_("save")):u.error(`插件 ${(L=e.plugin)==null?void 0:L.plugin_name} 配置保存失败：${V.message}}`)}catch(V){console.error(V)}}async function O(){await oe(),p.value=!1,s.value=!0}async function U(){await j(),await se(),s.value=!1,p.value=!0}const ie=h([{title:"查看详情",value:1,show:(X=e.plugin)==null?void 0:X.has_page,props:{prependIcon:"mdi-information-outline",click:O}},{title:"配置",value:2,show:!0,props:{prependIcon:"mdi-cog-outline",click:U}},{title:"插件",value:3,show:!0,props:{prependIcon:"mdi-trash-can-outline",color:"error",click:v}}]);return(m,n)=>{const L=W("IconBtn"),V=xe;return o(),k($,null,[i(w)?(o(),c(F,{key:0,width:e.width,height:e.height,onClick:n[0]||(n[0]=()=>{var f;(f=e.plugin)!=null&&f.has_page?O():U()})},{default:t(()=>{var f;return[D("div",{class:"relative pa-4 text-center card-cover-blurred",style:te({background:`${(f=e.plugin)==null?void 0:f.plugin_color}`})},[D("div",De,[l(L,null,{default:t(()=>[l(E,{icon:"mdi-dots-vertical",class:"text-white"}),l(pe,{activator:"parent","close-on-content-click":""},{default:t(()=>[l(de,null,{default:t(()=>[(o(!0),k($,null,T(i(ie),(r,b)=>ge((o(),c(fe,{key:b,variant:"plain","base-color":r.props.color,onClick:r.props.click},{prepend:t(()=>[l(E,{icon:r.props.prependIcon},null,8,["icon"])]),default:t(()=>[l(_e,{textContent:I(r.title)},null,8,["textContent"])]),_:2},1032,["base-color","onClick"])),[[me,r.show]])),128))]),_:1})]),_:1})]),_:1})]),l(le,{size:"128",class:M({shadow:i(y)})},{default:t(()=>{var r;return[l(ee,{src:`/plugin/${(r=e.plugin)==null?void 0:r.plugin_icon}`,"aspect-ratio":"4/3",cover:"",class:M({shadow:i(y)})},null,8,["src","class"])]}),_:1},8,["class"])],4),l(he,{class:"py-2"},{default:t(()=>[l(ne,{class:"flex items-center flex-row"},{default:t(()=>{var r,b;return[(r=e.plugin)!=null&&r.state?(o(),c(ve,{key:0,dot:"",inline:"",color:"success",class:"me-1 mb-1"})):x("",!0),C(" "+I((b=e.plugin)==null?void 0:b.plugin_name),1)]}),_:1})]),_:1}),l(z,null,{default:t(()=>{var r;return[C(I((r=e.plugin)==null?void 0:r.plugin_desc),1)]}),_:1})]}),_:1},8,["width","height"])):x("",!0),l(K,{modelValue:i(p),"onUpdate:modelValue":n[2]||(n[2]=f=>G(p)?p.value=f:null),"max-width":"800",scrollable:"",persistent:""},{default:t(()=>{var f;return[l(F,{title:`${(f=e.plugin)==null?void 0:f.plugin_name} - 配置`},{default:t(()=>[l(V,{onClick:n[1]||(n[1]=r=>p.value=!1)}),l(z,null,{default:t(()=>[(o(!0),k($,null,T(i(d),(r,b)=>(o(),c(Le,{key:b,config:r,form:i(g)},null,8,["config","form"]))),128))]),_:1}),l(J,null,{default:t(()=>[i(a).length>0?(o(),c(R,{key:0,onClick:O},{default:t(()=>[C(" 查看详情 ")]),_:1})):x("",!0),l(H),l(R,{onClick:re},{default:t(()=>[C(" 保存 ")]),_:1})]),_:1})]),_:1},8,["title"])]}),_:1},8,["modelValue"]),l(K,{modelValue:i(s),"onUpdate:modelValue":n[5]||(n[5]=f=>G(s)?s.value=f:null),"max-width":"1000",scrollable:"",persistent:""},{default:t(()=>{var f;return[l(F,{title:`${(f=e.plugin)==null?void 0:f.plugin_name}`},{default:t(()=>[l(V,{onClick:n[3]||(n[3]=r=>s.value=!1)}),l(z,null,{default:t(()=>[(o(!0),k($,null,T(i(a),(r,b)=>(o(),c(Be,{key:b,config:r},null,8,["config"]))),128))]),_:1}),l(J,null,{default:t(()=>[l(R,{onClick:U},{default:t(()=>[C(" 配置 ")]),_:1}),l(H),l(R,{onClick:n[4]||(n[4]=r=>s.value=!1)},{default:t(()=>[C(" 关闭 ")]),_:1})]),_:1})]),_:1},8,["title"])]}),_:1},8,["modelValue"])],64)}}});const Re=ae(Te,[["__scopeId","data-v-e549eecc"]]),Se={key:0,class:"mt-12 w-full text-center text-gray-500 text-sm flex flex-col items-center"},ze={key:1,class:"grid gap-4 grid-plugin-card"},Fe={class:"pa-4"},je={class:"grid gap-4 grid-plugin-card"},Ae=S({__name:"PluginCardListView",setup(P){const _=h([]),e=h(!1),u=h(!1),w=Q(()=>_.value.filter(a=>a.installed)),p=Q(()=>_.value.filter(a=>!a.installed));function g(){u.value=!1}function d(){s(),g()}async function s(){try{_.value=await B.get("plugin"),e.value=!0}catch(a){console.error(a)}}return ye(s),(a,y)=>(o(),k($,null,[i(e)?x("",!0):(o(),k("div",Se,[i(e)?x("",!0):(o(),c(Ve,{key:0,size:"48",indeterminate:"",color:"primary"}))])),i(w).length>0?(o(),k("div",ze,[(o(!0),k($,null,T(i(w),v=>(o(),c(Re,{key:v.id,plugin:v,onRemove:s,onSave:s},null,8,["plugin"]))),128))])):x("",!0),i(w).length===0&&i(e)?(o(),c(Y,{key:2,"error-code":"404","error-title":"没有安装插件","error-description":"点击右下角按钮，前往插件市场安装插件。"})):x("",!0),l(K,{modelValue:i(u),"onUpdate:modelValue":y[0]||(y[0]=v=>G(u)?u.value=v:null),fullscreen:"",scrim:!1,transition:"dialog-bottom-transition"},{activator:t(({props:v})=>[l(R,A({icon:"mdi-plus"},v,{size:"x-large",class:"fixed right-5 bottom-5"}),null,16)]),default:t(()=>[l(F,null,{default:t(()=>[D("div",null,[l(Ce,{color:"primary"},{default:t(()=>[l(ke,null,{default:t(()=>[C("插件市场")]),_:1}),l(H),l(we,null,{default:t(()=>[l(R,{size:"x-large",onClick:g},{default:t(()=>[l(E,{color:"white",icon:"mdi-close"})]),_:1})]),_:1})]),_:1})]),D("div",Fe,[D("div",je,[(o(!0),k($,null,T(i(p),v=>(o(),c(Ie,{key:v.id,plugin:v,onInstall:d},null,8,["plugin"]))),128))]),i(p).length===0&&i(e)?(o(),c(Y,{key:0,"error-code":"404","error-title":"没有未安装插件","error-description":"所有可用插件均已安装。"})):x("",!0)])]),_:1})]),_:1},8,["modelValue"])],64))}});const Ge=S({__name:"plugin",setup(P){return(_,e)=>(o(),c(Ae))}});export{Ge as default};
