import{d as B,r as x,q as ge,j as t,o as i,f as C,i as _,aC as ye,z as xe,$ as l,c as r,W as w,M as b,af as ke,p as I,ax as we,e as A,m as c,a3 as G,a as s,ag as L,t as d,I as W,V,aN as $e,aO as Se,K as D,a2 as Ve,a0 as F,Y as H,R as Ce,S as Ee,ac as Me,aP as je,a4 as K,P as De,aQ as Ie,aR as Pe,at as O,au as Q,aj as Te,b as Le}from"./index-29acab4d.js";import{_ as Be}from"./PersonCard.vue_vue_type_style_index_0_lang-fe26eab2.js";import{a as $}from"./index-585ed20f.js";import{S as Ne,_ as U}from"./MediaCardSlideView.vue_vue_type_script_setup_true_lang-62f425d3.js";import{_ as ze}from"./NoDataFound.vue_vue_type_script_setup_true_lang-aad8acd6.js";import{b as Re}from"./formatters-16dfb57c.js";import"./MediaCard.vue_vue_type_style_index_0_lang-7ee17492.js";import"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-3e7268af.js";import"./ExistIcon-14874f76.js";import"./_plugin-vue_export-helper-c27b6911.js";const qe=B({__name:"PersonCardSlideView",props:{apipath:String,linkurl:String,title:String},setup(P){const m=P,g=x(!1),e=x([]);async function h(){try{if(!m.apipath)return;e.value=await $.get(m.apipath),e.value.length>0&&(g.value=!0)}catch(f){console.error(f)}}return ge(h),(f,S)=>t(g)?(i(),C(Ne,ye(xe({key:0},m)),{content:_(()=>[(i(!0),r(b,null,w(t(e),v=>(i(),C(Be,{key:v.id,person:v,height:"15rem",width:"10rem"},null,8,["person"]))),128))]),_:1},16)):l("",!0)}}),Ae={key:0,class:"mt-12 w-full text-center text-gray-500 text-sm flex flex-col items-center"},Ge={key:1,class:"max-w-8xl mx-auto px-4"},We={class:"vue-media-back absolute left-0 top-0 w-full h-96"},Fe=s("div",{class:"vue-media-back absolute left-0 top-0 w-full h-96"},null,-1),He={class:"media-page"},Ke={class:"media-header"},Oe={class:"media-poster"},Qe={class:"w-full h-full"},Ue={class:"media-title"},Ye={key:0,class:"media-status"},Je=s("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full whitespace-nowrap transition !no-underline bg-green-500 bg-opacity-80 border border-green-500 !text-green-100 hover:bg-green-500 hover:bg-opacity-100 false overflow-hidden"},[s("div",{class:"relative z-20 flex items-center false"},[s("span",null,"已入库")])],-1),Xe=[Je],Ze={class:"d-flex flex-column flex-lg-row align-baseline justify-center justify-lg-start"},et={class:"align-self-center align-self-lg-end"},tt={key:0,class:"text-lg align-self-center align-self-lg-end"},st={class:"media-attributes"},at={key:0},it={key:1,class:"mx-1"},nt={key:2},rt={class:"media-actions"},ot={class:"media-overview"},lt={class:"media-overview-left"},ct={key:0,class:"tagline"},dt={key:1},ut={key:2,class:"media-crew"},_t=["href"],mt={key:3,class:"media-crew"},pt=["href"],ft=["href"],ht={class:"mt-6"},vt=["href"],bt={class:"inline-flex cursor-pointer items-center rounded-full bg-gray-600 px-2 py-1 text-sm text-gray-200 ring-1 ring-gray-500 transition hover:bg-gray-700"},gt=s("span",{class:"ms-1"},"TheMovieDb",-1),yt=["href"],xt={class:"inline-flex cursor-pointer items-center rounded-full bg-gray-600 px-2 py-1 text-sm text-gray-200 ring-1 ring-gray-500 transition hover:bg-gray-700"},kt=s("span",{class:"ms-1"},"豆瓣",-1),wt=["href"],$t={class:"inline-flex cursor-pointer items-center rounded-full bg-gray-600 px-2 py-1 text-sm text-gray-200 ring-1 ring-gray-500 transition hover:bg-gray-700"},St=s("span",{class:"ms-1"},"IMDb",-1),Vt=["href"],Ct={class:"inline-flex cursor-pointer items-center rounded-full bg-gray-600 px-2 py-1 text-sm text-gray-200 ring-1 ring-gray-500 transition hover:bg-gray-700"},Et=s("span",{class:"ms-1"},"TheTvDb",-1),Mt={key:4,class:"py-4"},jt={key:5,class:"flex w-full flex-col space-y-2"},Dt={class:"flex flex-row items-center justify-between"},It={class:"font-weight-bold"},Pt={class:"absolute right-12"},Tt={key:0,class:"mt-3 w-full text-center text-gray-500 text-sm flex flex-col items-center"},Lt={class:"flex flex-col justify-center divide-y divide-gray-700"},Bt={class:"flex-1"},Nt={class:"flex flex-col space-y-2 lg:flex-row lg:items-center lg:space-y-0 lg:space-x-2"},zt={class:"text-lg"},Rt={class:"flex items-center space-x-2"},qt={class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full whitespace-nowrap cursor-default bg-gray-700 !text-gray-300"},At={key:0,class:"media-overview-right"},Gt={class:"media-facts"},Wt={key:0,class:"media-ratings"},Ft={key:1,class:"media-fact"},Ht=s("span",null,"ID",-1),Kt={class:"media-fact-value"},Ot={key:2,class:"media-fact"},Qt=s("span",null,"原始标题",-1),Ut={class:"media-fact-value"},Yt={key:3,class:"media-fact"},Jt=s("span",null,"状态",-1),Xt={class:"media-fact-value"},Zt={key:4,class:"media-fact"},es=s("span",null,"上映日期",-1),ts={class:"media-fact-value"},ss={class:"flex items-center justify-end"},as=s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true",class:"h-4 w-4"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 15a4.5 4.5 0 004.5 4.5H18a3.75 3.75 0 001.332-7.257 3 3 0 00-3.758-3.848 5.25 5.25 0 00-10.233 2.33A4.502 4.502 0 002.25 15z"})],-1),is={class:"ml-1.5"},ns={key:5,class:"media-fact"},rs=s("span",null,"原始语言",-1),os={class:"media-fact-value"},ls={key:6,class:"media-fact"},cs=s("span",null,"出品国家",-1),ds={class:"media-fact-value"},us={class:"media-fact border-b-0"},_s=s("span",null,"制作公司",-1),ms={class:"media-fact-value text-end"},ps={key:0},fs={key:1},hs={key:2},vs=B({__name:"MediaDetailView",props:{mediaid:String,type:String},setup(P){const m=P,g=ke.useToast(),e=x({}),h=x(!1),f=x(!1),S=x(!1),v=x({}),E=x({}),M=x({});async function Y(){if(m.mediaid&&m.type){if(e.value=await $.get(`media/${m.mediaid}`,{params:{type_name:m.type}}),S.value=!0,!e.value.tmdb_id&&!e.value.douban_id)return;e.value.type==="电影"?X():Z(),e.value.type==="电影"?ee():se()}}async function J(a){if(!v.value[a])try{const n=await $.get(`tmdb/${e.value.tmdb_id}/${a}`);v.value[a]=n||[]}catch(n){console.error(n)}}async function X(){try{(await $.get("media/exists",{params:{tmdbid:e.value.tmdb_id,title:e.value.title,year:e.value.year,season:e.value.season,mtype:e.value.type}})).success&&(h.value=!0)}catch(a){console.error(a)}}async function N(a=0){try{const n=`tmdb:${e.value.tmdb_id}`;if((await $.get(`subscribe/media/${n}`,{params:{season:a}})).id)return!0}catch(n){console.error(n)}return!1}async function Z(){if(e.value.type==="电视剧")try{const a=await $.post("download/notexists",e.value);a&&(a.length===0&&(h.value=!0),a.forEach(n=>{let u=0;n.episodes.length===0?u=2:n.episodes.length<n.total_episode&&(u=1),u!==2&&(h.value=!0),E.value[n.season]=u}))}catch(a){console.error(a)}}async function ee(){e.value.type==="电影"&&(f.value=await N())}const te=I(()=>{var a,n;return(n=(a=e.value)==null?void 0:a.season_info)==null?void 0:n.filter(u=>u.season_number!==0)});async function se(){var a,n;if(e.value.type==="电视剧")try{(n=(a=e.value)==null?void 0:a.season_info)==null||n.forEach(async u=>{M.value[u.season_number??0]=await N(u.season_number)})}catch(u){console.error(u)}}async function ae(a=0){var n,u,y,o,p,j;O();try{let k=h.value?1:0;a&&(k=E.value[a]?0:1);const T=await $.post("subscribe/",{name:(n=e.value)==null?void 0:n.title,type:(u=e.value)==null?void 0:u.type,year:(y=e.value)==null?void 0:y.year,tmdbid:(o=e.value)==null?void 0:o.tmdb_id,doubanid:(p=e.value)==null?void 0:p.douban_id,season:a,best_version:k});T.success&&(f.value=!0,a&&(M.value[a]=!0)),ie(T.success,((j=e.value)==null?void 0:j.title)??"",a,T.message,k)}catch(k){console.error(k)}Q()}function ie(a,n,u,y,o){u&&(n=`${n} ${Re(u.toString())}`);let p="订阅";o>0&&(p="洗版订阅"),a?g.success(`${n} 添加${p}成功！`):g.error(`${n} 添加${p}失败：${y}！`)}async function ne(a){var n,u,y,o,p;O();try{const j=(n=e.value)!=null&&n.tmdb_id?`tmdb:${(u=e.value)==null?void 0:u.tmdb_id}`:`douban:${(y=e.value)==null?void 0:y.douban_id}`,k=await $.delete(`subscribe/media/${j}`,{params:{season:a}});k.success?(f.value=!1,a&&(M.value[a]=!1),g.success(`${(o=e.value)==null?void 0:o.title} 已取消订阅！`)):g.error(`${(p=e.value)==null?void 0:p.title} 取消订阅失败：${k.message}！`)}catch(j){console.error(j)}Q()}function z(a=0){f.value?ne(a):ae(a)}function re(a){return a.map(n=>n.name).join("、")}function oe(){return`https://www.themoviedb.org/${m.type==="电影"?"movie":"tv"}/${e.value.tmdb_id}`}function le(){return`https://movie.douban.com/subject/${e.value.douban_id}`}function ce(){return`https://www.imdb.com/title/${e.value.imdb_id}`}function de(){return`https://www.thetvdb.com/series/${e.value.tvdb_id}`}function ue(a){return a?`https://image.tmdb.org/t/p/w500${a}`:""}function _e(a=""){return a?a.replace("original","w500"):""}const me=I(()=>{var a;return(a=e.value.production_countries)==null?void 0:a.map(n=>n.name)}),pe=I(()=>{var a;return(a=e.value.production_companies)==null?void 0:a.map(n=>n.name)});function fe(a){const n=E.value[a];return n?n===1?"warning":n===2?"error":"success":"success"}function he(a){const n=E.value[a];return n?n===1?"部分缺失":n===2?"缺失":"已存在":"已存在"}const ve=I(()=>f.value?"mdi-heart":"mdi-heart-outline"),be=I(()=>f.value?"error":"warning");function R(a){return a.join("、")}function q(a){Te.push({path:"/resource",query:{keyword:`tmdb:${e.value.tmdb_id}`,type:e.value.type,area:a}})}return we(()=>{Y()}),(a,n)=>{const u=A("VSkeletonLoader"),y=A("IconBtn");return i(),r(b,null,[t(S)?l("",!0):(i(),r("div",Ae,[c(G,{size:"48",indeterminate:"",color:"primary"})])),t(e).tmdb_id||t(e).douban_id?(i(),r("div",Ge,[t(e).backdrop_path?(i(),r(b,{key:0},[s("div",We,[c(L,{class:"h-96",src:t(e).backdrop_path,cover:""},null,8,["src"])]),Fe],64)):l("",!0),s("div",He,[s("div",Ke,[s("div",Oe,[c(L,{src:_e(t(e).poster_path),cover:"",class:"object-cover aspect-w-2 aspect-h-3 ring-1 ring-gray-500"},{placeholder:_(()=>[s("div",Qe,[c(u,{class:"object-cover aspect-w-2 aspect-h-3"})])]),_:1},8,["src"])]),s("div",Ue,[t(h)?(i(),r("div",Ye,Xe)):l("",!0),s("h1",Ze,[s("div",et,d(t(e).title),1),t(e).year?(i(),r("div",tt," （"+d(t(e).year)+"） ",1)):l("",!0)]),s("span",st,[t(e).runtime||t(e).episode_run_time[0]?(i(),r("span",at,d(t(e).runtime||t(e).episode_run_time[0])+" 分钟",1)):l("",!0),(t(e).runtime||t(e).episode_run_time[0])&&t(e).genres?(i(),r("span",it," | ")):l("",!0),t(e).genres?(i(),r("span",nt,d(re(t(e).genres||[])),1)):l("",!0)])]),s("div",rt,[t(e).tmdb_id?(i(),C(W,{key:0,variant:"tonal",color:"info"},{prepend:_(()=>[c(V,{icon:"mdi-magnify"})]),default:_(()=>[D(" 搜索资源 "),c(Me,{activator:"parent","close-on-content-click":""},{default:_(()=>[c(Ve,null,{default:_(()=>[c(F,{variant:"plain",onClick:n[0]||(n[0]=o=>q("title"))},{default:_(()=>[c(H,null,{default:_(()=>[D("标题")]),_:1})]),_:1}),Ce(c(F,{variant:"plain",onClick:n[1]||(n[1]=o=>q("imdbid"))},{default:_(()=>[c(H,null,{default:_(()=>[D("IMDB链接")]),_:1})]),_:1},512),[[Ee,t(e).imdb_id]])]),_:1})]),_:1})]),_:1})):l("",!0),t(e).type==="电影"?(i(),C(W,{key:1,class:"ms-2",color:t(be),variant:"tonal",onClick:n[2]||(n[2]=o=>z(0))},{prepend:_(()=>[c(V,{icon:t(ve)},null,8,["icon"])]),default:_(()=>[D(" "+d(t(f)?"已订阅":"订阅"),1)]),_:1},8,["color"])):l("",!0)])]),s("div",ot,[s("div",lt,[t(e).tagline?(i(),r("div",ct,d(t(e).tagline),1)):l("",!0),t(e).overview?(i(),r("h2",dt," 简介 ")):l("",!0),s("p",null,d(t(e).overview),1),t(e).tmdb_id?(i(),r("ul",ut,[(i(!0),r(b,null,w(t(e).directors,o=>(i(),r("li",{key:o.id},[s("span",null,d(o.job),1),s("a",{class:"crew-name",href:`person?personid=${o.id}`,target:"_blank"},d(o.name),9,_t)]))),128))])):l("",!0),!t(e).tmdb_id&&t(e).douban_id?(i(),r("ul",mt,[(i(!0),r(b,null,w(t(e).directors,o=>(i(),r("li",{key:o.id},[s("span",null,d(R(o.roles)),1),s("a",{class:"crew-name",href:`${o.url}`,target:"_blank"},d(o.name),9,pt)]))),128)),(i(!0),r(b,null,w(t(e).actors,o=>(i(),r("li",{key:o.id},[s("span",null,d(R(o.roles)),1),s("a",{class:"crew-name",href:`${o.url}`,target:"_blank"},d(o.name),9,ft)]))),128))])):l("",!0),s("div",ht,[t(e).tmdb_id?(i(),r("a",{key:0,class:"mb-2 mr-2 inline-flex last:mr-0",href:oe(),target:"_blank"},[s("div",bt,[c(V,{icon:"mdi-link"}),gt])],8,vt)):l("",!0),t(e).douban_id?(i(),r("a",{key:1,class:"mb-2 mr-2 inline-flex last:mr-0",href:le(),target:"_blank"},[s("div",xt,[c(V,{icon:"mdi-link"}),kt])],8,yt)):l("",!0),t(e).imdb_id?(i(),r("a",{key:2,class:"mb-2 mr-2 inline-flex last:mr-0",href:ce(),target:"_blank"},[s("div",$t,[c(V,{icon:"mdi-link"}),St])],8,wt)):l("",!0),t(e).tvdb_id?(i(),r("a",{key:3,class:"mb-2 mr-2 inline-flex last:mr-0",href:de(),target:"_blank"},[s("div",Ct,[c(V,{icon:"mdi-link"}),Et])],8,Vt)):l("",!0)]),t(e).type==="电视剧"&&t(e).tmdb_id?(i(),r("h2",Mt," 季 ")):l("",!0),t(e).type==="电视剧"&&t(e).tmdb_id?(i(),r("div",jt,[c($e,null,{default:_(()=>[(i(!0),r(b,null,w(t(te),o=>(i(),C(Pe,{key:o.season_number,"onGroup:selected":p=>J(o.season_number||0)},{default:_(()=>[c(je,null,{default:_(()=>[s("div",Dt,[s("span",It,"第 "+d(o.season_number)+" 季",1),c(K,{size:"small",class:"ms-1"},{default:_(()=>[D(d(o.episode_count)+"集 ",1)]),_:2},1024),s("div",Pt,[t(E)?(i(),C(K,{key:0,color:fe(o.season_number||0),flat:""},{default:_(()=>[D(d(he(o.season_number||0)),1)]),_:2},1032,["color"])):l("",!0),c(y,{class:"ms-1",color:t(M)[o.season_number||0]?"error":"warning",variant:"text",onClick:De(p=>z(o.season_number),["stop"])},{default:_(()=>[c(V,{icon:t(M)[o.season_number||0]?"mdi-heart":"mdi-heart-outline"},null,8,["icon"])]),_:2},1032,["color","onClick"])])])]),_:2},1024),c(Ie,null,{default:_(()=>[t(v)[o.season_number||0]?l("",!0):(i(),r("div",Tt,[c(G,{size:"48",indeterminate:"",color:"primary"})])),s("div",Lt,[(i(!0),r(b,null,w(t(v)[o.season_number||0],p=>(i(),r("div",{key:p.episode_number,class:"flex flex-col space-y-4 py-4 xl:flex-row xl:space-y-4 xl:space-x-4"},[s("div",Bt,[s("div",Nt,[s("h3",zt,d(p.episode_number)+" - "+d(p.name),1),s("div",Rt,[s("span",qt,d(p.air_date),1)])]),s("p",null,d(p.overview),1)]),c(L,{cover:"",class:"rounded-lg","max-width":"15rem",src:ue(p.still_path||""),alt:""},null,8,["src"])]))),128))])]),_:2},1024)]),_:2},1032,["onGroup:selected"]))),128))]),_:1})])):l("",!0)]),t(e).tmdb_id?(i(),r("div",At,[s("div",Gt,[t(e).vote_average?(i(),r("div",Wt,[c(Se,{modelValue:t(e).vote_average,"onUpdate:modelValue":n[3]||(n[3]=o=>t(e).vote_average=o),density:"compact",length:"10",class:"ma-2",readonly:""},null,8,["modelValue"])])):l("",!0),t(e).tmdb_id?(i(),r("div",Ft,[Ht,s("span",Kt,d(t(e).tmdb_id),1)])):l("",!0),t(e).original_title||t(e).original_name?(i(),r("div",Ot,[Qt,s("span",Ut,d(t(e).original_title||t(e).original_name),1)])):l("",!0),t(e).status?(i(),r("div",Yt,[Jt,s("span",Xt,d(t(e).status),1)])):l("",!0),t(e).release_date||t(e).first_air_date?(i(),r("div",Zt,[es,s("span",ts,[s("span",ss,[as,s("span",is,d(t(e).release_date||t(e).first_air_date),1)])])])):l("",!0),t(e).original_language?(i(),r("div",ns,[rs,s("span",os,d(t(e).original_language),1)])):l("",!0),t(e).production_countries?(i(),r("div",ls,[cs,s("span",ds,[(i(!0),r(b,null,w(t(me),o=>(i(),r("span",{key:o,class:"flex items-center justify-end text-end"},d(o),1))),128))])])):l("",!0),s("div",us,[_s,s("span",ms,[(i(!0),r(b,null,w(t(pe),o=>(i(),r("span",{key:o,class:"block"},d(o),1))),128))])])])])):l("",!0)]),t(e).tmdb_id?(i(),r("div",ps,[c(qe,{apipath:`tmdb/credits/${t(e).tmdb_id}/${m.type}`,linkurl:`/credits/tmdb/credits/${t(e).tmdb_id}/${m.type}?title=演员阵容`,title:"演员阵容"},null,8,["apipath","linkurl"])])):l("",!0),t(e).tmdb_id?(i(),r("div",fs,[c(U,{apipath:`tmdb/recommend/${t(e).tmdb_id}/${m.type}`,linkurl:`/browse/tmdb/recommend/${t(e).tmdb_id}/${m.type}?title=推荐`,title:"推荐"},null,8,["apipath","linkurl"])])):l("",!0),t(e).tmdb_id?(i(),r("div",hs,[c(U,{apipath:`tmdb/similar/${t(e).tmdb_id}/${m.type}`,linkurl:`/browse/tmdb/similar/${t(e).tmdb_id}/${m.type}?title=类似`,title:"类似"},null,8,["apipath","linkurl"])])):l("",!0)])])):l("",!0),!t(e).tmdb_id&&!t(e).douban_id&&t(S)?(i(),C(ze,{key:2,"error-code":"500","error-title":"出错啦！","error-description":"未识别到TMDB媒体信息。"})):l("",!0)],64)}}});const Es=B({__name:"media",setup(P){var h,f,S,v;const m=Le(),g=(f=(h=m.query)==null?void 0:h.mediaid)==null?void 0:f.toString(),e=(v=(S=m.query)==null?void 0:S.type)==null?void 0:v.toString();return(E,M)=>(i(),r("div",null,[c(vs,{mediaid:t(g),type:t(e)},null,8,["mediaid","type"])]))}});export{Es as default};
