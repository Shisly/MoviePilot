import{b as je,a as de}from"./index-e40242f1.js";import{d as Z,r as g,p as W,e as ue,o as r,f as p,i as t,m as e,ac as ke,I as M,aC as Ee,aS as He,V as h,a2 as te,c as E,W as Y,a0 as le,j as l,Y as ae,K as b,t as F,M as K,$ as j,aF as Ge,z as xe,A as H,B as z,E as N,F as q,G as ye,L as ne,aD as Ve,aU as Te,aV as Pe,a as G,w as oe,q as Le,P as A,a1 as ce,af as Je,ae as Ke,N as Qe,a3 as Ye,ag as Ze,aW as Ie,Z as Xe,H as et,Q as tt,C as ie,D as O,a8 as ve,R as lt,S as at,ai as nt,aa as ot,a6 as _e,ax as Be}from"./index-3d39bc5b.js";import{_ as be}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as st}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-afaca0cb.js";import{n as Se}from"./index-705cb9e8.js";import{a as Ue}from"./formatters-16dfb57c.js";import{_ as rt}from"./MediaInfoCard.vue_vue_type_script_setup_true_lang-64eaeace.js";const Re=k=>(Te("data-v-19d7a72c"),k=k(),Pe(),k),it=Re(()=>G("div",{class:"flex-grow-1"},null,-1)),dt=Re(()=>G("div",{class:"flex-grow-1"},null,-1)),ut=Z({__name:"Toolbar",props:{storages:Array,storage:String,path:String,endpoints:Object,axios:Object},emits:["storagechanged","pathchanged","loading","foldercreated","sortchanged"],setup(k,{emit:v}){const a=k,P=g(!1),C=g(""),T=g("name");function I(){T.value==="name"?T.value="time":T.value="name",v("sortchanged",T.value)}const S=W(()=>{var _,i;let c="";const u=(_=a.path)==null?void 0:_.endsWith("/"),f=(i=a.path)==null?void 0:i.split("/").filter(V=>V);return(f==null?void 0:f.map((V,B)=>(c+=V+(B<f.length-1||u?"/":""),{name:V,path:c})))??[]}),L=W(()=>{var c;return(c=a.storages)==null?void 0:c.find(u=>u.code===a.storage)});function R(c){a.storage!==c&&(v("storagechanged",c),v("pathchanged",""))}function D(c){v("pathchanged",c)}function $(){const c=S.value??[],u=(c==null?void 0:c.length)===1?"/":c[c.length-2].path;D(u)}async function w(){var f,_,i;v("loading",!0);const u={url:(f=a.endpoints)==null?void 0:f.mkdir.url.replace(/{storage}/g,a.storage).replace(/{path}/g,encodeURIComponent(a.path+C.value)),method:((_=a.endpoints)==null?void 0:_.mkdir.method)||"post"};await((i=a.axios)==null?void 0:i.request(u)),P.value=!1,C.value="",v("loading",!1),v("foldercreated")}const y=W(()=>T.value==="time"?"mdi-sort-clock-ascending-outline":"mdi-sort-alphabetical-ascending");return(c,u)=>{const f=ue("Icon"),_=ue("IconBtn");return r(),p(Ve,{flat:"",dense:""},{default:t(()=>[e(Ge,{class:"overflow-hidden"},{default:t(()=>{var i;return[(i=a.storages)!=null&&i.length||0>1?(r(),p(ke,{key:0,"offset-y":""},{activator:t(({props:V})=>[e(M,Ee(He(V)),{default:t(()=>[e(h,{icon:"mdi-arrow-down-drop-circle-outline"})]),_:2},1040)]),default:t(()=>[e(te,null,{default:t(()=>[(r(!0),E(K,null,Y(k.storages,(V,B)=>{var X;return r(),p(le,{key:B,disabled:V.code===((X=l(L))==null?void 0:X.code),onClick:ee=>R(V.code)},{prepend:t(()=>[e(f,{icon:V.icon},null,8,["icon"])]),default:t(()=>[e(ae,null,{default:t(()=>[b(F(V.name),1)]),_:2},1024)]),_:2},1032,["disabled","onClick"])}),128))]),_:1})]),_:1})):j("",!0),e(M,{variant:"text","input-value":k.path==="/",class:"px-1",onClick:u[0]||(u[0]=V=>D("/"))},{default:t(()=>{var V,B;return[e(h,{icon:(V=l(L))==null?void 0:V.icon,class:"mr-2"},null,8,["icon"]),b(" "+F((B=l(L))==null?void 0:B.name),1)]}),_:1},8,["input-value"]),(r(!0),E(K,null,Y(l(S),(V,B)=>(r(),p(M,{key:B,variant:"text","input-value":B===l(S).length-1,class:"px-1 d-none d-md-block",onClick:X=>D(V.path)},{default:t(()=>[e(h,{icon:" mdi-chevron-right"}),b(" "+F(V.name),1)]),_:2},1032,["input-value","onClick"]))),128))]}),_:1}),it,e(_,{onClick:I},{default:t(()=>[e(h,{icon:l(y)},null,8,["icon"])]),_:1}),l(S).length>0?(r(),p(_,{key:0,onClick:$},{default:t(()=>[e(h,{icon:"mdi-arrow-up-bold-outline"})]),_:1})):j("",!0),e(ne,{modelValue:l(P),"onUpdate:modelValue":u[3]||(u[3]=i=>q(P)?P.value=i:null),"max-width":"50rem"},{activator:t(({props:i})=>[e(_,xe({title:"新建文件夹"},i),{default:t(()=>[e(h,{icon:"mdi-folder-plus-outline"})]),_:2},1040)]),default:t(()=>[e(H,{title:"新建文件夹"},{default:t(()=>[e(z,null,{default:t(()=>[e(N,{modelValue:l(C),"onUpdate:modelValue":u[1]||(u[1]=i=>q(C)?C.value=i:null),label:"名称"},null,8,["modelValue"])]),_:1}),e(ye,null,{default:t(()=>[dt,e(M,{depressed:"",onClick:u[2]||(u[2]=i=>P.value=!1)},{default:t(()=>[b(" 取消 ")]),_:1}),e(M,{disabled:!l(C),depressed:"",onClick:w},{default:t(()=>[b(" 新建 ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}});const ct=be(ut,[["__scopeId","data-v-19d7a72c"]]),pt={class:"grow scroll-x"},ft=Z({__name:"Tree",props:{icons:Object,storage:String,path:String,endpoints:Object,axios:Object,refreshpending:Boolean},emits:["pathchanged","loading","refreshed"],setup(k,{emit:v}){const a=k,P=g([]),C=g([]),T=g([]),I=g("");function S(){P.value=[],T.value=[{type:"dir",path:"/",basename:"root",extension:"",name:"root",children:[],size:0}]}async function L($){var u,f,_;v("loading",!0);const y={url:(u=a.endpoints)==null?void 0:u.list.url.replace(/{storage}/g,a.storage).replace(/{path}/g,$.path),method:((f=a.endpoints)==null?void 0:f.list.method)||"get"},c=await((_=a.axios)==null?void 0:_.request(y))??[];$.children=c.map(i=>(i.type==="dir"&&(i.children=[]),i)),v("loading",!1)}function R($){let w="";C.value.length&&(w=C.value[0]),a.path!==w&&v("pathchanged",w)}function D($){const w=[];for(w.push(T.value[0]);w.length>0;){const y=w.pop();if((y==null?void 0:y.path)===$)return y;if(y!=null&&y.children&&y.children.length)for(const c of y.children)w.push(c)}return null}return oe(()=>a.storage,()=>{S()}),oe(()=>a.path,()=>{a.path&&(C.value=[a.path],P.value.includes(a.path)||P.value.push(a.path))}),oe(()=>a.refreshpending,async()=>{if(a.refreshpending&&a.path){const $=D(a.path);$&&(await L($),v("refreshed"))}}),Le(()=>{S()}),($,w)=>{const y=ue("VTreeview");return r(),p(H,{flat:"",width:"250","min-height":"500",class:"d-flex flex-column folders-tree-card"},{default:t(()=>[G("div",pt,[e(y,{open:l(P),active:l(C),items:l(T),search:l(I),"load-children":L,"item-key":"path","item-text":"basename",dense:"",activatable:"",transition:"",class:"folders-tree","onUpdate:active":R},{prepend:t(({item:c,open:u})=>[c.type==="dir"?(r(),p(h,{key:0},{default:t(()=>[b(F(u?"mdi-folder-open-outline":"mdi-folder-outline"),1)]),_:2},1024)):a.icons?(r(),p(h,{key:1,icon:a.icons[c.extension.toLowerCase()]||a.icons.other},null,8,["icon"])):j("",!0)]),label:t(({item:c})=>[b(F(c.basename)+" ",1),c.type==="dir"?(r(),p(M,{key:0,icon:"",class:"ml-1",onClick:A(u=>L(c),["stop"])},{default:t(()=>[e(h,{class:"pa-0 mdi-18px",color:"grey lighten-1"},{default:t(()=>[b(" mdi-refresh ")]),_:1})]),_:2},1032,["onClick"])):j("",!0)]),_:1},8,["open","active","items","search"])]),e(ce),e(Ve,{density:"compact"},{default:t(()=>[e(M,{icon:"",onClick:S},{default:t(()=>[e(h,{icon:"mdi-collapse-all-outline"})]),_:1})]),_:1})]),_:1})}}});const mt=be(ft,[["__scopeId","data-v-5e129369"]]),pe=k=>(Te("data-v-5f5f73d3"),k=k(),Pe(),k),gt=pe(()=>G("br",null,null,-1)),ht=pe(()=>G("br",null,null,-1)),vt=pe(()=>G("div",{class:"flex-grow-1"},null,-1)),_t=pe(()=>G("div",{class:"flex-grow-1"},null,-1)),kt=Z({__name:"List",props:{icons:Object,storage:String,path:String,endpoints:Object,axios:Object,refreshpending:Boolean,sort:String},emits:["loading","pathchanged","refreshed","filedeleted","renamed"],setup(k,{emit:v}){const a=k,P=Je.useToast(),C=g(!0),T=Ke(),I=g(a.storage??""),S=g(a.axios??je),L=g([]),R=g(""),D=g(!1),$=g(!1),w=g(!1),y=g("请稍候 ..."),c=g(0),u=g(),f=g(""),_=g(),i=Qe({path:"",target:"",tmdbid:null,season:null,type_name:"",transfer_type:"",episode_format:"",episode_detail:"",episode_part:"",episode_offset:null,min_filesize:0}),V=g(),B=g(!1),X=g(Array.from({length:51},(o,n)=>n).map(o=>({title:`第 ${o} 季`,value:o}))),ee=W(()=>L.value.filter(o=>o.type==="dir"&&o.basename.includes(R.value))),se=W(()=>L.value.filter(o=>o.type==="file"&&o.basename.includes(R.value))),De=W(()=>{var o;return(o=a.path)==null?void 0:o.endsWith("/")}),J=W(()=>!De.value),Ce=W(()=>{var n,d;const o=(d=(n=a.path)==null?void 0:n.split(".").pop())==null?void 0:d.toLowerCase();return["png","jpg","jpeg","gif","bmp"].includes(o??"")});async function Q(){var d,U;C.value=!0,v("loading",!0);const n={url:(d=a.endpoints)==null?void 0:d.list.url.replace(/{storage}/g,I.value).replace(/{path}/g,encodeURIComponent(a.path||"")).replace(/{sort}/g,a.sort||"name"),method:((U=a.endpoints)==null?void 0:U.list.method)||"get"};L.value=await S.value.request(n)??[],v("loading",!1),C.value=!1}async function fe(o){var d,U;if(await T({title:"确认",content:`是否确认删除${o.type==="dir"?"目录":"文件"} ${o.basename}？`,confirmationText:"确认",cancellationText:"取消",dialogProps:{maxWidth:"50rem"}})){v("loading",!0);const m={url:(d=a.endpoints)==null?void 0:d.delete.url.replace(/{storage}/g,I.value).replace(/{path}/g,encodeURIComponent(o.path)),method:((U=a.endpoints)==null?void 0:U.delete.method)||"post"};await S.value.request(m),v("filedeleted"),v("loading",!1),Q()}}function we(o){v("pathchanged",o)}function Fe(o){var s;if(!o)return;const n=_e.state.auth.token,U=`/api/v1/${((s=a.endpoints)==null?void 0:s.download.url.replace(/{storage}/g,I.value).replace(/{path}/g,encodeURIComponent(o))).slice(1)}&token=${n}`;window.open(U,"_blank")}function Oe(o){var U;if(!o)return"";const n=_e.state.auth.token;return`/api/v1/${((U=a.endpoints)==null?void 0:U.image.url.replace(/{storage}/g,I.value).replace(/{path}/g,encodeURIComponent(o))).slice(1)}&token=${n}`}function me(o){_.value=o,f.value=o.name,D.value=!0}async function ze(){var d,U,s,m;v("loading",!0);const n={url:(U=a.endpoints)==null?void 0:U.rename.url.replace(/{storage}/g,a.storage).replace(/{path}/g,encodeURIComponent(((d=_.value)==null?void 0:d.path)||"")).replace(/{newname}/g,encodeURIComponent(f.value)),method:((s=a.endpoints)==null?void 0:s.mkdir.method)||"post"};await((m=a.axios)==null?void 0:m.request(n)),D.value=!1,f.value="",v("loading",!1),v("renamed")}function ge(o){_.value=o,$.value=!0}async function Me(){var o;i.path=((o=_.value)==null?void 0:o.path)??"";try{$.value=!1,w.value=!0,Ae(),de.post("transfer/manual",{},{params:i}).then(n=>{var d,U;w.value=!1,We(),n.success?(P.success(`${(d=_.value)==null?void 0:d.name} 整理成功！`),Q()):P.error(`${(U=_.value)==null?void 0:U.name} 整理失败：${n.message}！`)})}catch(n){console.log(n)}}function Ne(o){return new Date(o*1e3).toLocaleString()}oe(()=>a.path,async()=>{L.value=[],V.value=void 0,B.value=!1,await Q()}),oe(()=>a.refreshpending,async()=>{a.refreshpending&&(await Q(),v("refreshed"))});function Ae(){y.value="请稍候 ...";const o=_e.state.auth.token;u.value=new EventSource(`/api/v1/system/progress/filetransfer?token=${o}`),u.value.onmessage=n=>{const d=JSON.parse(n.data);d&&(y.value=d.text,c.value=d.value)}}function We(){var o;(o=u.value)==null||o.close()}async function re(o){var n,d;try{w.value=!0,y.value=`正在识别 ${o} ...`,c.value=0,V.value=await de.get("media/recognize_file",{params:{path:o}}),w.value=!1,V.value||P.error(`${o} 识别失败！`),B.value=!!((d=(n=V.value)==null?void 0:n.meta_info)!=null&&d.name)}catch(U){console.error(U)}}const $e=g([{title:"识别",value:1,props:{prependIcon:"mdi-text-recognition",click:o=>{re(o.path||"")}}},{title:"重命名",value:2,props:{prependIcon:"mdi-rename",click:me}},{title:"整理",value:3,props:{prependIcon:"mdi-folder-arrow-right",click:ge}},{title:"删除",value:4,props:{prependIcon:"mdi-delete-outline",color:"error",click:fe}}]);return Le(()=>{Q()}),(o,n)=>{const d=ue("IconBtn"),U=st;return r(),E(K,null,[e(H,{class:"d-flex flex-column"},{default:t(()=>[l(C)?(r(),p(z,{key:0,class:"text-center flex flex-col items-center"},{default:t(()=>[e(Ye,{size:"48",indeterminate:"",color:"primary"})]),_:1})):j("",!0),k.path?l(J)&&!l(Ce)?(r(),p(z,{key:2,class:"text-center break-all"},{default:t(()=>{var s,m,x;return[G("strong",null,F((s=l(L)[0])==null?void 0:s.name),1),gt,b(" 大小："+F(l(Ue)(((m=l(L)[0])==null?void 0:m.size)||0)),1),ht,b(" 修改时间："+F(Ne(((x=l(L)[0])==null?void 0:x.modify_time)||0)),1)]}),_:1})):l(J)&&l(Ce)?(r(),p(z,{key:3,class:"grow d-flex justify-center align-center"},{default:t(()=>[e(Ze,{src:Oe(k.path),"max-width":"100%","max-height":"100%"},null,8,["src"])]),_:1})):l(ee).length||l(se).length?(r(),p(z,{key:4,class:"p-0"},{default:t(()=>[l(ee).length?(r(),p(te,{key:0,subheader:""},{default:t(()=>[e(Ie,null,{default:t(()=>[b("目录")]),_:1}),(r(!0),E(K,null,Y(l(ee),(s,m)=>(r(),p(le,{key:m,class:"px-3 pe-1",onClick:x=>we(s.path)},{prepend:t(()=>[e(h,{icon:"mdi-folder-outline"})]),append:t(()=>[e(d,{class:"d-sm-none"},{default:t(()=>[e(h,{icon:"mdi-dots-vertical"}),e(ke,{activator:"parent","close-on-content-click":""},{default:t(()=>[e(te,null,{default:t(()=>[(r(!0),E(K,null,Y(l($e),(x,he)=>(r(),p(le,{key:he,variant:"plain","base-color":x.props.color,onClick:qe=>x.props.click(s)},{prepend:t(()=>[e(h,{icon:x.props.prependIcon},null,8,["icon"])]),default:t(()=>[e(ae,{textContent:F(x.title)},null,8,["textContent"])]),_:2},1032,["base-color","onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024),e(d,{class:"d-none d-sm-block",onClick:A(x=>re(s.path),["stop"])},{default:t(()=>[e(h,{icon:"mdi-text-recognition"})]),_:2},1032,["onClick"]),e(d,{class:"d-none d-sm-block",onClick:A(x=>me(s),["stop"])},{default:t(()=>[e(h,{icon:"mdi-rename"})]),_:2},1032,["onClick"]),e(d,{class:"d-none d-sm-block",onClick:A(x=>ge(s),["stop"])},{default:t(()=>[e(h,{icon:"mdi-folder-arrow-right"})]),_:2},1032,["onClick"]),e(d,{class:"d-none d-sm-block",onClick:A(x=>fe(s),["stop"])},{default:t(()=>[e(h,{icon:"mdi-delete-outline"})]),_:2},1032,["onClick"])]),default:t(()=>[e(ae,{textContent:F(s.name)},null,8,["textContent"])]),_:2},1032,["onClick"]))),128))]),_:1})):j("",!0),l(ee).length&&l(se).length?(r(),p(ce,{key:1})):j("",!0),l(se).length?(r(),p(te,{key:2,subheader:""},{default:t(()=>[e(Ie,null,{default:t(()=>[b("文件")]),_:1}),(r(!0),E(K,null,Y(l(se),(s,m)=>(r(),p(le,{key:m,class:"pl-3 pe-1",onClick:x=>we(s.path)},{prepend:t(()=>{var x;return[a.icons?(r(),p(h,{key:0,icon:a.icons[s.extension.toLowerCase()]||((x=a.icons)==null?void 0:x.other)},null,8,["icon"])):j("",!0)]}),append:t(()=>[e(d,{class:"d-sm-none"},{default:t(()=>[e(h,{icon:"mdi-dots-vertical"}),e(ke,{activator:"parent","close-on-content-click":""},{default:t(()=>[e(te,null,{default:t(()=>[(r(!0),E(K,null,Y(l($e),(x,he)=>(r(),p(le,{key:he,variant:"plain","base-color":x.props.color,onClick:qe=>x.props.click(s)},{prepend:t(()=>[e(h,{icon:x.props.prependIcon},null,8,["icon"])]),default:t(()=>[e(ae,{textContent:F(x.title)},null,8,["textContent"])]),_:2},1032,["base-color","onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024),e(d,{class:"d-none d-sm-block",onClick:A(x=>re(s.path),["stop"])},{default:t(()=>[e(h,{icon:"mdi-text-recognition"})]),_:2},1032,["onClick"]),e(d,{class:"d-none d-sm-block",onClick:A(x=>me(s),["stop"])},{default:t(()=>[e(h,{icon:"mdi-rename"})]),_:2},1032,["onClick"]),e(d,{class:"d-none d-sm-block",onClick:A(x=>ge(s),["stop"])},{default:t(()=>[e(h,{icon:"mdi-folder-arrow-right"})]),_:2},1032,["onClick"]),e(d,{class:"d-none d-sm-block",onClick:A(x=>fe(s),["stop"])},{default:t(()=>[e(h,{icon:"mdi-delete-outline"})]),_:2},1032,["onClick"])]),default:t(()=>[e(ae,{textContent:F(s.name)},null,8,["textContent"]),e(Xe,null,{default:t(()=>[b(F(l(Ue)(s.size)),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):j("",!0)]),_:1})):l(R)?(r(),p(z,{key:5,class:"grow d-flex justify-center align-center grey--text py-5"},{default:t(()=>[b(" 没有目录或文件 ")]),_:1})):l(C)?j("",!0):(r(),p(z,{key:6,class:"grow d-flex justify-center align-center grey--text py-5"},{default:t(()=>[b(" 空目录 ")]),_:1})):(r(),p(z,{key:1,class:"grow d-flex justify-center align-center grey--text"},{default:t(()=>[b(" 选择目录或文件 ")]),_:1})),k.path?(r(),p(ce,{key:7})):j("",!0),l(C)?j("",!0):(r(),p(Ve,{key:8,density:"compact",flat:"",color:"gray"},{default:t(()=>[l(J)?j("",!0):(r(),p(N,{key:0,modelValue:l(R),"onUpdate:modelValue":n[0]||(n[0]=s=>q(R)?R.value=s:null),"hide-details":"",flat:"",density:"compact",variant:"solo-filled",placeholder:"搜索 ...","prepend-inner-icon":"mdi-filter-outline",class:"me-2"},null,8,["modelValue"])),l(J)?(r(),p(et,{key:1})):j("",!0),l(J)?(r(),p(d,{key:2,onClick:n[1]||(n[1]=s=>re(a.path||""))},{default:t(()=>[e(h,{color:"primary"},{default:t(()=>[b(" mdi-text-recognition ")]),_:1})]),_:1})):j("",!0),l(J)?(r(),p(d,{key:3,onClick:n[2]||(n[2]=s=>Fe(a.path||""))},{default:t(()=>[e(h,{color:"primary"},{default:t(()=>[b(" mdi-download ")]),_:1})]),_:1})):j("",!0),l(J)?j("",!0):(r(),p(d,{key:4,onClick:Q},{default:t(()=>[e(h,{color:"primary"},{default:t(()=>[b(" mdi-refresh ")]),_:1})]),_:1}))]),_:1}))]),_:1}),e(ne,{modelValue:l(D),"onUpdate:modelValue":n[5]||(n[5]=s=>q(D)?D.value=s:null),"max-width":"50rem"},{activator:t(({props:s})=>[e(d,xe({title:"重命名"},s),{default:t(()=>[e(h,{icon:"mdi-rename-outline"})]),_:2},1040)]),default:t(()=>[e(H,{title:"重命名"},{default:t(()=>[e(z,null,{default:t(()=>[e(N,{modelValue:l(f),"onUpdate:modelValue":n[3]||(n[3]=s=>q(f)?f.value=s:null),label:"名称"},null,8,["modelValue"])]),_:1}),e(ye,null,{default:t(()=>[vt,e(M,{depressed:"",onClick:n[4]||(n[4]=s=>D.value=!1)},{default:t(()=>[b(" 取消 ")]),_:1}),e(M,{disabled:!l(f),depressed:"",onClick:ze},{default:t(()=>[b(" 重命名 ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(ne,{modelValue:l($),"onUpdate:modelValue":n[17]||(n[17]=s=>q($)?$.value=s:null),"max-width":"800",scrollable:""},{activator:t(({props:s})=>[e(d,xe({title:"整理"},s),{default:t(()=>[e(h,{icon:"mdi-folder-arrow-right-outline"})]),_:2},1040)]),default:t(()=>{var s;return[e(H,{title:`文件整理 - ${(s=l(_))==null?void 0:s.name}`},{default:t(()=>[e(z,{class:"pt-2"},{default:t(()=>[e(tt,{onSubmit:A(()=>{},["prevent"])},{default:t(()=>[e(ie,null,{default:t(()=>[e(O,{cols:"12",md:"8"},{default:t(()=>[e(N,{modelValue:l(i).target,"onUpdate:modelValue":n[6]||(n[6]=m=>l(i).target=m),label:"目的路径"},null,8,["modelValue"])]),_:1}),e(O,{cols:"12",md:"4"},{default:t(()=>[e(ve,{modelValue:l(i).transfer_type,"onUpdate:modelValue":n[7]||(n[7]=m=>l(i).transfer_type=m),label:"整理方式",items:[{title:"默认",value:""},{title:"移动",value:"move"},{title:"复制",value:"copy"},{title:"硬链接",value:"link"},{title:"软链接",value:"softlink"}]},null,8,["modelValue"])]),_:1})]),_:1}),e(ie,null,{default:t(()=>[e(O,{cols:"12",md:"4"},{default:t(()=>[e(ve,{modelValue:l(i).type_name,"onUpdate:modelValue":n[8]||(n[8]=m=>l(i).type_name=m),label:"类型",items:[{title:"请选择",value:""},{title:"电影",value:"电影"},{title:"电视剧",value:"电视剧"}]},null,8,["modelValue"])]),_:1}),e(O,{cols:"12",md:"4"},{default:t(()=>[e(N,{modelValue:l(i).tmdbid,"onUpdate:modelValue":n[9]||(n[9]=m=>l(i).tmdbid=m),label:"TMDBID",placeholder:"留空自动识别",rules:[l(Se)]},null,8,["modelValue","rules"])]),_:1}),e(O,{cols:"12",md:"4"},{default:t(()=>[lt(e(ve,{modelValue:l(i).season,"onUpdate:modelValue":n[10]||(n[10]=m=>l(i).season=m),modelModifiers:{number:!0},label:"季",items:l(X)},null,8,["modelValue","items"]),[[at,l(i).type_name==="电视剧"]])]),_:1})]),_:1}),e(ie,null,{default:t(()=>[e(O,{cols:"12",md:"8"},{default:t(()=>[e(N,{modelValue:l(i).episode_format,"onUpdate:modelValue":n[11]||(n[11]=m=>l(i).episode_format=m),label:"集数定位",placeholder:"使用{ep}定位集数"},null,8,["modelValue"])]),_:1}),e(O,{cols:"12",md:"4"},{default:t(()=>[e(N,{modelValue:l(i).episode_detail,"onUpdate:modelValue":n[12]||(n[12]=m=>l(i).episode_detail=m),label:"指定集数",placeholder:"起始集,终止集，如1或1,2"},null,8,["modelValue"])]),_:1}),e(O,{cols:"12",md:"4"},{default:t(()=>[e(N,{modelValue:l(i).episode_part,"onUpdate:modelValue":n[13]||(n[13]=m=>l(i).episode_part=m),label:"指定Part",placeholder:"如part1"},null,8,["modelValue"])]),_:1}),e(O,{cols:"12",md:"4"},{default:t(()=>[e(N,{modelValue:l(i).episode_offset,"onUpdate:modelValue":n[14]||(n[14]=m=>l(i).episode_offset=m),modelModifiers:{number:!0},label:"集数偏移",placeholder:"如-10"},null,8,["modelValue"])]),_:1}),e(O,{cols:"12",md:"4"},{default:t(()=>[e(N,{modelValue:l(i).min_filesize,"onUpdate:modelValue":n[15]||(n[15]=m=>l(i).min_filesize=m),modelModifiers:{number:!0},label:"最小文件大小（MB）",rules:[l(Se)],placeholder:"0"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(ye,null,{default:t(()=>[_t,e(M,{depressed:"",onClick:n[16]||(n[16]=m=>$.value=!1)},{default:t(()=>[b(" 取消 ")]),_:1}),e(M,{onClick:Me},{default:t(()=>[b(" 开始整理 ")]),_:1})]),_:1})]),_:1},8,["title"])]}),_:1},8,["modelValue"]),e(ne,{modelValue:l(w),"onUpdate:modelValue":n[18]||(n[18]=s=>q(w)?w.value=s:null),scrim:!1,width:"400"},{default:t(()=>[e(H,{color:"primary"},{default:t(()=>[e(z,{class:"text-center"},{default:t(()=>[b(F(l(y))+" ",1),l(c)?(r(),p(nt,{key:0,color:"white",class:"mb-0 mt-1","model-value":l(c)},null,8,["model-value"])):j("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(ne,{modelValue:l(B),"onUpdate:modelValue":n[20]||(n[20]=s=>q(B)?B.value=s:null),width:"800"},{default:t(()=>[e(H,null,{default:t(()=>[e(U,{onClick:n[19]||(n[19]=s=>B.value=!1)}),e(ot,null,{default:t(()=>[e(rt,{context:l(V)},null,8,["context"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}});const xt=be(kt,[["__scopeId","data-v-5f5f73d3"]]),yt=Z({__name:"FileBrowser",props:{storages:String,storage:String,path:String,tree:Boolean,endpoints:Object,axios:Object,axiosconfig:Object},emits:["pathchanged"],setup(k,{emit:v}){const a=k,P=[{name:"本地",code:"local",icon:"mdi-folder-multiple-outline"}],C={zip:"mdi-folder-zip-outline",rar:"mdi-folder-zip-outline",htm:"mdi-language-html5",html:"mdi-language-html5",js:"mdi-nodejs",json:"mdi-file-document-outline",md:"mdi-language-markdown-outline",pdf:"mdi-file-pdf",png:"mdi-file-image",jpg:"mdi-file-image",jpeg:"mdi-file-image",mp4:"mdi-filmstrip",mkv:"mdi-filmstrip",avi:"mdi-filmstrip",wmv:"mdi-filmstrip",mov:"mdi-filmstrip",txt:"mdi-file-document-outline",xls:"mdi-file-excel",other:"mdi-file-outline"},T=g(0),I=g("local"),S=g(!1),L=g("name"),R=g(),D=W(()=>{var f;const u=(f=a.storages)==null?void 0:f.split(",");return P.filter(_=>u==null?void 0:u.includes(_.code))});function $(u){}function w(u){I.value=u}function y(u){v("pathchanged",u)}function c(u){L.value=u,S.value=!0}return Be(()=>{I.value=a.storage??"local",R.value=a.axios??je.create(a.axiosconfig)}),(u,f)=>(r(),p(H,{class:"mx-auto",loading:l(T)>0},{default:t(()=>[e(ct,{path:a.path,storages:l(D),storage:l(I),endpoints:a.endpoints,axios:l(R),onStoragechanged:w,onPathchanged:y,onFoldercreated:f[0]||(f[0]=_=>S.value=!0),onSortchanged:c},null,8,["path","storages","storage","endpoints","axios"]),e(ie,{"no-gutters":""},{default:t(()=>[k.tree?(r(),p(O,{key:0,sm:"auto",class:"d-none d-md-block"},{default:t(()=>[e(mt,{path:a.path,storage:l(I),icons:C,endpoints:k.endpoints,axios:l(R),refreshpending:l(S),onPathchanged:y,onLoading:$,onRefreshed:f[1]||(f[1]=_=>S.value=!1)},null,8,["path","storage","endpoints","axios","refreshpending"])]),_:1})):j("",!0),k.tree?(r(),p(ce,{key:1,vertical:""})):j("",!0),e(O,null,{default:t(()=>[e(xt,{path:a.path,storage:l(I),icons:C,endpoints:k.endpoints,axios:l(R),refreshpending:l(S),sort:l(L),onPathchanged:y,onLoading:$,onRefreshed:f[2]||(f[2]=_=>S.value=!1),onFiledeleted:f[3]||(f[3]=_=>S.value=!0),onRenamed:f[4]||(f[4]=_=>S.value=!0)},null,8,["path","storage","endpoints","axios","refreshpending","sort"])]),_:1})]),_:1})]),_:1},8,["loading"]))}}),Vt=Z({__name:"FileBrowserView",setup(k){const v={list:{url:"/filebrowser/list?path={path}&sort={sort}",method:"get"},mkdir:{url:"/filebrowser/mkdir?path={path}",method:"get"},delete:{url:"/filebrowser/delete?path={path}",method:"get"},download:{url:"/filebrowser/download?path={path}",method:"get"},image:{url:"/filebrowser/image?path={path}",method:"get"},rename:{url:"/filebrowser/rename?path={path}&new_name={newname}",method:"get"}},a=g("/");async function P(){var T;try{const I=await de.get("system/env");I.success&&(a.value=((T=I.data)==null?void 0:T.DOWNLOAD_PATH)||"/"),a.value&&!a.value.endsWith("/")&&(a.value+="/")}catch(I){console.log(I)}}function C(T){a.value=T}return Be(async()=>{await P()}),(T,I)=>(r(),E("div",null,[e(yt,{storages:"local",tree:!1,path:l(a),endpoints:v,axios:l(de),onPathchanged:C},null,8,["path","axios"])]))}}),jt=Z({__name:"filemanager",setup(k){return(v,a)=>(r(),p(Vt))}});export{jt as default};
