import{P as j}from"./index-7e16144b.js";import{a as b}from"./index-1bb05dc5.js";import{_ as A}from"./NoDataFound.vue_vue_type_script_setup_true_lang-686775ba.js";import{d as D,r as g,j as t,o as s,f as h,i as c,m as r,ag as E,J as L,t as V,n as k,ab as F,az as G,A as z,ai as H,_,I,G as J,z as M,a5 as R,p as O,ax as q,al as K,c as C,a2 as Q,L as S,U as W,E as X}from"./index-1d8de1d3.js";const Y=D({__name:"DownloadingCard",props:{info:Object},setup($){var x;const e=$,w=g(!0);function u(){var a;return((a=e.info)==null?void 0:a.progress)??0}function v(){var a,n,l;return`↑ ${(a=e.info)==null?void 0:a.upspeed}/s ↓ ${(n=e.info)==null?void 0:n.dlspeed}/s ${(l=e.info)==null?void 0:l.left_time}`}const o=g(((x=e.info)==null?void 0:x.state)==="downloading"),f=g(!1);function d(){f.value=!0}function m(){return f.value?"text-white":""}async function y(){var n;const a=o.value?"stop":"start";try{(await b.get(`download/${a}/${(n=e.info)==null?void 0:n.hash}`)).success&&(o.value=!o.value)}catch(l){console.error(l)}}async function p(){var a;try{await b.delete(`download/${(a=e.info)==null?void 0:a.hash}`),w.value=!1}catch(n){console.error(n)}}return(a,n)=>{var l;return t(w)?(s(),h(M,{key:(l=e.info)==null?void 0:l.hash},{image:c(()=>{var i;return[r(E,{src:(i=e.info)==null?void 0:i.media.image,"aspect-ratio":"2/3",cover:"",class:"brightness-50",onLoad:d},null,8,["src"])]}),default:c(()=>[r(F,{class:k(["break-words whitespace-normal",m()])},{default:c(()=>{var i,T,B,N,P,U;return[L(V(((i=e.info)==null?void 0:i.media.title)||((T=e.info)==null?void 0:T.name))+" "+V((B=e.info)!=null&&B.media.episode?`${(N=e.info)==null?void 0:N.media.season} ${(P=e.info)==null?void 0:P.media.episode}`:(U=e.info)==null?void 0:U.season_episode),1)]}),_:1},8,["class"]),r(G,{class:k(["break-words whitespace-normal",m()])},{default:c(()=>{var i;return[L(V((i=e.info)==null?void 0:i.title),1)]}),_:1},8,["class"]),r(z,{class:k(["text-subtitle-1 pt-3 pb-1",m()])},{default:c(()=>[L(V(v()),1)]),_:1},8,["class"]),u()>0?(s(),h(z,{key:0,class:k(m())},{default:c(()=>[r(H,{"model-value":u()},null,8,["model-value"])]),_:1},8,["class"])):_("",!0),r(J,{class:"justify-space-between"},{default:c(()=>[r(I,{icon:`${t(o)?"mdi-pause":"mdi-play"}`,onClick:y},null,8,["icon"]),r(I,{color:"error",icon:"mdi-trash-can-outline",onClick:p})]),_:1})]),_:1})):_("",!0)}}}),Z={key:0,class:"mt-12 w-full text-center text-gray-500 text-sm flex flex-col items-center"},ee={key:0,class:"grid gap-3 grid-downloading-card"},ae=D({__name:"DownloadingListView",setup($){const e=R.state.auth.superUser,w=R.state.auth.userName;let u=null;const v=g([]),o=g(!1);async function f(){try{v.value=await b.get("download/"),o.value=!0}catch(p){console.error(p)}}const d=g(!1);function m(){d.value=!0,f(),d.value=!1}const y=O(()=>e?v.value:v.value.filter(p=>p.userid===w));return q(()=>{f(),u=setInterval(()=>{f()},3e3)}),K(()=>{u&&(clearInterval(u),u=null)}),(p,x)=>(s(),C(S,null,[t(o)?_("",!0):(s(),C("div",Z,[t(o)?_("",!0):(s(),h(Q,{key:0,size:"48",indeterminate:"",color:"primary"}))])),r(t(j),{modelValue:t(d),"onUpdate:modelValue":x[0]||(x[0]=a=>X(d)?d.value=a:null),onRefresh:m},{default:c(()=>[t(y).length>0?(s(),C("div",ee,[(s(!0),C(S,null,W(t(y),a=>(s(),h(Y,{key:a.hash,info:a},null,8,["info"]))),128))])):_("",!0),t(y).length===0&&t(o)?(s(),h(A,{key:1,"error-code":"404","error-title":"没有任务","error-description":"正在下载的任务将会显示在这里。"})):_("",!0)]),_:1},8,["modelValue"])],64))}});const ne=D({__name:"downloading",setup($){return(e,w)=>(s(),h(ae))}});export{ne as default};
