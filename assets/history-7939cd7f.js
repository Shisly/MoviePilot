import{_ as oe}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-5fa15fd8.js";import{d as A,af as re,r as o,e as I,o as y,c as P,m as l,i as s,aa as ne,ab as z,B as ie,C as N,J as u,D as ue,a as d,W as ce,V as T,t as n,a3 as R,ac as de,a1 as me,L as j,U as ve,f as J,X as fe,$ as pe,z as E,I as g,_ as ge}from"./index-1d8de1d3.js";import{a as F}from"./index-1bb05dc5.js";import{_ as _e}from"./ReorganizeForm.vue_vue_type_script_setup_true_lang-efdc85ec.js";import"./index-705cb9e8.js";const ye={class:"d-flex"},Ve={class:"d-flex flex-column ms-1"},xe={class:"d-block whitespace-nowrap text-high-emphasis"},ke=d("br",null,null,-1),we={class:"text-error"},Ce={key:0,class:"fixed right-5 bottom-5"},be={class:"d-flex flex-column flex-lg-row justify-center my-3"},he=A({__name:"TransferHistoryView",setup(M){const D=re.useToast(),m=o(!1),v=o(),h=o([]),V=o(""),r=o([]),W=[{title:"标题",key:"title",sortable:!1},{title:"目录",key:"src",sortable:!1},{title:"转移方式",key:"mode",sortable:!1},{title:"时间",key:"date",sortable:!1},{title:"状态",key:"status",sortable:!1},{title:"失败原因",key:"errmsg",sortable:!1},{title:"",key:"actions",sortable:!1}],U=o([]),x=o(""),$=o(!1),H=o(0),_=o(25),k=o(1),L=o(!1),X=o("请稍候 ..."),q=o(0),f=o(!1),B=o("");async function w({page:a,itemsPerPage:e}){$.value=!0;try{k.value=a;const i=await F.get("history/transfer",{params:{page:a,count:e,title:x.value}});U.value=i.data.list,H.value=i.data.total}catch(i){console.error(i)}$.value=!1}function G(a){return a==="电影"?"mdi-movie":a==="电视剧"?"mdi-television-classic":"mdi-help-circle"}function K(a){return a?"success":"error"}const O={copy:"复制",move:"移动",link:"硬链接",softlink:"软链接",rclone_copy:"Rclone复制",rclone_move:"Rclone移动"};async function Q(a){v.value=a,B.value=`确认删除 ${a.title} ${a.seasons}${a.episodes} ?`,f.value=!0}async function S(a,e,i){try{const c=await F.delete(`history/transfer?deletesrc=${e}&deletedest=${i}`,{data:a});c.success||D.error(`删除失败: ${c.msg}`)}catch(c){console.error(c)}}async function Y(a,e){f.value=!1,v.value&&(await S(v.value,a,e),w({page:k.value,itemsPerPage:_.value}))}async function Z(a,e){f.value=!1;const i=r.value.length;if(i===0)return;let c=0;L.value=!0;for(const p of r.value)X.value=`正在删除 ${p.title} ${p.seasons}${p.episodes} ...`,await S(p,a,e),c++,q.value=c/i*100;r.value=[],L.value=!1,w({page:k.value,itemsPerPage:_.value})}async function C(a,e){v.value?await Y(a,e):await Z(a,e)}async function ee(){r.value.length!==0&&(v.value=void 0,B.value=`确认删除 ${r.value.length} 条记录 ?`,f.value=!0)}async function te(){r.value.length!==0&&(v.value=void 0,h.value=r.value.map(a=>a.id),r.value.length===1?V.value=r.value[0].dest??"":V.value="",m.value=!0)}const ae=o([{title:"重新整理",value:1,props:{prependIcon:"mdi-redo-variant",click:a=>{h.value=[a.id],V.value=a.dest??"",m.value=!0}}},{title:"删除",value:2,props:{prependIcon:"mdi-trash-can-outline",color:"error",click:a=>{Q(a)}}}]);return(a,e)=>{const i=I("IconBtn"),c=I("VDataTableServer"),p=oe,le=I("VBottomSheet");return y(),P(j,null,[l(E,{class:"pb-5"},{default:s(()=>[l(ne,null,{default:s(()=>[l(z,null,{default:s(()=>[l(ie,null,{default:s(()=>[l(N,null,{default:s(()=>[u(" 历史记录 ")]),_:1}),l(N,null,{default:s(()=>[l(ue,{key:"search_navbar",modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=t=>x.value=t),class:"text-disabled",density:"compact",label:"搜索","append-inner-icon":"mdi-magnify",variant:"solo-filled","single-line":"","hide-details":"",flat:"",rounded:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(c,{modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=t=>r.value=t),"items-per-page":_.value,"onUpdate:itemsPerPage":e[2]||(e[2]=t=>_.value=t),headers:W,items:U.value,"items-length":H.value,search:x.value,loading:$.value,density:"compact","item-value":"id","return-object":"","fixed-header":"","show-select":"","items-per-page-text":"每页条数","page-text":"{0}-{1} 共 {2} 条","onUpdate:options":w},{"item.title":s(({item:t})=>[d("div",ye,[l(ce,null,{default:s(()=>[l(T,{icon:G(t.raw.type||"")},null,8,["icon"])]),_:2},1024),d("div",Ve,[d("span",xe,n(t.raw.title)+" "+n(t.raw.seasons)+n(t.raw.episodes),1),d("small",null,n(t.raw.category),1)])])]),"item.src":s(({item:t})=>[d("small",null,[u(n(t.raw.src)+" ",1),ke,u("=> "+n(t.raw.dest),1)])]),"item.mode":s(({item:t})=>[l(R,{variant:"outlined",color:"primary",size:"small"},{default:s(()=>[u(n(O[t.raw.mode]),1)]),_:2},1024)]),"item.status":s(({item:t})=>[l(R,{color:K(t.raw.status),size:"small"},{default:s(()=>[u(n(t.raw.status?"成功":"失败"),1)]),_:2},1032,["color"])]),"item.date":s(({item:t})=>[d("small",null,n(t.raw.date),1)]),"item.errmsg":s(({item:t})=>[d("small",we,n(t.raw.errmsg),1)]),"item.actions":s(({item:t})=>[l(i,null,{default:s(()=>[l(T,{icon:"mdi-dots-vertical"}),l(de,{activator:"parent","close-on-content-click":""},{default:s(()=>[l(me,null,{default:s(()=>[(y(!0),P(j,null,ve(ae.value,(b,se)=>(y(),J(pe,{key:se,variant:"plain","base-color":b.props.color,onClick:$e=>b.props.click(t.raw)},{prepend:s(()=>[l(T,{icon:b.props.prependIcon},null,8,["icon"])]),default:s(()=>[l(fe,{textContent:n(b.title)},null,8,["textContent"])]),_:2},1032,["base-color","onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"no-data":s(()=>[u(" 没有数据 ")]),_:1},8,["modelValue","items-per-page","items","items-length","search","loading"])]),_:1}),r.value.length>0?(y(),P("span",Ce,[l(g,{icon:"mdi-redo-variant",class:"me-2",color:"primary",size:"x-large",onClick:te}),l(g,{icon:"mdi-trash-can-outline",color:"error",size:"x-large",onClick:ee})])):ge("",!0),l(le,{modelValue:f.value,"onUpdate:modelValue":e[8]||(e[8]=t=>f.value=t),inset:""},{default:s(()=>[l(E,{class:"text-center rounded-t"},{default:s(()=>[l(p,{onClick:e[3]||(e[3]=t=>f.value=!1)}),l(z,{class:"pe-10"},{default:s(()=>[u(n(B.value),1)]),_:1}),d("div",be,[l(g,{color:"primary",class:"mb-2 mx-2",onClick:e[4]||(e[4]=t=>C(!1,!1))},{default:s(()=>[u(" 仅删除历史记录 ")]),_:1}),l(g,{color:"warning",class:"mb-2 mx-2",onClick:e[5]||(e[5]=t=>C(!0,!1))},{default:s(()=>[u(" 删除历史记录和源文件 ")]),_:1}),l(g,{color:"info",class:"mb-2 mx-2",onClick:e[6]||(e[6]=t=>C(!1,!0))},{default:s(()=>[u(" 删除历史记录和媒体库文件 ")]),_:1}),l(g,{color:"error",class:"mb-2 mx-2",onClick:e[7]||(e[7]=t=>C(!0,!0))},{default:s(()=>[u(" 删除历史记录、源文件和媒体库文件 ")]),_:1})])]),_:1})]),_:1},8,["modelValue"]),l(_e,{modelValue:m.value,"onUpdate:modelValue":e[9]||(e[9]=t=>m.value=t),logids:h.value,target:V.value,onDone:e[10]||(e[10]=()=>{m.value=!1,v.value=void 0,r.value=[],w({page:k.value,itemsPerPage:_.value})}),onClose:e[11]||(e[11]=t=>m.value=!1)},null,8,["modelValue","logids","target"])],64)}}});const Ue=A({__name:"history",setup(M){return(D,m)=>(y(),J(he))}});export{Ue as default};
