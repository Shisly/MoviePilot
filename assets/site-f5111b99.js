import{_ as _e}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-dc645124.js";import{d as ue,r as f,af as ye,N as be,q as Ne,e as fe,o as V,c as L,m as e,i as t,X as Ee,ag as Me,j as l,aa as Ke,ab as je,P as A,K as _,t as g,az as he,f as k,$ as x,B as q,V as U,z as H,aA as X,a1 as qe,G as Y,I as B,A as O,Q as re,C as D,D as c,E as w,J as He,H as ne,F as W,L as Z,a8 as ee,O as ge,aw as le,a as P,M as te,W as we,a4 as pe,n as Oe,ac as We,a2 as Ge,a0 as Ve,Y as ve,ax as Je,a3 as Qe,at as Xe,au as Ye}from"./index-b1eeefe2.js";import{a as z}from"./index-973676b3.js";import{f as Ze}from"./formatters-16dfb57c.js";import{r as E,n as M}from"./index-705cb9e8.js";import{E as el}from"./ExistIcon-c209383b.js";import{_ as ll}from"./NoDataFound.vue_vue_type_script_setup_true_lang-7364b069.js";import"./_plugin-vue_export-helper-c27b6911.js";const tl={class:"text-high-emphasis pt-1"},al={class:"text-sm my-1"},sl={class:"text-sm"},ol={class:"text-nowrap whitespace-nowrap"},rl={class:"me-n3"},nl=ue({__name:"SiteCard",props:{site:Object,width:String,height:String},emits:["remove","update"],setup(ae,{emit:F}){const d=ae,S=f(!1),R=f(""),y=ye.useToast(),C=f("测试"),K=f(!1),j=f("更新"),m=f(!1),$=f(!1),I=f(!1),v=f(!1),n=[{title:"标题",key:"title",sortable:!1},{title:"时间",key:"pubdate",sortable:!0},{title:"大小",key:"size",sortable:!0},{title:"做种",key:"seeders",sortable:!0},{title:"下载",key:"peers",sortable:!0},{title:"",key:"actions",sortable:!1}],G=f([]),u=f(""),se=f(!1),ke=f(0),oe=f(25),T=f({username:"",password:""}),xe=[{title:"启用",value:!0},{title:"停用",value:!1}],Ce=f(Array.from({length:50},(i,a)=>a+1).map(i=>({title:i,value:i}))),o=be(d.site??{});o.proxy=o.proxy===1,o.render=o.render===1;function $e(i){window.open(i,"_blank")}async function Ue(i){window.open(i,"_blank")}async function Se(){var i;try{R.value=(await z.get(`site/icon/${(i=d.site)==null?void 0:i.id}`)).data.icon}catch(a){console.error(a)}}async function Ie(){var i,a,b;try{C.value="测试中 ...",K.value=!0;const p=await z.get(`site/test/${(i=d.site)==null?void 0:i.id}`);p.success?y.success(`${(a=d.site)==null?void 0:a.name} 连通性测试成功，可正常使用！`):y.error(`${(b=d.site)==null?void 0:b.name} 连通性测试失败：${p.message}`),C.value="测试",K.value=!1}catch(p){console.error(p)}}async function Be(){$.value=!0}async function De(){I.value=!0}async function Te(){v.value=!0,Le()}async function ie(){var i,a,b;try{if(!T.value.username||!T.value.password)return;$.value=!1,j.value="更新中 ...",m.value=!0;const p=await z.get(`site/cookie/${(i=d.site)==null?void 0:i.id}`,{params:{username:T.value.username,password:T.value.password}});p.success?y.success(`${(a=d.site)==null?void 0:a.name} 更新Cookie & UA 成功！`):y.error(`${(b=d.site)==null?void 0:b.name} 更新失败：${p.message}`),j.value="更新",m.value=!1}catch(p){console.error(p)}}async function Pe(){var i,a,b,p;try{I.value=!1;const N=await z.delete(`site/${(i=d.site)==null?void 0:i.id}`);N.success?(y.success(`${(a=d.site)==null?void 0:a.name} 删除成功！`),F("remove")):y.error(`${(b=d.site)==null?void 0:b.name} 删除失败：${N.message}`)}catch(N){y.error(`${(p=d.site)==null?void 0:p.name} 删除失败！`),console.error(N)}}async function ze(){var i,a,b;try{I.value=!1;const p=await z.put("site/",o);p.success?(y.success(`${(i=d.site)==null?void 0:i.name} 更新成功！`),F("update")):y.error(`${(a=d.site)==null?void 0:a.name} 更新失败：${p.message}`)}catch(p){y.error(`${(b=d.site)==null?void 0:b.name} 更新失败！`),console.error(p)}}function Ae(i,a){return i===0?"text-white bg-lime-500":i<1?"text-white bg-green-500":a!==1?"text-white bg-sky-500":"text-white bg-gray-500"}async function Le(){var i;se.value=!0;try{G.value=await z.get(`site/resource/${(i=d.site)==null?void 0:i.id}`),se.value=!1}catch(a){console.error(a)}}function Fe(){var i;window.open((i=d.site)==null?void 0:i.url,"_blank")}return Ne(()=>{Se()}),(i,a)=>{const b=_e,p=fe("IconBtn"),N=fe("VDataTable");return V(),L(te,null,[e(O,{height:d.height,width:d.width,flat:!l(o).is_active,class:"overflow-hidden",onClick:De},{image:t(()=>[e(Ee,{class:"absolute right-2 bottom-2 rounded",variant:"flat",rounded:"0"},{default:t(()=>[e(Me,{src:l(R)},null,8,["src"])]),_:1})]),default:t(()=>[e(Ke,null,{default:t(()=>[e(je,{class:"font-bold",onClick:A(Fe,["stop"])},{default:t(()=>{var r;return[_(g((r=d.site)==null?void 0:r.name),1)]}),_:1},8,["onClick"]),e(he,null,{default:t(()=>{var r;return[_(g((r=d.site)==null?void 0:r.url),1)]}),_:1})]),_:1}),l(o).is_active?(V(),k(el,{key:0})):x("",!0),e(q,{class:"py-2"},{default:t(()=>[l(o).render?(V(),k(X,{key:0,text:"浏览器仿真"},{activator:t(({props:r})=>[e(U,H({color:"primary",class:"me-2"},r,{icon:"mdi-apple-safari"}),null,16)]),_:1})):x("",!0),l(o).proxy?(V(),k(X,{key:1,text:"代理"},{activator:t(({props:r})=>[e(U,H({color:"primary",class:"me-2"},r,{icon:"mdi-network-outline"}),null,16)]),_:1})):x("",!0),l(o).limit_interval?(V(),k(X,{key:2,text:"流控"},{activator:t(({props:r})=>[e(U,H({color:"primary",class:"me-2"},r,{icon:"mdi-speedometer"}),null,16)]),_:1})):x("",!0),l(o).filter?(V(),k(X,{key:3,text:"过滤"},{activator:t(({props:r})=>[e(U,H({color:"primary",class:"me-2"},r,{icon:"mdi-filter-cog-outline"}),null,16)]),_:1})):x("",!0)]),_:1}),e(qe,{class:"opacity-75",style:{"border-color":"rgba(var(--v-theme-on-background), var(--v-selected-opacity))"}}),e(Y,null,{default:t(()=>{var r;return[(r=d.site)!=null&&r.public?x("",!0):(V(),k(B,{key:0,disabled:l(m),onClick:A(Be,["stop"])},{prepend:t(()=>[e(U,{icon:"mdi-refresh"})]),default:t(()=>[_(" "+g(l(j)),1)]),_:1},8,["disabled","onClick"])),e(B,{disabled:l(K),onClick:A(Ie,["stop"])},{prepend:t(()=>[e(U,{icon:"mdi-link"})]),default:t(()=>[_(" "+g(l(C)),1)]),_:1},8,["disabled","onClick"]),e(B,{onClick:A(Te,["stop"])},{prepend:t(()=>[e(U,{icon:"mdi-web"})]),default:t(()=>[_(" 浏览 ")]),_:1},8,["onClick"])]}),_:1})]),_:1},8,["height","width","flat"]),e(Z,{modelValue:l($),"onUpdate:modelValue":a[3]||(a[3]=r=>W($)?$.value=r:null),"max-width":"50rem"},{default:t(()=>[e(O,{title:"更新站点Cookie & UA"},{default:t(()=>[e(q,null,{default:t(()=>[e(re,{onSubmit:A(()=>{},["prevent"])},{default:t(()=>[e(D,null,{default:t(()=>[e(c,{cols:"12",md:"6"},{default:t(()=>[e(w,{modelValue:l(T).username,"onUpdate:modelValue":a[0]||(a[0]=r=>l(T).username=r),label:"用户名",rules:[l(E)]},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",md:"6"},{default:t(()=>[e(w,{modelValue:l(T).password,"onUpdate:modelValue":a[1]||(a[1]=r=>l(T).password=r),label:"密码",type:l(S)?"text":"password","append-inner-icon":l(S)?"mdi-eye-off-outline":"mdi-eye-outline",rules:[l(E)],"onClick:appendInner":a[2]||(a[2]=r=>S.value=!l(S)),onKeydown:He(ie,["enter"])},null,8,["modelValue","type","append-inner-icon","rules","onKeydown"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(Y,null,{default:t(()=>[e(ne),e(B,{onClick:ie},{default:t(()=>[_(" 开始更新 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Z,{modelValue:l(I),"onUpdate:modelValue":a[16]||(a[16]=r=>W(I)?I.value=r:null),"max-width":"50rem",persistent:"",scrollable:""},{default:t(()=>{var r;return[e(O,{title:`编辑站点 - ${(r=d.site)==null?void 0:r.name}`},{default:t(()=>[e(q,{class:"pt-2"},{default:t(()=>[e(b,{onClick:a[4]||(a[4]=s=>I.value=!1)}),e(re,{onSubmit:A(()=>{},["prevent"])},{default:t(()=>[e(D,null,{default:t(()=>[e(c,{cols:"12",md:"6"},{default:t(()=>[e(w,{modelValue:l(o).url,"onUpdate:modelValue":a[5]||(a[5]=s=>l(o).url=s),label:"站点地址",rules:[l(E)]},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",md:"3"},{default:t(()=>[e(ee,{modelValue:l(o).pri,"onUpdate:modelValue":a[6]||(a[6]=s=>l(o).pri=s),label:"优先级",items:l(Ce),rules:[l(E)]},null,8,["modelValue","items","rules"])]),_:1}),e(c,{cols:"12",md:"3"},{default:t(()=>[e(ee,{modelValue:l(o).is_active,"onUpdate:modelValue":a[7]||(a[7]=s=>l(o).is_active=s),items:xe,label:"状态"},null,8,["modelValue"])]),_:1})]),_:1}),e(D,null,{default:t(()=>[e(c,{cols:"12"},{default:t(()=>[e(w,{modelValue:l(o).rss,"onUpdate:modelValue":a[8]||(a[8]=s=>l(o).rss=s),label:"RSS地址"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12"},{default:t(()=>[e(ge,{modelValue:l(o).cookie,"onUpdate:modelValue":a[9]||(a[9]=s=>l(o).cookie=s),label:"站点Cookie"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12"},{default:t(()=>[e(w,{modelValue:l(o).ua,"onUpdate:modelValue":a[10]||(a[10]=s=>l(o).ua=s),label:"站点User-Agent"},null,8,["modelValue"])]),_:1})]),_:1}),e(D,null,{default:t(()=>[e(c,{cols:"12",md:"4"},{default:t(()=>[e(w,{modelValue:l(o).limit_interval,"onUpdate:modelValue":a[11]||(a[11]=s=>l(o).limit_interval=s),label:"单位周期（秒）",rules:[l(M)]},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",md:"4"},{default:t(()=>[e(w,{modelValue:l(o).limit_seconds,"onUpdate:modelValue":a[12]||(a[12]=s=>l(o).limit_seconds=s),label:"访问次数",rules:[l(M)]},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",md:"4"},{default:t(()=>[e(w,{modelValue:l(o).limit_seconds,"onUpdate:modelValue":a[13]||(a[13]=s=>l(o).limit_seconds=s),label:"访问间隔（秒）",rules:[l(M)]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(D,null,{default:t(()=>[e(c,{cols:"12",md:"6"},{default:t(()=>[e(le,{modelValue:l(o).proxy,"onUpdate:modelValue":a[14]||(a[14]=s=>l(o).proxy=s),label:"代理"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",md:"6"},{default:t(()=>[e(le,{modelValue:l(o).render,"onUpdate:modelValue":a[15]||(a[15]=s=>l(o).render=s),label:"仿真"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(Y,null,{default:t(()=>[e(B,{color:"error",onClick:Pe},{default:t(()=>[_(" 删除 ")]),_:1}),e(ne),e(B,{onClick:ze},{default:t(()=>[_(" 确定 ")]),_:1})]),_:1})]),_:1},8,["title"])]}),_:1},8,["modelValue"]),e(Z,{modelValue:l(v),"onUpdate:modelValue":a[19]||(a[19]=r=>W(v)?v.value=r:null),"max-width":"80rem",scrollable:""},{default:t(()=>{var r;return[e(O,{title:`浏览站点 - ${(r=d.site)==null?void 0:r.name}`},{default:t(()=>[e(b,{onClick:a[17]||(a[17]=s=>v.value=!1)}),e(q,{class:"pt-2"},{default:t(()=>[e(N,{"items-per-page":l(oe),"onUpdate:itemsPerPage":a[18]||(a[18]=s=>W(oe)?oe.value=s:null),headers:n,items:l(G),"items-length":l(ke),search:l(u),loading:l(se),density:"compact","item-value":"title","return-object":"","fixed-header":"","items-per-page-text":"每页条数","page-text":"{0}-{1} 共 {2} 条"},{"item.title":t(({item:s})=>{var h,J,de,me,ce;return[P("div",tl,g(s.raw.title),1),P("div",al,g(s.raw.description),1),(V(!0),L(te,null,we((h=s.raw)==null?void 0:h.labels,(Q,Re)=>(V(),k(pe,{key:Re,variant:"elevated",size:"small",color:"primary",class:"me-1 mb-1"},{default:t(()=>[_(g(Q),1)]),_:2},1024))),128)),((J=s.raw)==null?void 0:J.downloadvolumefactor)!==1||((de=s.raw)==null?void 0:de.uploadvolumefactor)!==1?(V(),k(pe,{key:0,class:Oe([Ae((me=s.raw)==null?void 0:me.downloadvolumefactor,(ce=s.raw)==null?void 0:ce.uploadvolumefactor),"me-1 mb-1"]),variant:"elevated",size:"small"},{default:t(()=>{var Q;return[_(g((Q=s.raw)==null?void 0:Q.volume_factor),1)]}),_:2},1032,["class"])):x("",!0)]}),"item.pubdate":t(({item:s})=>[P("div",null,g(s.raw.date_elapsed),1),P("div",sl,g(s.raw.pubdate),1)]),"item.size":t(({item:s})=>[P("div",ol,g(l(Ze)(s.raw.size)),1)]),"item.seeders":t(({item:s})=>[P("div",null,g(s.raw.seeders),1)]),"item.peers":t(({item:s})=>[P("div",null,g(s.raw.peers),1)]),"item.actions":t(({item:s})=>[P("div",rl,[e(p,null,{default:t(()=>[e(U,{icon:"mdi-dots-vertical"}),e(We,{activator:"parent","close-on-content-click":""},{default:t(()=>[e(Ge,null,{default:t(()=>{var h;return[e(Ve,{variant:"plain",onClick:J=>$e(s.raw.page_url)},{prepend:t(()=>[e(U,{icon:"mdi-information"})]),default:t(()=>[e(ve,null,{default:t(()=>[_("查看详情")]),_:1})]),_:2},1032,["onClick"]),(h=s.raw.enclosure)!=null&&h.startsWith("http")?(V(),k(Ve,{key:0,variant:"plain",onClick:J=>Ue(s.raw.enclosure)},{prepend:t(()=>[e(U,{icon:"mdi-download"})]),default:t(()=>[e(ve,null,{default:t(()=>[_("下载种子")]),_:1})]),_:2},1032,["onClick"])):x("",!0)]}),_:2},1024)]),_:2},1024)]),_:2},1024)])]),"no-data":t(()=>[_(" 没有数据 ")]),_:1},8,["items-per-page","items","items-length","search","loading"])]),_:1})]),_:1},8,["title"])]}),_:1},8,["modelValue"])],64)}}});const ul={key:0,class:"mt-12 w-full text-center text-gray-500 text-sm flex flex-col items-center"},il={key:1,class:"grid gap-3 grid-site-card"},dl=ue({__name:"SiteCardListView",setup(ae){const F=ye.useToast(),d=f([]),S=f(!1),R=f("新增站点"),y=f(!1),C=f(!1),K=[{title:"启用",value:!0},{title:"停用",value:!1}],j=f(Array.from({length:50},(v,n)=>n+1).map(v=>({title:v,value:v}))),m=be({id:0,url:"",pri:1,is_active:!0,cookie:"",ua:"",limit_interval:0,limit_seconds:0,limit_count:0,proxy:0,render:0,name:"",domain:""});async function $(){try{d.value=await z.get("site/"),S.value=!0}catch(v){console.error(v)}}async function I(){if(m.url){Xe(),R.value="新增中...",y.value=!0;try{const v=await z.post("site/",m);v.success?(F.success("新增站点成功"),$()):F.error(`新增站点失败：${v.message}`),C.value=!1}catch(v){console.error(v)}Ye(),R.value="新增站点",y.value=!1}}return Je($),(v,n)=>{const G=_e;return V(),L(te,null,[l(S)?x("",!0):(V(),L("div",ul,[l(S)?x("",!0):(V(),k(Qe,{key:0,size:"48",indeterminate:"",color:"primary"}))])),l(d).length>0?(V(),L("div",il,[(V(!0),L(te,null,we(l(d),u=>(V(),k(nl,{key:u.id,site:u,onRemove:$,onUpdate:$},null,8,["site"]))),128))])):x("",!0),l(d).length===0&&l(S)?(V(),k(ll,{key:2,"error-code":"404","error-title":"没有站点","error-description":"已添加并支持的站点将会在这里显示。"})):x("",!0),e(Z,{modelValue:l(C),"onUpdate:modelValue":n[13]||(n[13]=u=>W(C)?C.value=u:null),"max-width":"50rem",persistent:"",scrollable:""},{activator:t(({props:u})=>[e(B,H({icon:"mdi-plus"},u,{size:"x-large",class:"fixed right-5 bottom-5"}),null,16)]),default:t(()=>[e(O,{title:"新增站点"},{default:t(()=>[e(G,{onClick:n[0]||(n[0]=u=>C.value=!1)}),e(q,{class:"pt-2"},{default:t(()=>[e(re,{onSubmit:A(()=>{},["prevent"])},{default:t(()=>[e(D,null,{default:t(()=>[e(c,{cols:"12",md:"6"},{default:t(()=>[e(w,{modelValue:l(m).url,"onUpdate:modelValue":n[1]||(n[1]=u=>l(m).url=u),label:"站点地址",rules:[l(E)]},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",md:"3"},{default:t(()=>[e(ee,{modelValue:l(m).pri,"onUpdate:modelValue":n[2]||(n[2]=u=>l(m).pri=u),label:"优先级",items:l(j),rules:[l(E)]},null,8,["modelValue","items","rules"])]),_:1}),e(c,{cols:"12",md:"3"},{default:t(()=>[e(ee,{modelValue:l(m).is_active,"onUpdate:modelValue":n[3]||(n[3]=u=>l(m).is_active=u),items:K,label:"状态"},null,8,["modelValue"])]),_:1})]),_:1}),e(D,null,{default:t(()=>[e(c,{cols:"12"},{default:t(()=>[e(w,{modelValue:l(m).rss,"onUpdate:modelValue":n[4]||(n[4]=u=>l(m).rss=u),label:"RSS地址"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12"},{default:t(()=>[e(ge,{modelValue:l(m).cookie,"onUpdate:modelValue":n[5]||(n[5]=u=>l(m).cookie=u),label:"站点Cookie"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12"},{default:t(()=>[e(w,{modelValue:l(m).ua,"onUpdate:modelValue":n[6]||(n[6]=u=>l(m).ua=u),label:"站点User-Agent"},null,8,["modelValue"])]),_:1})]),_:1}),e(D,null,{default:t(()=>[e(c,{cols:"12",md:"4"},{default:t(()=>[e(w,{modelValue:l(m).limit_interval,"onUpdate:modelValue":n[7]||(n[7]=u=>l(m).limit_interval=u),label:"单位周期（秒）",rules:[l(M)]},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",md:"4"},{default:t(()=>[e(w,{modelValue:l(m).limit_seconds,"onUpdate:modelValue":n[8]||(n[8]=u=>l(m).limit_seconds=u),label:"访问次数",rules:[l(M)]},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",md:"4"},{default:t(()=>[e(w,{modelValue:l(m).limit_seconds,"onUpdate:modelValue":n[9]||(n[9]=u=>l(m).limit_seconds=u),label:"访问间隔（秒）",rules:[l(M)]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(D,null,{default:t(()=>[e(c,{cols:"12",md:"6"},{default:t(()=>[e(le,{modelValue:l(m).proxy,"onUpdate:modelValue":n[10]||(n[10]=u=>l(m).proxy=u),label:"代理"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",md:"6"},{default:t(()=>[e(le,{modelValue:l(m).render,"onUpdate:modelValue":n[11]||(n[11]=u=>l(m).render=u),label:"仿真"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(Y,null,{default:t(()=>[e(B,{onClick:n[12]||(n[12]=u=>C.value=!1)},{default:t(()=>[_(" 取消 ")]),_:1}),e(ne),e(B,{color:"primary",disabled:l(y),onClick:I},{default:t(()=>[_(g(l(R)),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}});const bl=ue({__name:"site",setup(ae){return(F,d)=>(V(),L("div",null,[e(dl)]))}});export{bl as default};
