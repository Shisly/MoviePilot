import{d as B,r as x,q as ye,j as t,o as n,f as C,i as _,aD as ge,z as xe,W as l,a1 as w,c as r,a2 as $,M as b,ao as ke,p as I,az as we,e as A,m as c,av as G,a as s,U as L,t as d,I as U,V,aQ as $e,aR as Se,K as j,a9 as Ve,a7 as W,a4 as F,R as Ce,S as Ee,aa as Me,aS as De,_ as H,P as je,aT as Ie,aU as Te,as as K,at as Q,ae as Pe,b as Le}from"./index-7936348a.js";import{_ as Be}from"./PersonCard.vue_vue_type_style_index_0_lang-48e8a342.js";import{S as Ne,_ as J}from"./MediaCardSlideView.vue_vue_type_script_setup_true_lang-f12e5259.js";import{_ as ze}from"./NoDataFound.vue_vue_type_script_setup_true_lang-2b4126bf.js";import{b as Re}from"./formatters-71c0a2e3.js";import"./MediaCard.vue_vue_type_style_index_0_lang-a2c7ba27.js";import"./ExistIcon-92b237f9.js";import"./_plugin-vue_export-helper-c27b6911.js";const qe=B({__name:"PersonCardSlideView",props:{apipath:String,linkurl:String,title:String},setup(T){const m=T,y=x(!1),e=x([]);async function h(){try{if(!m.apipath)return;e.value=await w.get(m.apipath),e.value.length>0&&(y.value=!0)}catch(f){console.error(f)}}return ye(h),(f,S)=>t(y)?(n(),C(Ne,ge(xe({key:0},m)),{content:_(()=>[(n(!0),r(b,null,$(t(e),v=>(n(),C(Be,{key:v.id,person:v,height:"15rem",width:"10rem"},null,8,["person"]))),128))]),_:1},16)):l("",!0)}}),Ae={key:0,class:"mt-12 w-full text-center text-gray-500 text-sm flex flex-col items-center"},Ge={key:1,class:"max-w-8xl mx-auto px-4"},Ue={class:"vue-media-back absolute left-0 top-0 w-full h-96"},We=s("div",{class:"vue-media-back absolute left-0 top-0 w-full h-96"},null,-1),Fe={class:"media-page"},He={class:"media-header"},Ke={class:"media-poster"},Qe={class:"w-full h-full"},Je={class:"media-title"},Oe={key:0,class:"media-status"},Xe=s("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full whitespace-nowrap transition !no-underline bg-green-500 bg-opacity-80 border border-green-500 !text-green-100 hover:bg-green-500 hover:bg-opacity-100 false overflow-hidden"},[s("div",{class:"relative z-20 flex items-center false"},[s("span",null,"已入库")])],-1),Ye=[Xe],Ze={class:"flex flex-row items-baseline justify-start lg:justify-center"},et={key:0,class:"text-lg"},tt={class:"media-attributes"},st={key:0},at={key:1,class:"mx-1"},nt={key:2},it={class:"media-actions"},rt={class:"media-overview"},ot={class:"media-overview-left"},lt={key:0,class:"tagline"},ct={key:1},dt={key:2,class:"media-crew"},ut=["href"],_t={key:3,class:"media-crew"},mt=["href"],pt=["href"],ft={class:"mt-6"},ht=["href"],vt={class:"inline-flex cursor-pointer items-center rounded-full bg-gray-600 px-2 py-1 text-sm text-gray-200 ring-1 ring-gray-500 transition hover:bg-gray-700"},bt=s("span",{class:"ms-1"},"TheMovieDb",-1),yt=["href"],gt={class:"inline-flex cursor-pointer items-center rounded-full bg-gray-600 px-2 py-1 text-sm text-gray-200 ring-1 ring-gray-500 transition hover:bg-gray-700"},xt=s("span",{class:"ms-1"},"豆瓣",-1),kt=["href"],wt={class:"inline-flex cursor-pointer items-center rounded-full bg-gray-600 px-2 py-1 text-sm text-gray-200 ring-1 ring-gray-500 transition hover:bg-gray-700"},$t=s("span",{class:"ms-1"},"IMDb",-1),St=["href"],Vt={class:"inline-flex cursor-pointer items-center rounded-full bg-gray-600 px-2 py-1 text-sm text-gray-200 ring-1 ring-gray-500 transition hover:bg-gray-700"},Ct=s("span",{class:"ms-1"},"TheTvDb",-1),Et={key:4,class:"py-4"},Mt={key:5,class:"flex w-full flex-col space-y-2"},Dt={class:"flex flex-row items-center justify-between"},jt={class:"font-weight-bold"},It={class:"absolute right-12"},Tt={key:0,class:"mt-3 w-full text-center text-gray-500 text-sm flex flex-col items-center"},Pt={class:"flex flex-col justify-center divide-y divide-gray-700"},Lt={class:"flex-1"},Bt={class:"flex flex-col space-y-2 lg:flex-row lg:items-center lg:space-y-0 lg:space-x-2"},Nt={class:"text-lg"},zt={class:"flex items-center space-x-2"},Rt={class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full whitespace-nowrap cursor-default bg-gray-700 !text-gray-300"},qt={key:0,class:"media-overview-right"},At={class:"media-facts"},Gt={key:0,class:"media-ratings"},Ut={key:1,class:"media-fact"},Wt=s("span",null,"ID",-1),Ft={class:"media-fact-value"},Ht={key:2,class:"media-fact"},Kt=s("span",null,"原始标题",-1),Qt={class:"media-fact-value"},Jt={key:3,class:"media-fact"},Ot=s("span",null,"状态",-1),Xt={class:"media-fact-value"},Yt={key:4,class:"media-fact"},Zt=s("span",null,"上映日期",-1),es={class:"media-fact-value"},ts={class:"flex items-center justify-end"},ss=s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true",class:"h-4 w-4"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 15a4.5 4.5 0 004.5 4.5H18a3.75 3.75 0 001.332-7.257 3 3 0 00-3.758-3.848 5.25 5.25 0 00-10.233 2.33A4.502 4.502 0 002.25 15z"})],-1),as={class:"ml-1.5"},ns={key:5,class:"media-fact"},is=s("span",null,"原始语言",-1),rs={class:"media-fact-value"},os={key:6,class:"media-fact"},ls=s("span",null,"出品国家",-1),cs={class:"media-fact-value"},ds={class:"media-fact border-b-0"},us=s("span",null,"制作公司",-1),_s={class:"media-fact-value text-end"},ms={key:0},ps={key:1},fs={key:2},hs=B({__name:"MediaDetailView",props:{mediaid:String,type:String},setup(T){const m=T,y=ke.useToast(),e=x({}),h=x(!1),f=x(!1),S=x(!1),v=x({}),E=x({}),M=x({});async function O(){if(m.mediaid&&m.type){if(e.value=await w.get(`media/${m.mediaid}`,{params:{type_name:m.type}}),S.value=!0,!e.value.tmdb_id&&!e.value.douban_id)return;e.value.type==="电影"?Y():Z(),e.value.type==="电影"?ee():se()}}async function X(a){if(!v.value[a])try{const i=await w.get(`tmdb/${e.value.tmdb_id}/${a}`);v.value[a]=i||[]}catch(i){console.error(i)}}async function Y(){try{(await w.get("media/exists",{params:{tmdbid:e.value.tmdb_id,title:e.value.title,year:e.value.year,season:e.value.season,mtype:e.value.type}})).success&&(h.value=!0)}catch(a){console.error(a)}}async function N(a=0){try{const i=`tmdb:${e.value.tmdb_id}`;if((await w.get(`subscribe/media/${i}`,{params:{season:a}})).id)return!0}catch(i){console.error(i)}return!1}async function Z(){if(e.value.type==="电视剧")try{const a=await w.post("download/notexists",e.value);a&&(a.length===0&&(h.value=!0),a.forEach(i=>{let u=0;i.episodes.length===0?u=2:i.episodes.length<i.total_episode&&(u=1),u!==2&&(h.value=!0),E.value[i.season]=u}))}catch(a){console.error(a)}}async function ee(){e.value.type==="电影"&&(f.value=await N())}const te=I(()=>{var a,i;return(i=(a=e.value)==null?void 0:a.season_info)==null?void 0:i.filter(u=>u.season_number!==0)});async function se(){var a,i;if(e.value.type==="电视剧")try{(i=(a=e.value)==null?void 0:a.season_info)==null||i.forEach(async u=>{M.value[u.season_number??0]=await N(u.season_number)})}catch(u){console.error(u)}}async function ae(a=0){var i,u,g,o,p,D;K();try{let k=h.value?1:0;a&&(k=E.value[a]?0:1);const P=await w.post("subscribe",{name:(i=e.value)==null?void 0:i.title,type:(u=e.value)==null?void 0:u.type,year:(g=e.value)==null?void 0:g.year,tmdbid:(o=e.value)==null?void 0:o.tmdb_id,doubanid:(p=e.value)==null?void 0:p.douban_id,season:a,best_version:k});P.success&&(f.value=!0,a&&(M.value[a]=!0)),ne(P.success,((D=e.value)==null?void 0:D.title)??"",a,P.message,k)}catch(k){console.error(k)}Q()}function ne(a,i,u,g,o){u&&(i=`${i} ${Re(u.toString())}`);let p="订阅";o>0&&(p="洗版订阅"),a?y.success(`${i} 添加${p}成功！`):y.error(`${i} 添加${p}失败：${g}！`)}async function ie(a){var i,u,g,o,p;K();try{const D=(i=e.value)!=null&&i.tmdb_id?`tmdb:${(u=e.value)==null?void 0:u.tmdb_id}`:`douban:${(g=e.value)==null?void 0:g.douban_id}`,k=await w.delete(`subscribe/media/${D}`,{params:{season:a}});k.success?(f.value=!1,a&&(M.value[a]=!1),y.success(`${(o=e.value)==null?void 0:o.title} 已取消订阅！`)):y.error(`${(p=e.value)==null?void 0:p.title} 取消订阅失败：${k.message}！`)}catch(D){console.error(D)}Q()}function z(a=0){f.value?ie(a):ae(a)}function re(a){return a.map(i=>i.name).join("、")}function oe(){return`https://www.themoviedb.org/${m.type==="电影"?"movie":"tv"}/${e.value.tmdb_id}`}function le(){return`https://movie.douban.com/subject/${e.value.douban_id}`}function ce(){return`https://www.imdb.com/title/${e.value.imdb_id}`}function de(){return`https://www.thetvdb.com/series/${e.value.tvdb_id}`}function ue(a){return a?`https://image.tmdb.org/t/p/w500${a}`:""}function _e(a=""){return a?a.replace("original","w500"):""}const me=I(()=>{var a;return(a=e.value.production_countries)==null?void 0:a.map(i=>i.name)}),pe=I(()=>{var a;return(a=e.value.production_companies)==null?void 0:a.map(i=>i.name)});function fe(a){const i=E.value[a];return i?i===1?"warning":i===2?"error":"success":"success"}function he(a){const i=E.value[a];return i?i===1?"部分缺失":i===2?"缺失":"已存在":"已存在"}const ve=I(()=>f.value?"mdi-heart":"mdi-heart-outline"),be=I(()=>f.value?"error":"warning");function R(a){return a.join("、")}function q(a){Pe.push({path:"/resource",query:{keyword:`tmdb:${e.value.tmdb_id}`,type:e.value.type,area:a}})}return we(()=>{O()}),(a,i)=>{const u=A("VSkeletonLoader"),g=A("IconBtn");return n(),r(b,null,[t(S)?l("",!0):(n(),r("div",Ae,[c(G,{size:"48",indeterminate:"",color:"primary"})])),t(e).tmdb_id||t(e).douban_id?(n(),r("div",Ge,[t(e).backdrop_path?(n(),r(b,{key:0},[s("div",Ue,[c(L,{class:"h-96",src:t(e).backdrop_path,cover:""},null,8,["src"])]),We],64)):l("",!0),s("div",Fe,[s("div",He,[s("div",Ke,[c(L,{src:_e(t(e).poster_path),cover:"",class:"object-cover aspect-w-2 aspect-h-3 ring-1 ring-gray-500"},{placeholder:_(()=>[s("div",Qe,[c(u,{class:"object-cover aspect-w-2 aspect-h-3"})])]),_:1},8,["src"])]),s("div",Je,[t(h)?(n(),r("div",Oe,Ye)):l("",!0),s("h1",Ze,[s("span",null,d(t(e).title),1),t(e).year?(n(),r("span",et,"（"+d(t(e).year)+"）",1)):l("",!0)]),s("span",tt,[t(e).runtime||t(e).episode_run_time[0]?(n(),r("span",st,d(t(e).runtime||t(e).episode_run_time[0])+" 分钟",1)):l("",!0),(t(e).runtime||t(e).episode_run_time[0])&&t(e).genres?(n(),r("span",at," | ")):l("",!0),t(e).genres?(n(),r("span",nt,d(re(t(e).genres||[])),1)):l("",!0)])]),s("div",it,[t(e).tmdb_id?(n(),C(U,{key:0,variant:"tonal",color:"info"},{prepend:_(()=>[c(V,{icon:"mdi-magnify"})]),default:_(()=>[j(" 搜索资源 "),c(Me,{activator:"parent","close-on-content-click":""},{default:_(()=>[c(Ve,null,{default:_(()=>[c(W,{variant:"plain",onClick:i[0]||(i[0]=o=>q("title"))},{default:_(()=>[c(F,null,{default:_(()=>[j("标题")]),_:1})]),_:1}),Ce(c(W,{variant:"plain",onClick:i[1]||(i[1]=o=>q("imdbid"))},{default:_(()=>[c(F,null,{default:_(()=>[j("IMDB链接")]),_:1})]),_:1},512),[[Ee,t(e).imdb_id]])]),_:1})]),_:1})]),_:1})):l("",!0),t(e).type==="电影"?(n(),C(U,{key:1,class:"ms-2",color:t(be),variant:"tonal",onClick:i[2]||(i[2]=o=>z(0))},{prepend:_(()=>[c(V,{icon:t(ve)},null,8,["icon"])]),default:_(()=>[j(" "+d(t(f)?"已订阅":"订阅"),1)]),_:1},8,["color"])):l("",!0)])]),s("div",rt,[s("div",ot,[t(e).tagline?(n(),r("div",lt,d(t(e).tagline),1)):l("",!0),t(e).overview?(n(),r("h2",ct," 简介 ")):l("",!0),s("p",null,d(t(e).overview),1),t(e).tmdb_id?(n(),r("ul",dt,[(n(!0),r(b,null,$(t(e).directors,o=>(n(),r("li",{key:o.id},[s("span",null,d(o.job),1),s("a",{class:"crew-name",href:`person?personid=${o.id}`,target:"_blank"},d(o.name),9,ut)]))),128))])):l("",!0),!t(e).tmdb_id&&t(e).douban_id?(n(),r("ul",_t,[(n(!0),r(b,null,$(t(e).directors,o=>(n(),r("li",{key:o.id},[s("span",null,d(R(o.roles)),1),s("a",{class:"crew-name",href:`${o.url}`,target:"_blank"},d(o.name),9,mt)]))),128)),(n(!0),r(b,null,$(t(e).actors,o=>(n(),r("li",{key:o.id},[s("span",null,d(R(o.roles)),1),s("a",{class:"crew-name",href:`${o.url}`,target:"_blank"},d(o.name),9,pt)]))),128))])):l("",!0),s("div",ft,[t(e).tmdb_id?(n(),r("a",{key:0,class:"mb-2 mr-2 inline-flex last:mr-0",href:oe(),target:"_blank"},[s("div",vt,[c(V,{icon:"mdi-link"}),bt])],8,ht)):l("",!0),t(e).douban_id?(n(),r("a",{key:1,class:"mb-2 mr-2 inline-flex last:mr-0",href:le(),target:"_blank"},[s("div",gt,[c(V,{icon:"mdi-link"}),xt])],8,yt)):l("",!0),t(e).imdb_id?(n(),r("a",{key:2,class:"mb-2 mr-2 inline-flex last:mr-0",href:ce(),target:"_blank"},[s("div",wt,[c(V,{icon:"mdi-link"}),$t])],8,kt)):l("",!0),t(e).tvdb_id?(n(),r("a",{key:3,class:"mb-2 mr-2 inline-flex last:mr-0",href:de(),target:"_blank"},[s("div",Vt,[c(V,{icon:"mdi-link"}),Ct])],8,St)):l("",!0)]),t(e).type==="电视剧"&&t(e).tmdb_id?(n(),r("h2",Et," 季 ")):l("",!0),t(e).type==="电视剧"&&t(e).tmdb_id?(n(),r("div",Mt,[c($e,null,{default:_(()=>[(n(!0),r(b,null,$(t(te),o=>(n(),C(Te,{key:o.season_number,"onGroup:selected":p=>X(o.season_number||0)},{default:_(()=>[c(De,null,{default:_(()=>[s("div",Dt,[s("span",jt,"第 "+d(o.season_number)+" 季",1),c(H,{size:"small",class:"ms-1"},{default:_(()=>[j(d(o.episode_count)+"集 ",1)]),_:2},1024),s("div",It,[t(E)?(n(),C(H,{key:0,color:fe(o.season_number||0),flat:""},{default:_(()=>[j(d(he(o.season_number||0)),1)]),_:2},1032,["color"])):l("",!0),c(g,{class:"ms-1",color:t(M)[o.season_number||0]?"error":"warning",variant:"text",onClick:je(p=>z(o.season_number),["stop"])},{default:_(()=>[c(V,{icon:t(M)[o.season_number||0]?"mdi-heart":"mdi-heart-outline"},null,8,["icon"])]),_:2},1032,["color","onClick"])])])]),_:2},1024),c(Ie,null,{default:_(()=>[t(v)[o.season_number||0]?l("",!0):(n(),r("div",Tt,[c(G,{size:"48",indeterminate:"",color:"primary"})])),s("div",Pt,[(n(!0),r(b,null,$(t(v)[o.season_number||0],p=>(n(),r("div",{key:p.episode_number,class:"flex flex-col space-y-4 py-4 xl:flex-row xl:space-y-4 xl:space-x-4"},[s("div",Lt,[s("div",Bt,[s("h3",Nt,d(p.episode_number)+" - "+d(p.name),1),s("div",zt,[s("span",Rt,d(p.air_date),1)])]),s("p",null,d(p.overview),1)]),c(L,{cover:"",class:"rounded-lg","max-width":"15rem",src:ue(p.still_path||""),alt:""},null,8,["src"])]))),128))])]),_:2},1024)]),_:2},1032,["onGroup:selected"]))),128))]),_:1})])):l("",!0)]),t(e).tmdb_id?(n(),r("div",qt,[s("div",At,[t(e).vote_average?(n(),r("div",Gt,[c(Se,{modelValue:t(e).vote_average,"onUpdate:modelValue":i[3]||(i[3]=o=>t(e).vote_average=o),density:"compact",length:"10",class:"ma-2",readonly:""},null,8,["modelValue"])])):l("",!0),t(e).tmdb_id?(n(),r("div",Ut,[Wt,s("span",Ft,d(t(e).tmdb_id),1)])):l("",!0),t(e).original_title||t(e).original_name?(n(),r("div",Ht,[Kt,s("span",Qt,d(t(e).original_title||t(e).original_name),1)])):l("",!0),t(e).status?(n(),r("div",Jt,[Ot,s("span",Xt,d(t(e).status),1)])):l("",!0),t(e).release_date||t(e).first_air_date?(n(),r("div",Yt,[Zt,s("span",es,[s("span",ts,[ss,s("span",as,d(t(e).release_date||t(e).first_air_date),1)])])])):l("",!0),t(e).original_language?(n(),r("div",ns,[is,s("span",rs,d(t(e).original_language),1)])):l("",!0),t(e).production_countries?(n(),r("div",os,[ls,s("span",cs,[(n(!0),r(b,null,$(t(me),o=>(n(),r("span",{key:o,class:"flex items-center justify-end text-end"},d(o),1))),128))])])):l("",!0),s("div",ds,[us,s("span",_s,[(n(!0),r(b,null,$(t(pe),o=>(n(),r("span",{key:o,class:"block"},d(o),1))),128))])])])])):l("",!0)]),t(e).tmdb_id?(n(),r("div",ms,[c(qe,{apipath:`tmdb/credits/${t(e).tmdb_id}/${m.type}`,linkurl:`/credits/tmdb/credits/${t(e).tmdb_id}/${m.type}?title=演员阵容`,title:"演员阵容"},null,8,["apipath","linkurl"])])):l("",!0),t(e).tmdb_id?(n(),r("div",ps,[c(J,{apipath:`tmdb/recommend/${t(e).tmdb_id}/${m.type}`,linkurl:`/browse/tmdb/recommend/${t(e).tmdb_id}/${m.type}?title=推荐`,title:"推荐"},null,8,["apipath","linkurl"])])):l("",!0),t(e).tmdb_id?(n(),r("div",fs,[c(J,{apipath:`tmdb/similar/${t(e).tmdb_id}/${m.type}`,linkurl:`/browse/tmdb/similar/${t(e).tmdb_id}/${m.type}?title=类似`,title:"类似"},null,8,["apipath","linkurl"])])):l("",!0)])])):l("",!0),!t(e).tmdb_id&&!t(e).douban_id&&t(S)?(n(),C(ze,{key:2,"error-code":"500","error-title":"出错啦！","error-description":"未识别到TMDB媒体信息。"})):l("",!0)],64)}}});const Ss=B({__name:"media",setup(T){var h,f,S,v;const m=Le(),y=(f=(h=m.query)==null?void 0:h.mediaid)==null?void 0:f.toString(),e=(v=(S=m.query)==null?void 0:S.type)==null?void 0:v.toString();return(E,M)=>(n(),r("div",null,[c(hs,{mediaid:t(y),type:t(e)},null,8,["mediaid","type"])]))}});export{Ss as default};
