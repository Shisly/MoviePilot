import{_ as T}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-708bd663.js";import{d as q,r as n,af as I,av as F,q as L,e as N,o as v,f as b,i as a,m as t,A as M,P as W,O as P,B as m,C as i,D as d,j as l,_ as D,a7 as c,aB as j,G as z,I as C,J as x,H as G,z as J}from"./index-e47a80b5.js";import{n as H}from"./index-705cb9e8.js";import{a as V}from"./index-253bfa29.js";const Z=q({__name:"SubscribeEditForm",props:{subid:Number},emits:["remove","save","close"],setup(B,{emit:f}){const r=B,p=n([]),y=n([]),e=n({id:r.subid??0,keyword:"",quality:"",resolution:"",effect:"",include:"",exclude:"",total_episode:0,start_episode:0,best_version:0,sites:[],type:"",name:"",year:"",tmdbid:0,state:"",last_update:"",username:"",current_priority:0}),_=I.useToast();async function S(){try{e.value.best_version=e.value.best_version?1:0;const u=await V.put("subscribe/",e.value);u.success?(_.success(`${e.value.name} 更新成功！`),f("save")):_.error(`${e.value.name} 更新失败：${u.message}！`)}catch(u){console.log(u)}}async function R(){try{const u=await V.get("site/rss");p.value=u.filter(s=>s.is_active)}catch(u){console.error(u)}}async function U(){p.value.length||await R();const u=p.value.map(s=>({title:s.name,value:s.id}));y.value=u.flat()}async function w(){try{const u=await V.get(`subscribe/${r.subid}`);e.value=u,e.value.best_version=e.value.best_version===1}catch(u){console.log(u)}}async function k(){try{(await V.delete(`subscribe/${r.subid}`)).success&&f("remove")}catch(u){console.log(u)}}F(()=>{r.subid&&w()});const $=n([{title:"全部",value:""},{title:"蓝光原盘",value:"Blu-?Ray.+VC-?1|Blu-?Ray.+AVC|UHD.+blu-?ray.+HEVC|MiniBD"},{title:"Remux",value:"Remux"},{title:"BluRay",value:"Blu-?Ray"},{title:"UHD",value:"UHD|UltraHD"},{title:"WEB-DL",value:"WEB-?DL|WEB-?RIP"},{title:"HDTV",value:"HDTV"},{title:"H265",value:"[Hx].?265|HEVC"},{title:"H264",value:"[Hx].?264|AVC"}]),g=n([{title:"全部",value:""},{title:"4k",value:"4K|2160p|x2160"},{title:"1080p",value:"1080[pi]|x1080"},{title:"720p",value:"720[pi]|x720"}]),E=n([{title:"全部",value:""},{title:"杜比视界",value:"Dolby[\\s.]+Vision|DOVI|[\\s.]+DV[\\s.]+"},{title:"杜比全景声",value:"Dolby[\\s.]*\\+?Atmos|Atmos"},{title:"HDR",value:"[\\s.]+HDR[\\s.]+|HDR10|HDR10\\+"},{title:"SDR",value:"[\\s.]+SDR[\\s.]+"}]);return L(async()=>{U()}),(u,s)=>{const A=T,O=N("VBottomSheet");return v(),b(O,{inset:"",scrollable:""},{default:a(()=>[t(J,{title:`编辑订阅 - ${l(e).name} ${l(e).season?`第 ${l(e).season} 季`:""}`,class:"rounded-t"},{default:a(()=>[t(M,{class:"pt-2"},{default:a(()=>[t(A,{onClick:s[0]||(s[0]=o=>f("close"))}),t(W,{onSubmit:P(()=>{},["prevent"])},{default:a(()=>[t(m,null,{default:a(()=>[t(i,{cols:"12",md:"8"},{default:a(()=>[t(d,{modelValue:l(e).keyword,"onUpdate:modelValue":s[1]||(s[1]=o=>l(e).keyword=o),label:"搜索关键词"},null,8,["modelValue"])]),_:1}),l(e).type==="电视剧"?(v(),b(i,{key:0,cols:"12",md:"2"},{default:a(()=>[t(d,{modelValue:l(e).total_episode,"onUpdate:modelValue":s[2]||(s[2]=o=>l(e).total_episode=o),label:"总集数",rules:[l(H)]},null,8,["modelValue","rules"])]),_:1})):D("",!0),l(e).type==="电视剧"?(v(),b(i,{key:1,cols:"12",md:"2"},{default:a(()=>[t(d,{modelValue:l(e).start_episode,"onUpdate:modelValue":s[3]||(s[3]=o=>l(e).start_episode=o),label:"开始集数",rules:[l(H)]},null,8,["modelValue","rules"])]),_:1})):D("",!0)]),_:1}),t(m,null,{default:a(()=>[t(i,{cols:"12",md:"4"},{default:a(()=>[t(c,{modelValue:l(e).quality,"onUpdate:modelValue":s[4]||(s[4]=o=>l(e).quality=o),label:"质量",items:l($)},null,8,["modelValue","items"])]),_:1}),t(i,{cols:"12",md:"4"},{default:a(()=>[t(c,{modelValue:l(e).resolution,"onUpdate:modelValue":s[5]||(s[5]=o=>l(e).resolution=o),label:"分辨率",items:l(g)},null,8,["modelValue","items"])]),_:1}),t(i,{cols:"12",md:"4"},{default:a(()=>[t(c,{modelValue:l(e).effect,"onUpdate:modelValue":s[6]||(s[6]=o=>l(e).effect=o),label:"特效",items:l(E)},null,8,["modelValue","items"])]),_:1})]),_:1}),t(m,null,{default:a(()=>[t(i,{cols:"12",md:"4"},{default:a(()=>[t(d,{modelValue:l(e).include,"onUpdate:modelValue":s[7]||(s[7]=o=>l(e).include=o),label:"包含（关键字、正则式）"},null,8,["modelValue"])]),_:1}),t(i,{cols:"12",md:"4"},{default:a(()=>[t(d,{modelValue:l(e).exclude,"onUpdate:modelValue":s[8]||(s[8]=o=>l(e).exclude=o),label:"排除（关键字、正则式）"},null,8,["modelValue"])]),_:1}),t(i,{cols:"12",md:"4"},{default:a(()=>[t(c,{modelValue:l(e).sites,"onUpdate:modelValue":s[9]||(s[9]=o=>l(e).sites=o),items:l(y),chips:"",label:"订阅站点",multiple:""},null,8,["modelValue","items"])]),_:1})]),_:1}),t(m,null,{default:a(()=>[t(i,{cols:"12"},{default:a(()=>[t(j,{modelValue:l(e).best_version,"onUpdate:modelValue":s[10]||(s[10]=o=>l(e).best_version=o),label:"洗版"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),t(z,null,{default:a(()=>[t(C,{color:"error",onClick:k},{default:a(()=>[x(" 取消订阅 ")]),_:1}),t(G),t(C,{variant:"tonal",onClick:S},{default:a(()=>[x(" 保存 ")]),_:1})]),_:1})]),_:1},8,["title"])]),_:1})}}});export{Z as _};
