import{d as K,r as V,p as M,e as te,o as r,f as p,i as t,m as e,aa as de,I as T,aC as Be,aU as Le,V as y,a9 as X,c as N,a2 as E,a7 as Y,j as l,a4 as Z,K as w,t as R,M as q,W as $,aF as Re,z as ie,A as G,B as O,E as z,F as H,G as ue,L as ce,aD as fe,aW as be,aX as Ve,a as Q,w as J,q as we,P as D,a8 as le,an as Fe,ao as Oe,aY as Ce,N as ze,au as De,U as Me,aZ as ke,a5 as Ne,H as Ae,Q as qe,C as ee,D as L,av as re,R as We,S as Ee,aw as ye,a1 as pe,ay as $e}from"./index-0265d51a.js";import{_ as me}from"./_plugin-vue_export-helper-c27b6911.js";import{n as xe}from"./index-705cb9e8.js";import{c as He}from"./formatters-79472207.js";const Ie=g=>(be("data-v-a8649fc5"),g=g(),Ve(),g),Ge=Ie(()=>Q("div",{class:"flex-grow-1"},null,-1)),Ke=Ie(()=>Q("div",{class:"flex-grow-1"},null,-1)),Qe=K({__name:"Toolbar",props:{storages:Array,storage:String,path:String,endpoints:Object,axios:Object},emits:["storagechanged","pathchanged","loading","foldercreated"],setup(g,{emit:h}){const a=g,I=V(!1),x=V(""),C=M(()=>{var n,m;let c="";const i=(n=a.path)==null?void 0:n.endsWith("/"),d=(m=a.path)==null?void 0:m.split("/").filter(v=>v);return(d==null?void 0:d.map((v,U)=>(c+=v+(U<d.length-1||i?"/":""),{name:v,path:c})))??[]}),b=M(()=>{var c;return(c=a.storages)==null?void 0:c.find(i=>i.code===a.storage)});function j(c){a.storage!==c&&(h("storagechanged",c),h("pathchanged",""))}function S(c){h("pathchanged",c)}function B(){const c=C.value??[],i=(c==null?void 0:c.length)===1?"/":c[c.length-2].path;S(i)}async function P(){var d,n,m;h("loading",!0);const i={url:(d=a.endpoints)==null?void 0:d.mkdir.url.replace(/{storage}/g,a.storage).replace(/{path}/g,encodeURIComponent(a.path+x.value)),method:((n=a.endpoints)==null?void 0:n.mkdir.method)||"post"};await((m=a.axios)==null?void 0:m.request(i)),I.value=!1,x.value="",h("loading",!1),h("foldercreated")}return(c,i)=>{const d=te("Icon"),n=te("IconBtn");return r(),p(fe,{flat:"",dense:""},{default:t(()=>[e(Re,{class:"overflow-hidden"},{default:t(()=>{var m;return[(m=a.storages)!=null&&m.length||0>1?(r(),p(de,{key:0,"offset-y":""},{activator:t(({props:v})=>[e(T,Be(Le(v)),{default:t(()=>[e(y,{icon:"mdi-arrow-down-drop-circle-outline"})]),_:2},1040)]),default:t(()=>[e(X,null,{default:t(()=>[(r(!0),N(q,null,E(g.storages,(v,U)=>{var F;return r(),p(Y,{key:U,disabled:v.code===((F=l(b))==null?void 0:F.code),onClick:A=>j(v.code)},{prepend:t(()=>[e(d,{icon:v.icon},null,8,["icon"])]),default:t(()=>[e(Z,null,{default:t(()=>[w(R(v.name),1)]),_:2},1024)]),_:2},1032,["disabled","onClick"])}),128))]),_:1})]),_:1})):$("",!0),e(T,{variant:"text","input-value":g.path==="/",class:"px-1",onClick:i[0]||(i[0]=v=>S("/"))},{default:t(()=>{var v,U;return[e(y,{icon:(v=l(b))==null?void 0:v.icon,class:"mr-2"},null,8,["icon"]),w(" "+R((U=l(b))==null?void 0:U.name),1)]}),_:1},8,["input-value"]),(r(!0),N(q,null,E(l(C),(v,U)=>(r(),p(T,{key:U,variant:"text","input-value":U===l(C).length-1,class:"px-1 d-none d-md-block",onClick:F=>S(v.path)},{default:t(()=>[e(y,{icon:" mdi-chevron-right"}),w(" "+R(v.name),1)]),_:2},1032,["input-value","onClick"]))),128))]}),_:1}),Ge,l(C).length>0?(r(),p(n,{key:0,onClick:B},{default:t(()=>[e(y,{icon:"mdi-arrow-up-bold-outline"})]),_:1})):$("",!0),e(ce,{modelValue:l(I),"onUpdate:modelValue":i[3]||(i[3]=m=>H(I)?I.value=m:null),"max-width":"600"},{activator:t(({props:m})=>[e(n,ie({title:"新建文件夹"},m),{default:t(()=>[e(y,{icon:"mdi-folder-plus-outline"})]),_:2},1040)]),default:t(()=>[e(G,{title:"新建文件夹"},{default:t(()=>[e(O,null,{default:t(()=>[e(z,{modelValue:l(x),"onUpdate:modelValue":i[1]||(i[1]=m=>H(x)?x.value=m:null),label:"名称"},null,8,["modelValue"])]),_:1}),e(ue,null,{default:t(()=>[Ke,e(T,{depressed:"",onClick:i[2]||(i[2]=m=>I.value=!1)},{default:t(()=>[w(" 取消 ")]),_:1}),e(T,{disabled:!l(x),depressed:"",onClick:P},{default:t(()=>[w(" 新建 ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}});const Xe=me(Qe,[["__scopeId","data-v-a8649fc5"]]),Ye={class:"grow scroll-x"},Ze=K({__name:"Tree",props:{icons:Object,storage:String,path:String,endpoints:Object,axios:Object,refreshpending:Boolean},emits:["pathchanged","loading","refreshed"],setup(g,{emit:h}){const a=g,I=V([]),x=V([]),C=V([]),b=V("");function j(){I.value=[],C.value=[{type:"dir",path:"/",basename:"root",extension:"",name:"root",children:[],size:0}]}async function S(c){var m,v,U;h("loading",!0);const d={url:(m=a.endpoints)==null?void 0:m.list.url.replace(/{storage}/g,a.storage).replace(/{path}/g,c.path),method:((v=a.endpoints)==null?void 0:v.list.method)||"get"},n=await((U=a.axios)==null?void 0:U.request(d))??[];c.children=n.map(F=>(F.type==="dir"&&(F.children=[]),F)),h("loading",!1)}function B(c){let i="";x.value.length&&(i=x.value[0]),a.path!==i&&h("pathchanged",i)}function P(c){const i=[];for(i.push(C.value[0]);i.length>0;){const d=i.pop();if((d==null?void 0:d.path)===c)return d;if(d!=null&&d.children&&d.children.length)for(const n of d.children)i.push(n)}return null}return J(()=>a.storage,()=>{j()}),J(()=>a.path,()=>{a.path&&(x.value=[a.path],I.value.includes(a.path)||I.value.push(a.path))}),J(()=>a.refreshpending,async()=>{if(a.refreshpending&&a.path){const c=P(a.path);c&&(await S(c),h("refreshed"))}}),we(()=>{j()}),(c,i)=>{const d=te("VTreeview");return r(),p(G,{flat:"",width:"250","min-height":"500",class:"d-flex flex-column folders-tree-card"},{default:t(()=>[Q("div",Ye,[e(d,{open:l(I),active:l(x),items:l(C),search:l(b),"load-children":S,"item-key":"path","item-text":"basename",dense:"",activatable:"",transition:"",class:"folders-tree","onUpdate:active":B},{prepend:t(({item:n,open:m})=>[n.type==="dir"?(r(),p(y,{key:0},{default:t(()=>[w(R(m?"mdi-folder-open-outline":"mdi-folder-outline"),1)]),_:2},1024)):a.icons?(r(),p(y,{key:1,icon:a.icons[n.extension.toLowerCase()]||a.icons.other},null,8,["icon"])):$("",!0)]),label:t(({item:n})=>[w(R(n.basename)+" ",1),n.type==="dir"?(r(),p(T,{key:0,icon:"",class:"ml-1",onClick:D(m=>S(n),["stop"])},{default:t(()=>[e(y,{class:"pa-0 mdi-18px",color:"grey lighten-1"},{default:t(()=>[w(" mdi-refresh ")]),_:1})]),_:2},1032,["onClick"])):$("",!0)]),_:1},8,["open","active","items","search"])]),e(le),e(fe,{density:"compact"},{default:t(()=>[e(T,{icon:"",onClick:j},{default:t(()=>[e(y,{icon:"mdi-collapse-all-outline"})]),_:1})]),_:1})]),_:1})}}});const Je=me(Ze,[["__scopeId","data-v-5e129369"]]),ge=g=>(be("data-v-0701ae94"),g=g(),Ve(),g),et=ge(()=>Q("br",null,null,-1)),tt=ge(()=>Q("div",{class:"flex-grow-1"},null,-1)),lt=ge(()=>Q("div",{class:"flex-grow-1"},null,-1)),at=K({__name:"List",props:{icons:Object,storage:String,path:String,endpoints:Object,axios:Object,refreshpending:Boolean},emits:["loading","pathchanged","refreshed","filedeleted","renamed"],setup(g,{emit:h}){const a=g,I=Fe.useToast(),x=V(!0),C=Oe(),b=V(a.storage??""),j=V(a.axios??Ce),S=V([]),B=V(""),P=V(!1),c=V(!1),i=V(""),d=V(),n=ze({path:"",target:"",tmdbid:0,season:0,type_name:"电影",transfer_type:"",episode_format:"",episode_detail:"",episode_part:"",episode_offset:null,min_filesize:0}),m=V(Array.from({length:50},(u,o)=>o+1).map(u=>({title:`第 ${u} 季`,value:u}))),v=M(()=>S.value.filter(u=>u.type==="dir"&&u.basename.includes(B.value))),U=M(()=>S.value.filter(u=>u.type==="file"&&u.basename.includes(B.value))),F=M(()=>{var u;return(u=a.path)==null?void 0:u.endsWith("/")}),A=M(()=>!F.value),he=M(()=>{var o,_;const u=(_=(o=a.path)==null?void 0:o.split(".").pop())==null?void 0:_.toLowerCase();return["png","jpg","jpeg","gif","bmp"].includes(u??"")});async function W(){var u,o;if(x.value=!0,h("loading",!0),F.value){const s={url:(u=a.endpoints)==null?void 0:u.list.url.replace(/{storage}/g,b.value).replace(/{path}/g,encodeURIComponent(a.path||"")),method:((o=a.endpoints)==null?void 0:o.list.method)||"get"};S.value=await j.value.request(s)??[]}h("loading",!1),x.value=!1}async function ae(u){var _,s;if(await C({title:"确认",content:`是否确认删除${u.type==="dir"?"目录":"文件"} ${u.basename}？`,confirmationText:"确认",cancellationText:"取消",dialogProps:{maxWidth:600}})){h("loading",!0);const k={url:(_=a.endpoints)==null?void 0:_.delete.url.replace(/{storage}/g,b.value).replace(/{path}/g,encodeURIComponent(u.path)),method:((s=a.endpoints)==null?void 0:s.delete.method)||"post"};await j.value.request(k),h("filedeleted"),h("loading",!1),W()}}function ve(u){h("pathchanged",u)}function Se(u){var f;if(!u)return;const o=ye.state.auth.token,s=`/api/v1/${((f=a.endpoints)==null?void 0:f.download.url.replace(/{storage}/g,b.value).replace(/{path}/g,encodeURIComponent(u))).slice(1)}&token=${o}`;window.open(s,"_blank")}function Ue(u){var s;if(!u)return"";const o=ye.state.auth.token;return`/api/v1/${((s=a.endpoints)==null?void 0:s.image.url.replace(/{storage}/g,b.value).replace(/{path}/g,encodeURIComponent(u))).slice(1)}&token=${o}`}function ne(u){d.value=u,i.value=u.name,P.value=!0}async function je(){var _,s,f,k;h("loading",!0);const o={url:(s=a.endpoints)==null?void 0:s.rename.url.replace(/{storage}/g,a.storage).replace(/{path}/g,encodeURIComponent(((_=d.value)==null?void 0:_.path)||"")).replace(/{newname}/g,encodeURIComponent(i.value)),method:((f=a.endpoints)==null?void 0:f.mkdir.method)||"post"};await((k=a.axios)==null?void 0:k.request(o)),P.value=!1,i.value="",h("loading",!1),h("renamed")}function oe(u){d.value=u,c.value=!0}async function Pe(){var u,o,_;n.path=encodeURIComponent(((u=d.value)==null?void 0:u.path)||"");try{c.value=!1;const s=await pe.post("transfer/manual",{},{params:n});s.success?(I.success(`${(o=d.value)==null?void 0:o.name} 整理成功！`),W()):I.error(`${(_=d.value)==null?void 0:_.name} 整理失败：${s.message}！`)}catch(s){console.log(s)}}J(()=>a.path,async()=>{S.value=[],await W()}),J(()=>a.refreshpending,async()=>{a.refreshpending&&(await W(),h("refreshed"))});const _e=V([{title:"重命名",value:1,props:{prependIcon:"mdi-rename",click:ne}},{title:"整理",value:2,props:{prependIcon:"mdi-folder-arrow-right",click:oe}},{title:"删除",value:3,props:{prependIcon:"mdi-delete-outline",color:"error",click:ae}}]);return we(()=>{W()}),(u,o)=>{const _=te("IconBtn");return r(),N(q,null,[e(G,{class:"d-flex flex-column"},{default:t(()=>[l(x)?(r(),p(O,{key:0,class:"text-center flex flex-col items-center"},{default:t(()=>[e(De,{size:"48",indeterminate:"",color:"primary"})]),_:1})):$("",!0),g.path?l(A)&&!l(he)?(r(),p(O,{key:2,class:"grow d-flex justify-center align-center break-all"},{default:t(()=>[w(" 文件: "+R(g.path),1),et]),_:1})):l(A)&&l(he)?(r(),p(O,{key:3,class:"grow d-flex justify-center align-center"},{default:t(()=>[e(Me,{src:Ue(g.path),"max-width":"100%","max-height":"100%"},null,8,["src"])]),_:1})):l(v).length||l(U).length?(r(),p(O,{key:4,class:"p-0"},{default:t(()=>[l(v).length?(r(),p(X,{key:0,subheader:""},{default:t(()=>[e(ke,null,{default:t(()=>[w("目录")]),_:1}),(r(!0),N(q,null,E(l(v),(s,f)=>(r(),p(Y,{key:f,class:"px-3 pe-1",onClick:k=>ve(s.path)},{prepend:t(()=>[e(y,{icon:"mdi-folder-outline"})]),append:t(()=>[e(_,{class:"d-sm-none"},{default:t(()=>[e(y,{icon:"mdi-dots-vertical"}),e(de,{activator:"parent","close-on-content-click":""},{default:t(()=>[e(X,null,{default:t(()=>[(r(!0),N(q,null,E(l(_e),(k,se)=>(r(),p(Y,{key:se,variant:"plain","base-color":k.props.color,onClick:D(Te=>k.props.click(s),["stop"])},{prepend:t(()=>[e(y,{icon:k.props.prependIcon},null,8,["icon"])]),default:t(()=>[e(Z,{textContent:R(k.title)},null,8,["textContent"])]),_:2},1032,["base-color","onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024),e(_,{class:"d-none d-sm-block",onClick:D(k=>ne(s),["stop"])},{default:t(()=>[e(y,{icon:"mdi-rename"})]),_:2},1032,["onClick"]),e(_,{class:"d-none d-sm-block",onClick:D(k=>oe(s),["stop"])},{default:t(()=>[e(y,{icon:"mdi-folder-arrow-right"})]),_:2},1032,["onClick"]),e(_,{class:"d-none d-sm-block",onClick:D(k=>ae(s),["stop"])},{default:t(()=>[e(y,{icon:"mdi-delete-outline"})]),_:2},1032,["onClick"])]),default:t(()=>[e(Z,{textContent:R(s.name)},null,8,["textContent"])]),_:2},1032,["onClick"]))),128))]),_:1})):$("",!0),l(v).length&&l(U).length?(r(),p(le,{key:1})):$("",!0),l(U).length?(r(),p(X,{key:2,subheader:""},{default:t(()=>[e(ke,null,{default:t(()=>[w("文件")]),_:1}),(r(!0),N(q,null,E(l(U),(s,f)=>(r(),p(Y,{key:f,class:"pl-3 pe-1",onClick:k=>ve(s.path)},{prepend:t(()=>{var k;return[a.icons?(r(),p(y,{key:0,icon:a.icons[s.extension.toLowerCase()]||((k=a.icons)==null?void 0:k.other)},null,8,["icon"])):$("",!0)]}),append:t(()=>[e(_,{class:"d-sm-none"},{default:t(()=>[e(y,{icon:"mdi-dots-vertical"}),e(de,{activator:"parent","close-on-content-click":""},{default:t(()=>[e(X,null,{default:t(()=>[(r(!0),N(q,null,E(l(_e),(k,se)=>(r(),p(Y,{key:se,variant:"plain","base-color":k.props.color,onClick:D(Te=>k.props.click(s),["stop"])},{prepend:t(()=>[e(y,{icon:k.props.prependIcon},null,8,["icon"])]),default:t(()=>[e(Z,{textContent:R(k.title)},null,8,["textContent"])]),_:2},1032,["base-color","onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024),e(_,{class:"d-none d-sm-block",onClick:D(k=>ne(s),["stop"])},{default:t(()=>[e(y,{icon:"mdi-rename"})]),_:2},1032,["onClick"]),e(_,{class:"d-none d-sm-block",onClick:D(k=>oe(s),["stop"])},{default:t(()=>[e(y,{icon:"mdi-folder-arrow-right"})]),_:2},1032,["onClick"]),e(_,{class:"d-none d-sm-block",onClick:D(k=>ae(s),["stop"])},{default:t(()=>[e(y,{icon:"mdi-delete-outline"})]),_:2},1032,["onClick"])]),default:t(()=>[e(Z,{textContent:R(s.name)},null,8,["textContent"]),e(Ne,null,{default:t(()=>[w(R(l(He)(s.size)),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):$("",!0)]),_:1})):l(B)?(r(),p(O,{key:5,class:"grow d-flex justify-center align-center grey--text py-5"},{default:t(()=>[w(" 没有目录或文件 ")]),_:1})):l(x)?$("",!0):(r(),p(O,{key:6,class:"grow d-flex justify-center align-center grey--text py-5"},{default:t(()=>[w(" 空目录 ")]),_:1})):(r(),p(O,{key:1,class:"grow d-flex justify-center align-center grey--text"},{default:t(()=>[w(" 选择目录或文件 ")]),_:1})),g.path?(r(),p(le,{key:7})):$("",!0),l(x)?$("",!0):(r(),p(fe,{key:8,density:"compact",flat:"",color:"gray"},{default:t(()=>[l(A)?$("",!0):(r(),p(z,{key:0,modelValue:l(B),"onUpdate:modelValue":o[0]||(o[0]=s=>H(B)?B.value=s:null),"hide-details":"",flat:"",density:"compact",variant:"solo-filled",placeholder:"搜索 ...","prepend-inner-icon":"mdi-filter-outline",class:"me-2"},null,8,["modelValue"])),l(A)?(r(),p(Ae,{key:1})):$("",!0),l(A)?(r(),p(T,{key:2,onClick:o[1]||(o[1]=s=>Se(a.path||""))},{default:t(()=>[e(y,null,{default:t(()=>[w("mdi-download")]),_:1})]),_:1})):$("",!0),l(A)?$("",!0):(r(),p(T,{key:3,onClick:W},{default:t(()=>[e(y,null,{default:t(()=>[w("mdi-refresh")]),_:1})]),_:1}))]),_:1}))]),_:1}),e(ce,{modelValue:l(P),"onUpdate:modelValue":o[4]||(o[4]=s=>H(P)?P.value=s:null),"max-width":"600"},{activator:t(({props:s})=>[e(_,ie({title:"重命名"},s),{default:t(()=>[e(y,{icon:"mdi-rename-outline"})]),_:2},1040)]),default:t(()=>[e(G,{title:"重命名"},{default:t(()=>[e(O,null,{default:t(()=>[e(z,{modelValue:l(i),"onUpdate:modelValue":o[2]||(o[2]=s=>H(i)?i.value=s:null),label:"名称"},null,8,["modelValue"])]),_:1}),e(ue,null,{default:t(()=>[tt,e(T,{depressed:"",onClick:o[3]||(o[3]=s=>P.value=!1)},{default:t(()=>[w(" 取消 ")]),_:1}),e(T,{disabled:!l(i),depressed:"",onClick:je},{default:t(()=>[w(" 重命名 ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(ce,{modelValue:l(c),"onUpdate:modelValue":o[16]||(o[16]=s=>H(c)?c.value=s:null),"max-width":"800",scrollable:""},{activator:t(({props:s})=>[e(_,ie({title:"整理"},s),{default:t(()=>[e(y,{icon:"mdi-folder-arrow-right-outline"})]),_:2},1040)]),default:t(()=>{var s;return[e(G,{title:`文件整理 - ${(s=l(d))==null?void 0:s.name}`},{default:t(()=>[e(O,{class:"pt-2"},{default:t(()=>[e(qe,{onSubmit:D(()=>{},["prevent"])},{default:t(()=>[e(ee,null,{default:t(()=>[e(L,{cols:"12",md:"8"},{default:t(()=>[e(z,{modelValue:l(n).target,"onUpdate:modelValue":o[5]||(o[5]=f=>l(n).target=f),label:"目的路径"},null,8,["modelValue"])]),_:1}),e(L,{cols:"12",md:"4"},{default:t(()=>[e(re,{modelValue:l(n).transfer_type,"onUpdate:modelValue":o[6]||(o[6]=f=>l(n).transfer_type=f),label:"整理方式",items:[{title:"默认",value:""},{title:"移动",value:"move"},{title:"复制",value:"copy"},{title:"硬链接",value:"link"},{title:"软链接",value:"softlink"}]},null,8,["modelValue"])]),_:1})]),_:1}),e(ee,null,{default:t(()=>[e(L,{cols:"12",md:"4"},{default:t(()=>[e(re,{modelValue:l(n).type_name,"onUpdate:modelValue":o[7]||(o[7]=f=>l(n).type_name=f),label:"类型",items:[{title:"电影",value:"电影"},{title:"电视剧",value:"电视剧"}]},null,8,["modelValue"])]),_:1}),e(L,{cols:"12",md:"4"},{default:t(()=>[e(z,{modelValue:l(n).tmdbid,"onUpdate:modelValue":o[8]||(o[8]=f=>l(n).tmdbid=f),label:"TMDBID",rules:[l(xe)]},null,8,["modelValue","rules"])]),_:1}),e(L,{cols:"12",md:"4"},{default:t(()=>[We(e(re,{modelValue:l(n).season,"onUpdate:modelValue":o[9]||(o[9]=f=>l(n).season=f),modelModifiers:{number:!0},label:"季",items:l(m)},null,8,["modelValue","items"]),[[Ee,l(n).type_name==="电视剧"]])]),_:1})]),_:1}),e(ee,null,{default:t(()=>[e(L,{cols:"12",md:"8"},{default:t(()=>[e(z,{modelValue:l(n).episode_format,"onUpdate:modelValue":o[10]||(o[10]=f=>l(n).episode_format=f),label:"集数定位",placeholder:"使用{ep}定位集数"},null,8,["modelValue"])]),_:1}),e(L,{cols:"12",md:"4"},{default:t(()=>[e(z,{modelValue:l(n).episode_detail,"onUpdate:modelValue":o[11]||(o[11]=f=>l(n).episode_detail=f),label:"指定集数",placeholder:"起始集,终止集，如1或1,2"},null,8,["modelValue"])]),_:1}),e(L,{cols:"12",md:"4"},{default:t(()=>[e(z,{modelValue:l(n).episode_part,"onUpdate:modelValue":o[12]||(o[12]=f=>l(n).episode_part=f),label:"指定Part",placeholder:"如part1"},null,8,["modelValue"])]),_:1}),e(L,{cols:"12",md:"4"},{default:t(()=>[e(z,{modelValue:l(n).episode_offset,"onUpdate:modelValue":o[13]||(o[13]=f=>l(n).episode_offset=f),modelModifiers:{number:!0},label:"集数偏移",placeholder:"如-10"},null,8,["modelValue"])]),_:1}),e(L,{cols:"12",md:"4"},{default:t(()=>[e(z,{modelValue:l(n).min_filesize,"onUpdate:modelValue":o[14]||(o[14]=f=>l(n).min_filesize=f),modelModifiers:{number:!0},label:"最小文件大小（MB）",rules:[l(xe)],placeholder:"0"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(ue,null,{default:t(()=>[lt,e(T,{depressed:"",onClick:o[15]||(o[15]=f=>c.value=!1)},{default:t(()=>[w(" 取消 ")]),_:1}),e(T,{disabled:!l(n).tmdbid,depressed:"",onClick:Pe},{default:t(()=>[w(" 开始整理 ")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["title"])]}),_:1},8,["modelValue"])],64)}}});const nt=me(at,[["__scopeId","data-v-0701ae94"]]),ot=K({__name:"FileBrowser",props:{storages:String,storage:String,path:String,tree:Boolean,endpoints:Object,axios:Object,axiosconfig:Object},emits:["pathchanged"],setup(g,{emit:h}){const a=g,I=[{name:"本地",code:"local",icon:"mdi-folder-multiple-outline"}],x={zip:"mdi-folder-zip-outline",rar:"mdi-folder-zip-outline",htm:"mdi-language-html5",html:"mdi-language-html5",js:"mdi-nodejs",json:"mdi-file-document-outline",md:"mdi-language-markdown-outline",pdf:"mdi-file-pdf",png:"mdi-file-image",jpg:"mdi-file-image",jpeg:"mdi-file-image",mp4:"mdi-filmstrip",mkv:"mdi-filmstrip",avi:"mdi-filmstrip",wmv:"mdi-filmstrip",mov:"mdi-filmstrip",txt:"mdi-file-document-outline",xls:"mdi-file-excel",other:"mdi-file-outline"},C=V(0),b=V("local"),j=V(!1),S=V(),B=M(()=>{var n;const d=(n=a.storages)==null?void 0:n.split(",");return I.filter(m=>d==null?void 0:d.includes(m.code))});function P(d){}function c(d){b.value=d}function i(d){h("pathchanged",d)}return $e(()=>{b.value=a.storage??"local",S.value=a.axios??Ce.create(a.axiosconfig)}),(d,n)=>(r(),p(G,{class:"mx-auto",loading:l(C)>0},{default:t(()=>[e(Xe,{path:a.path,storages:l(B),storage:l(b),endpoints:a.endpoints,axios:l(S),onStoragechanged:c,onPathchanged:i,onFoldercreated:n[0]||(n[0]=m=>j.value=!0)},null,8,["path","storages","storage","endpoints","axios"]),e(ee,{"no-gutters":""},{default:t(()=>[g.tree?(r(),p(L,{key:0,sm:"auto",class:"d-none d-md-block"},{default:t(()=>[e(Je,{path:a.path,storage:l(b),icons:x,endpoints:g.endpoints,axios:l(S),refreshpending:l(j),onPathchanged:i,onLoading:P,onRefreshed:n[1]||(n[1]=m=>j.value=!1)},null,8,["path","storage","endpoints","axios","refreshpending"])]),_:1})):$("",!0),g.tree?(r(),p(le,{key:1,vertical:""})):$("",!0),e(L,null,{default:t(()=>[e(nt,{path:a.path,storage:l(b),icons:x,endpoints:g.endpoints,axios:l(S),refreshpending:l(j),onPathchanged:i,onLoading:P,onRefreshed:n[2]||(n[2]=m=>j.value=!1),onFiledeleted:n[3]||(n[3]=m=>j.value=!0),onRenamed:n[4]||(n[4]=m=>j.value=!0)},null,8,["path","storage","endpoints","axios","refreshpending"])]),_:1})]),_:1})]),_:1},8,["loading"]))}}),st=K({__name:"FileBrowserView",setup(g){const h={list:{url:"/filebrowser/list?path={path}",method:"get"},mkdir:{url:"/filebrowser/mkdir?path={path}",method:"get"},delete:{url:"/filebrowser/delete?path={path}",method:"get"},download:{url:"/filebrowser/download?path={path}",method:"get"},image:{url:"/filebrowser/image?path={path}",method:"get"},rename:{url:"/filebrowser/rename?path={path}&new_name={newname}",method:"get"}},a=V("/");async function I(){var C;try{const b=await pe.get("system/env");b.success&&(a.value=((C=b.data)==null?void 0:C.DOWNLOAD_PATH)||"/"),console.log(a.value)}catch(b){console.log(b)}}function x(C){a.value=C}return $e(async()=>{await I()}),(C,b)=>(r(),N("div",null,[e(ot,{storages:"local",tree:!1,path:l(a),endpoints:h,axios:l(pe),onPathchanged:x},null,8,["path","axios"])]))}}),ct=K({__name:"filemanager",setup(g){return(h,a)=>(r(),p(st))}});export{ct as default};
