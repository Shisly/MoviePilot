import{a as D}from"./index-57fabd3c.js";import{_ as Ve}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-dfca3186.js";import{d as Z,r as p,af as ye,av as Le,e as ae,o as u,f,i as t,m as e,A as J,P as ge,O as N,B as q,C as b,D as z,j as l,a7 as ue,N as Ae,aB as de,G as se,I as T,J as g,H as we,z as X,at as me,au as ce,q as Fe,c as E,W as Ee,ag as Ne,aa as Re,ab as Ke,a as I,t as k,az as Me,_ as C,V as S,a9 as W,aA as G,a0 as je,F as qe,E as H,K as pe,L as Q,U as ke,a3 as fe,n as He,ac as Oe,a1 as We,$ as ve,X as _e,ax as Ge,a2 as Je}from"./index-0997a18b.js";import{r as Y,n as le}from"./index-705cb9e8.js";import{f as Xe}from"./formatters-16dfb57c.js";import{E as Qe}from"./ExistIcon-79be9bcc.js";import{_ as Ye}from"./NoDataFound.vue_vue_type_script_setup_true_lang-4c78e798.js";import"./_plugin-vue_export-helper-c27b6911.js";const be=Z({__name:"SiteAddEditForm",props:{siteid:Number,oper:String},emits:["save","remove","close"],setup(R,{emit:_}){const o=R,a=p({id:o.siteid??0,url:"",rss:"",cookie:"",ua:"",pri:0,is_active:!0,limit_interval:0,limit_seconds:0,name:"",domain:""}),v=ye.useToast(),U=[{title:"启用",value:!0},{title:"停用",value:!1}],V=p(Array.from({length:50},(d,s)=>s+1).map(d=>({title:d,value:d})));Le(async()=>{o.siteid&&w()});async function w(){try{a.value=await D.get(`site/${o.siteid}`),a.value.proxy=a.value.proxy===1,a.value.render=a.value.render===1}catch(d){console.error(d)}}async function K(){var d;if((d=a.value)!=null&&d.url){me();try{const s=await D.post("site/",a.value);s.success?(v.success("新增站点成功"),_("save")):v.error(`新增站点失败：${s.message}`)}catch(s){console.error(s)}ce()}}async function M(){var d,s,B;try{const y=await D.delete(`site/${(d=a.value)==null?void 0:d.id}`);y.success?_("remove"):v.error(`${(s=a.value)==null?void 0:s.name} 删除失败：${y.message}`)}catch(y){v.error(`${(B=a.value)==null?void 0:B.name} 删除失败！`),console.error(y)}}async function L(){var d,s,B;me();try{const y=await D.put("site/",a.value);y.success?(v.success(`${(d=a.value)==null?void 0:d.name} 更新成功！`),_("save")):v.error(`${(s=a.value)==null?void 0:s.name} 更新失败：${y.message}`)}catch(y){v.error(`${(B=a.value)==null?void 0:B.name} 更新失败！`),console.error(y)}ce()}return(d,s)=>{const B=Ve,y=ae("VBottomSheet");return u(),f(y,{inset:"",scrollable:""},{default:t(()=>[e(X,{title:`${o.oper==="add"?"新增":"编辑"}站点${o.oper!=="add"?` - ${l(a).name}`:""}`,class:"rounded-t"},{default:t(()=>[e(B,{onClick:s[0]||(s[0]=i=>_("close"))}),e(J,{class:"pt-2"},{default:t(()=>[e(ge,{onSubmit:N(()=>{},["prevent"])},{default:t(()=>[e(q,null,{default:t(()=>[e(b,{cols:"12",md:"6"},{default:t(()=>[e(z,{modelValue:l(a).url,"onUpdate:modelValue":s[1]||(s[1]=i=>l(a).url=i),label:"站点地址",rules:[l(Y)]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12",md:"3"},{default:t(()=>[e(ue,{modelValue:l(a).pri,"onUpdate:modelValue":s[2]||(s[2]=i=>l(a).pri=i),label:"优先级",items:l(V),rules:[l(Y)]},null,8,["modelValue","items","rules"])]),_:1}),e(b,{cols:"12",md:"3"},{default:t(()=>[e(ue,{modelValue:l(a).is_active,"onUpdate:modelValue":s[3]||(s[3]=i=>l(a).is_active=i),items:U,label:"状态"},null,8,["modelValue"])]),_:1})]),_:1}),e(q,null,{default:t(()=>[e(b,{cols:"12"},{default:t(()=>[e(z,{modelValue:l(a).rss,"onUpdate:modelValue":s[4]||(s[4]=i=>l(a).rss=i),label:"RSS地址"},null,8,["modelValue"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(Ae,{modelValue:l(a).cookie,"onUpdate:modelValue":s[5]||(s[5]=i=>l(a).cookie=i),label:"站点Cookie"},null,8,["modelValue"])]),_:1}),e(b,{cols:"12"},{default:t(()=>[e(z,{modelValue:l(a).ua,"onUpdate:modelValue":s[6]||(s[6]=i=>l(a).ua=i),label:"站点User-Agent"},null,8,["modelValue"])]),_:1})]),_:1}),e(q,null,{default:t(()=>[e(b,{cols:"12",md:"4"},{default:t(()=>[e(z,{modelValue:l(a).limit_interval,"onUpdate:modelValue":s[7]||(s[7]=i=>l(a).limit_interval=i),label:"单位周期（秒）",rules:[l(le)]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12",md:"4"},{default:t(()=>[e(z,{modelValue:l(a).limit_seconds,"onUpdate:modelValue":s[8]||(s[8]=i=>l(a).limit_seconds=i),label:"访问次数",rules:[l(le)]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12",md:"4"},{default:t(()=>[e(z,{modelValue:l(a).limit_seconds,"onUpdate:modelValue":s[9]||(s[9]=i=>l(a).limit_seconds=i),label:"访问间隔（秒）",rules:[l(le)]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(q,null,{default:t(()=>[e(b,{cols:"12",md:"6"},{default:t(()=>[e(de,{modelValue:l(a).proxy,"onUpdate:modelValue":s[10]||(s[10]=i=>l(a).proxy=i),label:"代理"},null,8,["modelValue"])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(de,{modelValue:l(a).render,"onUpdate:modelValue":s[11]||(s[11]=i=>l(a).render=i),label:"仿真"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(se,null,{default:t(()=>[o.oper==="add"?(u(),f(T,{key:0,onClick:s[12]||(s[12]=i=>_("close"))},{default:t(()=>[g(" 取消 ")]),_:1})):(u(),f(T,{key:1,color:"error",onClick:M},{default:t(()=>[g(" 删除 ")]),_:1})),e(we),o.oper==="add"?(u(),f(T,{key:2,color:"primary",variant:"tonal",onClick:K},{default:t(()=>[g(" 新增 ")]),_:1})):(u(),f(T,{key:3,color:"primary",variant:"tonal",onClick:L},{default:t(()=>[g(" 保存 ")]),_:1}))]),_:1})]),_:1},8,["title"])]),_:1})}}}),Ze=["onClick"],et={class:"text-high-emphasis pt-1"},tt={class:"text-sm my-1"},lt={class:"text-sm"},at={class:"text-nowrap whitespace-nowrap"},st={class:"me-n3"},ot=Z({__name:"SiteCard",props:{site:Object,width:String,height:String},emits:["update","remove"],setup(R,{emit:_}){const o=R,a=p(!1),v=p(""),U=ye.useToast(),V=p("测试"),w=p(!1),K=p("更新"),M=p(!1),L=p(!1),d=p(!1),s=p(!1),B=[{title:"标题",key:"title",sortable:!1},{title:"时间",key:"pubdate",sortable:!0},{title:"大小",key:"size",sortable:!0},{title:"做种",key:"seeders",sortable:!0},{title:"下载",key:"peers",sortable:!0},{title:"",key:"actions",sortable:!1}],y=p([]),i=p(""),ee=p(!1),Ce=p(0),te=p(25),h=p({username:"",password:""});function xe(m){window.open(m,"_blank")}async function $e(m){window.open(m,"_blank")}async function Se(){var m;try{v.value=(await D.get(`site/icon/${(m=o.site)==null?void 0:m.id}`)).data.icon}catch(r){console.error(r)}}async function Ue(){var m,r,A;try{V.value="测试中 ...",w.value=!0;const x=await D.get(`site/test/${(m=o.site)==null?void 0:m.id}`);x.success?U.success(`${(r=o.site)==null?void 0:r.name} 连通性测试成功，可正常使用！`):U.error(`${(A=o.site)==null?void 0:A.name} 连通性测试失败：${x.message}`),V.value="测试",w.value=!1}catch(x){console.error(x)}}async function Be(){L.value=!0}async function Ie(){s.value=!0,Te()}async function oe(){var m,r,A;try{if(!h.value.username||!h.value.password)return;L.value=!1,K.value="更新中 ...",M.value=!0;const x=await D.get(`site/cookie/${(m=o.site)==null?void 0:m.id}`,{params:{username:h.value.username,password:h.value.password}});x.success?U.success(`${(r=o.site)==null?void 0:r.name} 更新Cookie & UA 成功！`):U.error(`${(A=o.site)==null?void 0:A.name} 更新失败：${x.message}`),K.value="更新",M.value=!1}catch(x){console.error(x)}}function De(m,r){return m===0?"text-white bg-lime-500":m<1?"text-white bg-green-500":r!==1?"text-white bg-sky-500":"text-white bg-gray-500"}async function Te(){var m;ee.value=!0;try{y.value=await D.get(`site/resource/${(m=o.site)==null?void 0:m.id}`),ee.value=!1}catch(r){console.error(r)}}function he(){var m;window.open((m=o.site)==null?void 0:m.url,"_blank")}return Fe(()=>{Se()}),(m,r)=>{var re,ne;const A=Ve,x=ae("IconBtn"),Pe=ae("VDataTable");return u(),E(Q,null,[e(X,{height:o.height,width:o.width,flat:!((re=o.site)!=null&&re.is_active),class:"overflow-hidden",onClick:r[0]||(r[0]=c=>d.value=!0)},{image:t(()=>[e(Ee,{class:"absolute right-2 bottom-2 rounded",variant:"flat",rounded:"0"},{default:t(()=>[e(Ne,{src:l(v)},null,8,["src"])]),_:1})]),default:t(()=>{var c;return[e(Re,null,{default:t(()=>[e(Ke,{class:"font-bold"},{default:t(()=>{var n;return[I("span",{onClick:N(he,["stop"])},k((n=o.site)==null?void 0:n.name),9,Ze)]}),_:1}),e(Me,null,{default:t(()=>{var n;return[g(k((n=o.site)==null?void 0:n.url),1)]}),_:1})]),_:1}),(c=o.site)!=null&&c.is_active?(u(),f(Qe,{key:0})):C("",!0),e(J,{class:"py-2"},{default:t(()=>{var n,P,F,j;return[((n=o.site)==null?void 0:n.render)===1?(u(),f(G,{key:0,text:"浏览器仿真"},{activator:t(({props:$})=>[e(S,W({color:"primary",class:"me-2"},$,{icon:"mdi-apple-safari"}),null,16)]),_:1})):C("",!0),((P=o.site)==null?void 0:P.proxy)===1?(u(),f(G,{key:1,text:"代理"},{activator:t(({props:$})=>[e(S,W({color:"primary",class:"me-2"},$,{icon:"mdi-network-outline"}),null,16)]),_:1})):C("",!0),(F=o.site)!=null&&F.limit_interval?(u(),f(G,{key:2,text:"流控"},{activator:t(({props:$})=>[e(S,W({color:"primary",class:"me-2"},$,{icon:"mdi-speedometer"}),null,16)]),_:1})):C("",!0),(j=o.site)!=null&&j.filter?(u(),f(G,{key:3,text:"过滤"},{activator:t(({props:$})=>[e(S,W({color:"primary",class:"me-2"},$,{icon:"mdi-filter-cog-outline"}),null,16)]),_:1})):C("",!0)]}),_:1}),e(je,{class:"opacity-75",style:{"border-color":"rgba(var(--v-theme-on-background), var(--v-selected-opacity))"}}),e(se,null,{default:t(()=>{var n;return[(n=o.site)!=null&&n.public?C("",!0):(u(),f(T,{key:0,disabled:l(M),onClick:N(Be,["stop"])},{prepend:t(()=>[e(S,{icon:"mdi-refresh"})]),default:t(()=>[g(" "+k(l(K)),1)]),_:1},8,["disabled","onClick"])),e(T,{disabled:l(w),onClick:N(Ue,["stop"])},{prepend:t(()=>[e(S,{icon:"mdi-link"})]),default:t(()=>[g(" "+k(l(V)),1)]),_:1},8,["disabled","onClick"]),e(T,{onClick:N(Ie,["stop"])},{prepend:t(()=>[e(S,{icon:"mdi-web"})]),default:t(()=>[g(" 浏览 ")]),_:1},8,["onClick"])]}),_:1})]}),_:1},8,["height","width","flat"]),e(pe,{modelValue:l(L),"onUpdate:modelValue":r[4]||(r[4]=c=>H(L)?L.value=c:null),"max-width":"50rem"},{default:t(()=>[e(X,{title:"更新站点Cookie & UA"},{default:t(()=>[e(J,null,{default:t(()=>[e(ge,{onSubmit:N(()=>{},["prevent"])},{default:t(()=>[e(q,null,{default:t(()=>[e(b,{cols:"12",md:"6"},{default:t(()=>[e(z,{modelValue:l(h).username,"onUpdate:modelValue":r[1]||(r[1]=c=>l(h).username=c),label:"用户名",rules:[l(Y)]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(z,{modelValue:l(h).password,"onUpdate:modelValue":r[2]||(r[2]=c=>l(h).password=c),label:"密码",type:l(a)?"text":"password","append-inner-icon":l(a)?"mdi-eye-off-outline":"mdi-eye-outline",rules:[l(Y)],"onClick:appendInner":r[3]||(r[3]=c=>a.value=!l(a)),onKeydown:qe(oe,["enter"])},null,8,["modelValue","type","append-inner-icon","rules","onKeydown"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(se,null,{default:t(()=>[e(we),e(T,{variant:"tonal",onClick:oe},{default:t(()=>[g(" 开始更新 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(be,{modelValue:l(d),"onUpdate:modelValue":r[5]||(r[5]=c=>H(d)?d.value=c:null),siteid:(ne=o.site)==null?void 0:ne.id,onSave:r[6]||(r[6]=c=>{d.value=!1,_("update")}),onRemove:r[7]||(r[7]=c=>_("remove")),onClose:r[8]||(r[8]=c=>d.value=!1)},null,8,["modelValue","siteid"]),e(pe,{modelValue:l(s),"onUpdate:modelValue":r[11]||(r[11]=c=>H(s)?s.value=c:null),"max-width":"80rem",scrollable:""},{default:t(()=>{var c;return[e(X,{title:`浏览站点 - ${(c=o.site)==null?void 0:c.name}`},{default:t(()=>[e(A,{onClick:r[9]||(r[9]=n=>s.value=!1)}),e(J,{class:"pt-2"},{default:t(()=>[e(Pe,{"items-per-page":l(te),"onUpdate:itemsPerPage":r[10]||(r[10]=n=>H(te)?te.value=n:null),headers:B,items:l(y),"items-length":l(Ce),search:l(i),loading:l(ee),density:"compact","item-value":"title","return-object":"","fixed-header":"","items-per-page-text":"每页条数","page-text":"{0}-{1} 共 {2} 条"},{"item.title":t(({item:n})=>{var P,F,j,$,ie;return[I("div",et,k(n.raw.title),1),I("div",tt,k(n.raw.description),1),(u(!0),E(Q,null,ke((P=n.raw)==null?void 0:P.labels,(O,ze)=>(u(),f(fe,{key:ze,variant:"elevated",size:"small",color:"primary",class:"me-1 mb-1"},{default:t(()=>[g(k(O),1)]),_:2},1024))),128)),((F=n.raw)==null?void 0:F.downloadvolumefactor)!==1||((j=n.raw)==null?void 0:j.uploadvolumefactor)!==1?(u(),f(fe,{key:0,class:He([De(($=n.raw)==null?void 0:$.downloadvolumefactor,(ie=n.raw)==null?void 0:ie.uploadvolumefactor),"me-1 mb-1"]),variant:"elevated",size:"small"},{default:t(()=>{var O;return[g(k((O=n.raw)==null?void 0:O.volume_factor),1)]}),_:2},1032,["class"])):C("",!0)]}),"item.pubdate":t(({item:n})=>[I("div",null,k(n.raw.date_elapsed),1),I("div",lt,k(n.raw.pubdate),1)]),"item.size":t(({item:n})=>[I("div",at,k(l(Xe)(n.raw.size)),1)]),"item.seeders":t(({item:n})=>[I("div",null,k(n.raw.seeders),1)]),"item.peers":t(({item:n})=>[I("div",null,k(n.raw.peers),1)]),"item.actions":t(({item:n})=>[I("div",st,[e(x,null,{default:t(()=>[e(S,{icon:"mdi-dots-vertical"}),e(Oe,{activator:"parent","close-on-content-click":""},{default:t(()=>[e(We,null,{default:t(()=>{var P;return[e(ve,{variant:"plain",onClick:F=>xe(n.raw.page_url)},{prepend:t(()=>[e(S,{icon:"mdi-information"})]),default:t(()=>[e(_e,null,{default:t(()=>[g("查看详情")]),_:1})]),_:2},1032,["onClick"]),(P=n.raw.enclosure)!=null&&P.startsWith("http")?(u(),f(ve,{key:0,variant:"plain",onClick:F=>$e(n.raw.enclosure)},{prepend:t(()=>[e(S,{icon:"mdi-download"})]),default:t(()=>[e(_e,null,{default:t(()=>[g("下载种子文件")]),_:1})]),_:2},1032,["onClick"])):C("",!0)]}),_:2},1024)]),_:2},1024)]),_:2},1024)])]),"no-data":t(()=>[g(" 没有数据 ")]),_:1},8,["items-per-page","items","items-length","search","loading"])]),_:1})]),_:1},8,["title"])]}),_:1},8,["modelValue"])],64)}}});const rt={key:0,class:"mt-12 w-full text-center text-gray-500 text-sm flex flex-col items-center"},nt={key:1,class:"grid gap-3 grid-site-card"},it=Z({__name:"SiteCardListView",setup(R){const _=p([]),o=p(!1),a=p(!1);async function v(){try{_.value=await D.get("site/"),o.value=!0}catch(U){console.error(U)}}return Ge(v),(U,V)=>(u(),E(Q,null,[l(o)?C("",!0):(u(),E("div",rt,[l(o)?C("",!0):(u(),f(Je,{key:0,size:"48",indeterminate:"",color:"primary"}))])),l(_).length>0?(u(),E("div",nt,[(u(!0),E(Q,null,ke(l(_),w=>(u(),f(ot,{key:w.id,site:w,onRemove:v,onUpdate:v},null,8,["site"]))),128))])):C("",!0),l(_).length===0&&l(o)?(u(),f(Ye,{key:2,"error-code":"404","error-title":"没有站点","error-description":"已添加并支持的站点将会在这里显示。"})):C("",!0),e(T,{icon:"mdi-plus",size:"x-large",class:"fixed right-5 bottom-5",oper:"add",onClick:V[0]||(V[0]=w=>a.value=!0)}),e(be,{modelValue:l(a),"onUpdate:modelValue":V[1]||(V[1]=w=>H(a)?a.value=w:null),oper:"add",onSave:V[2]||(V[2]=w=>{a.value=!1,v()}),onClose:V[3]||(V[3]=w=>a.value=!1)},null,8,["modelValue"])],64))}});const Vt=Z({__name:"site",setup(R){return(_,o)=>(u(),E("div",null,[e(it)]))}});export{Vt as default};
