import{d as J,r as x,p as M,e as ne,o as r,f as p,i as t,m as e,aa as pe,I as L,aD as De,aV as Me,V,a9 as Q,c as N,a2 as H,a7 as X,j as l,a4 as Y,K as C,t as R,M as A,W as S,aG as Ne,z as fe,A as E,B as F,E as z,F as q,G as me,L as le,aE as he,aX as $e,aY as Ie,a as K,w as Z,q as Se,P as D,a8 as oe,ao as Ae,ap as qe,aZ as Ue,N as Ee,av as We,U as Ge,a_ as we,a5 as He,H as Je,Q as Ke,C as ae,D as O,aw as ue,R as Qe,S as Xe,ai as Ye,ax as ce,a1 as ge,az as je}from"./index-7936348a.js";import{_ as ve}from"./_plugin-vue_export-helper-c27b6911.js";import{n as Ce}from"./index-705cb9e8.js";import{c as Ze}from"./formatters-71c0a2e3.js";const Pe=_=>($e("data-v-a8649fc5"),_=_(),Ie(),_),et=Pe(()=>K("div",{class:"flex-grow-1"},null,-1)),tt=Pe(()=>K("div",{class:"flex-grow-1"},null,-1)),lt=J({__name:"Toolbar",props:{storages:Array,storage:String,path:String,endpoints:Object,axios:Object},emits:["storagechanged","pathchanged","loading","foldercreated"],setup(_,{emit:k}){const a=_,U=x(!1),b=x(""),I=M(()=>{var c,f;let d="";const i=(c=a.path)==null?void 0:c.endsWith("/"),u=(f=a.path)==null?void 0:f.split("/").filter(h=>h);return(u==null?void 0:u.map((h,$)=>(d+=h+($<u.length-1||i?"/":""),{name:h,path:d})))??[]}),w=M(()=>{var d;return(d=a.storages)==null?void 0:d.find(i=>i.code===a.storage)});function P(d){a.storage!==d&&(k("storagechanged",d),k("pathchanged",""))}function j(d){k("pathchanged",d)}function B(){const d=I.value??[],i=(d==null?void 0:d.length)===1?"/":d[d.length-2].path;j(i)}async function T(){var u,c,f;k("loading",!0);const i={url:(u=a.endpoints)==null?void 0:u.mkdir.url.replace(/{storage}/g,a.storage).replace(/{path}/g,encodeURIComponent(a.path+b.value)),method:((c=a.endpoints)==null?void 0:c.mkdir.method)||"post"};await((f=a.axios)==null?void 0:f.request(i)),U.value=!1,b.value="",k("loading",!1),k("foldercreated")}return(d,i)=>{const u=ne("Icon"),c=ne("IconBtn");return r(),p(he,{flat:"",dense:""},{default:t(()=>[e(Ne,{class:"overflow-hidden"},{default:t(()=>{var f;return[(f=a.storages)!=null&&f.length||0>1?(r(),p(pe,{key:0,"offset-y":""},{activator:t(({props:h})=>[e(L,De(Me(h)),{default:t(()=>[e(V,{icon:"mdi-arrow-down-drop-circle-outline"})]),_:2},1040)]),default:t(()=>[e(Q,null,{default:t(()=>[(r(!0),N(A,null,H(_.storages,(h,$)=>{var m;return r(),p(X,{key:$,disabled:h.code===((m=l(w))==null?void 0:m.code),onClick:ke=>P(h.code)},{prepend:t(()=>[e(u,{icon:h.icon},null,8,["icon"])]),default:t(()=>[e(Y,null,{default:t(()=>[C(R(h.name),1)]),_:2},1024)]),_:2},1032,["disabled","onClick"])}),128))]),_:1})]),_:1})):S("",!0),e(L,{variant:"text","input-value":_.path==="/",class:"px-1",onClick:i[0]||(i[0]=h=>j("/"))},{default:t(()=>{var h,$;return[e(V,{icon:(h=l(w))==null?void 0:h.icon,class:"mr-2"},null,8,["icon"]),C(" "+R(($=l(w))==null?void 0:$.name),1)]}),_:1},8,["input-value"]),(r(!0),N(A,null,H(l(I),(h,$)=>(r(),p(L,{key:$,variant:"text","input-value":$===l(I).length-1,class:"px-1 d-none d-md-block",onClick:m=>j(h.path)},{default:t(()=>[e(V,{icon:" mdi-chevron-right"}),C(" "+R(h.name),1)]),_:2},1032,["input-value","onClick"]))),128))]}),_:1}),et,l(I).length>0?(r(),p(c,{key:0,onClick:B},{default:t(()=>[e(V,{icon:"mdi-arrow-up-bold-outline"})]),_:1})):S("",!0),e(le,{modelValue:l(U),"onUpdate:modelValue":i[3]||(i[3]=f=>q(U)?U.value=f:null),"max-width":"600"},{activator:t(({props:f})=>[e(c,fe({title:"新建文件夹"},f),{default:t(()=>[e(V,{icon:"mdi-folder-plus-outline"})]),_:2},1040)]),default:t(()=>[e(E,{title:"新建文件夹"},{default:t(()=>[e(F,null,{default:t(()=>[e(z,{modelValue:l(b),"onUpdate:modelValue":i[1]||(i[1]=f=>q(b)?b.value=f:null),label:"名称"},null,8,["modelValue"])]),_:1}),e(me,null,{default:t(()=>[tt,e(L,{depressed:"",onClick:i[2]||(i[2]=f=>U.value=!1)},{default:t(()=>[C(" 取消 ")]),_:1}),e(L,{disabled:!l(b),depressed:"",onClick:T},{default:t(()=>[C(" 新建 ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}});const at=ve(lt,[["__scopeId","data-v-a8649fc5"]]),nt={class:"grow scroll-x"},ot=J({__name:"Tree",props:{icons:Object,storage:String,path:String,endpoints:Object,axios:Object,refreshpending:Boolean},emits:["pathchanged","loading","refreshed"],setup(_,{emit:k}){const a=_,U=x([]),b=x([]),I=x([]),w=x("");function P(){U.value=[],I.value=[{type:"dir",path:"/",basename:"root",extension:"",name:"root",children:[],size:0}]}async function j(d){var f,h,$;k("loading",!0);const u={url:(f=a.endpoints)==null?void 0:f.list.url.replace(/{storage}/g,a.storage).replace(/{path}/g,d.path),method:((h=a.endpoints)==null?void 0:h.list.method)||"get"},c=await(($=a.axios)==null?void 0:$.request(u))??[];d.children=c.map(m=>(m.type==="dir"&&(m.children=[]),m)),k("loading",!1)}function B(d){let i="";b.value.length&&(i=b.value[0]),a.path!==i&&k("pathchanged",i)}function T(d){const i=[];for(i.push(I.value[0]);i.length>0;){const u=i.pop();if((u==null?void 0:u.path)===d)return u;if(u!=null&&u.children&&u.children.length)for(const c of u.children)i.push(c)}return null}return Z(()=>a.storage,()=>{P()}),Z(()=>a.path,()=>{a.path&&(b.value=[a.path],U.value.includes(a.path)||U.value.push(a.path))}),Z(()=>a.refreshpending,async()=>{if(a.refreshpending&&a.path){const d=T(a.path);d&&(await j(d),k("refreshed"))}}),Se(()=>{P()}),(d,i)=>{const u=ne("VTreeview");return r(),p(E,{flat:"",width:"250","min-height":"500",class:"d-flex flex-column folders-tree-card"},{default:t(()=>[K("div",nt,[e(u,{open:l(U),active:l(b),items:l(I),search:l(w),"load-children":j,"item-key":"path","item-text":"basename",dense:"",activatable:"",transition:"",class:"folders-tree","onUpdate:active":B},{prepend:t(({item:c,open:f})=>[c.type==="dir"?(r(),p(V,{key:0},{default:t(()=>[C(R(f?"mdi-folder-open-outline":"mdi-folder-outline"),1)]),_:2},1024)):a.icons?(r(),p(V,{key:1,icon:a.icons[c.extension.toLowerCase()]||a.icons.other},null,8,["icon"])):S("",!0)]),label:t(({item:c})=>[C(R(c.basename)+" ",1),c.type==="dir"?(r(),p(L,{key:0,icon:"",class:"ml-1",onClick:D(f=>j(c),["stop"])},{default:t(()=>[e(V,{class:"pa-0 mdi-18px",color:"grey lighten-1"},{default:t(()=>[C(" mdi-refresh ")]),_:1})]),_:2},1032,["onClick"])):S("",!0)]),_:1},8,["open","active","items","search"])]),e(oe),e(he,{density:"compact"},{default:t(()=>[e(L,{icon:"",onClick:P},{default:t(()=>[e(V,{icon:"mdi-collapse-all-outline"})]),_:1})]),_:1})]),_:1})}}});const st=ve(ot,[["__scopeId","data-v-5e129369"]]),_e=_=>($e("data-v-ca9dd14d"),_=_(),Ie(),_),rt=_e(()=>K("br",null,null,-1)),dt=_e(()=>K("div",{class:"flex-grow-1"},null,-1)),it=_e(()=>K("div",{class:"flex-grow-1"},null,-1)),ut=J({__name:"List",props:{icons:Object,storage:String,path:String,endpoints:Object,axios:Object,refreshpending:Boolean},emits:["loading","pathchanged","refreshed","filedeleted","renamed"],setup(_,{emit:k}){const a=_,U=Ae.useToast(),b=x(!0),I=qe(),w=x(a.storage??""),P=x(a.axios??Ue),j=x([]),B=x(""),T=x(!1),d=x(!1),i=x(!1),u=x("请稍候 ..."),c=x(0),f=x(),h=x(""),$=x(),m=Ee({path:"",target:"",tmdbid:null,season:null,type_name:"",transfer_type:"",episode_format:"",episode_detail:"",episode_part:"",episode_offset:null,min_filesize:0}),ke=x(Array.from({length:51},(s,n)=>n).map(s=>({title:`第 ${s} 季`,value:s}))),ee=M(()=>j.value.filter(s=>s.type==="dir"&&s.basename.includes(B.value))),te=M(()=>j.value.filter(s=>s.type==="file"&&s.basename.includes(B.value))),xe=M(()=>{var s;return(s=a.path)==null?void 0:s.endsWith("/")}),W=M(()=>!xe.value),ye=M(()=>{var n,v;const s=(v=(n=a.path)==null?void 0:n.split(".").pop())==null?void 0:v.toLowerCase();return["png","jpg","jpeg","gif","bmp"].includes(s??"")});async function G(){var s,n;if(b.value=!0,k("loading",!0),xe.value){const o={url:(s=a.endpoints)==null?void 0:s.list.url.replace(/{storage}/g,w.value).replace(/{path}/g,encodeURIComponent(a.path||"")),method:((n=a.endpoints)==null?void 0:n.list.method)||"get"};j.value=await P.value.request(o)??[]}k("loading",!1),b.value=!1}async function se(s){var v,o;if(await I({title:"确认",content:`是否确认删除${s.type==="dir"?"目录":"文件"} ${s.basename}？`,confirmationText:"确认",cancellationText:"取消",dialogProps:{maxWidth:600}})){k("loading",!0);const y={url:(v=a.endpoints)==null?void 0:v.delete.url.replace(/{storage}/g,w.value).replace(/{path}/g,encodeURIComponent(s.path)),method:((o=a.endpoints)==null?void 0:o.delete.method)||"post"};await P.value.request(y),k("filedeleted"),k("loading",!1),G()}}function Ve(s){k("pathchanged",s)}function Te(s){var g;if(!s)return;const n=ce.state.auth.token,o=`/api/v1/${((g=a.endpoints)==null?void 0:g.download.url.replace(/{storage}/g,w.value).replace(/{path}/g,encodeURIComponent(s))).slice(1)}&token=${n}`;window.open(o,"_blank")}function Le(s){var o;if(!s)return"";const n=ce.state.auth.token;return`/api/v1/${((o=a.endpoints)==null?void 0:o.image.url.replace(/{storage}/g,w.value).replace(/{path}/g,encodeURIComponent(s))).slice(1)}&token=${n}`}function re(s){$.value=s,h.value=s.name,T.value=!0}async function Be(){var v,o,g,y;k("loading",!0);const n={url:(o=a.endpoints)==null?void 0:o.rename.url.replace(/{storage}/g,a.storage).replace(/{path}/g,encodeURIComponent(((v=$.value)==null?void 0:v.path)||"")).replace(/{newname}/g,encodeURIComponent(h.value)),method:((g=a.endpoints)==null?void 0:g.mkdir.method)||"post"};await((y=a.axios)==null?void 0:y.request(n)),T.value=!1,h.value="",k("loading",!1),k("renamed")}function de(s){$.value=s,d.value=!0}async function Oe(){var s;m.path=((s=$.value)==null?void 0:s.path)??"";try{d.value=!1,i.value=!0,Re(),ge.post("transfer/manual",{},{params:m}).then(n=>{var v,o;i.value=!1,Fe(),n.success?(U.success(`${(v=$.value)==null?void 0:v.name} 整理成功！`),G()):U.error(`${(o=$.value)==null?void 0:o.name} 整理失败：${n.message}！`)})}catch(n){console.log(n)}}Z(()=>a.path,async()=>{j.value=[],await G()}),Z(()=>a.refreshpending,async()=>{a.refreshpending&&(await G(),k("refreshed"))});function Re(){u.value="请稍候 ...";const s=ce.state.auth.token;f.value=new EventSource(`/api/v1/system/progress/filetransfer?token=${s}`),f.value.onmessage=n=>{const v=JSON.parse(n.data);v&&(u.value=v.text,c.value=v.value)}}function Fe(){var s;(s=f.value)==null||s.close()}const be=x([{title:"重命名",value:1,props:{prependIcon:"mdi-rename",click:re}},{title:"整理",value:2,props:{prependIcon:"mdi-folder-arrow-right",click:de}},{title:"删除",value:3,props:{prependIcon:"mdi-delete-outline",color:"error",click:se}}]);return Se(()=>{G()}),(s,n)=>{const v=ne("IconBtn");return r(),N(A,null,[e(E,{class:"d-flex flex-column"},{default:t(()=>[l(b)?(r(),p(F,{key:0,class:"text-center flex flex-col items-center"},{default:t(()=>[e(We,{size:"48",indeterminate:"",color:"primary"})]),_:1})):S("",!0),_.path?l(W)&&!l(ye)?(r(),p(F,{key:2,class:"grow d-flex justify-center align-center break-all"},{default:t(()=>[C(" 文件: "+R(_.path),1),rt]),_:1})):l(W)&&l(ye)?(r(),p(F,{key:3,class:"grow d-flex justify-center align-center"},{default:t(()=>[e(Ge,{src:Le(_.path),"max-width":"100%","max-height":"100%"},null,8,["src"])]),_:1})):l(ee).length||l(te).length?(r(),p(F,{key:4,class:"p-0"},{default:t(()=>[l(ee).length?(r(),p(Q,{key:0,subheader:""},{default:t(()=>[e(we,null,{default:t(()=>[C("目录")]),_:1}),(r(!0),N(A,null,H(l(ee),(o,g)=>(r(),p(X,{key:g,class:"px-3 pe-1",onClick:y=>Ve(o.path)},{prepend:t(()=>[e(V,{icon:"mdi-folder-outline"})]),append:t(()=>[e(v,{class:"d-sm-none"},{default:t(()=>[e(V,{icon:"mdi-dots-vertical"}),e(pe,{activator:"parent","close-on-content-click":""},{default:t(()=>[e(Q,null,{default:t(()=>[(r(!0),N(A,null,H(l(be),(y,ie)=>(r(),p(X,{key:ie,variant:"plain","base-color":y.props.color,onClick:ze=>y.props.click(o)},{prepend:t(()=>[e(V,{icon:y.props.prependIcon},null,8,["icon"])]),default:t(()=>[e(Y,{textContent:R(y.title)},null,8,["textContent"])]),_:2},1032,["base-color","onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024),e(v,{class:"d-none d-sm-block",onClick:D(y=>re(o),["stop"])},{default:t(()=>[e(V,{icon:"mdi-rename"})]),_:2},1032,["onClick"]),e(v,{class:"d-none d-sm-block",onClick:D(y=>de(o),["stop"])},{default:t(()=>[e(V,{icon:"mdi-folder-arrow-right"})]),_:2},1032,["onClick"]),e(v,{class:"d-none d-sm-block",onClick:D(y=>se(o),["stop"])},{default:t(()=>[e(V,{icon:"mdi-delete-outline"})]),_:2},1032,["onClick"])]),default:t(()=>[e(Y,{textContent:R(o.name)},null,8,["textContent"])]),_:2},1032,["onClick"]))),128))]),_:1})):S("",!0),l(ee).length&&l(te).length?(r(),p(oe,{key:1})):S("",!0),l(te).length?(r(),p(Q,{key:2,subheader:""},{default:t(()=>[e(we,null,{default:t(()=>[C("文件")]),_:1}),(r(!0),N(A,null,H(l(te),(o,g)=>(r(),p(X,{key:g,class:"pl-3 pe-1",onClick:y=>Ve(o.path)},{prepend:t(()=>{var y;return[a.icons?(r(),p(V,{key:0,icon:a.icons[o.extension.toLowerCase()]||((y=a.icons)==null?void 0:y.other)},null,8,["icon"])):S("",!0)]}),append:t(()=>[e(v,{class:"d-sm-none"},{default:t(()=>[e(V,{icon:"mdi-dots-vertical"}),e(pe,{activator:"parent","close-on-content-click":""},{default:t(()=>[e(Q,null,{default:t(()=>[(r(!0),N(A,null,H(l(be),(y,ie)=>(r(),p(X,{key:ie,variant:"plain","base-color":y.props.color,onClick:ze=>y.props.click(o)},{prepend:t(()=>[e(V,{icon:y.props.prependIcon},null,8,["icon"])]),default:t(()=>[e(Y,{textContent:R(y.title)},null,8,["textContent"])]),_:2},1032,["base-color","onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024),e(v,{class:"d-none d-sm-block",onClick:D(y=>re(o),["stop"])},{default:t(()=>[e(V,{icon:"mdi-rename"})]),_:2},1032,["onClick"]),e(v,{class:"d-none d-sm-block",onClick:D(y=>de(o),["stop"])},{default:t(()=>[e(V,{icon:"mdi-folder-arrow-right"})]),_:2},1032,["onClick"]),e(v,{class:"d-none d-sm-block",onClick:D(y=>se(o),["stop"])},{default:t(()=>[e(V,{icon:"mdi-delete-outline"})]),_:2},1032,["onClick"])]),default:t(()=>[e(Y,{textContent:R(o.name)},null,8,["textContent"]),e(He,null,{default:t(()=>[C(R(l(Ze)(o.size)),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):S("",!0)]),_:1})):l(B)?(r(),p(F,{key:5,class:"grow d-flex justify-center align-center grey--text py-5"},{default:t(()=>[C(" 没有目录或文件 ")]),_:1})):l(b)?S("",!0):(r(),p(F,{key:6,class:"grow d-flex justify-center align-center grey--text py-5"},{default:t(()=>[C(" 空目录 ")]),_:1})):(r(),p(F,{key:1,class:"grow d-flex justify-center align-center grey--text"},{default:t(()=>[C(" 选择目录或文件 ")]),_:1})),_.path?(r(),p(oe,{key:7})):S("",!0),l(b)?S("",!0):(r(),p(he,{key:8,density:"compact",flat:"",color:"gray"},{default:t(()=>[l(W)?S("",!0):(r(),p(z,{key:0,modelValue:l(B),"onUpdate:modelValue":n[0]||(n[0]=o=>q(B)?B.value=o:null),"hide-details":"",flat:"",density:"compact",variant:"solo-filled",placeholder:"搜索 ...","prepend-inner-icon":"mdi-filter-outline",class:"me-2"},null,8,["modelValue"])),l(W)?(r(),p(Je,{key:1})):S("",!0),l(W)?(r(),p(L,{key:2,onClick:n[1]||(n[1]=o=>Te(a.path||""))},{default:t(()=>[e(V,null,{default:t(()=>[C("mdi-download")]),_:1})]),_:1})):S("",!0),l(W)?S("",!0):(r(),p(L,{key:3,onClick:G},{default:t(()=>[e(V,null,{default:t(()=>[C("mdi-refresh")]),_:1})]),_:1}))]),_:1}))]),_:1}),e(le,{modelValue:l(T),"onUpdate:modelValue":n[4]||(n[4]=o=>q(T)?T.value=o:null),"max-width":"600"},{activator:t(({props:o})=>[e(v,fe({title:"重命名"},o),{default:t(()=>[e(V,{icon:"mdi-rename-outline"})]),_:2},1040)]),default:t(()=>[e(E,{title:"重命名"},{default:t(()=>[e(F,null,{default:t(()=>[e(z,{modelValue:l(h),"onUpdate:modelValue":n[2]||(n[2]=o=>q(h)?h.value=o:null),label:"名称"},null,8,["modelValue"])]),_:1}),e(me,null,{default:t(()=>[dt,e(L,{depressed:"",onClick:n[3]||(n[3]=o=>T.value=!1)},{default:t(()=>[C(" 取消 ")]),_:1}),e(L,{disabled:!l(h),depressed:"",onClick:Be},{default:t(()=>[C(" 重命名 ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(le,{modelValue:l(d),"onUpdate:modelValue":n[16]||(n[16]=o=>q(d)?d.value=o:null),"max-width":"800",scrollable:""},{activator:t(({props:o})=>[e(v,fe({title:"整理"},o),{default:t(()=>[e(V,{icon:"mdi-folder-arrow-right-outline"})]),_:2},1040)]),default:t(()=>{var o;return[e(E,{title:`文件整理 - ${(o=l($))==null?void 0:o.name}`},{default:t(()=>[e(F,{class:"pt-2"},{default:t(()=>[e(Ke,{onSubmit:D(()=>{},["prevent"])},{default:t(()=>[e(ae,null,{default:t(()=>[e(O,{cols:"12",md:"8"},{default:t(()=>[e(z,{modelValue:l(m).target,"onUpdate:modelValue":n[5]||(n[5]=g=>l(m).target=g),label:"目的路径"},null,8,["modelValue"])]),_:1}),e(O,{cols:"12",md:"4"},{default:t(()=>[e(ue,{modelValue:l(m).transfer_type,"onUpdate:modelValue":n[6]||(n[6]=g=>l(m).transfer_type=g),label:"整理方式",items:[{title:"默认",value:""},{title:"移动",value:"move"},{title:"复制",value:"copy"},{title:"硬链接",value:"link"},{title:"软链接",value:"softlink"}]},null,8,["modelValue"])]),_:1})]),_:1}),e(ae,null,{default:t(()=>[e(O,{cols:"12",md:"4"},{default:t(()=>[e(ue,{modelValue:l(m).type_name,"onUpdate:modelValue":n[7]||(n[7]=g=>l(m).type_name=g),label:"类型",items:[{title:"请选择",value:""},{title:"电影",value:"电影"},{title:"电视剧",value:"电视剧"}]},null,8,["modelValue"])]),_:1}),e(O,{cols:"12",md:"4"},{default:t(()=>[e(z,{modelValue:l(m).tmdbid,"onUpdate:modelValue":n[8]||(n[8]=g=>l(m).tmdbid=g),label:"TMDBID",placeholder:"留空自动识别",rules:[l(Ce)]},null,8,["modelValue","rules"])]),_:1}),e(O,{cols:"12",md:"4"},{default:t(()=>[Qe(e(ue,{modelValue:l(m).season,"onUpdate:modelValue":n[9]||(n[9]=g=>l(m).season=g),modelModifiers:{number:!0},label:"季",items:l(ke)},null,8,["modelValue","items"]),[[Xe,l(m).type_name==="电视剧"]])]),_:1})]),_:1}),e(ae,null,{default:t(()=>[e(O,{cols:"12",md:"8"},{default:t(()=>[e(z,{modelValue:l(m).episode_format,"onUpdate:modelValue":n[10]||(n[10]=g=>l(m).episode_format=g),label:"集数定位",placeholder:"使用{ep}定位集数"},null,8,["modelValue"])]),_:1}),e(O,{cols:"12",md:"4"},{default:t(()=>[e(z,{modelValue:l(m).episode_detail,"onUpdate:modelValue":n[11]||(n[11]=g=>l(m).episode_detail=g),label:"指定集数",placeholder:"起始集,终止集，如1或1,2"},null,8,["modelValue"])]),_:1}),e(O,{cols:"12",md:"4"},{default:t(()=>[e(z,{modelValue:l(m).episode_part,"onUpdate:modelValue":n[12]||(n[12]=g=>l(m).episode_part=g),label:"指定Part",placeholder:"如part1"},null,8,["modelValue"])]),_:1}),e(O,{cols:"12",md:"4"},{default:t(()=>[e(z,{modelValue:l(m).episode_offset,"onUpdate:modelValue":n[13]||(n[13]=g=>l(m).episode_offset=g),modelModifiers:{number:!0},label:"集数偏移",placeholder:"如-10"},null,8,["modelValue"])]),_:1}),e(O,{cols:"12",md:"4"},{default:t(()=>[e(z,{modelValue:l(m).min_filesize,"onUpdate:modelValue":n[14]||(n[14]=g=>l(m).min_filesize=g),modelModifiers:{number:!0},label:"最小文件大小（MB）",rules:[l(Ce)],placeholder:"0"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(me,null,{default:t(()=>[it,e(L,{depressed:"",onClick:n[15]||(n[15]=g=>d.value=!1)},{default:t(()=>[C(" 取消 ")]),_:1}),e(L,{onClick:Oe},{default:t(()=>[C(" 开始整理 ")]),_:1})]),_:1})]),_:1},8,["title"])]}),_:1},8,["modelValue"]),e(le,{modelValue:l(i),"onUpdate:modelValue":n[17]||(n[17]=o=>q(i)?i.value=o:null),scrim:!1,width:"400"},{default:t(()=>[e(E,{color:"primary"},{default:t(()=>[e(F,{class:"text-center"},{default:t(()=>[C(R(l(u))+" ",1),e(Ye,{color:"white",class:"mb-0 mt-1","model-value":l(c)},null,8,["model-value"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}});const ct=ve(ut,[["__scopeId","data-v-ca9dd14d"]]),pt=J({__name:"FileBrowser",props:{storages:String,storage:String,path:String,tree:Boolean,endpoints:Object,axios:Object,axiosconfig:Object},emits:["pathchanged"],setup(_,{emit:k}){const a=_,U=[{name:"本地",code:"local",icon:"mdi-folder-multiple-outline"}],b={zip:"mdi-folder-zip-outline",rar:"mdi-folder-zip-outline",htm:"mdi-language-html5",html:"mdi-language-html5",js:"mdi-nodejs",json:"mdi-file-document-outline",md:"mdi-language-markdown-outline",pdf:"mdi-file-pdf",png:"mdi-file-image",jpg:"mdi-file-image",jpeg:"mdi-file-image",mp4:"mdi-filmstrip",mkv:"mdi-filmstrip",avi:"mdi-filmstrip",wmv:"mdi-filmstrip",mov:"mdi-filmstrip",txt:"mdi-file-document-outline",xls:"mdi-file-excel",other:"mdi-file-outline"},I=x(0),w=x("local"),P=x(!1),j=x(),B=M(()=>{var c;const u=(c=a.storages)==null?void 0:c.split(",");return U.filter(f=>u==null?void 0:u.includes(f.code))});function T(u){}function d(u){w.value=u}function i(u){k("pathchanged",u)}return je(()=>{w.value=a.storage??"local",j.value=a.axios??Ue.create(a.axiosconfig)}),(u,c)=>(r(),p(E,{class:"mx-auto",loading:l(I)>0},{default:t(()=>[e(at,{path:a.path,storages:l(B),storage:l(w),endpoints:a.endpoints,axios:l(j),onStoragechanged:d,onPathchanged:i,onFoldercreated:c[0]||(c[0]=f=>P.value=!0)},null,8,["path","storages","storage","endpoints","axios"]),e(ae,{"no-gutters":""},{default:t(()=>[_.tree?(r(),p(O,{key:0,sm:"auto",class:"d-none d-md-block"},{default:t(()=>[e(st,{path:a.path,storage:l(w),icons:b,endpoints:_.endpoints,axios:l(j),refreshpending:l(P),onPathchanged:i,onLoading:T,onRefreshed:c[1]||(c[1]=f=>P.value=!1)},null,8,["path","storage","endpoints","axios","refreshpending"])]),_:1})):S("",!0),_.tree?(r(),p(oe,{key:1,vertical:""})):S("",!0),e(O,null,{default:t(()=>[e(ct,{path:a.path,storage:l(w),icons:b,endpoints:_.endpoints,axios:l(j),refreshpending:l(P),onPathchanged:i,onLoading:T,onRefreshed:c[2]||(c[2]=f=>P.value=!1),onFiledeleted:c[3]||(c[3]=f=>P.value=!0),onRenamed:c[4]||(c[4]=f=>P.value=!0)},null,8,["path","storage","endpoints","axios","refreshpending"])]),_:1})]),_:1})]),_:1},8,["loading"]))}}),ft=J({__name:"FileBrowserView",setup(_){const k={list:{url:"/filebrowser/list?path={path}",method:"get"},mkdir:{url:"/filebrowser/mkdir?path={path}",method:"get"},delete:{url:"/filebrowser/delete?path={path}",method:"get"},download:{url:"/filebrowser/download?path={path}",method:"get"},image:{url:"/filebrowser/image?path={path}",method:"get"},rename:{url:"/filebrowser/rename?path={path}&new_name={newname}",method:"get"}},a=x("/");async function U(){var I;try{const w=await ge.get("system/env");w.success&&(a.value=((I=w.data)==null?void 0:I.DOWNLOAD_PATH)||"/"),a.value&&!a.value.endsWith("/")&&(a.value+="/")}catch(w){console.log(w)}}function b(I){a.value=I}return je(async()=>{await U()}),(I,w)=>(r(),N("div",null,[e(pt,{storages:"local",tree:!1,path:l(a),endpoints:k,axios:l(ge),onPathchanged:b},null,8,["path","axios"])]))}}),_t=J({__name:"filemanager",setup(_){return(k,a)=>(r(),p(ft))}});export{_t as default};
