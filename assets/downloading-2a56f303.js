import{P as R}from"./index-a5456898.js";import{d as b,r as m,j as s,o,f as p,i as n,m as r,U as S,K as C,t as w,n as V,Y as j,Z as U,B as T,ai as z,W as _,I as P,a as A,G as F,A as M,a1 as $,ay as E,ag as G,c as x,au as H,M as I,a2 as K,F as O}from"./index-6958f571.js";import{_ as W}from"./NoDataFound.vue_vue_type_style_index_0_lang-e90a023f.js";const Y={class:"ms-2"},Z=b({__name:"DownloadingCard",props:{info:Object},setup(k){var D;const e=k,l=m(!0);function u(){var a;return((a=e.info)==null?void 0:a.progress)??0}function g(){var a,i;return`↑ ${(a=e.info)==null?void 0:a.upspeed}/s ↓ ${(i=e.info)==null?void 0:i.dlspeed}/s`}const t=m(((D=e.info)==null?void 0:D.state)==="downloading"),v=m(!1);function y(){v.value=!0}function d(){return v.value?"text-white":""}async function f(){var i;const a=t.value?"stop":"start";try{(await $.put(`download/${(i=e.info)==null?void 0:i.hash}/${a}`)).success&&(t.value=!t.value)}catch(h){console.error(h)}}async function N(){var a;try{await $.delete(`download/${(a=e.info)==null?void 0:a.hash}`),l.value=!1}catch(i){console.error(i)}}return(a,i)=>{var h;return s(l)?(o(),p(M,{key:(h=e.info)==null?void 0:h.hash},{image:n(()=>{var c;return[r(S,{src:(c=e.info)==null?void 0:c.media.image,"aspect-ratio":"2/3",cover:"",class:"brightness-50",onLoad:y},null,8,["src"])]}),default:n(()=>[r(j,{class:V(["break-words whitespace-normal",d()])},{default:n(()=>{var c,L,B;return[C(w(((c=e.info)==null?void 0:c.media.title)||((L=e.info)==null?void 0:L.name))+" "+w((B=e.info)==null?void 0:B.season_episode),1)]}),_:1},8,["class"]),r(U,{class:V(["break-words whitespace-normal",d()])},{default:n(()=>{var c;return[C(w((c=e.info)==null?void 0:c.title),1)]}),_:1},8,["class"]),r(T,{class:V(["text-subtitle-1 pt-3 pb-1",d()])},{default:n(()=>[C(w(g()),1)]),_:1},8,["class"]),u()>0?(o(),p(T,{key:0,class:V(d())},{default:n(()=>[r(z,{"model-value":u()},null,8,["model-value"])]),_:1},8,["class"])):_("",!0),r(F,{class:"justify-space-between"},{default:n(()=>[r(P,{onClick:f},{default:n(()=>[A("span",Y,w(s(t)?"暂停":"开始"),1)]),_:1}),r(P,{color:"error",icon:"mdi-trash-can-outline",onClick:N})]),_:1})]),_:1})):_("",!0)}}}),q={key:0,class:"mt-12 w-full text-center text-gray-500 text-sm flex flex-col items-center"},J={key:0,class:"grid gap-3 grid-downloading-card"},Q=b({__name:"DownloadingListView",setup(k){let e=null;const l=m([]),u=m(!1);async function g(){try{l.value=await $.get("download"),u.value=!0}catch(y){console.error(y)}}const t=m(!1);function v(){t.value=!0,g(),t.value=!1}return E(()=>{g(),e=setInterval(()=>{g()},3e3)}),G(()=>{e&&(clearInterval(e),e=null)}),(y,d)=>(o(),x(I,null,[s(u)?_("",!0):(o(),x("div",q,[s(u)?_("",!0):(o(),p(H,{key:0,size:"48",indeterminate:"",color:"primary"}))])),r(s(R),{modelValue:s(t),"onUpdate:modelValue":d[0]||(d[0]=f=>O(t)?t.value=f:null),onRefresh:v},{default:n(()=>[s(l).length>0?(o(),x("div",J,[(o(!0),x(I,null,K(s(l),f=>(o(),p(Z,{key:f.hash,info:f},null,8,["info"]))),128))])):_("",!0),s(l).length===0&&s(u)?(o(),p(W,{key:1,"error-code":"404","error-title":"没有任务","error-description":"正在下载的任务将会显示在这里。"})):_("",!0)]),_:1},8,["modelValue"])],64))}});const te=b({__name:"downloading",setup(k){return(e,l)=>(o(),p(Q))}});export{te as default};
