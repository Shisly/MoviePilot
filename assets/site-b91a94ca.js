import{d as re,r as c,af as _e,N as ye,q as Ne,e as pe,o as V,c as L,m as e,i as l,X as Re,ag as Ee,j as t,aa as Me,ab as Ke,P as A,K as _,t as g,az as je,f as k,$ as x,B as j,V as $,z as q,aA as Q,a1 as qe,G as W,I as B,A as H,Q as se,C as T,D as p,E as w,J as He,H as oe,F as O,L as X,a8 as Y,O as be,aw as Z,a as P,M as ee,W as ge,a4 as fe,n as Oe,ac as Ge,a2 as Je,a0 as Ve,Y as ve,ax as Qe,a3 as We,at as Xe,au as Ye}from"./index-d25b67b6.js";import{a as z}from"./index-fcc720d1.js";import{_ as Ze}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-56702d5a.js";import{f as el}from"./formatters-16dfb57c.js";import{r as R,n as E}from"./index-705cb9e8.js";import{E as ll}from"./ExistIcon-c3f7ee6d.js";import{_ as tl}from"./NoDataFound.vue_vue_type_script_setup_true_lang-c7bc7429.js";import"./_plugin-vue_export-helper-c27b6911.js";const al={class:"text-high-emphasis pt-1"},sl={class:"text-sm my-1"},ol={class:"text-sm"},rl={class:"text-nowrap whitespace-nowrap"},nl={class:"me-n3"},ul=re({__name:"SiteCard",props:{site:Object,width:String,height:String},emits:["remove","update"],setup(le,{emit:F}){const u=le,U=c(!1),h=c(""),y=_e.useToast(),S=c("测试"),M=c(!1),K=c("更新"),m=c(!1),C=c(!1),I=c(!1),v=c(!1),d=[{title:"标题",key:"title",sortable:!1},{title:"时间",key:"pubdate",sortable:!0},{title:"大小",key:"size",sortable:!0},{title:"做种",key:"seeders",sortable:!0},{title:"下载",key:"peers",sortable:!0},{title:"",key:"actions",sortable:!1}],i=c([]),ne=c(""),te=c(!1),we=c(0),ae=c(25),ke=c(0),D=c({username:"",password:""}),xe=[{title:"启用",value:!0},{title:"停用",value:!1}],Ce=c(Array.from({length:50},(r,a)=>a+1).map(r=>({title:r,value:r}))),n=ye(u.site??{});n.proxy=n.proxy===1,n.render=n.render===1;function $e(r){window.open(r,"_blank")}async function Ue(r){window.open(r,"_blank")}async function Se(){var r;try{h.value=(await z.get(`site/icon/${(r=u.site)==null?void 0:r.id}`)).data.icon}catch(a){console.error(a)}}async function Ie(){var r,a,b;try{S.value="测试中 ...",M.value=!0;const f=await z.get(`site/test/${(r=u.site)==null?void 0:r.id}`);f.success?y.success(`${(a=u.site)==null?void 0:a.name} 连通性测试成功，可正常使用！`):y.error(`${(b=u.site)==null?void 0:b.name} 连通性测试失败：${f.message}`),S.value="测试",M.value=!1}catch(f){console.error(f)}}async function Be(){C.value=!0}async function Te(){I.value=!0}async function De(){v.value=!0,Le()}async function ue(){var r,a,b;try{if(!D.value.username||!D.value.password)return;C.value=!1,K.value="更新中 ...",m.value=!0;const f=await z.get(`site/cookie/${(r=u.site)==null?void 0:r.id}`,{params:{username:D.value.username,password:D.value.password}});f.success?y.success(`${(a=u.site)==null?void 0:a.name} 更新Cookie & UA 成功！`):y.error(`${(b=u.site)==null?void 0:b.name} 更新失败：${f.message}`),K.value="更新",m.value=!1}catch(f){console.error(f)}}async function Pe(){var r,a,b,f;try{I.value=!1;const N=await z.delete(`site/${(r=u.site)==null?void 0:r.id}`);N.success?(y.success(`${(a=u.site)==null?void 0:a.name} 删除成功！`),F("remove")):y.error(`${(b=u.site)==null?void 0:b.name} 删除失败：${N.message}`)}catch(N){y.error(`${(f=u.site)==null?void 0:f.name} 删除失败！`),console.error(N)}}async function ze(){var r,a,b;try{I.value=!1;const f=await z.put("site",n);f.success?(y.success(`${(r=u.site)==null?void 0:r.name} 更新成功！`),F("update")):y.error(`${(a=u.site)==null?void 0:a.name} 更新失败：${f.message}`)}catch(f){y.error(`${(b=u.site)==null?void 0:b.name} 更新失败！`),console.error(f)}}function Ae(r,a){return r===0?"text-white bg-lime-500":r<1?"text-white bg-green-500":a!==1?"text-white bg-sky-500":"text-white bg-gray-500"}async function Le(){var r;te.value=!0;try{i.value=await z.get("search/title",{params:{keyword:ne.value,page:ke.value,site:(r=u.site)==null?void 0:r.id}}),te.value=!1}catch(a){console.error(a)}}function Fe(){var r;window.open((r=u.site)==null?void 0:r.url,"_blank")}return Ne(()=>{Se()}),(r,a)=>{const b=Ze,f=pe("IconBtn"),N=pe("VDataTable");return V(),L(ee,null,[e(H,{height:u.height,width:u.width,flat:!t(n).is_active,class:"overflow-hidden",onClick:Te},{image:l(()=>[e(Re,{class:"absolute right-2 bottom-2 rounded",variant:"flat",rounded:"0"},{default:l(()=>[e(Ee,{src:t(h)},null,8,["src"])]),_:1})]),default:l(()=>[e(Me,null,{default:l(()=>[e(Ke,{class:"font-bold",onClick:A(Fe,["stop"])},{default:l(()=>{var o;return[_(g((o=u.site)==null?void 0:o.name),1)]}),_:1},8,["onClick"]),e(je,null,{default:l(()=>{var o;return[_(g((o=u.site)==null?void 0:o.url),1)]}),_:1})]),_:1}),t(n).is_active?(V(),k(ll,{key:0})):x("",!0),e(j,{class:"py-2"},{default:l(()=>[t(n).render?(V(),k(Q,{key:0,text:"浏览器仿真"},{activator:l(({props:o})=>[e($,q({color:"primary",class:"me-2"},o,{icon:"mdi-apple-safari"}),null,16)]),_:1})):x("",!0),t(n).proxy?(V(),k(Q,{key:1,text:"代理"},{activator:l(({props:o})=>[e($,q({color:"primary",class:"me-2"},o,{icon:"mdi-network-outline"}),null,16)]),_:1})):x("",!0),t(n).limit_interval?(V(),k(Q,{key:2,text:"流控"},{activator:l(({props:o})=>[e($,q({color:"primary",class:"me-2"},o,{icon:"mdi-speedometer"}),null,16)]),_:1})):x("",!0),t(n).filter?(V(),k(Q,{key:3,text:"过滤"},{activator:l(({props:o})=>[e($,q({color:"primary",class:"me-2"},o,{icon:"mdi-filter-cog-outline"}),null,16)]),_:1})):x("",!0)]),_:1}),e(qe,{class:"opacity-75",style:{"border-color":"rgba(var(--v-theme-on-background), var(--v-selected-opacity))"}}),e(W,null,{default:l(()=>{var o;return[(o=u.site)!=null&&o.public?x("",!0):(V(),k(B,{key:0,disabled:t(m),onClick:A(Be,["stop"])},{prepend:l(()=>[e($,{icon:"mdi-refresh"})]),default:l(()=>[_(" "+g(t(K)),1)]),_:1},8,["disabled","onClick"])),e(B,{disabled:t(M),onClick:A(Ie,["stop"])},{prepend:l(()=>[e($,{icon:"mdi-link"})]),default:l(()=>[_(" "+g(t(S)),1)]),_:1},8,["disabled","onClick"]),e(B,{onClick:A(De,["stop"])},{prepend:l(()=>[e($,{icon:"mdi-web"})]),default:l(()=>[_(" 浏览 ")]),_:1},8,["onClick"])]}),_:1})]),_:1},8,["height","width","flat"]),e(X,{modelValue:t(C),"onUpdate:modelValue":a[3]||(a[3]=o=>O(C)?C.value=o:null),"max-width":"50rem"},{default:l(()=>[e(H,{title:"更新站点Cookie & UA"},{default:l(()=>[e(j,null,{default:l(()=>[e(se,{onSubmit:A(()=>{},["prevent"])},{default:l(()=>[e(T,null,{default:l(()=>[e(p,{cols:"12",md:"6"},{default:l(()=>[e(w,{modelValue:t(D).username,"onUpdate:modelValue":a[0]||(a[0]=o=>t(D).username=o),label:"用户名",rules:[t(R)]},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12",md:"6"},{default:l(()=>[e(w,{modelValue:t(D).password,"onUpdate:modelValue":a[1]||(a[1]=o=>t(D).password=o),label:"密码",type:t(U)?"text":"password","append-inner-icon":t(U)?"mdi-eye-off-outline":"mdi-eye-outline",rules:[t(R)],"onClick:appendInner":a[2]||(a[2]=o=>U.value=!t(U)),onKeydown:He(ue,["enter"])},null,8,["modelValue","type","append-inner-icon","rules","onKeydown"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(W,null,{default:l(()=>[e(oe),e(B,{onClick:ue},{default:l(()=>[_(" 开始更新 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(X,{modelValue:t(I),"onUpdate:modelValue":a[15]||(a[15]=o=>O(I)?I.value=o:null),"max-width":"1000",persistent:"",scrollable:""},{default:l(()=>{var o;return[e(H,{title:`编辑站点 - ${(o=u.site)==null?void 0:o.name}`},{default:l(()=>[e(j,{class:"pt-2"},{default:l(()=>[e(b,{onClick:a[4]||(a[4]=s=>I.value=!1)}),e(se,{onSubmit:A(()=>{},["prevent"])},{default:l(()=>[e(T,null,{default:l(()=>[e(p,{cols:"12",md:"6"},{default:l(()=>[e(w,{modelValue:t(n).url,"onUpdate:modelValue":a[5]||(a[5]=s=>t(n).url=s),label:"站点地址",rules:[t(R)]},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12",md:"3"},{default:l(()=>[e(Y,{modelValue:t(n).pri,"onUpdate:modelValue":a[6]||(a[6]=s=>t(n).pri=s),label:"优先级",items:t(Ce),rules:[t(R)]},null,8,["modelValue","items","rules"])]),_:1}),e(p,{cols:"12",md:"3"},{default:l(()=>[e(Y,{modelValue:t(n).is_active,"onUpdate:modelValue":a[7]||(a[7]=s=>t(n).is_active=s),items:xe,label:"状态"},null,8,["modelValue"])]),_:1})]),_:1}),e(T,null,{default:l(()=>[e(p,{cols:"12"},{default:l(()=>[e(be,{modelValue:t(n).cookie,"onUpdate:modelValue":a[8]||(a[8]=s=>t(n).cookie=s),label:"站点Cookie"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12"},{default:l(()=>[e(w,{modelValue:t(n).ua,"onUpdate:modelValue":a[9]||(a[9]=s=>t(n).ua=s),label:"站点User-Agent"},null,8,["modelValue"])]),_:1})]),_:1}),e(T,null,{default:l(()=>[e(p,{cols:"12",md:"4"},{default:l(()=>[e(w,{modelValue:t(n).limit_interval,"onUpdate:modelValue":a[10]||(a[10]=s=>t(n).limit_interval=s),label:"单位周期（秒）",rules:[t(E)]},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12",md:"4"},{default:l(()=>[e(w,{modelValue:t(n).limit_seconds,"onUpdate:modelValue":a[11]||(a[11]=s=>t(n).limit_seconds=s),label:"访问次数",rules:[t(E)]},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12",md:"4"},{default:l(()=>[e(w,{modelValue:t(n).limit_seconds,"onUpdate:modelValue":a[12]||(a[12]=s=>t(n).limit_seconds=s),label:"访问间隔（秒）",rules:[t(E)]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(T,null,{default:l(()=>[e(p,{cols:"12",md:"6"},{default:l(()=>[e(Z,{modelValue:t(n).proxy,"onUpdate:modelValue":a[13]||(a[13]=s=>t(n).proxy=s),label:"代理"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:"6"},{default:l(()=>[e(Z,{modelValue:t(n).render,"onUpdate:modelValue":a[14]||(a[14]=s=>t(n).render=s),label:"仿真"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(W,null,{default:l(()=>[e(B,{color:"error",onClick:Pe},{default:l(()=>[_(" 删除 ")]),_:1}),e(oe),e(B,{onClick:ze},{default:l(()=>[_(" 确定 ")]),_:1})]),_:1})]),_:1},8,["title"])]}),_:1},8,["modelValue"]),e(X,{modelValue:t(v),"onUpdate:modelValue":a[18]||(a[18]=o=>O(v)?v.value=o:null),"max-width":"1280",scrollable:""},{default:l(()=>{var o;return[e(H,{title:`浏览站点 - ${(o=u.site)==null?void 0:o.name}`},{default:l(()=>[e(b,{onClick:a[16]||(a[16]=s=>v.value=!1)}),e(j,{class:"pt-2"},{default:l(()=>[e(N,{"items-per-page":t(ae),"onUpdate:itemsPerPage":a[17]||(a[17]=s=>O(ae)?ae.value=s:null),headers:d,items:t(i),"items-length":t(we),search:t(ne),loading:t(te),density:"compact","item-value":"title","return-object":"","fixed-header":"","items-per-page-text":"每页条数","page-text":"{0}-{1} 共 {2} 条"},{"item.title":l(({item:s})=>{var G,ie,de,me,ce;return[P("div",al,g(s.raw.title),1),P("div",sl,g(s.raw.description),1),(V(!0),L(ee,null,ge((G=s.raw)==null?void 0:G.labels,(J,he)=>(V(),k(fe,{key:he,variant:"elevated",size:"small",color:"primary",class:"me-1 mb-1"},{default:l(()=>[_(g(J),1)]),_:2},1024))),128)),((ie=s.raw)==null?void 0:ie.downloadvolumefactor)!==1||((de=s.raw)==null?void 0:de.uploadvolumefactor)!==1?(V(),k(fe,{key:0,class:Oe([Ae((me=s.raw)==null?void 0:me.downloadvolumefactor,(ce=s.raw)==null?void 0:ce.uploadvolumefactor),"me-1 mb-1"]),variant:"elevated",size:"small"},{default:l(()=>{var J;return[_(g((J=s.raw)==null?void 0:J.volume_factor),1)]}),_:2},1032,["class"])):x("",!0)]}),"item.pubdate":l(({item:s})=>[P("div",null,g(s.raw.date_elapsed),1),P("div",ol,g(s.raw.pubdate),1)]),"item.size":l(({item:s})=>[P("div",rl,g(t(el)(s.raw.size)),1)]),"item.seeders":l(({item:s})=>[P("div",null,g(s.raw.seeders),1)]),"item.peers":l(({item:s})=>[P("div",null,g(s.raw.peers),1)]),"item.actions":l(({item:s})=>[P("div",nl,[e(f,null,{default:l(()=>[e($,{icon:"mdi-dots-vertical"}),e(Ge,{activator:"parent","close-on-content-click":""},{default:l(()=>[e(Je,null,{default:l(()=>[e(Ve,{variant:"plain",onClick:G=>$e(s.raw.page_url)},{prepend:l(()=>[e($,{icon:"mdi-information"})]),default:l(()=>[e(ve,null,{default:l(()=>[_("查看详情")]),_:1})]),_:2},1032,["onClick"]),e(Ve,{variant:"plain",onClick:G=>Ue(s.raw.enclosure)},{prepend:l(()=>[e($,{icon:"mdi-download"})]),default:l(()=>[e(ve,null,{default:l(()=>[_("下载种子")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),"no-data":l(()=>[_(" 没有数据 ")]),_:1},8,["items-per-page","items","items-length","search","loading"])]),_:1})]),_:1},8,["title"])]}),_:1},8,["modelValue"])],64)}}});const il={key:0,class:"mt-12 w-full text-center text-gray-500 text-sm flex flex-col items-center"},dl={key:1,class:"grid gap-3 grid-site-card"},ml=re({__name:"SiteCardListView",setup(le){const F=_e.useToast(),u=c([]),U=c(!1),h=c("新增站点"),y=c(!1),S=c(!1),M=[{title:"启用",value:!0},{title:"停用",value:!1}],K=c(Array.from({length:50},(v,d)=>d+1).map(v=>({title:v,value:v}))),m=ye({id:0,url:"",pri:1,is_active:!0,cookie:"",ua:"",limit_interval:0,limit_seconds:0,limit_count:0,proxy:0,render:0,name:"",domain:""});async function C(){try{u.value=await z.get("site"),U.value=!0}catch(v){console.error(v)}}async function I(){if(m.url){Xe(),h.value="新增中...",y.value=!0;try{const v=await z.post("site",m);v.success?(F.success("新增站点成功"),C()):F.error(`新增站点失败：${v.message}`),S.value=!1}catch(v){console.error(v)}Ye(),h.value="新增站点",y.value=!1}}return Qe(C),(v,d)=>(V(),L(ee,null,[t(U)?x("",!0):(V(),L("div",il,[t(U)?x("",!0):(V(),k(We,{key:0,size:"48",indeterminate:"",color:"primary"}))])),t(u).length>0?(V(),L("div",dl,[(V(!0),L(ee,null,ge(t(u),i=>(V(),k(ul,{key:i.id,site:i,onRemove:C,onUpdate:C},null,8,["site"]))),128))])):x("",!0),t(u).length===0&&t(U)?(V(),k(tl,{key:2,"error-code":"404","error-title":"没有站点","error-description":"已添加并支持的站点将会在这里显示。"})):x("",!0),e(X,{modelValue:t(S),"onUpdate:modelValue":d[11]||(d[11]=i=>O(S)?S.value=i:null),"max-width":"800",persistent:"",scrollable:""},{activator:l(({props:i})=>[e(B,q({icon:"mdi-plus"},i,{size:"x-large",class:"fixed right-5 bottom-5"}),null,16)]),default:l(()=>[e(H,{title:"新增站点"},{default:l(()=>[e(j,{class:"pt-2"},{default:l(()=>[e(se,{onSubmit:A(()=>{},["prevent"])},{default:l(()=>[e(T,null,{default:l(()=>[e(p,{cols:"12",md:"6"},{default:l(()=>[e(w,{modelValue:t(m).url,"onUpdate:modelValue":d[0]||(d[0]=i=>t(m).url=i),label:"站点地址",rules:[t(R)]},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12",md:"3"},{default:l(()=>[e(Y,{modelValue:t(m).pri,"onUpdate:modelValue":d[1]||(d[1]=i=>t(m).pri=i),label:"优先级",items:t(K),rules:[t(R)]},null,8,["modelValue","items","rules"])]),_:1}),e(p,{cols:"12",md:"3"},{default:l(()=>[e(Y,{modelValue:t(m).is_active,"onUpdate:modelValue":d[2]||(d[2]=i=>t(m).is_active=i),items:M,label:"状态"},null,8,["modelValue"])]),_:1})]),_:1}),e(T,null,{default:l(()=>[e(p,{cols:"12"},{default:l(()=>[e(be,{modelValue:t(m).cookie,"onUpdate:modelValue":d[3]||(d[3]=i=>t(m).cookie=i),label:"站点Cookie"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12"},{default:l(()=>[e(w,{modelValue:t(m).ua,"onUpdate:modelValue":d[4]||(d[4]=i=>t(m).ua=i),label:"站点User-Agent"},null,8,["modelValue"])]),_:1})]),_:1}),e(T,null,{default:l(()=>[e(p,{cols:"12",md:"4"},{default:l(()=>[e(w,{modelValue:t(m).limit_interval,"onUpdate:modelValue":d[5]||(d[5]=i=>t(m).limit_interval=i),label:"单位周期（秒）",rules:[t(E)]},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12",md:"4"},{default:l(()=>[e(w,{modelValue:t(m).limit_seconds,"onUpdate:modelValue":d[6]||(d[6]=i=>t(m).limit_seconds=i),label:"访问次数",rules:[t(E)]},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12",md:"4"},{default:l(()=>[e(w,{modelValue:t(m).limit_seconds,"onUpdate:modelValue":d[7]||(d[7]=i=>t(m).limit_seconds=i),label:"访问间隔（秒）",rules:[t(E)]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(T,null,{default:l(()=>[e(p,{cols:"12",md:"6"},{default:l(()=>[e(Z,{modelValue:t(m).proxy,"onUpdate:modelValue":d[8]||(d[8]=i=>t(m).proxy=i),label:"代理"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:"6"},{default:l(()=>[e(Z,{modelValue:t(m).render,"onUpdate:modelValue":d[9]||(d[9]=i=>t(m).render=i),label:"仿真"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(W,null,{default:l(()=>[e(B,{onClick:d[10]||(d[10]=i=>S.value=!1)},{default:l(()=>[_(" 取消 ")]),_:1}),e(oe),e(B,{color:"primary",disabled:t(y),onClick:I},{default:l(()=>[_(g(t(h)),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}});const gl=re({__name:"site",setup(le){return(F,u)=>(V(),L("div",null,[e(ml)]))}});export{gl as default};
