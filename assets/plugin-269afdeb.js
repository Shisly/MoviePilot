import{d as F,an as Y,o,f as p,i as t,a as T,m as l,U as q,a3 as J,aB as Q,K as V,t as b,Y as Z,B as R,P as re,A as z,a1 as L,r as C,e as H,c as y,a2 as D,M as x,z as j,k as A,aC as se,W as k,N as G,j as c,V as O,aa as ie,a9 as ue,a7 as ce,a4 as pe,a6 as de,X as ge,G as K,I as S,H as M,F as N,L as E,p as W,ay as _e,au as me,aD as fe,aE as ve,aF as he}from"./index-1a6c8545.js";import{_ as X}from"./NoDataFound.vue_vue_type_style_index_0_lang-b81ecd8b.js";import{_ as ee}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as ye}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-094f357a.js";import{i as Ve}from"./index-d2c33d5a.js";const Ce=["href"],ke=F({__name:"PluginAppCard",props:{plugin:Object,width:String,height:String},emits:["install"],setup($,{emit:m}){const e=$,s=Y.useToast();async function w(){var i,d,g;try{const n=await L.get(`plugin/install/${(i=e.plugin)==null?void 0:i.id}`);n.success?(s.success(`插件 ${(d=e.plugin)==null?void 0:d.plugin_name} 安装成功！`),m("install")):s.error(`插件 ${(g=e.plugin)==null?void 0:g.plugin_name} 安装失败：${n.message}}`)}catch(n){console.error(n)}}return(i,d)=>(o(),p(z,{width:e.width,height:e.height,onClick:w},{default:t(()=>{var g;return[T("div",{class:"relative pa-4 text-center card-cover-blurred",style:Q({background:`${(g=e.plugin)==null?void 0:g.plugin_color}`})},[l(J,{size:"128",class:"shadow"},{default:t(()=>{var n;return[l(q,{src:`/plugin/${(n=e.plugin)==null?void 0:n.plugin_icon}`,"aspect-ratio":"4/3",cover:""},null,8,["src"])]}),_:1})],4),l(Z,null,{default:t(()=>{var n;return[V(b((n=e.plugin)==null?void 0:n.plugin_name),1)]}),_:1}),l(R,null,{default:t(()=>{var n;return[V(b((n=e.plugin)==null?void 0:n.plugin_desc),1)]}),_:1}),l(R,null,{default:t(()=>{var n,u;return[V(" 作者："),T("a",{href:(n=e.plugin)==null?void 0:n.author_url,target:"_blank",onClick:d[0]||(d[0]=re(()=>{},["stop"]))},b((u=e.plugin)==null?void 0:u.plugin_author),9,Ce)]}),_:1})]}),_:1},8,["width","height"]))}});const xe=ee(ke,[["__scopeId","data-v-067ad2c4"]]),$e=F({__name:"FormRender",props:{config:Object,form:Object},setup($){const m=$,e=C(m.config||{component:"div",text:"",props:{},content:[]}),s=C(m.form||{});return(w,i)=>{var g;const d=H("FormRender",!0);return o(),p(A(e.value.component),j(e.value.props,{modelValue:s.value[((g=e.value.props)==null?void 0:g.model)||""],"onUpdate:modelValue":i[0]||(i[0]=n=>{var u;return s.value[((u=e.value.props)==null?void 0:u.model)||""]=n})}),{default:t(()=>[V(b(e.value.text)+" ",1),(o(!0),y(x,null,D(e.value.content||[],(n,u)=>{var I;return o(),p(d,{key:u,modelValue:s.value[((I=n.props)==null?void 0:I.model)||""],"onUpdate:modelValue":f=>{var U;return s.value[((U=n.props)==null?void 0:U.model)||""]=f},config:n,form:s.value},null,8,["modelValue","onUpdate:modelValue","config","form"])}),128))]),_:1},16,["modelValue"])}}}),we=F({__name:"PageRender",props:{config:Object,handler:Boolean},setup($){const e=C($.config||{component:"div",text:"",html:"",props:{},content:[]});return(s,w)=>{const i=H("PageRender",!0);return o(),y(x,null,[e.value.html?k("",!0):(o(),p(A(e.value.component),se(j({key:0},e.value.props)),{default:t(()=>[V(b(e.value.text)+" ",1),(o(!0),y(x,null,D(e.value.content||[],(d,g)=>(o(),p(i,{key:g,config:d},null,8,["config"]))),128))]),_:1},16)),e.value.html?(o(),p(A(e.value.component),j({key:1},e.value.props,{innerHTML:e.value.html}),null,16,["innerHTML"])):k("",!0)],64)}}}),Pe={class:"me-n3 absolute top-0 right-3"},be=F({__name:"PluginCard",props:{plugin:Object,width:String,height:String},emits:["remove","save"],setup($,{emit:m}){const e=$,s=Y.useToast(),w=C(!0),i=C(!1),d=C({});let g=G([]);const n=C(!1);let u=G([]);async function I(){var _,a,B;try{const v=await L.delete(`plugin/${(_=e.plugin)==null?void 0:_.id}`);v.success?(s.success(`插件 ${(a=e.plugin)==null?void 0:a.plugin_name} 已卸载`),m("remove")):s.error(`插件 ${(B=e.plugin)==null?void 0:B.plugin_name} 卸载失败：${v.message}}`)}catch(v){console.error(v)}}async function f(){var _;try{const a=await L.get(`plugin/form/${(_=e.plugin)==null?void 0:_.id}`);a&&(g=a.conf,a.model&&(d.value=a.model))}catch(a){console.error(a)}}async function U(){var _;try{const a=await L.get(`plugin/page/${(_=e.plugin)==null?void 0:_.id}`);a&&(u=a)}catch(a){console.error(a)}}async function le(){var _;try{const a=await L.get(`plugin/${(_=e.plugin)==null?void 0:_.id}`);Ve(a)||(d.value=a)}catch(a){console.error(a)}}async function te(){var _,a,B;try{const v=await L.put(`plugin/${(_=e.plugin)==null?void 0:_.id}`,d.value);v.success?(s.success(`插件 ${(a=e.plugin)==null?void 0:a.plugin_name} 配置已保存`),i.value=!1,m("save")):s.error(`插件 ${(B=e.plugin)==null?void 0:B.plugin_name} 配置保存失败：${v.message}}`)}catch(v){console.error(v)}}async function ne(){i.value=!1,n.value=!0}async function ae(){await f(),await le(),await U(),i.value=!0}const oe=C([{title:"卸载",value:1,props:{prependIcon:"mdi-trash-can-outline",color:"error",click:I}}]);return(_,a)=>{const B=H("IconBtn"),v=ye;return o(),y(x,null,[c(w)?(o(),p(z,{key:0,width:e.width,height:e.height,onClick:ae},{default:t(()=>{var h;return[T("div",{class:"relative pa-4 text-center card-cover-blurred",style:Q({background:`${(h=e.plugin)==null?void 0:h.plugin_color}`})},[T("div",Pe,[l(B,null,{default:t(()=>[l(O,{icon:"mdi-dots-vertical",class:"text-white"}),l(ie,{activator:"parent","close-on-content-click":""},{default:t(()=>[l(ue,null,{default:t(()=>[(o(!0),y(x,null,D(c(oe),(r,P)=>(o(),p(ce,{key:P,variant:"plain","base-color":r.props.color,onClick:r.props.click},{prepend:t(()=>[l(O,{icon:r.props.prependIcon},null,8,["icon"])]),default:t(()=>[l(pe,{textContent:b(r.title)},null,8,["textContent"])]),_:2},1032,["base-color","onClick"]))),128))]),_:1})]),_:1})]),_:1})]),l(J,{size:"128",class:"shadow"},{default:t(()=>{var r;return[l(q,{src:`/plugin/${(r=e.plugin)==null?void 0:r.plugin_icon}`,"aspect-ratio":"4/3",cover:""},null,8,["src"])]}),_:1})],4),l(ge,{class:"py-2"},{default:t(()=>[l(Z,{class:"flex items-center flex-row"},{default:t(()=>{var r,P;return[(r=e.plugin)!=null&&r.state?(o(),p(de,{key:0,dot:"",inline:"",color:"success",class:"me-1 mb-1"})):k("",!0),V(" "+b((P=e.plugin)==null?void 0:P.plugin_name),1)]}),_:1})]),_:1}),l(R,null,{default:t(()=>{var r;return[V(b((r=e.plugin)==null?void 0:r.plugin_desc),1)]}),_:1})]}),_:1},8,["width","height"])):k("",!0),l(E,{modelValue:c(i),"onUpdate:modelValue":a[1]||(a[1]=h=>N(i)?i.value=h:null),"max-width":"800",scrollable:"",persistent:""},{default:t(()=>{var h;return[l(z,{title:(h=e.plugin)==null?void 0:h.plugin_name},{default:t(()=>[l(v,{onClick:a[0]||(a[0]=r=>i.value=!1)}),l(R,null,{default:t(()=>[(o(!0),y(x,null,D(c(g),(r,P)=>(o(),p($e,{key:P,config:r,form:c(d)},null,8,["config","form"]))),128))]),_:1}),l(K,null,{default:t(()=>[c(u).length>0?(o(),p(S,{key:0,onClick:ne},{default:t(()=>[V(" 详情 ")]),_:1})):k("",!0),l(M),l(S,{onClick:te},{default:t(()=>[V(" 保存 ")]),_:1})]),_:1})]),_:1},8,["title"])]}),_:1},8,["modelValue"]),l(E,{modelValue:c(n),"onUpdate:modelValue":a[4]||(a[4]=h=>N(n)?n.value=h:null),"max-width":"1000",scrollable:"",persistent:""},{default:t(()=>{var h;return[l(z,{title:`${(h=e.plugin)==null?void 0:h.plugin_name} - 详情`},{default:t(()=>[l(v,{onClick:a[2]||(a[2]=r=>n.value=!1)}),l(R,null,{default:t(()=>[(o(!0),y(x,null,D(c(u),(r,P)=>(o(),p(we,{key:P,config:r},null,8,["config"]))),128))]),_:1}),l(K,null,{default:t(()=>[l(M),l(S,{onClick:a[3]||(a[3]=r=>n.value=!1)},{default:t(()=>[V(" 关闭 ")]),_:1})]),_:1})]),_:1},8,["title"])]}),_:1},8,["modelValue"])],64)}}});const Ie=ee(be,[["__scopeId","data-v-95ce48d2"]]),Be={key:0,class:"mt-12 w-full text-center text-gray-500 text-sm flex flex-col items-center"},Le={key:1,class:"grid gap-4 grid-plugin-card"},Te={class:"pa-4"},De={class:"grid gap-4 grid-plugin-card"},Fe=F({__name:"PluginCardListView",setup($){const m=C([]),e=C(!1),s=C(!1),w=W(()=>m.value.filter(u=>u.installed)),i=W(()=>m.value.filter(u=>!u.installed));function d(){s.value=!1}function g(){n(),d()}async function n(){try{m.value=await L.get("plugin"),e.value=!0}catch(u){console.error(u)}}return _e(n),(u,I)=>(o(),y(x,null,[c(e)?k("",!0):(o(),y("div",Be,[c(e)?k("",!0):(o(),p(me,{key:0,size:"48",indeterminate:"",color:"primary"}))])),c(w).length>0?(o(),y("div",Le,[(o(!0),y(x,null,D(c(w),f=>(o(),p(Ie,{key:f.id,plugin:f,onRemove:n,onSave:n},null,8,["plugin"]))),128))])):k("",!0),c(w).length===0&&c(e)?(o(),p(X,{key:2,"error-code":"404","error-title":"没有安装插件","error-description":"点击右下角按钮，前往插件市场安装插件。"})):k("",!0),l(E,{modelValue:c(s),"onUpdate:modelValue":I[0]||(I[0]=f=>N(s)?s.value=f:null),fullscreen:"",scrim:!1,transition:"dialog-bottom-transition"},{activator:t(({props:f})=>[l(S,j({icon:"mdi-plus"},f,{size:"x-large",class:"fixed right-5 bottom-5"}),null,16)]),default:t(()=>[l(z,null,{default:t(()=>[T("div",null,[l(fe,{color:"primary"},{default:t(()=>[l(ve,null,{default:t(()=>[V("插件市场")]),_:1}),l(M),l(he,null,{default:t(()=>[l(S,{size:"x-large",onClick:d},{default:t(()=>[l(O,{color:"white",icon:"mdi-close"})]),_:1})]),_:1})]),_:1})]),T("div",Te,[T("div",De,[(o(!0),y(x,null,D(c(i),f=>(o(),p(xe,{key:f.id,plugin:f,onInstall:g},null,8,["plugin"]))),128))]),c(i).length===0&&c(e)?(o(),p(X,{key:0,"error-code":"404","error-title":"没有未安装插件","error-description":"所有可用插件均已安装。"})):k("",!0)])]),_:1})]),_:1},8,["modelValue"])],64))}});const Ae=F({__name:"plugin",setup($){return(m,e)=>(o(),p(Fe))}});export{Ae as default};
