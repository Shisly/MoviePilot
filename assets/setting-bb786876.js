import{d as q,r as C,af as J,N as ye,q as Q,e as pe,o as _,c as I,m as e,i as t,D as R,A,B as G,X as be,j as a,a as l,I as F,V as P,a1 as oe,Q as le,C as N,E as X,F as H,K as v,f as T,P as ee,a5 as ue,M as j,W,t as L,a4 as se,R as he,S as xe,ac as we,a2 as Ve,a0 as re,Y as ie,$ as z,G as Ce,H as Se,L as fe,aG as te,az as O,a8 as me,aa as D,O as ae,ab as _e,aH as ke,as as ve,al as $e,b as Re,aI as Ue,aJ as Ie,aK as Fe,aL as Y,T as K}from"./index-b59a64ba.js";import{r as ce}from"./index-705cb9e8.js";import{a as k}from"./index-d70fcb37.js";import{a as de}from"./avatar-1-4acd3e19.js";import{_ as ge}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-683058f7.js";import{c as De}from"./index-d2c33d5a.js";const Le={class:"d-flex flex-column justify-center gap-5"},Te={class:"d-flex flex-wrap gap-2"},Ae=l("span",{class:"d-none d-sm-block"},"上传头像",-1),Ee=l("span",{class:"d-none d-sm-block"},"重置",-1),Be=l("p",{class:"text-body-1 mb-0"}," 允许 JPG、GIF 或 PNG 格式， 最大尺寸 800K。 ",-1),Pe=l("thead",null,[l("tr",null,[l("th",{scope:"col"}," 用户名 "),l("th",{scope:"col"}," 邮箱 "),l("th",{scope:"col"}," 状态 "),l("th",{scope:"col"}," 管理员 "),l("th",{scope:"col",class:"w-5"})])],-1),He=q({__name:"AccountSettingAccount",setup(M){const d=C(!1),s=C(!1),p=C(!1),f=C(""),g=C(""),b=J.useToast(),x=C(),$=C(!1),y=ye({name:"",password:"",email:""}),m=C({id:0,name:"",password:"",email:"",is_active:!1,is_superuser:!1,avatar:""}),c=C([]);function S(u){const r=new FileReader,{files:U}=u.target;U&&U.length>0&&(r.readAsDataURL(U[0]),r.onload=()=>{typeof r.result=="string"&&(m.value.avatar=r.result,V())})}function B(){m.value.avatar=de}async function E(){try{const u=await k.get("user/current");m.value=u,m.value.avatar||(m.value.avatar=de)}catch(u){console.log(u)}}async function V(){if(f.value||g.value){if(f.value!==g.value){b.error("两次输入的密码不一致");return}m.value.password=f.value}try{const u=await k.put("user/",m.value);u.success?b.success("用户信息保存成功！"):b.error(`用户信息保存失败：${u.message}！`)}catch(u){console.log(u)}}async function h(){try{const u=await k.get("/user/");c.value=u}catch(u){console.log(u)}}async function n(u){try{const r=await k.delete(`user/${u.name}`);r.success?(b.success("用户删除成功！"),h()):b.error(`用户删除失败：${r.message}！`)}catch(r){console.log(r)}}async function i(u){try{u.is_active=!u.is_active;const r=await k.put("user/",u);r.success?(b.success("用户冻结成功！"),h()):b.error(`用户冻结失败：${r.message}！`)}catch(r){console.log(r)}}async function o(){try{const u=await k.post("user",y);u.success?(b.success("用户新增成功！"),h(),$.value=!1):b.error(`用户新增失败：${u.message}！`)}catch(u){console.log(u)}}return Q(()=>{E(),h()}),(u,r)=>{const U=pe("IconBtn");return _(),I(j,null,[e(N,null,{default:t(()=>[e(R,{cols:"12"},{default:t(()=>[e(A,{title:"个人信息"},{default:t(()=>[e(G,{class:"d-flex"},{default:t(()=>[e(be,{rounded:"lg",size:"100",class:"me-6",image:a(m).avatar},null,8,["image"]),l("form",Le,[l("div",Te,[e(F,{color:"primary",onClick:r[0]||(r[0]=w=>{var Z;return(Z=a(x))==null?void 0:Z.click()})},{default:t(()=>[e(P,{icon:"mdi-cloud-upload-outline",class:"d-sm-none"}),Ae]),_:1}),l("input",{ref_key:"refInputEl",ref:x,type:"file",name:"file",accept:".jpeg,.png,.jpg,GIF",hidden:"",onInput:S},null,544),e(F,{type:"reset",color:"error",variant:"tonal",onClick:B},{default:t(()=>[Ee,e(P,{icon:"mdi-refresh",class:"d-sm-none"})]),_:1})]),Be])]),_:1}),e(oe),e(G,null,{default:t(()=>[e(le,{class:"mt-6"},{default:t(()=>[e(N,null,{default:t(()=>[e(R,{md:"6",cols:"12"},{default:t(()=>[e(X,{modelValue:a(m).name,"onUpdate:modelValue":r[1]||(r[1]=w=>a(m).name=w),readonly:"",label:"用户名"},null,8,["modelValue"])]),_:1}),e(R,{cols:"12",md:"6"},{default:t(()=>[e(X,{modelValue:a(m).email,"onUpdate:modelValue":r[2]||(r[2]=w=>a(m).email=w),label:"邮箱",type:"email"},null,8,["modelValue"])]),_:1}),e(R,{cols:"12",md:"6"},{default:t(()=>[e(X,{modelValue:a(f),"onUpdate:modelValue":r[3]||(r[3]=w=>H(f)?f.value=w:null),type:a(d)?"text":"password","append-inner-icon":a(d)?"mdi-eye-off-outline":"mdi-eye-outline",label:"新密码",autocomplete:"new-password","onClick:appendInner":r[4]||(r[4]=w=>d.value=!a(d))},null,8,["modelValue","type","append-inner-icon"])]),_:1}),e(R,{cols:"12",md:"6"},{default:t(()=>[e(X,{modelValue:a(g),"onUpdate:modelValue":r[5]||(r[5]=w=>H(g)?g.value=w:null),type:a(s)?"text":"password","append-inner-icon":a(s)?"mdi-eye-off-outline":"mdi-eye-outline",label:"确认新密码","onClick:appendInner":r[6]||(r[6]=w=>s.value=!a(s))},null,8,["modelValue","type","append-inner-icon"])]),_:1}),e(R,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:t(()=>[e(F,{onClick:V},{default:t(()=>[v(" 保存 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(m).is_superuser?(_(),T(R,{key:0,cols:"12"},{default:t(()=>[e(A,{title:"所有用户"},{append:t(()=>[e(U,{onClick:r[7]||(r[7]=ee(w=>$.value=!0,["stop"]))},{default:t(()=>[e(P,{icon:"mdi-plus"})]),_:1})]),default:t(()=>[e(ue,{class:"text-no-wrap"},{default:t(()=>[Pe,l("tbody",null,[(_(!0),I(j,null,W(a(c),w=>(_(),I("tr",{key:w.name},[l("td",null,L(w.name),1),l("td",null,L(w.email),1),l("td",null,[w.is_active?(_(),T(se,{key:0,color:"success","text-color":"white"},{default:t(()=>[v(" 激活 ")]),_:1})):(_(),T(se,{key:1,color:"error","text-color":"white"},{default:t(()=>[v(" 冻结 ")]),_:1}))]),l("td",null,L(w.is_superuser?"是":"否"),1),l("td",null,[he(e(U,null,{default:t(()=>[e(P,{icon:"mdi-dots-vertical"}),e(we,{activator:"parent","close-on-content-click":""},{default:t(()=>[e(Ve,null,{default:t(()=>[e(re,{variant:"plain",onClick:Z=>i(w)},{prepend:t(()=>[e(P,{icon:"mdi-lock"})]),default:t(()=>[e(ie,null,{default:t(()=>[v(L(w.is_active?"冻结":"解冻"),1)]),_:2},1024)]),_:2},1032,["onClick"]),e(re,{variant:"plain","base-color":"error",onClick:Z=>n(w)},{prepend:t(()=>[e(P,{icon:"mdi-delete"})]),default:t(()=>[e(ie,null,{default:t(()=>[v("删除")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1536),[[xe,a(m).is_superuser&&a(m).name!=w.name]])])]))),128))])]),_:1})]),_:1})]),_:1})):z("",!0)]),_:1}),e(fe,{modelValue:a($),"onUpdate:modelValue":r[13]||(r[13]=w=>H($)?$.value=w:null),"max-width":"50rem",persistent:""},{default:t(()=>[e(A,{title:"新增用户"},{default:t(()=>[e(G,null,{default:t(()=>[e(le,{onSubmit:ee(()=>{},["prevent"])},{default:t(()=>[e(N,null,{default:t(()=>[e(R,{cols:"12",md:"6"},{default:t(()=>[e(X,{modelValue:a(y).name,"onUpdate:modelValue":r[8]||(r[8]=w=>a(y).name=w),label:"用户名",rules:[a(ce)]},null,8,["modelValue","rules"])]),_:1}),e(R,{cols:"12",md:"6"},{default:t(()=>[e(X,{modelValue:a(y).password,"onUpdate:modelValue":r[9]||(r[9]=w=>a(y).password=w),label:"密码",rules:[a(ce)],type:a(p)?"text":"password","append-inner-icon":a(p)?"mdi-eye-off-outline":"mdi-eye-outline","onClick:appendInner":r[10]||(r[10]=w=>p.value=!a(p))},null,8,["modelValue","rules","type","append-inner-icon"])]),_:1}),e(R,{cols:"12",md:"6"},{default:t(()=>[e(X,{modelValue:a(y).email,"onUpdate:modelValue":r[11]||(r[11]=w=>a(y).email=w),label:"邮箱"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(Ce,null,{default:t(()=>[e(F,{onClick:r[12]||(r[12]=w=>$.value=!1)},{default:t(()=>[v(" 取消 ")]),_:1}),e(Se),e(F,{onClick:o},{default:t(()=>[v(" 确定 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),je=l("thead",null,[l("tr",null,[l("th",{scope:"col"}," 消息类型 "),l("th",{scope:"col"}," 微信 "),l("th",{scope:"col"}," Telegram "),l("th",{scope:"col"}," Slack "),l("th",{scope:"col"}," SynologyChat ")])],-1),Me={key:0},Ne=l("td",{colspan:"4",class:"text-center"}," 没有设置任何通知渠道 ",-1),qe=[Ne],Ge={class:"d-flex flex-wrap gap-4 mt-4"},We=q({__name:"AccountSettingNotification",setup(M){const d=C([]),s=J.useToast();async function p(){try{const g=await k.get("message/switchs");d.value=g}catch(g){console.log(g)}}async function f(){try{(await k.post("message/switchs",d.value)).success?s.success("保存通知消息设置成功"):s.error("保存通知消息设置失败！")}catch(g){console.log(g)}}return Q(()=>{p()}),(g,b)=>(_(),T(A,{title:"消息通知"},{default:t(()=>[e(G,null,{default:t(()=>[v(" 对应消息类型只会发送给选中的消息渠道。 ")]),_:1}),e(ue,{class:"text-no-wrap"},{default:t(()=>[je,l("tbody",null,[(_(!0),I(j,null,W(a(d),x=>(_(),I("tr",{key:x.mtype},[l("td",null,L(x.mtype),1),l("td",null,[e(te,{modelValue:x.wechat,"onUpdate:modelValue":$=>x.wechat=$},null,8,["modelValue","onUpdate:modelValue"])]),l("td",null,[e(te,{modelValue:x.telegram,"onUpdate:modelValue":$=>x.telegram=$},null,8,["modelValue","onUpdate:modelValue"])]),l("td",null,[e(te,{modelValue:x.slack,"onUpdate:modelValue":$=>x.slack=$},null,8,["modelValue","onUpdate:modelValue"])]),l("td",null,[e(te,{modelValue:x.synologychat,"onUpdate:modelValue":$=>x.synologychat=$},null,8,["modelValue","onUpdate:modelValue"])])]))),128)),a(d).length===0?(_(),I("tr",Me,qe)):z("",!0)])]),_:1}),e(oe),e(G,null,{default:t(()=>[e(le,{onSubmit:ee(()=>{},["prevent"])},{default:t(()=>[l("div",Ge,[e(F,{mtype:"submit",onClick:f},{default:t(()=>[v(" 保存 ")]),_:1})])]),_:1},8,["onSubmit"])]),_:1})]),_:1}))}}),Oe=q({__name:"AccountSettingRule",setup(M){const d=J.useToast(),s=C("seeder"),p=[{title:"站点优先",value:"site"},{title:"做种数优先",value:"seeder"}],f=C({include:"",exclude:""});async function g(){var y;try{const m=await k.get("system/setting/TorrentsPriority");s.value=(y=m.data)==null?void 0:y.value}catch(m){console.log(m)}}async function b(){var y,m;try{const c=await k.get("system/setting/DefaultFilterRules");(y=c.data)!=null&&y.value&&(f.value=(m=c.data)==null?void 0:m.value)}catch(c){console.log(c)}}async function x(){try{(await k.post("system/setting/TorrentsPriority",s.value)).success?d.success("优先规则保存成功"):d.error("优先规则保存失败！")}catch(y){console.log(y)}}async function $(){try{(await k.post("system/setting/DefaultFilterRules",f.value)).success?d.success("默认包含/排除规则保存成功"):d.error("默认包含/排除规则保存失败！")}catch(y){console.log(y)}}return Q(()=>{g(),b()}),(y,m)=>(_(),T(N,null,{default:t(()=>[e(R,{cols:"12"},{default:t(()=>[e(A,{title:"下载优先规则"},{default:t(()=>[e(O,null,{default:t(()=>[v(" 按站点优先级或资源种子数量排序和择优下载。 ")]),_:1}),e(G,null,{default:t(()=>[e(le,null,{default:t(()=>[e(N,null,{default:t(()=>[e(R,{cols:"12",md:"6"},{default:t(()=>[e(me,{modelValue:a(s),"onUpdate:modelValue":m[0]||(m[0]=c=>H(s)?s.value=c:null),items:p,label:"优先规则",outlined:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(D,null,{default:t(()=>[e(F,{type:"submit",onClick:x},{default:t(()=>[v(" 保存 ")]),_:1})]),_:1})]),_:1})]),_:1}),e(R,{cols:"12"},{default:t(()=>[e(A,{title:"默认过滤规则"},{default:t(()=>[e(O,null,{default:t(()=>[v(" 设置在搜索和订阅时默认使用的过滤规则。 ")]),_:1}),e(G,null,{default:t(()=>[e(le,null,{default:t(()=>[e(N,null,{default:t(()=>[e(R,{cols:"12",md:"6"},{default:t(()=>[e(X,{modelValue:a(f).include,"onUpdate:modelValue":m[1]||(m[1]=c=>a(f).include=c),type:"text",label:"包含（关键字、正则式）"},null,8,["modelValue"])]),_:1}),e(R,{cols:"12",md:"6"},{default:t(()=>[e(X,{modelValue:a(f).exclude,"onUpdate:modelValue":m[2]||(m[2]=c=>a(f).exclude=c),type:"text",label:"排除（关键字、正则式）"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(D,null,{default:t(()=>[e(F,{type:"submit",onClick:$},{default:t(()=>[v(" 保存 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}});const Ye=q({__name:"AccountSettingSite",setup(M){const d=J.useToast(),s=C(!1),p=C("重置站点数据"),f=C(!1);async function g(){try{f.value=!0,p.value="正在重置...",(await k.get("site/reset")).success?d.success("站点重置成功，请等待CookieCloud同步完成！"):d.error("站点重置失败！"),f.value=!1,p.value="重置站点数据"}catch(b){console.log(b)}}return(b,x)=>(_(),T(N,null,{default:t(()=>[e(R,{cols:"12"},{default:t(()=>[e(A,{title:"站点重置"},{default:t(()=>[e(G,null,{default:t(()=>[l("div",null,[e(te,{modelValue:a(s),"onUpdate:modelValue":x[0]||(x[0]=$=>H(s)?s.value=$:null),label:"确认删除所有站点数据并重新同步。"},null,8,["modelValue"])]),e(F,{disabled:!a(s)||a(f),color:"error",class:"mt-3",onClick:g},{default:t(()=>[v(L(a(p)),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1}))}}),Ke=q({__name:"AccountSettingWords",setup(M){const d=J.useToast(),s=C(""),p=C(""),f=C("");async function g(){var c;try{const S=await k.get("system/setting/CustomIdentifiers");s.value=(c=S.data)==null?void 0:c.value.join(`
`)}catch(S){console.log(S)}}async function b(){var c;try{const S=await k.get("system/setting/CustomReleaseGroups");p.value=(c=S.data)==null?void 0:c.value.join(`
`)}catch(S){console.log(S)}}async function x(){var c;try{const S=await k.get("system/setting/TransferExcludeWords");f.value=(c=S.data)==null?void 0:c.value.join(`
`)}catch(S){console.log(S)}}async function $(){try{(await k.post("system/setting/CustomIdentifiers",s.value.split(`
`))).success?d.success("自定义识别词保存成功"):d.error("自定义识别词保存失败！")}catch(c){console.log(c)}}async function y(){try{(await k.post("system/setting/CustomReleaseGroups",p.value.split(`
`))).success?d.success("自定义制作组/字幕组保存成功"):d.error("自定义制作组/字幕组保存失败！")}catch(c){console.log(c)}}async function m(){try{(await k.post("system/setting/TransferExcludeWords",f.value.split(`
`))).success?d.success("文件整理屏蔽词保存成功"):d.error("文件整理屏蔽词保存失败！")}catch(c){console.log(c)}}return Q(()=>{g(),b(),x()}),(c,S)=>(_(),T(N,null,{default:t(()=>[e(R,{cols:"12"},{default:t(()=>[e(A,{title:"自定义识别词"},{default:t(()=>[e(O,null,{default:t(()=>[v(" 添加规则对种子名或者文件名进行预处理以校正识别。 ")]),_:1}),e(D,null,{default:t(()=>[e(ae,{modelValue:a(s),"onUpdate:modelValue":S[0]||(S[0]=B=>H(s)?s.value=B:null),"auto-grow":"",placeholder:`支持正则表达式，特殊字符需要\\转义，一行为一组，支持以下几种配置格式：
屏蔽词
被替换词 => 替换词
前定位词 <> 后定位词 >> 集偏移量（EP）
被替换词 => 替换词 && 前定位词 <> 后定位词 >> 集偏移量（EP）`},null,8,["modelValue"])]),_:1}),e(D,null,{default:t(()=>[e(F,{type:"submit",onClick:$},{default:t(()=>[v(" 保存 ")]),_:1})]),_:1})]),_:1})]),_:1}),e(R,{cols:"12"},{default:t(()=>[e(A,{title:"自定义制作组/字幕组"},{default:t(()=>[e(O,null,{default:t(()=>[v(" 添加无法识别的制作组/字幕组。 ")]),_:1}),e(D,null,{default:t(()=>[e(ae,{modelValue:a(p),"onUpdate:modelValue":S[1]||(S[1]=B=>H(p)?p.value=B:null),"auto-grow":"",placeholder:"支持正则表达式，特殊字符需要\\转义，一行代表一个制作组/字幕组"},null,8,["modelValue"])]),_:1}),e(D,null,{default:t(()=>[e(F,{type:"submit",onClick:y},{default:t(()=>[v(" 保存 ")]),_:1})]),_:1})]),_:1})]),_:1}),e(R,{cols:"12"},{default:t(()=>[e(A,{title:"文件整理屏蔽词"},{default:t(()=>[e(O,null,{default:t(()=>[v(" 目录名或文件名中包含屏蔽词时不进行整理。 ")]),_:1}),e(D,null,{default:t(()=>[e(ae,{modelValue:a(f),"onUpdate:modelValue":S[2]||(S[2]=B=>H(f)?f.value=B:null),"auto-grow":"",placeholder:"支持正则表达式，特殊字符需要\\转义，一行代表一个屏蔽词"},null,8,["modelValue"])]),_:1}),e(D,null,{default:t(()=>[e(F,{type:"submit",onClick:m},{default:t(()=>[v(" 保存 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}}),Xe={class:"px-3"},ze={class:"section"},Je=l("div",null,[l("h3",{class:"heading"}," 关于 MoviePilot ")],-1),Qe={class:"section border-t border-gray-800"},Ze={class:"max-w-6xl py-4 sm:grid sm:grid-cols-3 sm:gap-4"},et=l("dt",{class:"block text-sm font-bold"}," 当前版本 ",-1),tt={class:"flex text-sm sm:col-span-2 sm:mt-0"},lt={class:"flex-grow flex flex-row items-center truncate"},st={class:"truncate"},at={key:0,href:"https://github.com/jxxghp/MoviePilot/releases",target:"_blank",rel:"noopener noreferrer"},nt=l("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full whitespace-nowrap bg-green-500 bg-opacity-80 border border-green-500 !text-green-100 ml-2 !cursor-pointer transition hover:bg-green-400"}," 最新 ",-1),ot=[nt],ut={class:"max-w-6xl py-4 sm:grid sm:grid-cols-3 sm:gap-4"},rt=l("dt",{class:"block text-sm font-bold"}," 配置目录 ",-1),it={class:"flex text-sm sm:col-span-2 sm:mt-0"},ct={class:"flex-grow undefined"},dt=l("div",{class:"max-w-6xl py-4 sm:grid sm:grid-cols-3 sm:gap-4"},[l("dt",{class:"block text-sm font-bold"}," 数据目录 "),l("dd",{class:"flex text-sm sm:col-span-2 sm:mt-0"},[l("span",{class:"flex-grow undefined"},[l("code",null,"/moviepilot")])])],-1),pt={class:"max-w-6xl py-4 sm:grid sm:grid-cols-3 sm:gap-4"},ft=l("dt",{class:"block text-sm font-bold"}," 时区 ",-1),mt={class:"flex text-sm sm:col-span-2 sm:mt-0"},_t={class:"flex-grow undefined"},vt=ke('<div class="section"><div><h3 class="heading"> 支援 </h3></div><div class="section border-t border-gray-800"><dl><div><div class="max-w-6xl py-4 sm:grid sm:grid-cols-3 sm:gap-4"><dt class="block text-sm font-bold"> 文档 </dt><dd class="flex text-sm sm:col-span-2 sm:mt-0"><span class="flex-grow undefined"><a href="https://github.com/jxxghp/MoviePilot/blob/main/README.md" target="_blank" rel="noreferrer" class="text-indigo-500 transition duration-300 hover:underline"> https://github.com/jxxghp/MoviePilot/blob/main/README.md </a></span></dd></div></div><div><div class="max-w-6xl py-4 sm:grid sm:grid-cols-3 sm:gap-4"><dt class="block text-sm font-bold"> 问题反馈 </dt><dd class="flex text-sm sm:col-span-2 sm:mt-0"><span class="flex-grow undefined"><a href="https://github.com/jxxghp/MoviePilot/issues/new/choose" target="_blank" rel="noreferrer" class="text-indigo-500 transition duration-300 hover:underline"> https://github.com/jxxghp/MoviePilot/issues/new/choose </a></span></dd></div></div><div><div class="max-w-6xl py-4 sm:grid sm:grid-cols-3 sm:gap-4"><dt class="block text-sm font-bold"> 发布频道 </dt><dd class="flex text-sm sm:col-span-2 sm:mt-0"><span class="flex-grow undefined"><a href="https://t.me/moviepilot_channel" target="_blank" rel="noreferrer" class="text-indigo-500 transition duration-300 hover:underline"> https://t.me/moviepilot_channel </a></span></dd></div></div></dl></div></div>',1),gt={class:"section"},yt=l("h3",{class:"heading"}," 软件版本 ",-1),bt={class:"section space-y-3"},ht={class:"flex w-full flex-grow items-center justify-start space-x-2 truncate sm:justify-start"},xt={class:"truncate text-lg font-bold"},wt={class:"mr-2 whitespace-nowrap text-xs font-normal"},Vt={key:0,class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full whitespace-nowrap cursor-default bg-green-500 bg-opacity-80 border border-green-500 !text-green-100"},Ct={key:1,class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full whitespace-nowrap cursor-default bg-indigo-500 bg-opacity-80 border border-indigo-500 !text-indigo-100"},St=q({__name:"AccountSettingAbout",setup(M){const d=C({}),s=C([]),p=C(!1),f=C(""),g=C(""),b=C("");function x(c,S){g.value=c,b.value=S.replaceAll(`\r
`,"<br />"),p.value=!0}async function $(){try{const c=await k.get("system/env");d.value=c.data}catch(c){console.log(c)}}async function y(){try{const c=await k.get("system/versions");s.value=c.data??[],s.value.length>0&&(f.value=s.value[0].tag_name)}catch(c){console.log(c)}}function m(c){return`${De(c)}前`}return Q(()=>{$(),y()}),(c,S)=>{const B=ge;return _(),I(j,null,[l("div",Xe,[l("div",ze,[Je,l("div",Qe,[l("dl",null,[l("div",null,[l("div",Ze,[et,l("dd",tt,[l("span",lt,[l("code",st,L(a(d).VERSION),1),a(f)===a(d).VERSION?(_(),I("a",at,ot)):z("",!0)])])])]),l("div",null,[l("div",ut,[rt,l("dd",it,[l("span",ct,[l("code",null,L(a(d).CONFIG_DIR),1)])])]),dt]),l("div",null,[l("div",pt,[ft,l("dd",mt,[l("span",_t,[l("code",null,L(a(d).TZ),1)])])])])])])]),vt,l("div",gt,[l("div",null,[yt,l("div",bt,[l("div",null,[(_(!0),I(j,null,W(a(s),E=>(_(),I("div",{key:E.tag_name,class:"mb-3 flex w-full flex-col space-y-3 rounded-md px-4 py-2 shadow-md ring-1 ring-gray-400 sm:flex-row sm:space-y-0 sm:space-x-3"},[l("div",ht,[l("span",xt,[l("span",wt,L(m(E.published_at)),1),v(" "+L(E.tag_name),1)]),E.tag_name===a(f)?(_(),I("span",Vt," 最新软件版本 ")):z("",!0),E.tag_name===a(d).VERSION?(_(),I("span",Ct," 当前版本 ")):z("",!0)]),e(F,{onClick:ee(V=>x(E.tag_name,E.body),["stop"])},{prepend:t(()=>[e(P,{icon:"mdi-text-box-outline"})]),default:t(()=>[v(" 查看变更日志 ")]),_:2},1032,["onClick"])]))),128))])])])])]),e(fe,{modelValue:a(p),"onUpdate:modelValue":S[1]||(S[1]=E=>H(p)?p.value=E:null),width:"600",scrollable:""},{default:t(()=>[e(A,null,{default:t(()=>[e(D,null,{default:t(()=>[e(B,{onClick:S[0]||(S[0]=E=>p.value=!1)}),e(_e,null,{default:t(()=>[v(L(a(g))+" 变更日志",1)]),_:1})]),_:1}),e(G,{innerHTML:a(b)},null,8,["innerHTML"])]),_:1})]),_:1},8,["modelValue"])],64)}}});const kt={class:"absolute top-3 right-14"},ne=q({__name:"FilterRuleCard",props:{pri:String,maxpri:String,rules:Array,width:String,height:String},emits:["close","changed","levelup","leveldown"],setup(M,{emit:d}){const s=M;function p(){d("close")}function f(){d("levelup",s.pri)}function g(){d("leveldown",s.pri)}function b($){d("changed",s.pri,$)}const x=C([{title:"特效字幕",value:" SPECSUB "},{title:"中文字幕",value:" CNSUB "},{title:"分辨率: 4K",value:" 4K "},{title:"分辨率: 1080P",value:" 1080P "},{title:"分辨率: 720P",value:" 720P "},{title:"排除: 720P",value:" !720P "},{title:"质量: 蓝光原盘",value:" BLU "},{title:"排除: 蓝光原盘",value:" !BLU "},{title:"质量: BLURAY",value:" BLURAY "},{title:"排除: BLURAY",value:" !BLURAY "},{title:"质量: UHD",value:" UHD "},{title:"排除: UHD",value:" !UHD "},{title:"质量: REMUX",value:" REMUX "},{title:"排除: REMUX",value:" !REMUX "},{title:"质量: WEB-DL",value:" WEBDL "},{title:"排除: WEB-DL",value:" !WEBDL "},{title:"编码: H265",value:" H265 "},{title:"排除: H265",value:" !H265 "},{title:"编码: H264",value:" H264 "},{title:"排除: H264",value:" !H264 "},{title:"效果: 杜比视界",value:" DOLBY "},{title:"排除: 杜比视界",value:" !DOLBY "},{title:"效果: HDR",value:" HDR "},{title:"排除: HDR",value:" !HDR "},{title:"国语配音",value:" CNVOI "},{title:"排除: 国语配音",value:" !CNVOI "},{title:"促销: 免费",value:" FREE "}]);return($,y)=>{const m=pe("IconBtn"),c=ge;return _(),T(A,{variant:"tonal",width:s.width,height:s.height},{default:t(()=>[l("span",kt,[s.pri!=="1"?(_(),T(m,{key:0,onClick:ee(f,["stop"])},{default:t(()=>[e(P,{icon:"mdi-arrow-up"})]),_:1},8,["onClick"])):z("",!0),s.pri!==s.maxpri?(_(),T(m,{key:1,onClick:ee(g,["stop"])},{default:t(()=>[e(P,{icon:"mdi-arrow-down"})]),_:1},8,["onClick"])):z("",!0)]),e(c,{onClick:p}),e(D,null,{default:t(()=>[e(_e,null,{default:t(()=>[v("优先级 "+L(s.pri),1)]),_:1}),e(N,null,{default:t(()=>[e(R,null,{default:t(()=>[(_(),T(me,{key:s.pri,modelValue:s.rules,"onUpdate:modelValue":[y[0]||(y[0]=S=>s.rules=S),b],variant:"underlined",items:a(x),chips:"",label:"",multiple:""},null,8,["modelValue","items"]))]),_:1})]),_:1})]),_:1})]),_:1},8,["width","height"])}}}),$t={class:"grid gap-3 grid-filterrule-card"},Rt=q({__name:"AccountSettingSearch",setup(M){const d=J.useToast(),s=C([]),p=C([]),f=C([]);async function g(){var V,h;try{const n=await k.get("system/setting/SearchFilterRules");if(n.success){const i=((h=(V=n.data)==null?void 0:V.value)==null?void 0:h.split(">"))??[];s.value=i==null?void 0:i.map((o,u)=>({pri:(u+1).toString(),rules:o.split("&")}))}}catch(n){console.log(n)}}async function b(){try{let V="";s.value.length!==0&&(V=s.value.filter(n=>n.rules.length>0).map(n=>n.rules.join("&")).join(">")),(await k.post("system/setting/SearchFilterRules",V)).success?d.success("搜索优先级保存成功"):d.error("搜索优先级保存失败！")}catch(V){console.log(V)}}function x(V,h){const n=s.value.find(i=>i.pri===V);n&&(n.rules=h)}function $(V){const h=s.value.filter(n=>n.pri!==V).map((n,i)=>(n.pri=(i+1).toString(),n));s.value=h}function y(){const h={pri:(s.value.length+1).toString(),rules:[]};s.value.push(h)}async function m(){try{const V=await k.get("site/");p.value=V.filter(h=>h.is_active),c()}catch(V){console.log(V)}}async function c(){var V;try{const h=await k.get("system/setting/IndexerSites");f.value=((V=h.data)==null?void 0:V.value)??[]}catch(h){console.log(h)}}async function S(){try{(await k.post("system/setting/IndexerSites",f.value)).success?d.success("搜索站点保存成功"):d.error("搜索站点保存失败！")}catch(V){console.log(V)}}function B(V){const h=s.value.find(o=>o.pri===V);if(!h)return;const n=s.value.find(o=>o.pri===(parseInt(V)-1).toString());if(!n)return;const i=h.pri;h.pri=n.pri,n.pri=i,s.value.sort((o,u)=>parseInt(o.pri)-parseInt(u.pri))}function E(V){const h=s.value.find(o=>o.pri===V);if(!h)return;const n=s.value.find(o=>o.pri===(parseInt(V)+1).toString());if(!n)return;const i=h.pri;h.pri=n.pri,n.pri=i,s.value.sort((o,u)=>parseInt(o.pri)-parseInt(u.pri))}return Q(()=>{g(),m()}),(V,h)=>(_(),T(N,null,{default:t(()=>[e(R,{cols:"12"},{default:t(()=>[e(A,{title:"搜索站点"},{default:t(()=>[e(O,null,{default:t(()=>[v(" 只有选中的站点才会在搜索中使用。")]),_:1}),e(D,null,{default:t(()=>[e(ve,{modelValue:a(f),"onUpdate:modelValue":h[0]||(h[0]=n=>H(f)?f.value=n:null),column:"",multiple:""},{default:t(()=>[(_(!0),I(j,null,W(a(p),n=>(_(),T(se,{key:n.id,color:a(f).includes(n.id)?"primary":"",filter:"",variant:"outlined",value:n.id},{default:t(()=>[v(L(n.name),1)]),_:2},1032,["color","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(D,null,{default:t(()=>[e(F,{type:"submit",onClick:S},{default:t(()=>[v(" 保存 ")]),_:1})]),_:1})]),_:1})]),_:1}),e(R,{cols:"12"},{default:t(()=>[e(A,{title:"搜索优先级"},{default:t(()=>[e(O,null,{default:t(()=>[v(" 设置在搜索时默认使用的优先级排序，未在优先级中的资源将不在搜索结果中显示。 ")]),_:1}),e(D,null,{default:t(()=>[l("div",$t,[(_(!0),I(j,null,W(a(s),(n,i)=>(_(),T(ne,{key:i,pri:n.pri,maxpri:a(s).length.toString(),rules:n.rules,onChanged:x,onClose:o=>$(n.pri),onLeveldown:E,onLevelup:B},null,8,["pri","maxpri","rules","onClose"]))),128))])]),_:1}),e(D,null,{default:t(()=>[e(F,{type:"submit",class:"me-2",onClick:h[1]||(h[1]=n=>b())},{default:t(()=>[v(" 保存 ")]),_:1}),e(F,{color:"success",variant:"tonal",onClick:h[2]||(h[2]=n=>y())},{default:t(()=>[e(P,{icon:"mdi-plus"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}});const Ut={class:"grid gap-3 grid-filterrule-card"},It={class:"grid gap-3 grid-filterrule-card"},Ft=q({__name:"AccountSettingSubscribe",setup(M){const d=J.useToast(),s=C([]),p=C([]),f=C([]),g=C([]);async function b(){var n;try{const i=await k.get("system/setting/RssSites");g.value=((n=i.data)==null?void 0:n.value)??[]}catch(i){console.log(i)}}async function x(){try{(await k.post("system/setting/RssSites",g.value)).success?d.success("订阅站点保存成功"):d.error("订阅站点保存失败！")}catch(n){console.log(n)}}async function $(){try{const n=await k.get("site/");f.value=n.filter(i=>i.is_active),b()}catch(n){console.log(n)}}async function y(n){var i,o;try{const u=await k.get(`system/setting/${n}`);if(u.success){const r=((o=(i=u.data)==null?void 0:i.value)==null?void 0:o.split(">"))??[],U=n==="SubscribeFilterRules"?s:p;U.value=r==null?void 0:r.map((w,Z)=>({pri:(Z+1).toString(),rules:w.split("&")}))}}catch(u){console.log(u)}}async function m(n){try{let i="";const o=n==="SubscribeFilterRules"?s:p;o.value.length!==0&&(i=o.value.filter(U=>U.rules.length>0).map(U=>U.rules.join("&")).join(">"));const u=await k.post(`system/setting/${n}`,i),r=n==="SubscribeFilterRules"?"订阅优先级":"洗版优先级";u.success?d.success(`${r}保存成功`):d.error(`${r}保存失败！`)}catch(i){console.log(i)}}function c(n,i){const o=s.value.find(u=>u.pri===n);o&&(o.rules=i)}function S(n,i){const o=p.value.find(u=>u.pri===n);o&&(o.rules=i)}function B(n,i){const o=(n==="SubscribeFilterRules"?s.value:p.value).filter(u=>u.pri!==i).map((u,r)=>(u.pri=(r+1).toString(),u));n==="SubscribeFilterRules"?s.value=o:p.value=o}function E(n){const i=n==="SubscribeFilterRules"?s:p,u={pri:(i.value.length+1).toString(),rules:[]};i.value.push(u)}function V(n,i){const o=n.find(U=>U.pri===i);if(!o)return;const u=n.find(U=>U.pri===(parseInt(i)-1).toString());if(!u)return;const r=o.pri;o.pri=u.pri,u.pri=r,n.sort((U,w)=>parseInt(U.pri)-parseInt(w.pri))}function h(n,i){const o=n.find(U=>U.pri===i);if(!o)return;const u=n.find(U=>U.pri===(parseInt(i)+1).toString());if(!u)return;const r=o.pri;o.pri=u.pri,u.pri=r,n.sort((U,w)=>parseInt(U.pri)-parseInt(w.pri))}return Q(()=>{$(),y("SubscribeFilterRules"),y("BestVersionFilterRules")}),(n,i)=>(_(),T(N,null,{default:t(()=>[e(R,{cols:"12"},{default:t(()=>[e(A,{title:"订阅站点"},{default:t(()=>[e(O,null,{default:t(()=>[v(" 只有选中的站点才会在订阅中使用。")]),_:1}),e(D,null,{default:t(()=>[e(ve,{modelValue:a(g),"onUpdate:modelValue":i[0]||(i[0]=o=>H(g)?g.value=o:null),column:"",multiple:""},{default:t(()=>[(_(!0),I(j,null,W(a(f),o=>(_(),T(se,{key:o.id,color:a(g).includes(o.id)?"primary":"",filter:"",variant:"outlined",value:o.id},{default:t(()=>[v(L(o.name),1)]),_:2},1032,["color","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(D,null,{default:t(()=>[e(F,{type:"submit",onClick:x},{default:t(()=>[v(" 保存 ")]),_:1})]),_:1})]),_:1})]),_:1}),e(R,{cols:"12"},{default:t(()=>[e(A,{title:"订阅优先级"},{default:t(()=>[e(O,null,{default:t(()=>[v(" 设置在正常订阅时默认使用的优先级，未在优先级中的资源将不会自动下载。 ")]),_:1}),e(D,null,{default:t(()=>[l("div",Ut,[(_(!0),I(j,null,W(a(s),(o,u)=>(_(),T(ne,{key:u,pri:o.pri,maxpri:a(s).length.toString(),rules:o.rules,onChanged:c,onClose:r=>B("SubscribeFilterRules",o.pri),onLeveldown:r=>h(a(s),o.pri),onLevelup:r=>V(a(s),o.pri)},null,8,["pri","maxpri","rules","onClose","onLeveldown","onLevelup"]))),128))])]),_:1}),e(D,null,{default:t(()=>[e(F,{type:"submit",class:"me-2",onClick:i[1]||(i[1]=o=>m("SubscribeFilterRules"))},{default:t(()=>[v(" 保存 ")]),_:1}),e(F,{color:"success",variant:"tonal",onClick:i[2]||(i[2]=o=>E("SubscribeFilterRules"))},{default:t(()=>[e(P,{icon:"mdi-plus"})]),_:1})]),_:1})]),_:1})]),_:1}),e(R,{cols:"12"},{default:t(()=>[e(A,{title:"洗版优先级"},{default:t(()=>[e(O,null,{default:t(()=>[v(" 设置在订阅洗版时使用的优先级，匹配优先级1时洗版完成。 ")]),_:1}),e(D,null,{default:t(()=>[l("div",It,[(_(!0),I(j,null,W(a(p),(o,u)=>(_(),T(ne,{key:u,pri:o.pri,maxpri:a(p).length.toString(),rules:o.rules,onChanged:S,onClose:r=>B("BestVersionFilterRules",o.pri),onLeveldown:r=>h(a(p),o.pri),onLevelup:r=>V(a(p),o.pri)},null,8,["pri","maxpri","rules","onClose","onLeveldown","onLevelup"]))),128))])]),_:1}),e(D,null,{default:t(()=>[e(F,{type:"submit",class:"me-2",onClick:i[3]||(i[3]=o=>m("BestVersionFilterRules"))},{default:t(()=>[v(" 保存 ")]),_:1}),e(F,{color:"success",variant:"tonal",onClick:i[4]||(i[4]=o=>E("BestVersionFilterRules"))},{default:t(()=>[e(P,{icon:"mdi-plus"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}});const Dt=l("thead",null,[l("tr",null,[l("th",{scope:"col"}," 任务名称 "),l("th",{scope:"col"}," 任务状态 "),l("th",{scope:"col"}," 下一次执行时间 "),l("th",{scope:"col"})])],-1),Lt={key:0},Tt=l("td",{colspan:"4",class:"text-center"}," 没有后台服务 ",-1),At=[Tt],Et=q({__name:"AccountSettingService",setup(M){const d=J.useToast(),s=C([]);let p=null;async function f(){try{const x=await k.get("dashboard/schedule");s.value=x}catch(x){console.log(x)}}function g(x){switch(x){case"正在运行":return"success";case"已停止":return"error";case"等待":return"";default:return""}}function b(x){try{k.get("system/runscheduler",{params:{jobid:x}}),d.success("定时作业执行请求提交成功！"),setTimeout(()=>{f()},1e3)}catch($){console.log($)}}return Q(()=>{f(),p=setInterval(()=>{f()},5e3)}),$e(()=>{p&&(clearInterval(p),p=null)}),(x,$)=>(_(),T(A,{title:"定时作业"},{default:t(()=>[e(G,null,{default:t(()=>[v(" 手动执行不会影响作业正常的时间表。 ")]),_:1}),e(ue,{class:"text-no-wrap"},{default:t(()=>[Dt,l("tbody",null,[(_(!0),I(j,null,W(a(s),y=>(_(),I("tr",{key:y.id},[l("td",null,L(y.name),1),l("td",null,[e(se,{color:g(y.status)},{default:t(()=>[v(L(y.status),1)]),_:2},1032,["color"])]),l("td",null,L(y.next_run),1),l("td",null,[e(F,{size:"small",disabled:y.status==="正在运行",onClick:m=>b(y.id)},{prepend:t(()=>[e(P,null,{default:t(()=>[v("mdi-play")]),_:1})]),default:t(()=>[v(" 执行 ")]),_:2},1032,["disabled","onClick"])])]))),128)),a(s).length===0?(_(),I("tr",Lt,At)):z("",!0)])]),_:1})]),_:1}))}}),qt=q({__name:"setting",setup(M){const d=Re(),s=C(d.params.tab),p=[{title:"用户",icon:"mdi-account",tab:"account"},{title:"站点",icon:"mdi-web",tab:"site"},{title:"搜索",icon:"mdi-magnify",tab:"search"},{title:"订阅",icon:"mdi-rss",tab:"subscribe"},{title:"服务",icon:"mdi-list-box",tab:"service"},{title:"规则",icon:"mdi-filter-cog",tab:"filter"},{title:"通知",icon:"mdi-bell",tab:"notification"},{title:"词表",icon:"mdi-file-word-box",tab:"words"},{title:"关于",icon:"mdi-information",tab:"about"}];return(f,g)=>(_(),I("div",null,[e(Ue,{modelValue:a(s),"onUpdate:modelValue":g[0]||(g[0]=b=>H(s)?s.value=b:null),"show-arrows":""},{default:t(()=>[(_(),I(j,null,W(p,b=>e(Fe,{key:b.icon,value:b.tab},{default:t(()=>[e(P,{size:"20",start:"",icon:b.icon},null,8,["icon"]),v(" "+L(b.title),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"]),e(oe),e(Ie,{modelValue:a(s),"onUpdate:modelValue":g[1]||(g[1]=b=>H(s)?s.value=b:null),class:"mt-5 disable-tab-transition",touch:!1},{default:t(()=>[e(Y,{value:"account"},{default:t(()=>[e(K,{name:"fade-slide",appear:""},{default:t(()=>[e(He)]),_:1})]),_:1}),e(Y,{value:"site"},{default:t(()=>[e(K,{name:"fade-slide",appear:""},{default:t(()=>[e(Ye)]),_:1})]),_:1}),e(Y,{value:"search"},{default:t(()=>[e(K,{name:"fade-slide",appear:""},{default:t(()=>[e(Rt)]),_:1})]),_:1}),e(Y,{value:"subscribe"},{default:t(()=>[e(K,{name:"fade-slide",appear:""},{default:t(()=>[e(Ft)]),_:1})]),_:1}),e(Y,{value:"service"},{default:t(()=>[e(K,{name:"fade-slide",appear:""},{default:t(()=>[e(Et)]),_:1})]),_:1}),e(Y,{value:"filter"},{default:t(()=>[e(K,{name:"fade-slide",appear:""},{default:t(()=>[e(Oe)]),_:1})]),_:1}),e(Y,{value:"notification"},{default:t(()=>[e(K,{name:"fade-slide",appear:""},{default:t(()=>[e(We)]),_:1})]),_:1}),e(Y,{value:"words"},{default:t(()=>[e(K,{name:"fade-slide",appear:""},{default:t(()=>[e(Ke)]),_:1})]),_:1}),e(Y,{value:"about"},{default:t(()=>[e(K,{name:"fade-slide",appear:""},{default:t(()=>[e(St)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});export{qt as default};
