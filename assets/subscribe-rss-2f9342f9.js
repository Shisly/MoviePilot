import{_ as re}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-cadf5b57.js";import{d as h,af as ie,r as c,N as me,q as Ie,e as oe,o as V,c as C,f as $,i as t,m as e,ag as Re,V as T,a as y,ac as ne,a2 as ue,M as K,W as pe,a0 as J,Y as X,t as _,j as l,ab as Te,n as P,K as g,aa as De,B as z,z as ce,$ as k,A as G,Q as fe,P as Ve,C as O,D as p,E as b,a8 as N,R as Be,S as Le,aw as F,G as ve,I as E,H as _e,F as H,L as Z,ax as Pe,a3 as ze,at as Ne,au as Fe}from"./index-0516855f.js";import{P as Ae}from"./index-3c6b2ddd.js";import{a as D}from"./index-f16a791c.js";import{_ as Me}from"./NoDataFound.vue_vue_type_script_setup_true_lang-ed022067.js";import{c as je}from"./index-d2c33d5a.js";import{b as qe,f as Ee}from"./formatters-16dfb57c.js";import{r as de,n as He}from"./index-705cb9e8.js";const Ge={class:"me-n3"},Ke={class:"d-flex align-center"},Oe={class:"text-high-emphasis"},Qe={class:"text-nowrap whitespace-nowrap"},We={class:"text-sm"},Ye={class:"me-n3"},Je=h({__name:"RssCard",props:{media:Object},emits:["remove","save"],setup(Q,{emit:B}){var le,te;const i=Q,U=ie.useToast(),S=c(!1),v=c(!1),u=c(!1),x=c(!1),I=c(0),A=c(25),W=[{title:"标题",key:"title",sortable:!0},{title:"时间",key:"pubdate",sortable:!0},{title:"大小",key:"size",sortable:!0},{title:"",key:"actions",sortable:!1}],w=c([]),R=c(""),s=me(i.media??{});s.best_version=s.best_version===1,s.proxy=s.proxy===1,s.filter=s.filter===1;const n=c(`${(le=i.media)!=null&&le.last_update?`${je(((te=i.media)==null?void 0:te.last_update)||"")}前`:""}`);function Y(){S.value=!0}function d(){var m,a;return((m=i.media)==null?void 0:m.type)==="电影"?"mdi-movie":((a=i.media)==null?void 0:a.type)==="电视剧"?"mdi-television-classic":"mdi-help-circle"}function M(){return S.value?"white":""}function j(){return S.value?"text-white":""}async function be(){var m;try{(await D.delete(`rss/${(m=i.media)==null?void 0:m.id}`)).success&&B("remove")}catch(a){console.log(a)}}async function ye(){var m,a;v.value=!1;try{const f=await D.put("rss",s);f.success?(U.success(`${(m=i.media)==null?void 0:m.name} 更新成功！`),B("remove")):U.error(`${(a=i.media)==null?void 0:a.name} 更新失败：${f.message}！`)}catch(f){console.log(f)}}async function ge(){var m,a,f,q;try{const L=await D.get(`site/domain/${(a=(m=i.media)==null?void 0:m.url)==null?void 0:a.split("/")[2]}`);L&&(R.value=L.name)}catch(L){R.value=((q=(f=i.media)==null?void 0:f.url)==null?void 0:q.split("/")[2])??"未知",console.log(L)}}async function xe(){u.value=!0,x.value=!0,await we(),x.value=!1}async function we(){var m;try{const a=await D.get(`rss/preview/${(m=i.media)==null?void 0:m.id}`);w.value=a}catch(a){console.log(a)}}async function ee(){v.value=!0}async function ke(){var m,a;try{(await D.get(`rss/refresh/${(m=i.media)==null?void 0:m.id}`)).success&&U.success(`${(a=i.media)==null?void 0:a.name} 已提交刷新任务！`)}catch(f){console.log(f)}}const Ce=c(Array.from({length:50},(m,a)=>a+1).map(m=>({title:`第 ${m} 季`,value:m})));function $e(m){window.open(m,"_blank")}async function Ue(m){window.open(m,"_blank")}const Se=c([{title:"编辑",value:1,props:{prependIcon:"mdi-file-edit-outline",click:ee}},{title:"预览",value:2,props:{prependIcon:"mdi-eye-outline",click:xe}},{title:"刷新",value:3,props:{prependIcon:"mdi-refresh",click:ke}},{title:"取消订阅",value:4,props:{prependIcon:"mdi-trash-can-outline",color:"error",click:be}}]);return Ie(()=>{ge()}),(m,a)=>{var ae;const f=oe("IconBtn"),q=re,L=oe("VDataTable");return V(),C(K,null,[(V(),$(G,{key:(ae=i.media)==null?void 0:ae.id,class:P(`${l(s).best_version?"outline-dashed outline-1":""}`),onClick:ee},{image:t(()=>{var r,o;return[e(Re,{src:((r=i.media)==null?void 0:r.backdrop)||((o=i.media)==null?void 0:o.poster),"aspect-ratio":"2/3",cover:"",class:"brightness-50",onLoad:Y},null,8,["src"])]}),default:t(()=>[e(De,null,{prepend:t(()=>[e(T,{size:"1.9rem",color:M(),icon:d()},null,8,["color","icon"])]),append:t(()=>[y("div",Ge,[e(f,null,{default:t(()=>[e(T,{icon:"mdi-dots-vertical",color:M()},null,8,["color"]),e(ne,{activator:"parent","close-on-content-click":""},{default:t(()=>[e(ue,null,{default:t(()=>[(V(!0),C(K,null,pe(l(Se),(r,o)=>(V(),$(J,{key:o,variant:"plain","base-color":r.props.color,onClick:r.props.click},{prepend:t(()=>[e(T,{icon:r.props.prependIcon},null,8,["icon"])]),default:t(()=>[e(X,{textContent:_(r.title)},null,8,["textContent"])]),_:2},1032,["base-color","onClick"]))),128))]),_:1})]),_:1})]),_:1})])]),default:t(()=>[e(Te,{class:P(j())},{default:t(()=>{var r,o,se;return[g(_((r=i.media)==null?void 0:r.name)+" "+_(l(qe)((o=i.media)!=null&&o.season?(se=i.media)==null?void 0:se.season.toString():"")),1)]}),_:1},8,["class"])]),_:1}),e(z,null,{default:t(()=>{var r;return[y("p",{class:P(["clamp-text mb-0",j()])},_((r=i.media)==null?void 0:r.description),3)]}),_:1}),e(z,{class:"d-flex justify-space-between align-center flex-wrap"},{default:t(()=>{var r,o;return[y("div",Ke,[e(f,{icon:"mdi-star",color:M(),class:"me-1"},null,8,["color"]),y("span",{class:P(["text-subtitle-2 me-4",j()])},_((r=i.media)==null?void 0:r.vote),3),e(f,ce(i,{icon:"mdi-progress-clock",color:M(),class:"me-1"}),null,16,["color"]),y("span",{class:P(["text-subtitle-2 me-4",j()])},_(((o=i.media)==null?void 0:o.processed)||0),3),l(R)?(V(),$(f,{key:0,icon:"mdi-web",color:M(),class:"me-1"},null,8,["color"])):k("",!0),l(R)?(V(),C("span",{key:1,class:P(["text-subtitle-2 me-4",j()])},_(l(R)),3)):k("",!0)])]}),_:1}),l(n)?(V(),$(z,{key:0,class:"absolute right-0 bottom-0 d-flex align-center p-2 text-gray-300"},{default:t(()=>[e(T,{icon:"mdi-download",class:"me-1"}),g(" "+_(l(n)),1)]),_:1})):k("",!0)]),_:1},8,["class"])),e(Z,{modelValue:l(v),"onUpdate:modelValue":a[14]||(a[14]=r=>H(v)?v.value=r:null),"max-width":"800",persistent:"",scrollable:""},{default:t(()=>{var r;return[e(G,{title:`订阅 - ${(r=i.media)==null?void 0:r.name}`},{default:t(()=>[e(q,{onClick:a[0]||(a[0]=o=>v.value=!1)}),e(z,{class:"pt-2"},{default:t(()=>[e(fe,{onSubmit:Ve(()=>{},["prevent"])},{default:t(()=>[e(O,null,{default:t(()=>[e(p,{cols:"12"},{default:t(()=>[e(b,{modelValue:l(s).url,"onUpdate:modelValue":a[1]||(a[1]=o=>l(s).url=o),label:"RSS地址",placeholder:"https://example.com/rss"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:"6"},{default:t(()=>[e(N,{modelValue:l(s).type,"onUpdate:modelValue":a[2]||(a[2]=o=>l(s).type=o),label:"类型",items:[{title:"电影",value:"电影"},{title:"电视剧",value:"电视剧"}],readonly:""},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:"6"},{default:t(()=>[e(b,{modelValue:l(s).title,"onUpdate:modelValue":a[3]||(a[3]=o=>l(s).title=o),label:"标题",readonly:""},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:"6"},{default:t(()=>[e(b,{modelValue:l(s).year,"onUpdate:modelValue":a[4]||(a[4]=o=>l(s).year=o),label:"年份",readonly:""},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:"6"},{default:t(()=>[Be(e(N,{modelValue:l(s).season,"onUpdate:modelValue":a[5]||(a[5]=o=>l(s).season=o),label:"季",items:l(Ce),readonly:""},null,8,["modelValue","items"]),[[Le,l(s).type==="电视剧"]])]),_:1}),e(p,{cols:"12",md:"6"},{default:t(()=>[e(b,{modelValue:l(s).include,"onUpdate:modelValue":a[6]||(a[6]=o=>l(s).include=o),label:"包含"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:"6"},{default:t(()=>[e(b,{modelValue:l(s).exclude,"onUpdate:modelValue":a[7]||(a[7]=o=>l(s).exclude=o),label:"排除"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:"6"},{default:t(()=>[e(b,{modelValue:l(s).save_path,"onUpdate:modelValue":a[8]||(a[8]=o=>l(s).save_path=o),label:"保存路径",placeholder:"留空自动"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:"6"},{default:t(()=>[e(N,{modelValue:l(s).state,"onUpdate:modelValue":a[9]||(a[9]=o=>l(s).state=o),label:"状态",items:[{title:"启用",value:1},{title:"停用",value:0}]},null,8,["modelValue"])]),_:1})]),_:1}),e(O,null,{default:t(()=>[e(p,{cols:"12",md:"4"},{default:t(()=>[e(F,{modelValue:l(s).best_version,"onUpdate:modelValue":a[10]||(a[10]=o=>l(s).best_version=o),label:"洗版"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:"4"},{default:t(()=>[e(F,{modelValue:l(s).proxy,"onUpdate:modelValue":a[11]||(a[11]=o=>l(s).proxy=o),label:"代理服务器"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:"4"},{default:t(()=>[e(F,{modelValue:l(s).filter,"onUpdate:modelValue":a[12]||(a[12]=o=>l(s).filter=o),label:"过滤规则"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(ve,null,{default:t(()=>[e(E,{onClick:a[13]||(a[13]=o=>v.value=!1)},{default:t(()=>[g(" 取消 ")]),_:1}),e(_e),e(E,{onClick:ye},{default:t(()=>[g(" 确定 ")]),_:1})]),_:1})]),_:1},8,["title"])]}),_:1},8,["modelValue"]),e(Z,{modelValue:l(u),"onUpdate:modelValue":a[17]||(a[17]=r=>H(u)?u.value=r:null),"max-width":"1280",scrollable:""},{default:t(()=>[e(G,{title:"RSS预览"},{default:t(()=>[e(q,{onClick:a[15]||(a[15]=r=>u.value=!1)}),e(z,{class:"pt-2"},{default:t(()=>[e(L,{"items-per-page":l(A),"onUpdate:itemsPerPage":a[16]||(a[16]=r=>H(A)?A.value=r:null),headers:W,items:l(w),"items-length":l(I),loading:l(x),density:"compact","item-value":"title","return-object":"","fixed-header":"","items-per-page-text":"每页条数","page-text":"{0}-{1} 共 {2} 条"},{"item.title":t(({item:r})=>[y("div",Oe,_(r.raw.title),1)]),"item.size":t(({item:r})=>[y("div",Qe,_(l(Ee)(r.raw.size)),1)]),"item.pubdate":t(({item:r})=>[y("div",We,_(r.raw.pubdate),1)]),"item.actions":t(({item:r})=>[y("div",Ye,[e(f,null,{default:t(()=>[e(T,{icon:"mdi-dots-vertical"}),e(ne,{activator:"parent","close-on-content-click":""},{default:t(()=>[e(ue,null,{default:t(()=>[e(J,{variant:"plain",onClick:o=>$e(r.raw.page_url)},{prepend:t(()=>[e(T,{icon:"mdi-information"})]),default:t(()=>[e(X,null,{default:t(()=>[g("查看详情")]),_:1})]),_:2},1032,["onClick"]),e(J,{variant:"plain",onClick:o=>Ue(r.raw.enclosure)},{prepend:t(()=>[e(T,{icon:"mdi-download"})]),default:t(()=>[e(X,null,{default:t(()=>[g("下载种子")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),"no-data":t(()=>[g(" 没有数据 ")]),_:1},8,["items-per-page","items","items-length","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),Xe={key:0,class:"mt-12 w-full text-center text-gray-500 text-sm flex flex-col items-center"},Ze={key:0,class:"grid gap-3 grid-rss-card p-1"},he=h({__name:"RssListView",setup(Q){const B=ie.useToast(),i=c(!1),U=c("新增订阅"),S=c(!1),v=c(!1),u=me({url:"",type:"电影",title:"",year:"",season:1,include:"",exclude:"",best_version:!1,proxy:!1,filter:!0,save_path:"",state:1}),x=c([]);async function I(){try{x.value=await D.get("rss"),i.value=!0}catch(s){console.error(s)}}async function A(){if(!(!u.url||!u.title)){Ne(),U.value="新增中...",S.value=!0,u.type==="电影"&&(u.season=0);try{const s=await D.post("rss",u);s.success?(B.success("新增自定义订阅成功"),I()):B.error(`新增自定义订阅失败：${s.message}`),v.value=!1}catch(s){console.error(s)}Fe(),U.value="新增订阅",S.value=!1}}const W=c(Array.from({length:50},(s,n)=>n+1).map(s=>({title:`第 ${s} 季`,value:s})));Pe(I);const w=c(!1);function R(){w.value=!0,I(),w.value=!1}return(s,n)=>{const Y=re;return V(),C(K,null,[l(i)?k("",!0):(V(),C("div",Xe,[l(i)?k("",!0):(V(),$(ze,{key:0,size:"48",indeterminate:"",color:"primary"}))])),e(l(Ae),{modelValue:l(w),"onUpdate:modelValue":n[0]||(n[0]=d=>H(w)?w.value=d:null),onRefresh:R},{default:t(()=>[l(x).length>0?(V(),C("div",Ze,[(V(!0),C(K,null,pe(l(x),d=>(V(),$(Je,{key:d.id,media:d,onRemove:I,onSave:I},null,8,["media"]))),128))])):k("",!0),l(x).length===0&&l(i)?(V(),$(Me,{key:1,"error-code":"404","error-title":"没有自定义订阅","error-description":"点击右下角按钮新增订阅。"})):k("",!0)]),_:1},8,["modelValue"]),e(Z,{modelValue:l(v),"onUpdate:modelValue":n[15]||(n[15]=d=>H(v)?v.value=d:null),"max-width":"800",persistent:"",scrollable:""},{activator:t(({props:d})=>[e(E,ce({icon:"mdi-plus"},d,{size:"x-large",class:"fixed right-5 bottom-5"}),null,16)]),default:t(()=>[e(G,{title:"新增自定义订阅"},{default:t(()=>[e(Y,{onClick:n[1]||(n[1]=d=>v.value=!1)}),e(z,{class:"pt-2"},{default:t(()=>[e(fe,{onSubmit:Ve(()=>{},["prevent"])},{default:t(()=>[e(O,null,{default:t(()=>[e(p,{cols:"12"},{default:t(()=>[e(b,{modelValue:l(u).url,"onUpdate:modelValue":n[2]||(n[2]=d=>l(u).url=d),label:"RSS地址",placeholder:"https://example.com/rss",rules:[l(de)]},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12",md:"6"},{default:t(()=>[e(N,{modelValue:l(u).type,"onUpdate:modelValue":n[3]||(n[3]=d=>l(u).type=d),label:"类型",items:[{title:"电影",value:"电影"},{title:"电视剧",value:"电视剧"}]},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:"6"},{default:t(()=>[e(b,{modelValue:l(u).title,"onUpdate:modelValue":n[4]||(n[4]=d=>l(u).title=d),label:"标题",rules:[l(de)]},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12",md:"6"},{default:t(()=>[e(b,{modelValue:l(u).year,"onUpdate:modelValue":n[5]||(n[5]=d=>l(u).year=d),label:"年份",rules:[l(He)]},null,8,["modelValue","rules"])]),_:1}),l(u).type==="电视剧"?(V(),$(p,{key:0,cols:"12",md:"6"},{default:t(()=>[e(N,{modelValue:l(u).season,"onUpdate:modelValue":n[6]||(n[6]=d=>l(u).season=d),label:"季",items:l(W)},null,8,["modelValue","items"])]),_:1})):k("",!0),e(p,{cols:"12",md:"6"},{default:t(()=>[e(b,{modelValue:l(u).include,"onUpdate:modelValue":n[7]||(n[7]=d=>l(u).include=d),label:"包含",placeholder:"支持正则表达式"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:"6"},{default:t(()=>[e(b,{modelValue:l(u).exclude,"onUpdate:modelValue":n[8]||(n[8]=d=>l(u).exclude=d),label:"排除",placeholder:"支持正则表达式"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:"6"},{default:t(()=>[e(b,{modelValue:l(u).save_path,"onUpdate:modelValue":n[9]||(n[9]=d=>l(u).save_path=d),label:"保存路径",placeholder:"留空自动"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:"6"},{default:t(()=>[e(N,{modelValue:l(u).state,"onUpdate:modelValue":n[10]||(n[10]=d=>l(u).state=d),label:"状态",items:[{title:"启用",value:1},{title:"停用",value:0}]},null,8,["modelValue"])]),_:1})]),_:1}),e(O,null,{default:t(()=>[e(p,{cols:"12",md:"4"},{default:t(()=>[e(F,{modelValue:l(u).best_version,"onUpdate:modelValue":n[11]||(n[11]=d=>l(u).best_version=d),label:"洗版"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:"4"},{default:t(()=>[e(F,{modelValue:l(u).proxy,"onUpdate:modelValue":n[12]||(n[12]=d=>l(u).proxy=d),label:"代理服务器"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:"4"},{default:t(()=>[e(F,{modelValue:l(u).filter,"onUpdate:modelValue":n[13]||(n[13]=d=>l(u).filter=d),label:"过滤规则"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(ve,null,{default:t(()=>[e(E,{onClick:n[14]||(n[14]=d=>v.value=!1)},{default:t(()=>[g(" 取消 ")]),_:1}),e(_e),e(E,{color:"primary",disabled:l(S),onClick:A},{default:t(()=>[g(_(l(U)),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}});const dl=h({__name:"subscribe-rss",setup(Q){return(B,i)=>(V(),C("div",null,[e(he)]))}});export{dl as default};
