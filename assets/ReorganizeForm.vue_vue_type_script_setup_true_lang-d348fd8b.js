import{_ as A}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-a39d80f9.js";import{d as N,r as i,q as j,e as H,o as g,f as $,i as o,m as l,D as f,j as a,E as L,F as J,aE as O,a1 as q,c as E,U as G,L as F,ag as Q,a as W,X,J as C,t as P,Y,$ as Z,a0 as ee,_ as M,z as T,af as le,M as te,av as ae,A as K,P as oe,O as se,B as S,C as u,a7 as x,Q as ne,R as re,G as de,I as R,H as ue,ai as ie,K as U,a5 as me}from"./index-a900fb48.js";import{a as D}from"./index-83601d12.js";import{n as z}from"./index-705cb9e8.js";const pe={class:"w-full h-full"},fe=N({__name:"TmdbSelectorCard",emits:["update:modelValue","close"],setup(I,{emit:_}){const n=i([]),c=i(""),V=i(!1),m=i(null);function y(d){console.log(d),_("update:modelValue",d.tmdbid),_("close")}function v(d=""){return d?d.replace("original","w500"):""}async function b(){if(c)try{V.value=!0;const d=await D.get("media/search",{params:{title:c.value,page:1,count:20}});n.value=[];for(const t of d)n.value.push({tmdbid:t.tmdb_id||0,poster:v(t.poster_path),title:`${t.title}（${t.year}）`,overview:`<span class="text-primary">${t.type}</span> ${t.overview}`});V.value=!1}catch(d){console.error(d)}}return j(()=>{setTimeout(()=>{var d;(d=m.value)==null||d.focus()},500)}),(d,t)=>{const h=H("VSkeletonLoader");return g(),$(T,{class:"mx-auto",width:"100%"},{default:o(()=>[l(O,{flat:"",class:"p-0"},{default:o(()=>[l(f,{ref_key:"tmdbKeyword",ref:m,modelValue:a(c),"onUpdate:modelValue":t[0]||(t[0]=p=>L(c)?c.value=p:null),label:"输入名称搜索","single-line":"",placeholder:"电影或电视剧名称",variant:"solo","append-inner-icon":"mdi-magnify",flat:"",class:"mx-1",loading:a(V),"onClick:appendInner":b,onKeydown:J(b,["enter"])},null,8,["modelValue","loading","onKeydown"])]),_:1}),a(n).length>0?(g(),$(q,{key:0,lines:"three"},{default:o(()=>[(g(!0),E(F,null,G(a(n),(p,k)=>(g(),E(F,{key:k},[l(Z,{onClick:r=>y(p)},{prepend:o(()=>[l(Q,{height:"75",width:"50",src:p.poster,"aspect-ratio":"2/3",class:"object-cover rounded shadow ring-gray-500 me-3",cover:""},{placeholder:o(()=>[W("div",pe,[l(h,{class:"object-cover aspect-w-2 aspect-h-3"})])]),_:2},1032,["src"])]),default:o(()=>[l(X,null,{default:o(()=>[C(P(p.title),1)]),_:2},1024),l(Y,{class:"mt-2",innerHTML:p.overview},null,8,["innerHTML"])]),_:2},1032,["onClick"]),k<a(n).length-1?(g(),$(ee,{key:0,class:"mt-1",inset:""})):M("",!0)],64))),128))]),_:1})):M("",!0)]),_:1})}}}),_e=N({__name:"ReorganizeForm",props:{path:String,target:String,logids:Array},emits:["done","close"],setup(I,{emit:_}){const n=I,c=i(Array.from({length:51},(r,e)=>e).map(r=>({title:`第 ${r} 季`,value:r}))),V=le.useToast(),m=i(!1),y=i(),v=i(!1),b=i("请稍候 ..."),d=i(0),t=te({logid:0,path:"",target:n.target??"",tmdbid:null,season:null,type_name:"",transfer_type:"",episode_format:"",episode_detail:"",episode_part:"",episode_offset:null,min_filesize:0});ae(()=>{t.path=n.path??"",t.target=n.target??""});function h(){b.value="请稍候 ...";const r=me.state.auth.token;y.value=new EventSource(`/api/v1/system/progress/filetransfer?token=${r}`),y.value.onmessage=e=>{const w=JSON.parse(e.data);w&&(b.value=w.text,d.value=w.value)}}function p(){var r;(r=y.value)==null||r.close()}async function k(){if(!(!n.logids&&!n.path)){if(v.value=!0,h(),n.path)try{const r=await D.post("transfer/manual",{},{params:t});r.success?V.success(`${n.path} 整理完成！`):V.error(`${n.path} 整理失败：${r.message}！`)}catch(r){console.log(r)}else if(n.logids)for(const r of n.logids){t.logid=r;try{const e=await D.post("transfer/manual",{},{params:t});e.success||V.error(`历史记录 ${r} 重新整理失败：${e.message}！`)}catch(e){console.log(e)}}p(),v.value=!1,_("done")}}return(r,e)=>{const w=A;return g(),$(U,{scrollable:"","max-width":"60rem"},{default:o(()=>{var B;return[l(T,{title:`${n.path?`整理 - ${n.path}`:`整理 - 共 ${(B=n.logids)==null?void 0:B.length} 条记录`}`,class:"rounded-t"},{default:o(()=>[l(w,{onClick:e[0]||(e[0]=s=>_("close"))}),l(K,{class:"pt-2"},{default:o(()=>[l(oe,{onSubmit:se(()=>{},["prevent"])},{default:o(()=>[l(S,null,{default:o(()=>[l(u,{cols:"12",md:"8"},{default:o(()=>[l(f,{modelValue:a(t).target,"onUpdate:modelValue":e[1]||(e[1]=s=>a(t).target=s),label:"目的路径",placeholder:"留空自动"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"4"},{default:o(()=>[l(x,{modelValue:a(t).transfer_type,"onUpdate:modelValue":e[2]||(e[2]=s=>a(t).transfer_type=s),label:"整理方式",items:[{title:"默认",value:""},{title:"移动",value:"move"},{title:"复制",value:"copy"},{title:"硬链接",value:"link"},{title:"软链接",value:"softlink"},{title:"Rclone复制",value:"rclone_copy"},{title:"Rclone移动",value:"rclone_move"}]},null,8,["modelValue"])]),_:1})]),_:1}),l(S,null,{default:o(()=>[l(u,{cols:"12",md:"4"},{default:o(()=>[l(x,{modelValue:a(t).type_name,"onUpdate:modelValue":e[3]||(e[3]=s=>a(t).type_name=s),label:"类型",items:[{title:"自动",value:""},{title:"电影",value:"电影"},{title:"电视剧",value:"电视剧"}]},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"4"},{default:o(()=>[l(f,{modelValue:a(t).tmdbid,"onUpdate:modelValue":e[4]||(e[4]=s=>a(t).tmdbid=s),disabled:a(t).type_name==="",label:"TMDBID",placeholder:"留空自动识别",rules:[a(z)],"append-inner-icon":"mdi-magnify","onClick:appendInner":e[5]||(e[5]=s=>m.value=!0)},null,8,["modelValue","disabled","rules"])]),_:1}),l(u,{cols:"12",md:"4"},{default:o(()=>[ne(l(x,{modelValue:a(t).season,"onUpdate:modelValue":e[6]||(e[6]=s=>a(t).season=s),modelModifiers:{number:!0},label:"季",items:a(c)},null,8,["modelValue","items"]),[[re,a(t).type_name==="电视剧"]])]),_:1})]),_:1}),l(S,null,{default:o(()=>[l(u,{cols:"12",md:"8"},{default:o(()=>[l(f,{modelValue:a(t).episode_format,"onUpdate:modelValue":e[7]||(e[7]=s=>a(t).episode_format=s),label:"集数定位",placeholder:"使用{ep}定位集数"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"4"},{default:o(()=>[l(f,{modelValue:a(t).episode_detail,"onUpdate:modelValue":e[8]||(e[8]=s=>a(t).episode_detail=s),label:"指定集数",placeholder:"起始集,终止集，如1或1,2"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"4"},{default:o(()=>[l(f,{modelValue:a(t).episode_part,"onUpdate:modelValue":e[9]||(e[9]=s=>a(t).episode_part=s),label:"指定Part",placeholder:"如part1"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"4"},{default:o(()=>[l(f,{modelValue:a(t).episode_offset,"onUpdate:modelValue":e[10]||(e[10]=s=>a(t).episode_offset=s),modelModifiers:{number:!0},label:"集数偏移",placeholder:"如-10"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"4"},{default:o(()=>[l(f,{modelValue:a(t).min_filesize,"onUpdate:modelValue":e[11]||(e[11]=s=>a(t).min_filesize=s),modelModifiers:{number:!0},label:"最小文件大小（MB）",rules:[a(z)],placeholder:"0"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),l(de,null,{default:o(()=>[l(R,{depressed:"",onClick:e[12]||(e[12]=s=>_("close"))},{default:o(()=>[C(" 取消 ")]),_:1}),l(ue),l(R,{variant:"tonal",onClick:k},{default:o(()=>[C(" 开始整理 ")]),_:1})]),_:1})]),_:1},8,["title"]),l(U,{modelValue:a(v),"onUpdate:modelValue":e[13]||(e[13]=s=>L(v)?v.value=s:null),scrim:!1,width:"25rem"},{default:o(()=>[l(T,{color:"primary"},{default:o(()=>[l(K,{class:"text-center"},{default:o(()=>[C(P(a(b))+" ",1),a(d)?(g(),$(ie,{key:0,color:"white",class:"mb-0 mt-1","model-value":a(d)},null,8,["model-value"])):M("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(U,{modelValue:a(m),"onUpdate:modelValue":e[16]||(e[16]=s=>L(m)?m.value=s:null),width:"40rem",scrollable:""},{default:o(()=>[l(fe,{modelValue:a(t).tmdbid,"onUpdate:modelValue":e[14]||(e[14]=s=>a(t).tmdbid=s),onClose:e[15]||(e[15]=s=>m.value=!1)},null,8,["modelValue"])]),_:1},8,["modelValue"])]}),_:1})}}});export{_e as _};
