import{a as B}from"./index-83601d12.js";import{_ as _e}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-a39d80f9.js";import{d as Y,r as p,af as Ve,av as Le,o as u,f,i as t,K as le,m as e,A as G,P as ye,O as E,B as j,C as k,D as P,j as l,a7 as ie,N as Ae,aB as ue,G as ae,I as D,J as y,H as ge,z as J,at as de,au as me,q as Fe,e as ce,c as F,W as Ee,ag as Ne,aa as Re,ab as Ke,a as I,t as w,az as Me,_ as b,V as $,a9 as O,aA as W,a0 as je,F as qe,E as q,L as X,U as we,a3 as pe,n as He,ac as Oe,a1 as We,$ as fe,X as ve,ax as Ge,a2 as Je}from"./index-a900fb48.js";import{r as Q,n as te}from"./index-705cb9e8.js";import{f as Xe}from"./formatters-16dfb57c.js";import{E as Qe}from"./ExistIcon-11b45da9.js";import{_ as Ye}from"./NoDataFound.vue_vue_type_script_setup_true_lang-9795ac0b.js";import"./_plugin-vue_export-helper-c27b6911.js";const ke=Y({__name:"SiteAddEditForm",props:{siteid:Number,oper:String},emits:["save","remove","close"],setup(N,{emit:_}){const o=N,a=p({id:o.siteid??0,url:"",rss:"",cookie:"",ua:"",pri:0,is_active:!0,limit_interval:0,limit_seconds:0,name:"",domain:""}),v=Ve.useToast(),S=[{title:"启用",value:!0},{title:"停用",value:!1}],V=p(Array.from({length:50},(d,s)=>s+1).map(d=>({title:d,value:d})));Le(async()=>{o.siteid&&g()});async function g(){try{a.value=await B.get(`site/${o.siteid}`),a.value.proxy=a.value.proxy===1,a.value.render=a.value.render===1}catch(d){console.error(d)}}async function R(){var d;if((d=a.value)!=null&&d.url){de();try{const s=await B.post("site/",a.value);s.success?(v.success("新增站点成功"),_("save")):v.error(`新增站点失败：${s.message}`)}catch(s){console.error(s)}me()}}async function K(){var d,s,U;try{const r=await B.delete(`site/${(d=a.value)==null?void 0:d.id}`);r.success?_("remove"):v.error(`${(s=a.value)==null?void 0:s.name} 删除失败：${r.message}`)}catch(r){v.error(`${(U=a.value)==null?void 0:U.name} 删除失败！`),console.error(r)}}async function z(){var d,s,U;de();try{const r=await B.put("site/",a.value);r.success?(v.success(`${(d=a.value)==null?void 0:d.name} 更新成功！`),_("save")):v.error(`${(s=a.value)==null?void 0:s.name} 更新失败：${r.message}`)}catch(r){v.error(`${(U=a.value)==null?void 0:U.name} 更新失败！`),console.error(r)}me()}return(d,s)=>{const U=_e;return u(),f(le,{scrollable:"","max-width":"60rem"},{default:t(()=>[e(J,{title:`${o.oper==="add"?"新增":"编辑"}站点${o.oper!=="add"?` - ${l(a).name}`:""}`,class:"rounded-t"},{default:t(()=>[e(U,{onClick:s[0]||(s[0]=r=>_("close"))}),e(G,{class:"pt-2"},{default:t(()=>[e(ye,{onSubmit:E(()=>{},["prevent"])},{default:t(()=>[e(j,null,{default:t(()=>[e(k,{cols:"12",md:"6"},{default:t(()=>[e(P,{modelValue:l(a).url,"onUpdate:modelValue":s[1]||(s[1]=r=>l(a).url=r),label:"站点地址",rules:[l(Q)]},null,8,["modelValue","rules"])]),_:1}),e(k,{cols:"12",md:"3"},{default:t(()=>[e(ie,{modelValue:l(a).pri,"onUpdate:modelValue":s[2]||(s[2]=r=>l(a).pri=r),label:"优先级",items:l(V),rules:[l(Q)]},null,8,["modelValue","items","rules"])]),_:1}),e(k,{cols:"12",md:"3"},{default:t(()=>[e(ie,{modelValue:l(a).is_active,"onUpdate:modelValue":s[3]||(s[3]=r=>l(a).is_active=r),items:S,label:"状态"},null,8,["modelValue"])]),_:1})]),_:1}),e(j,null,{default:t(()=>[e(k,{cols:"12"},{default:t(()=>[e(P,{modelValue:l(a).rss,"onUpdate:modelValue":s[4]||(s[4]=r=>l(a).rss=r),label:"RSS地址"},null,8,["modelValue"])]),_:1}),e(k,{cols:"12"},{default:t(()=>[e(Ae,{modelValue:l(a).cookie,"onUpdate:modelValue":s[5]||(s[5]=r=>l(a).cookie=r),label:"站点Cookie"},null,8,["modelValue"])]),_:1}),e(k,{cols:"12"},{default:t(()=>[e(P,{modelValue:l(a).ua,"onUpdate:modelValue":s[6]||(s[6]=r=>l(a).ua=r),label:"站点User-Agent"},null,8,["modelValue"])]),_:1})]),_:1}),e(j,null,{default:t(()=>[e(k,{cols:"12",md:"4"},{default:t(()=>[e(P,{modelValue:l(a).limit_interval,"onUpdate:modelValue":s[7]||(s[7]=r=>l(a).limit_interval=r),label:"单位周期（秒）",rules:[l(te)]},null,8,["modelValue","rules"])]),_:1}),e(k,{cols:"12",md:"4"},{default:t(()=>[e(P,{modelValue:l(a).limit_seconds,"onUpdate:modelValue":s[8]||(s[8]=r=>l(a).limit_seconds=r),label:"访问次数",rules:[l(te)]},null,8,["modelValue","rules"])]),_:1}),e(k,{cols:"12",md:"4"},{default:t(()=>[e(P,{modelValue:l(a).limit_seconds,"onUpdate:modelValue":s[9]||(s[9]=r=>l(a).limit_seconds=r),label:"访问间隔（秒）",rules:[l(te)]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(j,null,{default:t(()=>[e(k,{cols:"12",md:"6"},{default:t(()=>[e(ue,{modelValue:l(a).proxy,"onUpdate:modelValue":s[10]||(s[10]=r=>l(a).proxy=r),label:"代理"},null,8,["modelValue"])]),_:1}),e(k,{cols:"12",md:"6"},{default:t(()=>[e(ue,{modelValue:l(a).render,"onUpdate:modelValue":s[11]||(s[11]=r=>l(a).render=r),label:"仿真"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(ae,null,{default:t(()=>[o.oper==="add"?(u(),f(D,{key:0,onClick:s[12]||(s[12]=r=>_("close"))},{default:t(()=>[y(" 取消 ")]),_:1})):(u(),f(D,{key:1,color:"error",onClick:K},{default:t(()=>[y(" 删除 ")]),_:1})),e(ge),o.oper==="add"?(u(),f(D,{key:2,color:"primary",variant:"tonal",onClick:R},{default:t(()=>[y(" 新增 ")]),_:1})):(u(),f(D,{key:3,color:"primary",variant:"tonal",onClick:z},{default:t(()=>[y(" 保存 ")]),_:1}))]),_:1})]),_:1},8,["title"])]),_:1})}}}),Ze=["onClick"],et={class:"text-high-emphasis pt-1"},tt={class:"text-sm my-1"},lt={class:"text-sm"},at={class:"text-nowrap whitespace-nowrap"},st={class:"me-n3"},ot=Y({__name:"SiteCard",props:{site:Object,width:String,height:String},emits:["update","remove"],setup(N,{emit:_}){const o=N,a=p(!1),v=p(""),S=Ve.useToast(),V=p("测试"),g=p(!1),R=p("更新"),K=p(!1),z=p(!1),d=p(!1),s=p(!1),U=[{title:"标题",key:"title",sortable:!1},{title:"时间",key:"pubdate",sortable:!0},{title:"大小",key:"size",sortable:!0},{title:"做种",key:"seeders",sortable:!0},{title:"下载",key:"peers",sortable:!0},{title:"",key:"actions",sortable:!1}],r=p([]),be=p(""),Z=p(!1),Ce=p(0),ee=p(25),T=p({username:"",password:""});function xe(m){window.open(m,"_blank")}async function $e(m){window.open(m,"_blank")}async function Se(){var m;try{v.value=(await B.get(`site/icon/${(m=o.site)==null?void 0:m.id}`)).data.icon}catch(n){console.error(n)}}async function Ue(){var m,n,L;try{V.value="测试中 ...",g.value=!0;const C=await B.get(`site/test/${(m=o.site)==null?void 0:m.id}`);C.success?S.success(`${(n=o.site)==null?void 0:n.name} 连通性测试成功，可正常使用！`):S.error(`${(L=o.site)==null?void 0:L.name} 连通性测试失败：${C.message}`),V.value="测试",g.value=!1}catch(C){console.error(C)}}async function Ie(){z.value=!0}async function Be(){s.value=!0,Te()}async function se(){var m,n,L;try{if(!T.value.username||!T.value.password)return;z.value=!1,R.value="更新中 ...",K.value=!0;const C=await B.get(`site/cookie/${(m=o.site)==null?void 0:m.id}`,{params:{username:T.value.username,password:T.value.password}});C.success?S.success(`${(n=o.site)==null?void 0:n.name} 更新Cookie & UA 成功！`):S.error(`${(L=o.site)==null?void 0:L.name} 更新失败：${C.message}`),R.value="更新",K.value=!1}catch(C){console.error(C)}}function De(m,n){return m===0?"text-white bg-lime-500":m<1?"text-white bg-green-500":n!==1?"text-white bg-sky-500":"text-white bg-gray-500"}async function Te(){var m;Z.value=!0;try{r.value=await B.get(`site/resource/${(m=o.site)==null?void 0:m.id}`),Z.value=!1}catch(n){console.error(n)}}function he(){var m;window.open((m=o.site)==null?void 0:m.url,"_blank")}return Fe(()=>{Se()}),(m,n)=>{var oe,re;const L=_e,C=ce("IconBtn"),Pe=ce("VDataTable");return u(),F(X,null,[e(J,{height:o.height,width:o.width,flat:!((oe=o.site)!=null&&oe.is_active),class:"overflow-hidden",onClick:n[0]||(n[0]=c=>d.value=!0)},{image:t(()=>[e(Ee,{class:"absolute right-2 bottom-2 rounded",variant:"flat",rounded:"0"},{default:t(()=>[e(Ne,{src:l(v)},null,8,["src"])]),_:1})]),default:t(()=>{var c;return[e(Re,null,{default:t(()=>[e(Ke,{class:"font-bold"},{default:t(()=>{var i;return[I("span",{onClick:E(he,["stop"])},w((i=o.site)==null?void 0:i.name),9,Ze)]}),_:1}),e(Me,null,{default:t(()=>{var i;return[y(w((i=o.site)==null?void 0:i.url),1)]}),_:1})]),_:1}),(c=o.site)!=null&&c.is_active?(u(),f(Qe,{key:0})):b("",!0),e(G,{class:"py-2"},{default:t(()=>{var i,h,A,M;return[((i=o.site)==null?void 0:i.render)===1?(u(),f(W,{key:0,text:"浏览器仿真"},{activator:t(({props:x})=>[e($,O({color:"primary",class:"me-2"},x,{icon:"mdi-apple-safari"}),null,16)]),_:1})):b("",!0),((h=o.site)==null?void 0:h.proxy)===1?(u(),f(W,{key:1,text:"代理"},{activator:t(({props:x})=>[e($,O({color:"primary",class:"me-2"},x,{icon:"mdi-network-outline"}),null,16)]),_:1})):b("",!0),(A=o.site)!=null&&A.limit_interval?(u(),f(W,{key:2,text:"流控"},{activator:t(({props:x})=>[e($,O({color:"primary",class:"me-2"},x,{icon:"mdi-speedometer"}),null,16)]),_:1})):b("",!0),(M=o.site)!=null&&M.filter?(u(),f(W,{key:3,text:"过滤"},{activator:t(({props:x})=>[e($,O({color:"primary",class:"me-2"},x,{icon:"mdi-filter-cog-outline"}),null,16)]),_:1})):b("",!0)]}),_:1}),e(je,{class:"opacity-75",style:{"border-color":"rgba(var(--v-theme-on-background), var(--v-selected-opacity))"}}),e(ae,null,{default:t(()=>{var i;return[(i=o.site)!=null&&i.public?b("",!0):(u(),f(D,{key:0,disabled:l(K),onClick:E(Ie,["stop"])},{prepend:t(()=>[e($,{icon:"mdi-refresh"})]),default:t(()=>[y(" "+w(l(R)),1)]),_:1},8,["disabled","onClick"])),e(D,{disabled:l(g),onClick:E(Ue,["stop"])},{prepend:t(()=>[e($,{icon:"mdi-link"})]),default:t(()=>[y(" "+w(l(V)),1)]),_:1},8,["disabled","onClick"]),e(D,{onClick:E(Be,["stop"])},{prepend:t(()=>[e($,{icon:"mdi-web"})]),default:t(()=>[y(" 浏览 ")]),_:1},8,["onClick"])]}),_:1})]}),_:1},8,["height","width","flat"]),e(le,{modelValue:l(z),"onUpdate:modelValue":n[4]||(n[4]=c=>q(z)?z.value=c:null),"max-width":"50rem"},{default:t(()=>[e(J,{title:"更新站点Cookie & UA"},{default:t(()=>[e(G,null,{default:t(()=>[e(ye,{onSubmit:E(()=>{},["prevent"])},{default:t(()=>[e(j,null,{default:t(()=>[e(k,{cols:"12",md:"6"},{default:t(()=>[e(P,{modelValue:l(T).username,"onUpdate:modelValue":n[1]||(n[1]=c=>l(T).username=c),label:"用户名",rules:[l(Q)]},null,8,["modelValue","rules"])]),_:1}),e(k,{cols:"12",md:"6"},{default:t(()=>[e(P,{modelValue:l(T).password,"onUpdate:modelValue":n[2]||(n[2]=c=>l(T).password=c),label:"密码",type:l(a)?"text":"password","append-inner-icon":l(a)?"mdi-eye-off-outline":"mdi-eye-outline",rules:[l(Q)],"onClick:appendInner":n[3]||(n[3]=c=>a.value=!l(a)),onKeydown:qe(se,["enter"])},null,8,["modelValue","type","append-inner-icon","rules","onKeydown"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(ae,null,{default:t(()=>[e(ge),e(D,{variant:"tonal",onClick:se},{default:t(()=>[y(" 开始更新 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(ke,{modelValue:l(d),"onUpdate:modelValue":n[5]||(n[5]=c=>q(d)?d.value=c:null),siteid:(re=o.site)==null?void 0:re.id,onSave:n[6]||(n[6]=c=>{d.value=!1,_("update")}),onRemove:n[7]||(n[7]=c=>_("remove")),onClose:n[8]||(n[8]=c=>d.value=!1)},null,8,["modelValue","siteid"]),e(le,{modelValue:l(s),"onUpdate:modelValue":n[11]||(n[11]=c=>q(s)?s.value=c:null),"max-width":"80rem",scrollable:""},{default:t(()=>{var c;return[e(J,{title:`浏览站点 - ${(c=o.site)==null?void 0:c.name}`},{default:t(()=>[e(L,{onClick:n[9]||(n[9]=i=>s.value=!1)}),e(G,{class:"pt-2"},{default:t(()=>[e(Pe,{"items-per-page":l(ee),"onUpdate:itemsPerPage":n[10]||(n[10]=i=>q(ee)?ee.value=i:null),headers:U,items:l(r),"items-length":l(Ce),search:l(be),loading:l(Z),density:"compact","item-value":"title","return-object":"","fixed-header":"","items-per-page-text":"每页条数","page-text":"{0}-{1} 共 {2} 条"},{"item.title":t(({item:i})=>{var h,A,M,x,ne;return[I("div",et,w(i.raw.title),1),I("div",tt,w(i.raw.description),1),(u(!0),F(X,null,we((h=i.raw)==null?void 0:h.labels,(H,ze)=>(u(),f(pe,{key:ze,variant:"elevated",size:"small",color:"primary",class:"me-1 mb-1"},{default:t(()=>[y(w(H),1)]),_:2},1024))),128)),((A=i.raw)==null?void 0:A.downloadvolumefactor)!==1||((M=i.raw)==null?void 0:M.uploadvolumefactor)!==1?(u(),f(pe,{key:0,class:He([De((x=i.raw)==null?void 0:x.downloadvolumefactor,(ne=i.raw)==null?void 0:ne.uploadvolumefactor),"me-1 mb-1"]),variant:"elevated",size:"small"},{default:t(()=>{var H;return[y(w((H=i.raw)==null?void 0:H.volume_factor),1)]}),_:2},1032,["class"])):b("",!0)]}),"item.pubdate":t(({item:i})=>[I("div",null,w(i.raw.date_elapsed),1),I("div",lt,w(i.raw.pubdate),1)]),"item.size":t(({item:i})=>[I("div",at,w(l(Xe)(i.raw.size)),1)]),"item.seeders":t(({item:i})=>[I("div",null,w(i.raw.seeders),1)]),"item.peers":t(({item:i})=>[I("div",null,w(i.raw.peers),1)]),"item.actions":t(({item:i})=>[I("div",st,[e(C,null,{default:t(()=>[e($,{icon:"mdi-dots-vertical"}),e(Oe,{activator:"parent","close-on-content-click":""},{default:t(()=>[e(We,null,{default:t(()=>{var h;return[e(fe,{variant:"plain",onClick:A=>xe(i.raw.page_url)},{prepend:t(()=>[e($,{icon:"mdi-information"})]),default:t(()=>[e(ve,null,{default:t(()=>[y("查看详情")]),_:1})]),_:2},1032,["onClick"]),(h=i.raw.enclosure)!=null&&h.startsWith("http")?(u(),f(fe,{key:0,variant:"plain",onClick:A=>$e(i.raw.enclosure)},{prepend:t(()=>[e($,{icon:"mdi-download"})]),default:t(()=>[e(ve,null,{default:t(()=>[y("下载种子文件")]),_:1})]),_:2},1032,["onClick"])):b("",!0)]}),_:2},1024)]),_:2},1024)]),_:2},1024)])]),"no-data":t(()=>[y(" 没有数据 ")]),_:1},8,["items-per-page","items","items-length","search","loading"])]),_:1})]),_:1},8,["title"])]}),_:1},8,["modelValue"])],64)}}});const rt={key:0,class:"mt-12 w-full text-center text-gray-500 text-sm flex flex-col items-center"},nt={key:1,class:"grid gap-3 grid-site-card"},it=Y({__name:"SiteCardListView",setup(N){const _=p([]),o=p(!1),a=p(!1);async function v(){try{_.value=await B.get("site/"),o.value=!0}catch(S){console.error(S)}}return Ge(v),(S,V)=>(u(),F(X,null,[l(o)?b("",!0):(u(),F("div",rt,[l(o)?b("",!0):(u(),f(Je,{key:0,size:"48",indeterminate:"",color:"primary"}))])),l(_).length>0?(u(),F("div",nt,[(u(!0),F(X,null,we(l(_),g=>(u(),f(ot,{key:g.id,site:g,onRemove:v,onUpdate:v},null,8,["site"]))),128))])):b("",!0),l(_).length===0&&l(o)?(u(),f(Ye,{key:2,"error-code":"404","error-title":"没有站点","error-description":"已添加并支持的站点将会在这里显示。"})):b("",!0),e(D,{icon:"mdi-plus",size:"x-large",class:"fixed right-5 bottom-5",oper:"add",onClick:V[0]||(V[0]=g=>a.value=!0)}),e(ke,{modelValue:l(a),"onUpdate:modelValue":V[1]||(V[1]=g=>q(a)?a.value=g:null),oper:"add",onSave:V[2]||(V[2]=g=>{a.value=!1,v()}),onClose:V[3]||(V[3]=g=>a.value=!1)},null,8,["modelValue"])],64))}});const Vt=Y({__name:"site",setup(N){return(_,o)=>(u(),F("div",null,[e(it)]))}});export{Vt as default};
