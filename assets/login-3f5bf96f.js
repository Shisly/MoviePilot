import{d as j,ad as U,r as d,q as F,aj as f,o as h,f as N,i as l,j as a,ag as v,a as p,m as s,aa as S,ab as T,J as _,A as D,P as M,O as q,B as A,C as g,D as b,c as P,t as $,_ as z,aH as L,I as R,n as E,z as H}from"./index-d3947ac1.js";import{r as V}from"./index-705cb9e8.js";import{a as w}from"./index-b9b8a38f.js";const J="/assets/logo-c95d39dc.png",O={class:"auth-wrapper d-flex align-center justify-center pa-4"},G={class:"d-flex pe-0"},K={key:0,class:"text-error mt-1"},Q={class:"d-flex align-center justify-space-between flex-wrap mt-1 mb-4"},ee=j({__name:"login",setup(W){const u=U(),t=d({username:"",password:"",remember:!0}),x=d(null),i=d(!1),n=d(""),c=d(""),m=d(!1);async function k(){w.get("/login/tmdb").then(o=>{c.value=o.message}).catch(o=>{console.log(o)})}function y(){if(n.value="",!t.value.username||!t.value.password)return;const o=new FormData;o.append("username",t.value.username),o.append("password",t.value.password),w.post("/login/access-token",o,{headers:{Accept:"application/json"}}).then(e=>{const r=e.access_token,C=e.super_user,B=e.user_name,I=e.avatar;u.dispatch("auth/updateToken",r),u.dispatch("auth/updateRemember",t.value.remember),u.dispatch("auth/updateSuperUser",C),u.dispatch("auth/updateUserName",B),u.dispatch("auth/updateAvatar",I),f.push("/")}).catch(e=>{e.response?e.response.status===401?n.value="登录失败，请检查用户名和密码是否正确":e.response.status===403?n.value="登录失败，您没有权限访问":e.response.status===500?n.value="登录失败，服务器错误":n.value=`登录失败 ${e.response.status}，请检查用户名和密码是否正确`:n.value="登录失败，请检查网络连接"})}return F(()=>{const o=u.state.auth.token,e=u.state.auth.remember;o&&e?f.push("/"):k()}),(o,e)=>(h(),N(v,{"aspect-ratio":"4/3",src:a(c),class:"w-full h-full overflow-hidden",cover:"",onLoad:e[4]||(e[4]=r=>m.value=!0)},{default:l(()=>[p("div",O,[s(H,{class:E(["auth-card pa-7 w-full h-full",a(m)?"backdrop-blur-xl bg-white/50":""]),"max-width":"25rem",theme:a(m)?"light":""},{default:l(()=>[s(S,{class:"justify-center mb-7"},{prepend:l(()=>[p("div",G,[s(v,{src:a(J),width:"64",height:"64"},null,8,["src"])])]),default:l(()=>[s(T,{class:"font-weight-semibold text-2xl text-uppercase"},{default:l(()=>[_(" MoviePilot ")]),_:1})]),_:1}),s(D,null,{default:l(()=>[s(a(M),{ref_key:"refForm",ref:x,onSubmit:q(()=>{},["prevent"])},{default:l(()=>[s(A,null,{default:l(()=>[s(g,{cols:"12"},{default:l(()=>[s(b,{modelValue:a(t).username,"onUpdate:modelValue":e[0]||(e[0]=r=>a(t).username=r),label:"用户名",type:"text",rules:[a(V)]},null,8,["modelValue","rules"])]),_:1}),s(g,{cols:"12"},{default:l(()=>[s(b,{modelValue:a(t).password,"onUpdate:modelValue":e[1]||(e[1]=r=>a(t).password=r),label:"密码",type:a(i)?"text":"password","append-inner-icon":a(i)?"mdi-eye-off-outline":"mdi-eye-outline",rules:[a(V)],"onClick:appendInner":e[2]||(e[2]=r=>i.value=!a(i))},null,8,["modelValue","type","append-inner-icon","rules"]),a(n)?(h(),P("div",K,$(a(n)),1)):z("",!0),p("div",Q,[s(L,{modelValue:a(t).remember,"onUpdate:modelValue":e[3]||(e[3]=r=>a(t).remember=r),label:"保持登录",required:""},null,8,["modelValue"])]),s(R,{block:"",type:"submit",onClick:y},{default:l(()=>[_(" 登录 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["class","theme"])])]),_:1},8,["src"]))}});export{ee as default};
