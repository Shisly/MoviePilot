import{_ as me}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-46ff3c26.js";import{d as O,af as fe,r as o,e as S,o as y,c as H,m as a,i as t,aa as ve,ab as F,C as G,D as T,K as u,E as J,a as d,X as pe,V as L,t as n,a4 as R,ac as Ve,a2 as ge,M as W,W as _e,f as Q,Y as ye,a0 as we,A as P,B as X,a8 as xe,j as Y,P as be,G as ke,H as Ce,I as _,J as $e,L as K,$ as he,ai as Ie}from"./index-d97604e4.js";import{r as Te,n as Pe}from"./index-705cb9e8.js";import{a as M}from"./index-228e1652.js";import{_ as Be}from"./TmdbSelectorCard.vue_vue_type_script_setup_true_lang-57450ecc.js";const De={class:"d-flex"},Ue={class:"d-flex flex-column ms-1"},Se={class:"d-block whitespace-nowrap text-high-emphasis"},He=d("br",null,null,-1),Le={class:"text-error"},Ke={key:0,class:"fixed right-5 bottom-5"},Me={class:"d-flex flex-column flex-md-row justify-center my-3"},Ne=O({__name:"TransferHistoryView",setup(Z){const w=fe.useToast(),V=o(!1),v=o(""),x=o("电影"),ee=o([{title:"电影",value:"电影"},{title:"电视剧",value:"电视剧"}]),c=o(),m=o([]),le=[{title:"标题",key:"title",sortable:!1},{title:"目录",key:"src",sortable:!1},{title:"转移方式",key:"mode",sortable:!1},{title:"时间",key:"date",sortable:!1},{title:"状态",key:"status",sortable:!1},{title:"失败原因",key:"errmsg",sortable:!1},{title:"",key:"actions",sortable:!1}],N=o([]),b=o(""),B=o(!1),j=o(0),g=o(25),k=o(1),C=o(!1),z=o("请稍候 ..."),A=o(0),$=o(!1),f=o(!1),D=o("");async function h({page:s,itemsPerPage:e}){B.value=!0;try{k.value=s;const r=await M.get("history/transfer",{params:{page:s,count:e,title:b.value}});N.value=r.data.list,j.value=r.data.total}catch(r){console.error(r)}B.value=!1}function ae(s){return s==="电影"?"mdi-movie":s==="电视剧"?"mdi-television-classic":"mdi-help-circle"}function te(s){return s?"success":"error"}const se={copy:"复制",move:"移动",link:"硬链接",softlink:"软链接"};async function oe(s){c.value=s,D.value=`确认删除 ${s.title} ${s.seasons}${s.episodes} ?`,f.value=!0}async function E(s,e,r){try{const i=await M.delete(`history/transfer?deletesrc=${e}&deletedest=${r}`,{data:s});i.success||w.error(`删除失败: ${i.msg}`)}catch(i){console.error(i)}}async function re(s,e){f.value=!1,c.value&&(await E(c.value,s,e),h({page:k.value,itemsPerPage:g.value}))}async function ne(s,e){f.value=!1;const r=m.value.length;if(r===0)return;let i=0;C.value=!0;for(const p of m.value)z.value=`正在删除 ${p.title} ${p.seasons}${p.episodes} ...`,await E(p,s,e),i++,A.value=i/r*100;m.value=[],C.value=!1,h({page:k.value,itemsPerPage:g.value})}async function U(s,e){c.value?await re(s,e):await ne(s,e)}async function ue(){m.value.length!==0&&(c.value=void 0,D.value=`确认删除 ${m.value.length} 条记录 ?`,f.value=!0)}async function q(){var s;try{if(!v.value||!x.value)return;V.value=!1,w.info(`正在重新整理 ${(s=c.value)==null?void 0:s.title} ...`);const e={...c.value},r=await M.post("history/transfer",e,{params:{mtype:x.value,new_tmdbid:parseInt(v.value)}});r.success?h({page:k.value,itemsPerPage:g.value}):w.error(`重新整理失败: ${r.message}！`)}catch(e){console.log(e)}}const ie=o([{title:"重新整理",value:1,props:{prependIcon:"mdi-redo-variant",click:s=>{V.value=!0,c.value=s}}},{title:"删除",value:2,props:{prependIcon:"mdi-trash-can-outline",color:"error",click:s=>{oe(s)}}}]);return(s,e)=>{const r=S("IconBtn"),i=S("VDataTableServer"),p=me,de=S("VBottomSheet");return y(),H(W,null,[a(P,{class:"pb-5"},{default:t(()=>[a(ve,null,{default:t(()=>[a(F,null,{default:t(()=>[a(G,null,{default:t(()=>[a(T,null,{default:t(()=>[u(" 历史记录 ")]),_:1}),a(T,null,{default:t(()=>[a(J,{key:"search_navbar",modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=l=>b.value=l),class:"text-disabled",density:"compact",label:"搜索","append-inner-icon":"mdi-magnify",variant:"solo-filled","single-line":"","hide-details":"",flat:"",rounded:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),a(i,{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=l=>m.value=l),"items-per-page":g.value,"onUpdate:itemsPerPage":e[2]||(e[2]=l=>g.value=l),headers:le,items:N.value,"items-length":j.value,search:b.value,loading:B.value,density:"compact","item-value":"id","return-object":"","fixed-header":"","show-select":"","items-per-page-text":"每页条数","page-text":"{0}-{1} 共 {2} 条","onUpdate:options":h},{"item.title":t(({item:l})=>[d("div",De,[a(pe,null,{default:t(()=>[a(L,{icon:ae(l.raw.type||"")},null,8,["icon"])]),_:2},1024),d("div",Ue,[d("span",Se,n(l.raw.title)+" "+n(l.raw.seasons)+n(l.raw.episodes),1),d("small",null,n(l.raw.category),1)])])]),"item.src":t(({item:l})=>[d("small",null,[u(n(l.raw.src)+" ",1),He,u("=> "+n(l.raw.dest),1)])]),"item.mode":t(({item:l})=>[a(R,{variant:"outlined",color:"primary",size:"small"},{default:t(()=>[u(n(se[l.raw.mode]),1)]),_:2},1024)]),"item.status":t(({item:l})=>[a(R,{color:te(l.raw.status),size:"small"},{default:t(()=>[u(n(l.raw.status?"成功":"失败"),1)]),_:2},1032,["color"])]),"item.date":t(({item:l})=>[d("small",null,n(l.raw.date),1)]),"item.errmsg":t(({item:l})=>[d("small",Le,n(l.raw.errmsg),1)]),"item.actions":t(({item:l})=>[a(r,null,{default:t(()=>[a(L,{icon:"mdi-dots-vertical"}),a(Ve,{activator:"parent","close-on-content-click":""},{default:t(()=>[a(ge,null,{default:t(()=>[(y(!0),H(W,null,_e(ie.value,(I,ce)=>(y(),Q(we,{key:ce,variant:"plain","base-color":I.props.color,onClick:je=>I.props.click(l.raw)},{prepend:t(()=>[a(L,{icon:I.props.prependIcon},null,8,["icon"])]),default:t(()=>[a(ye,{textContent:n(I.title)},null,8,["textContent"])]),_:2},1032,["base-color","onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"no-data":t(()=>[u(" 没有数据 ")]),_:1},8,["modelValue","items-per-page","items","items-length","search","loading"])]),_:1}),a(K,{modelValue:V.value,"onUpdate:modelValue":e[6]||(e[6]=l=>V.value=l),"max-width":"50rem"},{default:t(()=>[a(P,{title:"重新整理"},{default:t(()=>[a(X,null,{default:t(()=>[a(G,null,{default:t(()=>[a(T,{cols:"12",md:"4"},{default:t(()=>[a(xe,{modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=l=>x.value=l),label:"类型",rules:[Y(Te)],items:ee.value},null,8,["modelValue","rules","items"])]),_:1}),a(T,{cols:"12",md:"8"},{default:t(()=>[a(J,{modelValue:v.value,"onUpdate:modelValue":e[4]||(e[4]=l=>v.value=l),label:"TMDB编号",rules:[Y(Pe)],"append-inner-icon":"mdi-magnify","onClick:appendInner":e[5]||(e[5]=be(l=>$.value=!0,["stop"]))},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),a(ke,null,{default:t(()=>[a(Ce),a(_,{onClick:q,onKeydown:$e(q,["enter"])},{default:t(()=>[u(" 确定 ")]),_:1},8,["onKeydown"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),m.value.length>0?(y(),H("span",Ke,[a(_,{icon:"mdi-trash-can-outline",color:"error",size:"x-large",onClick:ue})])):he("",!0),a(K,{modelValue:C.value,"onUpdate:modelValue":e[7]||(e[7]=l=>C.value=l),scrim:!1,width:"25rem"},{default:t(()=>[a(P,{color:"primary"},{default:t(()=>[a(X,{class:"text-center"},{default:t(()=>[u(n(z.value)+" ",1),a(Ie,{color:"white",class:"mb-0 mt-1","model-value":A.value},null,8,["model-value"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(K,{modelValue:$.value,"onUpdate:modelValue":e[10]||(e[10]=l=>$.value=l),width:"600",scrollable:""},{default:t(()=>[a(Be,{modelValue:v.value,"onUpdate:modelValue":e[8]||(e[8]=l=>v.value=l),onClose:e[9]||(e[9]=l=>$.value=!1)},null,8,["modelValue"])]),_:1},8,["modelValue"]),a(de,{modelValue:f.value,"onUpdate:modelValue":e[15]||(e[15]=l=>f.value=l),inset:""},{default:t(()=>[a(P,{class:"text-center"},{default:t(()=>[a(p,{onClick:e[11]||(e[11]=l=>f.value=!1)}),a(F,{class:"pe-10"},{default:t(()=>[u(n(D.value),1)]),_:1}),d("div",Me,[a(_,{color:"info",class:"mb-2 mx-2",onClick:e[12]||(e[12]=l=>U(!1,!1))},{default:t(()=>[u(" 仅删除历史记录 ")]),_:1}),a(_,{color:"warning",class:"mb-2 mx-2",onClick:e[13]||(e[13]=l=>U(!1,!0))},{default:t(()=>[u(" 删除历史记录和媒体库文件 ")]),_:1}),a(_,{color:"error",class:"mb-2 mx-2",onClick:e[14]||(e[14]=l=>U(!0,!0))},{default:t(()=>[u(" 删除历史记录、源文件和媒体库文件 ")]),_:1})])]),_:1})]),_:1},8,["modelValue"])],64)}}});const Ge=O({__name:"history",setup(Z){return(w,V)=>(y(),Q(Ne))}});export{Ge as default};
