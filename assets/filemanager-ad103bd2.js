import{b as Pe,a as de}from"./index-228e1652.js";import{d as ee,r as g,p as E,e as ue,o as i,f as p,i as t,m as e,ac as _e,I as M,aC as qe,aT as Ee,V as v,a2 as te,c as H,W as Z,a0 as le,j as l,Y as ae,K as V,t as F,M as K,$ as j,aF as He,z as ke,A as G,B as z,E as N,F as q,G as ye,L as Y,aD as xe,a as Q,w as ne,q as Te,P as A,a1 as ce,af as Ge,ae as Je,N as Ke,a3 as Qe,ag as Xe,aV as Ie,Z as Ye,H as Se,Q as Ze,C as ie,D as O,a8 as ve,R as et,S as tt,ai as lt,aa as at,a6 as he,aW as nt,aX as ot,ax as Le}from"./index-d97604e4.js";import{_ as Be}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as st}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-46ff3c26.js";import{n as Ue}from"./index-705cb9e8.js";import{a as je}from"./formatters-16dfb57c.js";import{_ as rt}from"./MediaInfoCard.vue_vue_type_script_setup_true_lang-bf4d8131.js";import{_ as it}from"./TmdbSelectorCard.vue_vue_type_script_setup_true_lang-57450ecc.js";const dt=Q("div",{class:"flex-grow-1"},null,-1),ut=Q("div",{class:"flex-grow-1"},null,-1),ct=ee({__name:"Toolbar",props:{storages:Array,storage:String,path:String,endpoints:Object,axios:Object},emits:["storagechanged","pathchanged","loading","foldercreated","sortchanged"],setup(b,{emit:h}){const n=b,T=g(!1),C=g(""),P=g("name");function I(){P.value==="name"?P.value="time":P.value="name",h("sortchanged",P.value)}const S=E(()=>{var _,r;let c="";const u=(_=n.path)==null?void 0:_.endsWith("/"),f=(r=n.path)==null?void 0:r.split("/").filter(x=>x);return(f==null?void 0:f.map((x,B)=>(c+=x+(B<f.length-1||u?"/":""),{name:x,path:c})))??[]}),L=E(()=>{var c;return(c=n.storages)==null?void 0:c.find(u=>u.code===n.storage)});function D(c){n.storage!==c&&(h("storagechanged",c),h("pathchanged",""))}function R(c){h("pathchanged",c)}function $(){const c=S.value??[],u=(c==null?void 0:c.length)===1?"/":c[c.length-2].path;R(u)}async function w(){var f,_,r;h("loading",!0);const u={url:(f=n.endpoints)==null?void 0:f.mkdir.url.replace(/{storage}/g,n.storage).replace(/{path}/g,encodeURIComponent(n.path+C.value)),method:((_=n.endpoints)==null?void 0:_.mkdir.method)||"post"};await((r=n.axios)==null?void 0:r.request(u)),T.value=!1,C.value="",h("loading",!1),h("foldercreated")}const y=E(()=>P.value==="time"?"mdi-sort-clock-ascending-outline":"mdi-sort-alphabetical-ascending");return(c,u)=>{const f=ue("Icon"),_=ue("IconBtn");return i(),p(xe,{flat:"",dense:""},{default:t(()=>[e(He,{class:"overflow-hidden"},{default:t(()=>{var r;return[(r=n.storages)!=null&&r.length||0>1?(i(),p(_e,{key:0,"offset-y":""},{activator:t(({props:x})=>[e(M,qe(Ee(x)),{default:t(()=>[e(v,{icon:"mdi-arrow-down-drop-circle-outline"})]),_:2},1040)]),default:t(()=>[e(te,null,{default:t(()=>[(i(!0),H(K,null,Z(b.storages,(x,B)=>{var W;return i(),p(le,{key:B,disabled:x.code===((W=l(L))==null?void 0:W.code),onClick:be=>D(x.code)},{prepend:t(()=>[e(f,{icon:x.icon},null,8,["icon"])]),default:t(()=>[e(ae,null,{default:t(()=>[V(F(x.name),1)]),_:2},1024)]),_:2},1032,["disabled","onClick"])}),128))]),_:1})]),_:1})):j("",!0),e(M,{variant:"text","input-value":b.path==="/",class:"px-1",onClick:u[0]||(u[0]=x=>R("/"))},{default:t(()=>{var x,B;return[e(v,{icon:(x=l(L))==null?void 0:x.icon,class:"mr-2"},null,8,["icon"]),V(" "+F((B=l(L))==null?void 0:B.name),1)]}),_:1},8,["input-value"]),(i(!0),H(K,null,Z(l(S),(x,B)=>(i(),p(M,{key:B,variant:"text","input-value":B===l(S).length-1,class:"px-1 d-none d-md-block",onClick:W=>R(x.path)},{default:t(()=>[e(v,{icon:" mdi-chevron-right"}),V(" "+F(x.name),1)]),_:2},1032,["input-value","onClick"]))),128))]}),_:1}),dt,e(_,{onClick:I},{default:t(()=>[e(v,{icon:l(y)},null,8,["icon"])]),_:1}),l(S).length>0?(i(),p(_,{key:0,onClick:$},{default:t(()=>[e(v,{icon:"mdi-arrow-up-bold-outline"})]),_:1})):j("",!0),e(Y,{modelValue:l(T),"onUpdate:modelValue":u[3]||(u[3]=r=>q(T)?T.value=r:null),"max-width":"50rem"},{activator:t(({props:r})=>[e(_,ke({title:"新建文件夹"},r),{default:t(()=>[e(v,{icon:"mdi-folder-plus-outline"})]),_:2},1040)]),default:t(()=>[e(G,{title:"新建文件夹"},{default:t(()=>[e(z,null,{default:t(()=>[e(N,{modelValue:l(C),"onUpdate:modelValue":u[1]||(u[1]=r=>q(C)?C.value=r:null),label:"名称"},null,8,["modelValue"])]),_:1}),e(ye,null,{default:t(()=>[ut,e(M,{depressed:"",onClick:u[2]||(u[2]=r=>T.value=!1)},{default:t(()=>[V(" 取消 ")]),_:1}),e(M,{disabled:!l(C),depressed:"",onClick:w},{default:t(()=>[V(" 新建 ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}}),pt={class:"grow scroll-x"},ft=ee({__name:"Tree",props:{icons:Object,storage:String,path:String,endpoints:Object,axios:Object,refreshpending:Boolean},emits:["pathchanged","loading","refreshed"],setup(b,{emit:h}){const n=b,T=g([]),C=g([]),P=g([]),I=g("");function S(){T.value=[],P.value=[{type:"dir",path:"/",basename:"root",extension:"",name:"root",children:[],size:0,modify_time:0}]}async function L($){var u,f,_;h("loading",!0);const y={url:(u=n.endpoints)==null?void 0:u.list.url.replace(/{storage}/g,n.storage).replace(/{path}/g,$.path),method:((f=n.endpoints)==null?void 0:f.list.method)||"get"},c=await((_=n.axios)==null?void 0:_.request(y))??[];$.children=c.map(r=>(r.type==="dir"&&(r.children=[]),r)),h("loading",!1)}function D($){let w="";C.value.length&&(w=C.value[0]),n.path!==w&&h("pathchanged",w)}function R($){const w=[];for(w.push(P.value[0]);w.length>0;){const y=w.pop();if((y==null?void 0:y.path)===$)return y;if(y!=null&&y.children&&y.children.length)for(const c of y.children)w.push(c)}return null}return ne(()=>n.storage,()=>{S()}),ne(()=>n.path,()=>{n.path&&(C.value=[n.path],T.value.includes(n.path)||T.value.push(n.path))}),ne(()=>n.refreshpending,async()=>{if(n.refreshpending&&n.path){const $=R(n.path);$&&(await L($),h("refreshed"))}}),Te(()=>{S()}),($,w)=>{const y=ue("VTreeview");return i(),p(G,{flat:"",width:"250","min-height":"500",class:"d-flex flex-column folders-tree-card"},{default:t(()=>[Q("div",pt,[e(y,{open:l(T),active:l(C),items:l(P),search:l(I),"load-children":L,"item-key":"path","item-text":"basename",dense:"",activatable:"",transition:"",class:"folders-tree","onUpdate:active":D},{prepend:t(({item:c,open:u})=>[c.type==="dir"?(i(),p(v,{key:0},{default:t(()=>[V(F(u?"mdi-folder-open-outline":"mdi-folder-outline"),1)]),_:2},1024)):n.icons?(i(),p(v,{key:1,icon:n.icons[c.extension.toLowerCase()]||n.icons.other},null,8,["icon"])):j("",!0)]),label:t(({item:c})=>[V(F(c.basename)+" ",1),c.type==="dir"?(i(),p(M,{key:0,icon:"",class:"ml-1",onClick:A(u=>L(c),["stop"])},{default:t(()=>[e(v,{class:"pa-0 mdi-18px",color:"grey lighten-1"},{default:t(()=>[V(" mdi-refresh ")]),_:1})]),_:2},1032,["onClick"])):j("",!0)]),_:1},8,["open","active","items","search"])]),e(ce),e(xe,{density:"compact"},{default:t(()=>[e(M,{icon:"",onClick:S},{default:t(()=>[e(v,{icon:"mdi-collapse-all-outline"})]),_:1})]),_:1})]),_:1})}}});const mt=Be(ft,[["__scopeId","data-v-38430c21"]]),Ve=b=>(nt("data-v-d5bc2aed"),b=b(),ot(),b),gt=Ve(()=>Q("br",null,null,-1)),vt=Ve(()=>Q("br",null,null,-1)),ht=Ve(()=>Q("div",{class:"flex-grow-1"},null,-1)),_t=ee({__name:"List",props:{icons:Object,storage:String,path:String,endpoints:Object,axios:Object,refreshpending:Boolean,sort:String},emits:["loading","pathchanged","refreshed","filedeleted","renamed"],setup(b,{emit:h}){const n=b,T=Ge.useToast(),C=g(!0),P=Je(),I=g(n.storage??""),S=g(n.axios??Pe),L=g([]),D=g(""),R=g(!1),$=g(!1),w=g(!1),y=g("请稍候 ..."),c=g(0),u=g(),f=g(""),_=g(),r=Ke({path:"",target:"",tmdbid:null,season:null,type_name:"",transfer_type:"",episode_format:"",episode_detail:"",episode_part:"",episode_offset:null,min_filesize:0}),x=g(),B=g(!1),W=g(!1),be=g(Array.from({length:51},(s,a)=>a).map(s=>({title:`第 ${s} 季`,value:s}))),oe=E(()=>L.value.filter(s=>s.type==="dir"&&s.basename.includes(D.value))),se=E(()=>L.value.filter(s=>s.type==="file"&&s.basename.includes(D.value))),De=E(()=>{var s;return(s=n.path)==null?void 0:s.endsWith("/")}),J=E(()=>!De.value),Ce=E(()=>{var a,d;const s=(d=(a=n.path)==null?void 0:a.split(".").pop())==null?void 0:d.toLowerCase();return["png","jpg","jpeg","gif","bmp"].includes(s??"")});async function X(){var d,U;C.value=!0,h("loading",!0);const a={url:(d=n.endpoints)==null?void 0:d.list.url.replace(/{storage}/g,I.value).replace(/{path}/g,encodeURIComponent(n.path||"")).replace(/{sort}/g,n.sort||"name"),method:((U=n.endpoints)==null?void 0:U.list.method)||"get"};L.value=await S.value.request(a)??[],h("loading",!1),C.value=!1}async function pe(s){var d,U;if(await P({title:"确认",content:`是否确认删除${s.type==="dir"?"目录":"文件"} ${s.basename}？`,confirmationText:"确认",cancellationText:"取消",dialogProps:{maxWidth:"50rem"}})){h("loading",!0);const m={url:(d=n.endpoints)==null?void 0:d.delete.url.replace(/{storage}/g,I.value).replace(/{path}/g,encodeURIComponent(s.path)),method:((U=n.endpoints)==null?void 0:U.delete.method)||"post"};await S.value.request(m),h("filedeleted"),h("loading",!1),X()}}function we(s){h("pathchanged",s)}function Re(s){var o;if(!s)return;const a=he.state.auth.token,U=`/api/v1/${((o=n.endpoints)==null?void 0:o.download.url.replace(/{storage}/g,I.value).replace(/{path}/g,encodeURIComponent(s))).slice(1)}&token=${a}`;window.open(U,"_blank")}function Fe(s){var U;if(!s)return"";const a=he.state.auth.token;return`/api/v1/${((U=n.endpoints)==null?void 0:U.image.url.replace(/{storage}/g,I.value).replace(/{path}/g,encodeURIComponent(s))).slice(1)}&token=${a}`}function fe(s){_.value=s,f.value=s.name,R.value=!0}async function Oe(){var d,U,o,m;h("loading",!0);const a={url:(U=n.endpoints)==null?void 0:U.rename.url.replace(/{storage}/g,n.storage).replace(/{path}/g,encodeURIComponent(((d=_.value)==null?void 0:d.path)||"")).replace(/{newname}/g,encodeURIComponent(f.value)),method:((o=n.endpoints)==null?void 0:o.mkdir.method)||"post"};await((m=n.axios)==null?void 0:m.request(a)),R.value=!1,f.value="",h("loading",!1),h("renamed")}function me(s){_.value=s,$.value=!0}async function ze(){var s;r.path=((s=_.value)==null?void 0:s.path)??"";try{$.value=!1,w.value=!0,Ne(),de.post("transfer/manual",{},{params:r}).then(a=>{var d,U;w.value=!1,Ae(),a.success?(T.success(`${(d=_.value)==null?void 0:d.name} 整理完成！`),X()):T.error(`${(U=_.value)==null?void 0:U.name} 整理失败：${a.message}！`)})}catch(a){console.log(a)}}function Me(s){return new Date(s*1e3).toLocaleString()}ne(()=>n.path,async()=>{L.value=[],x.value=void 0,B.value=!1,await X()}),ne(()=>n.refreshpending,async()=>{n.refreshpending&&(await X(),h("refreshed"))});function Ne(){y.value="请稍候 ...";const s=he.state.auth.token;u.value=new EventSource(`/api/v1/system/progress/filetransfer?token=${s}`),u.value.onmessage=a=>{const d=JSON.parse(a.data);d&&(y.value=d.text,c.value=d.value)}}function Ae(){var s;(s=u.value)==null||s.close()}async function re(s){var a,d;try{w.value=!0,y.value=`正在识别 ${s} ...`,c.value=0,x.value=await de.get("media/recognize_file",{params:{path:s}}),w.value=!1,x.value||T.error(`${s} 识别失败！`),B.value=!!((d=(a=x.value)==null?void 0:a.meta_info)!=null&&d.name)}catch(U){console.error(U)}}const $e=g([{title:"识别",value:1,props:{prependIcon:"mdi-text-recognition",click:s=>{re(s.path||"")}}},{title:"重命名",value:2,props:{prependIcon:"mdi-rename",click:fe}},{title:"整理",value:3,props:{prependIcon:"mdi-folder-arrow-right",click:me}},{title:"删除",value:4,props:{prependIcon:"mdi-delete-outline",color:"error",click:pe}}]);return Te(()=>{X()}),(s,a)=>{const d=ue("IconBtn"),U=st;return i(),H(K,null,[e(G,{class:"d-flex flex-column"},{default:t(()=>[l(C)?(i(),p(z,{key:0,class:"text-center flex flex-col items-center"},{default:t(()=>[e(Qe,{size:"48",indeterminate:"",color:"primary"})]),_:1})):j("",!0),b.path?l(J)&&!l(Ce)?(i(),p(z,{key:2,class:"text-center break-all"},{default:t(()=>{var o,m,k;return[Q("strong",null,F((o=l(L)[0])==null?void 0:o.name),1),gt,V(" 大小："+F(l(je)(((m=l(L)[0])==null?void 0:m.size)||0)),1),vt,V(" 修改时间："+F(Me(((k=l(L)[0])==null?void 0:k.modify_time)||0)),1)]}),_:1})):l(J)&&l(Ce)?(i(),p(z,{key:3,class:"grow d-flex justify-center align-center"},{default:t(()=>[e(Xe,{src:Fe(b.path),"max-width":"100%","max-height":"100%"},null,8,["src"])]),_:1})):l(oe).length||l(se).length?(i(),p(z,{key:4,class:"p-0"},{default:t(()=>[l(oe).length?(i(),p(te,{key:0,subheader:""},{default:t(()=>[e(Ie,null,{default:t(()=>[V("目录")]),_:1}),(i(!0),H(K,null,Z(l(oe),(o,m)=>(i(),p(le,{key:m,class:"px-3 pe-1",onClick:k=>we(o.path)},{prepend:t(()=>[e(v,{icon:"mdi-folder-outline"})]),append:t(()=>[e(d,{class:"d-sm-none"},{default:t(()=>[e(v,{icon:"mdi-dots-vertical"}),e(_e,{activator:"parent","close-on-content-click":""},{default:t(()=>[e(te,null,{default:t(()=>[(i(!0),H(K,null,Z(l($e),(k,ge)=>(i(),p(le,{key:ge,variant:"plain","base-color":k.props.color,onClick:We=>k.props.click(o)},{prepend:t(()=>[e(v,{icon:k.props.prependIcon},null,8,["icon"])]),default:t(()=>[e(ae,{textContent:F(k.title)},null,8,["textContent"])]),_:2},1032,["base-color","onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024),e(d,{class:"d-none d-sm-block",onClick:A(k=>re(o.path),["stop"])},{default:t(()=>[e(v,{icon:"mdi-text-recognition"})]),_:2},1032,["onClick"]),e(d,{class:"d-none d-sm-block",onClick:A(k=>fe(o),["stop"])},{default:t(()=>[e(v,{icon:"mdi-rename"})]),_:2},1032,["onClick"]),e(d,{class:"d-none d-sm-block",onClick:A(k=>me(o),["stop"])},{default:t(()=>[e(v,{icon:"mdi-folder-arrow-right"})]),_:2},1032,["onClick"]),e(d,{class:"d-none d-sm-block",onClick:A(k=>pe(o),["stop"])},{default:t(()=>[e(v,{icon:"mdi-delete-outline"})]),_:2},1032,["onClick"])]),default:t(()=>[e(ae,{textContent:F(o.name)},null,8,["textContent"])]),_:2},1032,["onClick"]))),128))]),_:1})):j("",!0),l(oe).length&&l(se).length?(i(),p(ce,{key:1})):j("",!0),l(se).length?(i(),p(te,{key:2,subheader:""},{default:t(()=>[e(Ie,null,{default:t(()=>[V("文件")]),_:1}),(i(!0),H(K,null,Z(l(se),(o,m)=>(i(),p(le,{key:m,class:"pl-3 pe-1",onClick:k=>we(o.path)},{prepend:t(()=>{var k;return[n.icons?(i(),p(v,{key:0,icon:n.icons[o.extension.toLowerCase()]||((k=n.icons)==null?void 0:k.other)},null,8,["icon"])):j("",!0)]}),append:t(()=>[e(d,{class:"d-sm-none"},{default:t(()=>[e(v,{icon:"mdi-dots-vertical"}),e(_e,{activator:"parent","close-on-content-click":""},{default:t(()=>[e(te,null,{default:t(()=>[(i(!0),H(K,null,Z(l($e),(k,ge)=>(i(),p(le,{key:ge,variant:"plain","base-color":k.props.color,onClick:We=>k.props.click(o)},{prepend:t(()=>[e(v,{icon:k.props.prependIcon},null,8,["icon"])]),default:t(()=>[e(ae,{textContent:F(k.title)},null,8,["textContent"])]),_:2},1032,["base-color","onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024),e(d,{class:"d-none d-sm-block",onClick:A(k=>re(o.path),["stop"])},{default:t(()=>[e(v,{icon:"mdi-text-recognition"})]),_:2},1032,["onClick"]),e(d,{class:"d-none d-sm-block",onClick:A(k=>fe(o),["stop"])},{default:t(()=>[e(v,{icon:"mdi-rename"})]),_:2},1032,["onClick"]),e(d,{class:"d-none d-sm-block",onClick:A(k=>me(o),["stop"])},{default:t(()=>[e(v,{icon:"mdi-folder-arrow-right"})]),_:2},1032,["onClick"]),e(d,{class:"d-none d-sm-block",onClick:A(k=>pe(o),["stop"])},{default:t(()=>[e(v,{icon:"mdi-delete-outline"})]),_:2},1032,["onClick"])]),default:t(()=>[e(ae,{textContent:F(o.name)},null,8,["textContent"]),e(Ye,null,{default:t(()=>[V(F(l(je)(o.size)),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):j("",!0)]),_:1})):l(D)?(i(),p(z,{key:5,class:"grow d-flex justify-center align-center grey--text py-5"},{default:t(()=>[V(" 没有目录或文件 ")]),_:1})):l(C)?j("",!0):(i(),p(z,{key:6,class:"grow d-flex justify-center align-center grey--text py-5"},{default:t(()=>[V(" 空目录 ")]),_:1})):(i(),p(z,{key:1,class:"grow d-flex justify-center align-center grey--text"},{default:t(()=>[V(" 选择目录或文件 ")]),_:1})),b.path?(i(),p(ce,{key:7})):j("",!0),l(C)?j("",!0):(i(),p(xe,{key:8,density:"compact",flat:"",color:"gray"},{default:t(()=>[l(J)?j("",!0):(i(),p(N,{key:0,modelValue:l(D),"onUpdate:modelValue":a[0]||(a[0]=o=>q(D)?D.value=o:null),"hide-details":"",flat:"",density:"compact",variant:"solo-filled",placeholder:"搜索 ...","prepend-inner-icon":"mdi-filter-outline",class:"me-2"},null,8,["modelValue"])),l(J)?(i(),p(Se,{key:1})):j("",!0),l(J)?(i(),p(d,{key:2,onClick:a[1]||(a[1]=o=>re(n.path||""))},{default:t(()=>[e(v,{color:"primary"},{default:t(()=>[V(" mdi-text-recognition ")]),_:1})]),_:1})):j("",!0),l(J)?(i(),p(d,{key:3,onClick:a[2]||(a[2]=o=>Re(n.path||""))},{default:t(()=>[e(v,{color:"primary"},{default:t(()=>[V(" mdi-download ")]),_:1})]),_:1})):j("",!0),l(J)?j("",!0):(i(),p(d,{key:4,onClick:X},{default:t(()=>[e(v,{color:"primary"},{default:t(()=>[V(" mdi-refresh ")]),_:1})]),_:1}))]),_:1}))]),_:1}),e(Y,{modelValue:l(R),"onUpdate:modelValue":a[5]||(a[5]=o=>q(R)?R.value=o:null),"max-width":"50rem"},{activator:t(({props:o})=>[e(d,ke({title:"重命名"},o),{default:t(()=>[e(v,{icon:"mdi-rename-outline"})]),_:2},1040)]),default:t(()=>[e(G,{title:"重命名"},{default:t(()=>[e(z,null,{default:t(()=>[e(N,{modelValue:l(f),"onUpdate:modelValue":a[3]||(a[3]=o=>q(f)?f.value=o:null),label:"名称"},null,8,["modelValue"])]),_:1}),e(ye,null,{default:t(()=>[ht,e(M,{depressed:"",onClick:a[4]||(a[4]=o=>R.value=!1)},{default:t(()=>[V(" 取消 ")]),_:1}),e(M,{disabled:!l(f),depressed:"",onClick:Oe},{default:t(()=>[V(" 重命名 ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Y,{modelValue:l($),"onUpdate:modelValue":a[18]||(a[18]=o=>q($)?$.value=o:null),"max-width":"50rem",scrollable:""},{activator:t(({props:o})=>[e(d,ke({title:"整理"},o),{default:t(()=>[e(v,{icon:"mdi-folder-arrow-right-outline"})]),_:2},1040)]),default:t(()=>{var o;return[e(G,{title:`文件整理 - ${(o=l(_))==null?void 0:o.name}`},{default:t(()=>[e(z,{class:"pt-2"},{default:t(()=>[e(Ze,{onSubmit:A(()=>{},["prevent"])},{default:t(()=>[e(ie,null,{default:t(()=>[e(O,{cols:"12",md:"8"},{default:t(()=>[e(N,{modelValue:l(r).target,"onUpdate:modelValue":a[6]||(a[6]=m=>l(r).target=m),label:"目的路径",placeholder:"留空自动"},null,8,["modelValue"])]),_:1}),e(O,{cols:"12",md:"4"},{default:t(()=>[e(ve,{modelValue:l(r).transfer_type,"onUpdate:modelValue":a[7]||(a[7]=m=>l(r).transfer_type=m),label:"整理方式",items:[{title:"默认",value:""},{title:"移动",value:"move"},{title:"复制",value:"copy"},{title:"硬链接",value:"link"},{title:"软链接",value:"softlink"}]},null,8,["modelValue"])]),_:1})]),_:1}),e(ie,null,{default:t(()=>[e(O,{cols:"12",md:"4"},{default:t(()=>[e(ve,{modelValue:l(r).type_name,"onUpdate:modelValue":a[8]||(a[8]=m=>l(r).type_name=m),label:"类型",items:[{title:"请选择",value:""},{title:"电影",value:"电影"},{title:"电视剧",value:"电视剧"}]},null,8,["modelValue"])]),_:1}),e(O,{cols:"12",md:"4"},{default:t(()=>[e(N,{modelValue:l(r).tmdbid,"onUpdate:modelValue":a[9]||(a[9]=m=>l(r).tmdbid=m),label:"TMDBID",placeholder:"留空自动识别",rules:[l(Ue)],"append-inner-icon":"mdi-magnify","onClick:appendInner":a[10]||(a[10]=m=>W.value=!0)},null,8,["modelValue","rules"])]),_:1}),e(O,{cols:"12",md:"4"},{default:t(()=>[et(e(ve,{modelValue:l(r).season,"onUpdate:modelValue":a[11]||(a[11]=m=>l(r).season=m),modelModifiers:{number:!0},label:"季",items:l(be)},null,8,["modelValue","items"]),[[tt,l(r).type_name==="电视剧"]])]),_:1})]),_:1}),e(ie,null,{default:t(()=>[e(O,{cols:"12",md:"8"},{default:t(()=>[e(N,{modelValue:l(r).episode_format,"onUpdate:modelValue":a[12]||(a[12]=m=>l(r).episode_format=m),label:"集数定位",placeholder:"使用{ep}定位集数"},null,8,["modelValue"])]),_:1}),e(O,{cols:"12",md:"4"},{default:t(()=>[e(N,{modelValue:l(r).episode_detail,"onUpdate:modelValue":a[13]||(a[13]=m=>l(r).episode_detail=m),label:"指定集数",placeholder:"起始集,终止集，如1或1,2"},null,8,["modelValue"])]),_:1}),e(O,{cols:"12",md:"4"},{default:t(()=>[e(N,{modelValue:l(r).episode_part,"onUpdate:modelValue":a[14]||(a[14]=m=>l(r).episode_part=m),label:"指定Part",placeholder:"如part1"},null,8,["modelValue"])]),_:1}),e(O,{cols:"12",md:"4"},{default:t(()=>[e(N,{modelValue:l(r).episode_offset,"onUpdate:modelValue":a[15]||(a[15]=m=>l(r).episode_offset=m),modelModifiers:{number:!0},label:"集数偏移",placeholder:"如-10"},null,8,["modelValue"])]),_:1}),e(O,{cols:"12",md:"4"},{default:t(()=>[e(N,{modelValue:l(r).min_filesize,"onUpdate:modelValue":a[16]||(a[16]=m=>l(r).min_filesize=m),modelModifiers:{number:!0},label:"最小文件大小（MB）",rules:[l(Ue)],placeholder:"0"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(ye,null,{default:t(()=>[e(M,{depressed:"",onClick:a[17]||(a[17]=m=>$.value=!1)},{default:t(()=>[V(" 取消 ")]),_:1}),e(Se),e(M,{onClick:ze},{default:t(()=>[V(" 开始整理 ")]),_:1})]),_:1})]),_:1},8,["title"])]}),_:1},8,["modelValue"]),e(Y,{modelValue:l(w),"onUpdate:modelValue":a[19]||(a[19]=o=>q(w)?w.value=o:null),scrim:!1,width:"25rem"},{default:t(()=>[e(G,{color:"primary"},{default:t(()=>[e(z,{class:"text-center"},{default:t(()=>[V(F(l(y))+" ",1),l(c)?(i(),p(lt,{key:0,color:"white",class:"mb-0 mt-1","model-value":l(c)},null,8,["model-value"])):j("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Y,{modelValue:l(B),"onUpdate:modelValue":a[21]||(a[21]=o=>q(B)?B.value=o:null),width:"50rem"},{default:t(()=>[e(G,null,{default:t(()=>[e(U,{onClick:a[20]||(a[20]=o=>B.value=!1)}),e(at,null,{default:t(()=>[e(rt,{context:l(x)},null,8,["context"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Y,{modelValue:l(W),"onUpdate:modelValue":a[24]||(a[24]=o=>q(W)?W.value=o:null),width:"40rem",scrollable:""},{default:t(()=>[e(it,{modelValue:l(r).tmdbid,"onUpdate:modelValue":a[22]||(a[22]=o=>l(r).tmdbid=o),onClose:a[23]||(a[23]=o=>W.value=!1)},null,8,["modelValue"])]),_:1},8,["modelValue"])],64)}}});const kt=Be(_t,[["__scopeId","data-v-d5bc2aed"]]),yt=ee({__name:"FileBrowser",props:{storages:String,storage:String,path:String,tree:Boolean,endpoints:Object,axios:Object,axiosconfig:Object},emits:["pathchanged"],setup(b,{emit:h}){const n=b,T=[{name:"本地",code:"local",icon:"mdi-folder-multiple-outline"}],C={zip:"mdi-folder-zip-outline",rar:"mdi-folder-zip-outline",htm:"mdi-language-html5",html:"mdi-language-html5",js:"mdi-nodejs",json:"mdi-file-document-outline",md:"mdi-language-markdown-outline",pdf:"mdi-file-pdf",png:"mdi-file-image",jpg:"mdi-file-image",jpeg:"mdi-file-image",mp4:"mdi-filmstrip",mkv:"mdi-filmstrip",avi:"mdi-filmstrip",wmv:"mdi-filmstrip",mov:"mdi-filmstrip",txt:"mdi-file-document-outline",xls:"mdi-file-excel",other:"mdi-file-outline"},P=g(0),I=g("local"),S=g(!1),L=g("name"),D=g(),R=E(()=>{var f;const u=(f=n.storages)==null?void 0:f.split(",");return T.filter(_=>u==null?void 0:u.includes(_.code))});function $(u){}function w(u){I.value=u}function y(u){h("pathchanged",u)}function c(u){L.value=u,S.value=!0}return Le(()=>{I.value=n.storage??"local",D.value=n.axios??Pe.create(n.axiosconfig)}),(u,f)=>(i(),p(G,{class:"mx-auto",loading:l(P)>0},{default:t(()=>[e(ct,{path:n.path,storages:l(R),storage:l(I),endpoints:n.endpoints,axios:l(D),onStoragechanged:w,onPathchanged:y,onFoldercreated:f[0]||(f[0]=_=>S.value=!0),onSortchanged:c},null,8,["path","storages","storage","endpoints","axios"]),e(ie,{"no-gutters":""},{default:t(()=>[b.tree?(i(),p(O,{key:0,sm:"auto",class:"d-none d-md-block"},{default:t(()=>[e(mt,{path:n.path,storage:l(I),icons:C,endpoints:b.endpoints,axios:l(D),refreshpending:l(S),onPathchanged:y,onLoading:$,onRefreshed:f[1]||(f[1]=_=>S.value=!1)},null,8,["path","storage","endpoints","axios","refreshpending"])]),_:1})):j("",!0),b.tree?(i(),p(ce,{key:1,vertical:""})):j("",!0),e(O,null,{default:t(()=>[e(kt,{path:n.path,storage:l(I),icons:C,endpoints:b.endpoints,axios:l(D),refreshpending:l(S),sort:l(L),onPathchanged:y,onLoading:$,onRefreshed:f[2]||(f[2]=_=>S.value=!1),onFiledeleted:f[3]||(f[3]=_=>S.value=!0),onRenamed:f[4]||(f[4]=_=>S.value=!0)},null,8,["path","storage","endpoints","axios","refreshpending","sort"])]),_:1})]),_:1})]),_:1},8,["loading"]))}}),xt=ee({__name:"FileBrowserView",setup(b){const h={list:{url:"/filebrowser/list?path={path}&sort={sort}",method:"get"},mkdir:{url:"/filebrowser/mkdir?path={path}",method:"get"},delete:{url:"/filebrowser/delete?path={path}",method:"get"},download:{url:"/filebrowser/download?path={path}",method:"get"},image:{url:"/filebrowser/image?path={path}",method:"get"},rename:{url:"/filebrowser/rename?path={path}&new_name={newname}",method:"get"}},n=g("/");async function T(){var P;try{const I=await de.get("system/env");I.success&&(n.value=((P=I.data)==null?void 0:P.DOWNLOAD_PATH)||"/"),n.value&&!n.value.endsWith("/")&&(n.value+="/")}catch(I){console.log(I)}}function C(P){n.value=P}return Le(async()=>{await T()}),(P,I)=>(i(),H("div",null,[e(yt,{storages:"local",tree:!1,path:l(n),endpoints:h,axios:l(de),onPathchanged:C},null,8,["path","axios"])]))}}),jt=ee({__name:"filemanager",setup(b){return(h,n)=>(i(),p(xt))}});export{jt as default};
