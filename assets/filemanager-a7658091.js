import{b as we,a as ue}from"./index-1bb05dc5.js";import{d as K,r as m,p as N,e as le,o,f as c,i as t,m as e,ac as pe,I as q,aD as Ue,aU as Oe,V as g,a1 as Z,c as E,U as J,$ as ee,j as a,X as te,J as V,t as L,L as M,_ as S,aG as Re,a9 as De,z as G,A as D,D as fe,E as W,G as be,K as oe,aE as me,a as Y,w as ne,q as Ve,O as F,a0 as se,af as ze,ae as Fe,a2 as Ne,ag as qe,aw as _e,Y as Ae,H as ke,ai as We,aa as Ee,a5 as xe,aW as Me,aX as Ge,ax as $e,C as ye,B as He}from"./index-1d8de1d3.js";import{_ as Ie}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as Xe}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-5fa15fd8.js";import{_ as Je}from"./ReorganizeForm.vue_vue_type_script_setup_true_lang-efdc85ec.js";import{a as Ce}from"./formatters-16dfb57c.js";import{_ as Ke}from"./MediaInfoCard.vue_vue_type_script_setup_true_lang-c269d30a.js";import"./index-705cb9e8.js";const Ye=Y("div",{class:"flex-grow-1"},null,-1),Qe=Y("div",{class:"flex-grow-1"},null,-1),Ze=K({__name:"Toolbar",props:{storages:Array,storage:String,path:String,endpoints:Object,axios:Object},emits:["storagechanged","pathchanged","loading","foldercreated","sortchanged"],setup(C,{emit:f}){const n=C,P=m(!1),w=m(""),x=m("name");function j(){x.value==="name"?x.value="time":x.value="name",f("sortchanged",x.value)}const $=N(()=>{var _,v;let i="";const s=(_=n.path)==null?void 0:_.endsWith("/"),u=(v=n.path)==null?void 0:v.split("/").filter(y=>y);return(u==null?void 0:u.map((y,B)=>(i+=y+(B<u.length-1||s?"/":""),{name:y,path:i})))??[]}),O=N(()=>{var i;return(i=n.storages)==null?void 0:i.find(s=>s.code===n.storage)});function U(i){n.storage!==i&&(f("storagechanged",i),f("pathchanged",""))}function R(i){f("pathchanged",i)}function b(){const i=$.value??[],s=(i==null?void 0:i.length)===1?"/":i[i.length-2].path;R(s)}async function I(){var u,_,v;f("loading",!0);const s={url:(u=n.endpoints)==null?void 0:u.mkdir.url.replace(/{storage}/g,n.storage).replace(/{path}/g,encodeURIComponent(n.path+w.value)),method:((_=n.endpoints)==null?void 0:_.mkdir.method)||"post"};await((v=n.axios)==null?void 0:v.request(s)),P.value=!1,w.value="",f("loading",!1),f("foldercreated")}const h=N(()=>x.value==="time"?"mdi-sort-clock-ascending-outline":"mdi-sort-alphabetical-ascending");return(i,s)=>{const u=le("Icon"),_=le("IconBtn");return o(),c(me,{flat:"",dense:""},{default:t(()=>[e(Re,{class:"overflow-hidden"},{default:t(()=>{var v;return[(v=n.storages)!=null&&v.length||0>1?(o(),c(pe,{key:0,"offset-y":""},{activator:t(({props:y})=>[e(q,Ue(Oe(y)),{default:t(()=>[e(g,{icon:"mdi-arrow-down-drop-circle-outline"})]),_:2},1040)]),default:t(()=>[e(Z,null,{default:t(()=>[(o(!0),E(M,null,J(C.storages,(y,B)=>{var Q;return o(),c(ee,{key:B,disabled:y.code===((Q=a(O))==null?void 0:Q.code),onClick:A=>U(y.code)},{prepend:t(()=>[e(u,{icon:y.icon},null,8,["icon"])]),default:t(()=>[e(te,null,{default:t(()=>[V(L(y.name),1)]),_:2},1024)]),_:2},1032,["disabled","onClick"])}),128))]),_:1})]),_:1})):S("",!0),e(q,{variant:"text","input-value":C.path==="/",class:"px-1",onClick:s[0]||(s[0]=y=>R("/"))},{default:t(()=>{var y,B;return[e(g,{icon:(y=a(O))==null?void 0:y.icon,class:"mr-2"},null,8,["icon"]),V(" "+L((B=a(O))==null?void 0:B.name),1)]}),_:1},8,["input-value"]),(o(!0),E(M,null,J(a($),(y,B)=>(o(),c(q,{key:B,variant:"text","input-value":B===a($).length-1,class:"px-1 d-none d-md-block",onClick:Q=>R(y.path)},{default:t(()=>[e(g,{icon:" mdi-chevron-right"}),V(" "+L(y.name),1)]),_:2},1032,["input-value","onClick"]))),128))]}),_:1}),Ye,e(_,{onClick:j},{default:t(()=>[e(g,{icon:a(h)},null,8,["icon"])]),_:1}),a($).length>0?(o(),c(_,{key:0,onClick:b},{default:t(()=>[e(g,{icon:"mdi-arrow-up-bold-outline"})]),_:1})):S("",!0),e(oe,{modelValue:a(P),"onUpdate:modelValue":s[3]||(s[3]=v=>W(P)?P.value=v:null),"max-width":"50rem"},{activator:t(({props:v})=>[e(_,De({title:"新建文件夹"},v),{default:t(()=>[e(g,{icon:"mdi-folder-plus-outline"})]),_:2},1040)]),default:t(()=>[e(G,{title:"新建文件夹"},{default:t(()=>[e(D,null,{default:t(()=>[e(fe,{modelValue:a(w),"onUpdate:modelValue":s[1]||(s[1]=v=>W(w)?w.value=v:null),label:"名称"},null,8,["modelValue"])]),_:1}),e(be,null,{default:t(()=>[Qe,e(q,{depressed:"",onClick:s[2]||(s[2]=v=>P.value=!1)},{default:t(()=>[V(" 取消 ")]),_:1}),e(q,{disabled:!a(w),depressed:"",variant:"tonal",onClick:I},{default:t(()=>[V(" 新建 ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}}),et={class:"grow scroll-x"},tt=K({__name:"Tree",props:{icons:Object,storage:String,path:String,endpoints:Object,axios:Object,refreshpending:Boolean},emits:["pathchanged","loading","refreshed"],setup(C,{emit:f}){const n=C,P=m([]),w=m([]),x=m([]),j=m("");function $(){P.value=[],x.value=[{type:"dir",path:"/",basename:"root",extension:"",name:"root",children:[],size:0,modify_time:0}]}async function O(b){var s,u,_;f("loading",!0);const h={url:(s=n.endpoints)==null?void 0:s.list.url.replace(/{storage}/g,n.storage).replace(/{path}/g,b.path),method:((u=n.endpoints)==null?void 0:u.list.method)||"get"},i=await((_=n.axios)==null?void 0:_.request(h))??[];b.children=i.map(v=>(v.type==="dir"&&(v.children=[]),v)),f("loading",!1)}function U(b){let I="";w.value.length&&(I=w.value[0]),n.path!==I&&f("pathchanged",I)}function R(b){const I=[];for(I.push(x.value[0]);I.length>0;){const h=I.pop();if((h==null?void 0:h.path)===b)return h;if(h!=null&&h.children&&h.children.length)for(const i of h.children)I.push(i)}return null}return ne(()=>n.storage,()=>{$()}),ne(()=>n.path,()=>{n.path&&(w.value=[n.path],P.value.includes(n.path)||P.value.push(n.path))}),ne(()=>n.refreshpending,async()=>{if(n.refreshpending&&n.path){const b=R(n.path);b&&(await O(b),f("refreshed"))}}),Ve(()=>{$()}),(b,I)=>{const h=le("VTreeview");return o(),c(G,{flat:"",width:"250","min-height":"500",class:"d-flex flex-column folders-tree-card"},{default:t(()=>[Y("div",et,[e(h,{open:a(P),active:a(w),items:a(x),search:a(j),"load-children":O,"item-key":"path","item-text":"basename",dense:"",activatable:"",transition:"",class:"folders-tree","onUpdate:active":U},{prepend:t(({item:i,open:s})=>[i.type==="dir"?(o(),c(g,{key:0},{default:t(()=>[V(L(s?"mdi-folder-open-outline":"mdi-folder-outline"),1)]),_:2},1024)):n.icons?(o(),c(g,{key:1,icon:n.icons[i.extension.toLowerCase()]||n.icons.other},null,8,["icon"])):S("",!0)]),label:t(({item:i})=>[V(L(i.basename)+" ",1),i.type==="dir"?(o(),c(q,{key:0,icon:"",class:"ml-1",onClick:F(s=>O(i),["stop"])},{default:t(()=>[e(g,{class:"pa-0 mdi-18px",color:"grey lighten-1"},{default:t(()=>[V(" mdi-refresh ")]),_:1})]),_:2},1032,["onClick"])):S("",!0)]),_:1},8,["open","active","items","search"])]),e(se),e(me,{density:"compact"},{default:t(()=>[e(q,{icon:"",onClick:$},{default:t(()=>[e(g,{icon:"mdi-collapse-all-outline"})]),_:1})]),_:1})]),_:1})}}});const nt=Ie(tt,[["__scopeId","data-v-38430c21"]]),Se=C=>(Me("data-v-a3ea397a"),C=C(),Ge(),C),at=Se(()=>Y("br",null,null,-1)),ot=Se(()=>Y("br",null,null,-1)),lt=K({__name:"List",props:{icons:Object,storage:String,path:String,endpoints:Object,axios:Object,refreshpending:Boolean,sort:String},emits:["loading","pathchanged","refreshed","filedeleted","renamed"],setup(C,{emit:f}){const n=C,P=ze.useToast(),w=m(!0),x=m(!1),j=m("请稍候 ..."),$=m(0),O=Fe(),U=m(n.storage??""),R=m(n.axios??we),b=m([]),I=m(""),h=m(!1),i=m(!1),s=m(""),u=m(),_=m(),v=m(!1),y=N(()=>b.value.filter(d=>d.type==="dir"&&d.basename.includes(I.value))),B=N(()=>b.value.filter(d=>d.type==="file"&&d.basename.includes(I.value))),Q=N(()=>{var d;return(d=n.path)==null?void 0:d.endsWith("/")}),A=N(()=>!Q.value),ge=N(()=>{var r,p;const d=(p=(r=n.path)==null?void 0:r.split(".").pop())==null?void 0:p.toLowerCase();return["png","jpg","jpeg","gif","bmp"].includes(d??"")});async function H(){var p,T;w.value=!0,f("loading",!0);const r={url:(p=n.endpoints)==null?void 0:p.list.url.replace(/{storage}/g,U.value).replace(/{path}/g,encodeURIComponent(n.path||"")).replace(/{sort}/g,n.sort||"name"),method:((T=n.endpoints)==null?void 0:T.list.method)||"get"};b.value=await R.value.request(r)??[],f("loading",!1),w.value=!1}async function re(d){var p,T;if(await O({title:"确认",content:`是否确认删除${d.type==="dir"?"目录":"文件"} ${d.basename}？`,confirmationText:"确认",cancellationText:"取消",dialogProps:{maxWidth:"50rem"},cancellationButtonProps:{variant:"tonal"}})){f("loading",!0);const l={url:(p=n.endpoints)==null?void 0:p.delete.url.replace(/{storage}/g,U.value).replace(/{path}/g,encodeURIComponent(d.path)),method:((T=n.endpoints)==null?void 0:T.delete.method)||"post"};await R.value.request(l),f("filedeleted"),f("loading",!1),H()}}function he(d){f("pathchanged",d)}function je(d){var z;if(!d)return;const r=xe.state.auth.token,T=`/api/v1/${((z=n.endpoints)==null?void 0:z.download.url.replace(/{storage}/g,U.value).replace(/{path}/g,encodeURIComponent(d))).slice(1)}&token=${r}`;window.open(T,"_blank")}function Te(d){var T;if(!d)return"";const r=xe.state.auth.token;return`/api/v1/${((T=n.endpoints)==null?void 0:T.image.url.replace(/{storage}/g,U.value).replace(/{path}/g,encodeURIComponent(d))).slice(1)}&token=${r}`}function ie(d){u.value=d,s.value=d.name,h.value=!0}async function Pe(){var p,T,z,l;f("loading",!0);const r={url:(T=n.endpoints)==null?void 0:T.rename.url.replace(/{storage}/g,n.storage).replace(/{path}/g,encodeURIComponent(((p=u.value)==null?void 0:p.path)||"")).replace(/{newname}/g,encodeURIComponent(s.value)),method:((z=n.endpoints)==null?void 0:z.mkdir.method)||"post"};await((l=n.axios)==null?void 0:l.request(r)),h.value=!1,s.value="",f("loading",!1),f("renamed")}function de(d){u.value=d,i.value=!0}function Be(d){return new Date(d*1e3).toLocaleString()}ne(()=>n.path,async()=>{b.value=[],_.value=void 0,v.value=!1,await H()}),ne(()=>n.refreshpending,async()=>{n.refreshpending&&(await H(),f("refreshed"))});async function ae(d){var r,p;try{x.value=!0,j.value=`正在识别 ${d} ...`,$.value=0,_.value=await ue.get("media/recognize_file",{params:{path:d}}),x.value=!1,_.value||P.error(`${d} 识别失败！`),v.value=!!((p=(r=_.value)==null?void 0:r.meta_info)!=null&&p.name)}catch(T){console.error(T)}}const ve=m([{title:"识别",value:1,props:{prependIcon:"mdi-text-recognition",click:d=>{ae(d.path||"")}}},{title:"重命名",value:2,props:{prependIcon:"mdi-rename",click:ie}},{title:"整理",value:3,props:{prependIcon:"mdi-folder-arrow-right",click:de}},{title:"删除",value:4,props:{prependIcon:"mdi-delete-outline",color:"error",click:re}}]);return Ve(()=>{H()}),(d,r)=>{var z;const p=le("IconBtn"),T=Xe;return o(),E(M,null,[e(G,{class:"d-flex flex-column"},{default:t(()=>[a(w)?(o(),c(D,{key:0,class:"text-center flex flex-col items-center"},{default:t(()=>[e(Ne,{size:"48",indeterminate:"",color:"primary"})]),_:1})):S("",!0),C.path?a(A)&&!a(ge)?(o(),c(D,{key:2,class:"text-center break-all"},{default:t(()=>{var l,X,k;return[Y("strong",null,L((l=a(b)[0])==null?void 0:l.name),1),at,V(" 大小："+L(a(Ce)(((X=a(b)[0])==null?void 0:X.size)||0)),1),ot,V(" 修改时间："+L(Be(((k=a(b)[0])==null?void 0:k.modify_time)||0)),1)]}),_:1})):a(A)&&a(ge)?(o(),c(D,{key:3,class:"grow d-flex justify-center align-center"},{default:t(()=>[e(qe,{src:Te(C.path),"max-width":"100%","max-height":"100%"},null,8,["src"])]),_:1})):a(y).length||a(B).length?(o(),c(D,{key:4,class:"p-0"},{default:t(()=>[a(y).length?(o(),c(Z,{key:0,subheader:""},{default:t(()=>[e(_e,null,{default:t(()=>[V("目录")]),_:1}),(o(!0),E(M,null,J(a(y),(l,X)=>(o(),c(ee,{key:X,class:"px-3 pe-1",onClick:k=>he(l.path)},{prepend:t(()=>[e(g,{icon:"mdi-folder-outline"})]),append:t(()=>[e(p,{class:"d-sm-none"},{default:t(()=>[e(g,{icon:"mdi-dots-vertical"}),e(pe,{activator:"parent","close-on-content-click":""},{default:t(()=>[e(Z,null,{default:t(()=>[(o(!0),E(M,null,J(a(ve),(k,ce)=>(o(),c(ee,{key:ce,variant:"plain","base-color":k.props.color,onClick:Le=>k.props.click(l)},{prepend:t(()=>[e(g,{icon:k.props.prependIcon},null,8,["icon"])]),default:t(()=>[e(te,{textContent:L(k.title)},null,8,["textContent"])]),_:2},1032,["base-color","onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024),e(p,{class:"d-none d-sm-block",onClick:F(k=>ae(l.path),["stop"])},{default:t(()=>[e(g,{icon:"mdi-text-recognition"})]),_:2},1032,["onClick"]),e(p,{class:"d-none d-sm-block",onClick:F(k=>ie(l),["stop"])},{default:t(()=>[e(g,{icon:"mdi-rename"})]),_:2},1032,["onClick"]),e(p,{class:"d-none d-sm-block",onClick:F(k=>de(l),["stop"])},{default:t(()=>[e(g,{icon:"mdi-folder-arrow-right"})]),_:2},1032,["onClick"]),e(p,{class:"d-none d-sm-block",onClick:F(k=>re(l),["stop"])},{default:t(()=>[e(g,{icon:"mdi-delete-outline"})]),_:2},1032,["onClick"])]),default:t(()=>[e(te,{textContent:L(l.name)},null,8,["textContent"])]),_:2},1032,["onClick"]))),128))]),_:1})):S("",!0),a(y).length&&a(B).length?(o(),c(se,{key:1})):S("",!0),a(B).length?(o(),c(Z,{key:2,subheader:""},{default:t(()=>[e(_e,null,{default:t(()=>[V("文件")]),_:1}),(o(!0),E(M,null,J(a(B),(l,X)=>(o(),c(ee,{key:X,class:"pl-3 pe-1",onClick:k=>he(l.path)},{prepend:t(()=>{var k;return[n.icons?(o(),c(g,{key:0,icon:n.icons[l.extension.toLowerCase()]||((k=n.icons)==null?void 0:k.other)},null,8,["icon"])):S("",!0)]}),append:t(()=>[e(p,{class:"d-sm-none"},{default:t(()=>[e(g,{icon:"mdi-dots-vertical"}),e(pe,{activator:"parent","close-on-content-click":""},{default:t(()=>[e(Z,null,{default:t(()=>[(o(!0),E(M,null,J(a(ve),(k,ce)=>(o(),c(ee,{key:ce,variant:"plain","base-color":k.props.color,onClick:Le=>k.props.click(l)},{prepend:t(()=>[e(g,{icon:k.props.prependIcon},null,8,["icon"])]),default:t(()=>[e(te,{textContent:L(k.title)},null,8,["textContent"])]),_:2},1032,["base-color","onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024),e(p,{class:"d-none d-sm-block",onClick:F(k=>ae(l.path),["stop"])},{default:t(()=>[e(g,{icon:"mdi-text-recognition"})]),_:2},1032,["onClick"]),e(p,{class:"d-none d-sm-block",onClick:F(k=>ie(l),["stop"])},{default:t(()=>[e(g,{icon:"mdi-rename"})]),_:2},1032,["onClick"]),e(p,{class:"d-none d-sm-block",onClick:F(k=>de(l),["stop"])},{default:t(()=>[e(g,{icon:"mdi-folder-arrow-right"})]),_:2},1032,["onClick"]),e(p,{class:"d-none d-sm-block",onClick:F(k=>re(l),["stop"])},{default:t(()=>[e(g,{icon:"mdi-delete-outline"})]),_:2},1032,["onClick"])]),default:t(()=>[e(te,{textContent:L(l.name)},null,8,["textContent"]),e(Ae,null,{default:t(()=>[V(L(a(Ce)(l.size)),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):S("",!0)]),_:1})):a(I)?(o(),c(D,{key:5,class:"grow d-flex justify-center align-center grey--text py-5"},{default:t(()=>[V(" 没有目录或文件 ")]),_:1})):a(w)?S("",!0):(o(),c(D,{key:6,class:"grow d-flex justify-center align-center grey--text py-5"},{default:t(()=>[V(" 空目录 ")]),_:1})):(o(),c(D,{key:1,class:"grow d-flex justify-center align-center grey--text"},{default:t(()=>[V(" 选择目录或文件 ")]),_:1})),C.path?(o(),c(se,{key:7})):S("",!0),a(w)?S("",!0):(o(),c(me,{key:8,density:"compact",flat:"",color:"gray"},{default:t(()=>[a(A)?S("",!0):(o(),c(fe,{key:0,modelValue:a(I),"onUpdate:modelValue":r[0]||(r[0]=l=>W(I)?I.value=l:null),"hide-details":"",flat:"",density:"compact",variant:"solo-filled",placeholder:"搜索 ...","prepend-inner-icon":"mdi-filter-outline",class:"me-2"},null,8,["modelValue"])),a(A)?(o(),c(ke,{key:1})):S("",!0),a(A)?(o(),c(p,{key:2,onClick:r[1]||(r[1]=l=>ae(n.path||""))},{default:t(()=>[e(g,{color:"primary"},{default:t(()=>[V(" mdi-text-recognition ")]),_:1})]),_:1})):S("",!0),a(A)?(o(),c(p,{key:3,onClick:r[2]||(r[2]=l=>je(n.path||""))},{default:t(()=>[e(g,{color:"primary"},{default:t(()=>[V(" mdi-download ")]),_:1})]),_:1})):S("",!0),a(A)?S("",!0):(o(),c(p,{key:4,onClick:H},{default:t(()=>[e(g,{color:"primary"},{default:t(()=>[V(" mdi-refresh ")]),_:1})]),_:1}))]),_:1}))]),_:1}),e(oe,{modelValue:a(h),"onUpdate:modelValue":r[5]||(r[5]=l=>W(h)?h.value=l:null),"max-width":"50rem"},{default:t(()=>[e(G,{title:"重命名"},{default:t(()=>[e(D,null,{default:t(()=>[e(fe,{modelValue:a(s),"onUpdate:modelValue":r[3]||(r[3]=l=>W(s)?s.value=l:null),label:"名称"},null,8,["modelValue"])]),_:1}),e(be,null,{default:t(()=>[e(q,{depressed:"",onClick:r[4]||(r[4]=l=>h.value=!1)},{default:t(()=>[V(" 取消 ")]),_:1}),e(ke),e(q,{disabled:!a(s),depressed:"",variant:"tonal",onClick:Pe},{default:t(()=>[V(" 重命名 ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Je,{modelValue:a(i),"onUpdate:modelValue":r[6]||(r[6]=l=>W(i)?i.value=l:null),path:(z=a(u))==null?void 0:z.path,onDone:r[7]||(r[7]=l=>{i.value=!1,H()}),onClose:r[8]||(r[8]=l=>i.value=!1)},null,8,["modelValue","path"]),e(oe,{modelValue:a(x),"onUpdate:modelValue":r[9]||(r[9]=l=>W(x)?x.value=l:null),scrim:!1,width:"25rem"},{default:t(()=>[e(G,{color:"primary"},{default:t(()=>[e(D,{class:"text-center"},{default:t(()=>[V(L(a(j))+" ",1),a($)?(o(),c(We,{key:0,color:"white",class:"mb-0 mt-1","model-value":a($)},null,8,["model-value"])):S("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(oe,{modelValue:a(v),"onUpdate:modelValue":r[11]||(r[11]=l=>W(v)?v.value=l:null),width:"50rem"},{default:t(()=>[e(G,null,{default:t(()=>[e(T,{onClick:r[10]||(r[10]=l=>v.value=!1)}),e(Ee,null,{default:t(()=>[e(Ke,{context:a(_)},null,8,["context"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}});const st=Ie(lt,[["__scopeId","data-v-a3ea397a"]]),rt=K({__name:"FileBrowser",props:{storages:String,storage:String,path:String,tree:Boolean,endpoints:Object,axios:Object,axiosconfig:Object},emits:["pathchanged"],setup(C,{emit:f}){const n=C,P=[{name:"本地",code:"local",icon:"mdi-folder-multiple-outline"}],w={zip:"mdi-folder-zip-outline",rar:"mdi-folder-zip-outline",htm:"mdi-language-html5",html:"mdi-language-html5",js:"mdi-nodejs",json:"mdi-file-document-outline",md:"mdi-language-markdown-outline",pdf:"mdi-file-pdf",png:"mdi-file-image",jpg:"mdi-file-image",jpeg:"mdi-file-image",mp4:"mdi-filmstrip",mkv:"mdi-filmstrip",avi:"mdi-filmstrip",wmv:"mdi-filmstrip",mov:"mdi-filmstrip",txt:"mdi-file-document-outline",xls:"mdi-file-excel",other:"mdi-file-outline"},x=m(0),j=m("local"),$=m(!1),O=m("name"),U=m(),R=N(()=>{var u;const s=(u=n.storages)==null?void 0:u.split(",");return P.filter(_=>s==null?void 0:s.includes(_.code))});function b(s){}function I(s){j.value=s}function h(s){f("pathchanged",s)}function i(s){O.value=s,$.value=!0}return $e(()=>{j.value=n.storage??"local",U.value=n.axios??we.create(n.axiosconfig)}),(s,u)=>(o(),c(G,{class:"mx-auto",loading:a(x)>0},{default:t(()=>[e(Ze,{path:n.path,storages:a(R),storage:a(j),endpoints:n.endpoints,axios:a(U),onStoragechanged:I,onPathchanged:h,onFoldercreated:u[0]||(u[0]=_=>$.value=!0),onSortchanged:i},null,8,["path","storages","storage","endpoints","axios"]),e(He,{"no-gutters":""},{default:t(()=>[C.tree?(o(),c(ye,{key:0,sm:"auto",class:"d-none d-md-block"},{default:t(()=>[e(nt,{path:n.path,storage:a(j),icons:w,endpoints:C.endpoints,axios:a(U),refreshpending:a($),onPathchanged:h,onLoading:b,onRefreshed:u[1]||(u[1]=_=>$.value=!1)},null,8,["path","storage","endpoints","axios","refreshpending"])]),_:1})):S("",!0),C.tree?(o(),c(se,{key:1,vertical:""})):S("",!0),e(ye,null,{default:t(()=>[e(st,{path:n.path,storage:a(j),icons:w,endpoints:C.endpoints,axios:a(U),refreshpending:a($),sort:a(O),onPathchanged:h,onLoading:b,onRefreshed:u[2]||(u[2]=_=>$.value=!1),onFiledeleted:u[3]||(u[3]=_=>$.value=!0),onRenamed:u[4]||(u[4]=_=>$.value=!0)},null,8,["path","storage","endpoints","axios","refreshpending","sort"])]),_:1})]),_:1})]),_:1},8,["loading"]))}}),it=K({__name:"FileBrowserView",setup(C){const f={list:{url:"/filebrowser/list?path={path}&sort={sort}",method:"get"},mkdir:{url:"/filebrowser/mkdir?path={path}",method:"get"},delete:{url:"/filebrowser/delete?path={path}",method:"get"},download:{url:"/filebrowser/download?path={path}",method:"get"},image:{url:"/filebrowser/image?path={path}",method:"get"},rename:{url:"/filebrowser/rename?path={path}&new_name={newname}",method:"get"}},n=m("/");async function P(){var x;try{const j=await ue.get("system/env");j.success&&(n.value=((x=j.data)==null?void 0:x.DOWNLOAD_PATH)||"/"),n.value&&!n.value.endsWith("/")&&(n.value+="/")}catch(j){console.log(j)}}function w(x){n.value=x}return $e(async()=>{await P()}),(x,j)=>(o(),E("div",null,[e(rt,{storages:"local",tree:!1,path:a(n),endpoints:f,axios:a(ue),onPathchanged:w},null,8,["path","axios"])]))}}),vt=K({__name:"filemanager",setup(C){return(f,n)=>(o(),c(it))}});export{vt as default};
