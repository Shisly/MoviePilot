import{a as T}from"./index-57fabd3c.js";import{_ as W}from"./NoDataFound.vue_vue_type_script_setup_true_lang-4c78e798.js";import{d as R,af as Y,r as h,o as a,f as c,i as t,a as B,m as l,ag as ee,n as H,j as i,W as le,aC as te,J as C,t as b,ab as ne,A as z,O as ue,z as F,e as U,c as y,L as $,U as D,a9 as M,k as j,_ as w,aD as ce,M as X,V as N,ac as pe,a1 as de,Q as ge,R as me,$ as _e,X as fe,Z as ve,aa as he,G as Z,I as S,H as G,E as J,p as q,ax as ye,a2 as Ve,aE as ke,aF as Ce,aG as we,K as $e}from"./index-0997a18b.js";import{_ as oe}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as xe}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-dfca3186.js";import{i as Pe}from"./index-d2c33d5a.js";const Ie=["href"],be=R({__name:"PluginAppCard",props:{plugin:Object,width:String,height:String},emits:["install"],setup(P,{emit:f}){const e=P,u=Y.useToast(),x=h(!1);async function p(){var g,d,s;try{const o=await T.get(`plugin/install/${(g=e.plugin)==null?void 0:g.id}`);o.success?(u.success(`插件 ${(d=e.plugin)==null?void 0:d.plugin_name} 安装成功！`),f("install")):u.error(`插件 ${(s=e.plugin)==null?void 0:s.plugin_name} 安装失败：${o.message}}`)}catch(o){console.error(o)}}return(g,d)=>(a(),c(F,{width:e.width,height:e.height,onClick:p},{default:t(()=>{var s;return[B("div",{class:"relative pa-4 text-center card-cover-blurred",style:te({background:`${(s=e.plugin)==null?void 0:s.plugin_color}`})},[l(le,{size:"8rem",class:H({shadow:i(x)})},{default:t(()=>{var o;return[l(ee,{src:`/plugin_icon/${(o=e.plugin)==null?void 0:o.plugin_icon}`,"aspect-ratio":"4/3",cover:"",onLoad:d[0]||(d[0]=V=>x.value=!0)},null,8,["src"])]}),_:1},8,["class"])],4),l(ne,null,{default:t(()=>{var o;return[C(b((o=e.plugin)==null?void 0:o.plugin_name),1)]}),_:1}),l(z,null,{default:t(()=>{var o;return[C(b((o=e.plugin)==null?void 0:o.plugin_desc),1)]}),_:1}),l(z,null,{default:t(()=>{var o,V;return[C(" 作者："),B("a",{href:(o=e.plugin)==null?void 0:o.author_url,target:"_blank",onClick:d[1]||(d[1]=ue(()=>{},["stop"]))},b((V=e.plugin)==null?void 0:V.plugin_author),9,Ie)]}),_:1})]}),_:1},8,["width","height"]))}});const Le=oe(be,[["__scopeId","data-v-ec886703"]]),Te=R({__name:"FormRender",props:{config:Object,form:Object},setup(P){const f=P,e=h(f.config??{component:"div",text:"",html:"",props:{},content:[]}),u=h(f.form||{});return(x,p)=>{var d;const g=U("FormRender",!0);return a(),y($,null,[e.value.html?w("",!0):(a(),c(j(e.value.component),M({key:0},e.value.props,{modelValue:u.value[((d=e.value.props)==null?void 0:d.model)||""],"onUpdate:modelValue":p[0]||(p[0]=s=>{var o;return u.value[((o=e.value.props)==null?void 0:o.model)||""]=s})}),{default:t(()=>[C(b(e.value.text)+" ",1),(a(!0),y($,null,D(e.value.content||[],(s,o)=>{var V;return a(),c(g,{key:o,modelValue:u.value[((V=s.props)==null?void 0:V.model)||""],"onUpdate:modelValue":v=>{var O;return u.value[((O=s.props)==null?void 0:O.model)||""]=v},config:s,form:u.value},null,8,["modelValue","onUpdate:modelValue","config","form"])}),128))]),_:1},16,["modelValue"])),e.value.html?(a(),c(j(e.value.component),M({key:1},e.value.props,{innerHTML:e.value.html}),null,16,["innerHTML"])):w("",!0)],64)}}}),Be=R({__name:"PageRender",props:{config:Object},setup(P){const e=h(P.config??{component:"div",text:"",html:"",props:{},content:[]});return(u,x)=>{const p=U("PageRender",!0);return a(),y($,null,[e.value.html?w("",!0):(a(),c(j(e.value.component),ce(M({key:0},e.value.props)),{default:t(()=>[C(b(e.value.text)+" ",1),(a(!0),y($,null,D(e.value.content||[],(g,d)=>(a(),c(p,{key:d,config:g},null,8,["config"]))),128))]),_:1},16)),e.value.html?(a(),c(j(e.value.component),M({key:1},e.value.props,{innerHTML:e.value.html}),null,16,["innerHTML"])):w("",!0)],64)}}}),De={class:"me-n3 absolute top-0 right-3"},Se=R({__name:"PluginCard",props:{plugin:Object,width:String,height:String},emits:["remove","save"],setup(P,{emit:f}){var K;const e=P,u=Y.useToast(),x=h(!0),p=h(!1),g=h({});let d=X([]);const s=h(!1);let o=X([]);const V=h(!1);async function v(){var m,n,L;try{const k=await T.delete(`plugin/${(m=e.plugin)==null?void 0:m.id}`);k.success?(u.success(`插件 ${(n=e.plugin)==null?void 0:n.plugin_name} 已卸载`),f("remove")):u.error(`插件 ${(L=e.plugin)==null?void 0:L.plugin_name} 卸载失败：${k.message}}`)}catch(k){console.error(k)}}async function O(){var m;try{const n=await T.get(`plugin/form/${(m=e.plugin)==null?void 0:m.id}`);n&&(d=n.conf,n.model&&(g.value=n.model))}catch(n){console.error(n)}}async function ae(){var m;try{const n=await T.get(`plugin/page/${(m=e.plugin)==null?void 0:m.id}`);n&&(o=n)}catch(n){console.error(n)}}async function se(){var m;try{const n=await T.get(`plugin/${(m=e.plugin)==null?void 0:m.id}`);Pe(n)||(g.value=n)}catch(n){console.error(n)}}async function re(){var m,n,L;try{const k=await T.put(`plugin/${(m=e.plugin)==null?void 0:m.id}`,g.value);k.success?(u.success(`插件 ${(n=e.plugin)==null?void 0:n.plugin_name} 配置已保存`),p.value=!1,f("save")):u.error(`插件 ${(L=e.plugin)==null?void 0:L.plugin_name} 配置保存失败：${k.message}}`)}catch(k){console.error(k)}}async function A(){await ae(),p.value=!1,s.value=!0}async function E(){await O(),await se(),s.value=!1,p.value=!0}const ie=h([{title:"查看详情",value:1,show:(K=e.plugin)==null?void 0:K.has_page,props:{prependIcon:"mdi-information-outline",click:A}},{title:"配置",value:2,show:!0,props:{prependIcon:"mdi-cog-outline",click:E}},{title:"卸载",value:3,show:!0,props:{prependIcon:"mdi-trash-can-outline",color:"error",click:v}}]);return(m,n)=>{const L=U("IconBtn"),k=xe,Q=U("VBottomSheet");return a(),y($,null,[i(x)?(a(),c(F,{key:0,width:e.width,height:e.height,onClick:n[0]||(n[0]=()=>{var _;(_=e.plugin)!=null&&_.has_page?A():E()})},{default:t(()=>{var _;return[B("div",{class:"relative pa-4 text-center card-cover-blurred",style:te({background:`${(_=e.plugin)==null?void 0:_.plugin_color}`})},[B("div",De,[l(L,null,{default:t(()=>[l(N,{icon:"mdi-dots-vertical",class:"text-white"}),l(pe,{activator:"parent","close-on-content-click":""},{default:t(()=>[l(de,null,{default:t(()=>[(a(!0),y($,null,D(i(ie),(r,I)=>ge((a(),c(_e,{key:I,variant:"plain","base-color":r.props.color,onClick:r.props.click},{prepend:t(()=>[l(N,{icon:r.props.prependIcon},null,8,["icon"])]),default:t(()=>[l(fe,{textContent:b(r.title)},null,8,["textContent"])]),_:2},1032,["base-color","onClick"])),[[me,r.show]])),128))]),_:1})]),_:1})]),_:1})]),l(le,{size:"8rem",class:H({shadow:i(V)})},{default:t(()=>{var r;return[l(ee,{src:`/plugin_icon/${(r=e.plugin)==null?void 0:r.plugin_icon}`,"aspect-ratio":"4/3",cover:"",class:H({shadow:i(V)})},null,8,["src","class"])]}),_:1},8,["class"])],4),l(he,{class:"py-2"},{default:t(()=>[l(ne,{class:"flex items-center flex-row"},{default:t(()=>{var r,I;return[(r=e.plugin)!=null&&r.state?(a(),c(ve,{key:0,dot:"",inline:"",color:"success",class:"me-1 mb-1"})):w("",!0),C(" "+b((I=e.plugin)==null?void 0:I.plugin_name),1)]}),_:1})]),_:1}),l(z,null,{default:t(()=>{var r;return[C(b((r=e.plugin)==null?void 0:r.plugin_desc),1)]}),_:1})]}),_:1},8,["width","height"])):w("",!0),l(Q,{modelValue:i(p),"onUpdate:modelValue":n[2]||(n[2]=_=>J(p)?p.value=_:null),scrollable:"",inset:""},{default:t(()=>{var _;return[l(F,{title:`${(_=e.plugin)==null?void 0:_.plugin_name} - 配置`,class:"rounded-t"},{default:t(()=>[l(k,{onClick:n[1]||(n[1]=r=>p.value=!1)}),l(z,null,{default:t(()=>[(a(!0),y($,null,D(i(d),(r,I)=>(a(),c(Te,{key:I,config:r,form:i(g)},null,8,["config","form"]))),128))]),_:1}),l(Z,null,{default:t(()=>[i(o).length>0?(a(),c(S,{key:0,onClick:A},{default:t(()=>[C(" 查看详情 ")]),_:1})):w("",!0),l(G),l(S,{variant:"tonal",onClick:re},{default:t(()=>[C(" 保存 ")]),_:1})]),_:1})]),_:1},8,["title"])]}),_:1},8,["modelValue"]),l(Q,{modelValue:i(s),"onUpdate:modelValue":n[5]||(n[5]=_=>J(s)?s.value=_:null),scrollable:"",inset:""},{default:t(()=>{var _;return[l(F,{title:`${(_=e.plugin)==null?void 0:_.plugin_name}`,class:"rounded-t"},{default:t(()=>[l(k,{onClick:n[3]||(n[3]=r=>s.value=!1)}),l(z,null,{default:t(()=>[(a(!0),y($,null,D(i(o),(r,I)=>(a(),c(Be,{key:I,config:r},null,8,["config"]))),128))]),_:1}),l(Z,null,{default:t(()=>[l(S,{onClick:E},{default:t(()=>[C(" 配置 ")]),_:1}),l(G),l(S,{variant:"tonal",onClick:n[4]||(n[4]=r=>s.value=!1)},{default:t(()=>[C(" 关闭 ")]),_:1})]),_:1})]),_:1},8,["title"])]}),_:1},8,["modelValue"])],64)}}});const Re=oe(Se,[["__scopeId","data-v-d362d086"]]),ze={key:0,class:"mt-12 w-full text-center text-gray-500 text-sm flex flex-col items-center"},Fe={key:1,class:"grid gap-4 grid-plugin-card"},Me={class:"pa-4"},Oe={class:"grid gap-4 grid-plugin-card"},Ue=R({__name:"PluginCardListView",setup(P){const f=h([]),e=h(!1),u=h(!1),x=q(()=>f.value.filter(o=>o.installed)),p=q(()=>f.value.filter(o=>!o.installed));function g(){u.value=!1}function d(){s(),g()}async function s(){try{f.value=await T.get("plugin/"),e.value=!0}catch(o){console.error(o)}}return ye(s),(o,V)=>(a(),y($,null,[i(e)?w("",!0):(a(),y("div",ze,[i(e)?w("",!0):(a(),c(Ve,{key:0,size:"48",indeterminate:"",color:"primary"}))])),i(x).length>0?(a(),y("div",Fe,[(a(!0),y($,null,D(i(x),v=>(a(),c(Re,{key:v.id,plugin:v,onRemove:s,onSave:s},null,8,["plugin"]))),128))])):w("",!0),i(x).length===0&&i(e)?(a(),c(W,{key:2,"error-code":"404","error-title":"没有安装插件","error-description":"点击右下角按钮，前往插件市场安装插件。"})):w("",!0),l($e,{modelValue:i(u),"onUpdate:modelValue":V[0]||(V[0]=v=>J(u)?u.value=v:null),fullscreen:"",scrim:!1,transition:"dialog-bottom-transition"},{activator:t(({props:v})=>[l(S,M({icon:"mdi-plus"},v,{size:"x-large",class:"fixed right-5 bottom-5"}),null,16)]),default:t(()=>[l(F,null,{default:t(()=>[B("div",null,[l(ke,{color:"primary"},{default:t(()=>[l(Ce,null,{default:t(()=>[C("插件市场")]),_:1}),l(G),l(we,null,{default:t(()=>[l(S,{size:"x-large",onClick:g},{default:t(()=>[l(N,{color:"white",icon:"mdi-close"})]),_:1})]),_:1})]),_:1})]),B("div",Me,[B("div",Oe,[(a(!0),y($,null,D(i(p),v=>(a(),c(Le,{key:v.id,plugin:v,onInstall:d},null,8,["plugin"]))),128))]),i(p).length===0&&i(e)?(a(),c(W,{key:0,"error-code":"404","error-title":"没有未安装插件","error-description":"所有可用插件均已安装。"})):w("",!0)])]),_:1})]),_:1},8,["modelValue"])],64))}});const Je=R({__name:"plugin",setup(P){return(f,e)=>(a(),c(Ue))}});export{Je as default};
