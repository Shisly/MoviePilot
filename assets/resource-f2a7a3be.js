import{d as Y,an as re,ao as ie,r as h,q as le,e as ue,o,f as m,ap as de,j as t,i as a,m as r,U as ce,a3 as me,a as U,V as X,aa as pe,a9 as fe,c as z,a2 as K,a7 as ve,a4 as ye,t as w,M as G,Y as ge,K as V,X as Z,B as ee,_ as $,W as f,n as he,I as _e,P as te,G as we,R as ke,S as Ve,a8 as xe,aq as be,a6 as se,a0 as Ce,A as oe,a1 as M,ar as $e,as as ze,N as Se,at as Te,au as ae,C as Ie,av as T,D as I,aw as De,b as Fe}from"./index-6958f571.js";import{a as Le}from"./formatters-080fb386.js";import{_ as Oe}from"./NoDataFound.vue_vue_type_style_index_0_lang-e90a023f.js";const Be={class:"text-green-700 ms-2 text-sm"},Pe={class:"text-orange-700 ms-2 text-sm"},Ee={class:"me-n3"},Ne=Y({__name:"TorrentCard",props:{torrent:Object,more:Array,width:String,height:String},setup(q){var A,R,W;const v=q,x=re.useToast(),D=ie(),k=h(!1),i=h((A=v.torrent)==null?void 0:A.torrent_info),b=h((R=v.torrent)==null?void 0:R.media_info),_=h((W=v.torrent)==null?void 0:W.meta_info),d=h("");async function F(){var y;try{d.value=(await M.get(`site/icon/${(y=i==null?void 0:i.value)==null?void 0:y.site}`)).data.icon}catch(u){console.error(u)}}async function L(y=void 0,u=void 0,l=void 0){var e;(!u||!l||!y)&&(y=(e=i.value)==null?void 0:e.site_name,u=b.value,l=i.value),await D({title:"确认",content:`是否确认下载【${y}】${l==null?void 0:l.title} ?`,confirmationText:"确认",cancellationText:"取消",dialogProps:{maxWidth:600}})&&O(u,l)}async function O(y,u){$e();try{(await M.post("download",{media_in:y,torrent_in:u})).success?x.success(`${u==null?void 0:u.site_name} ${u==null?void 0:u.title} 添加下载成功！`):x.error(`${u==null?void 0:u.site_name} ${u==null?void 0:u.title} 添加下载失败！`)}catch(l){console.error(l)}ze()}function B(){var y;window.open((y=i.value)==null?void 0:y.page_url,"_blank")}async function P(){var y;window.open((y=i.value)==null?void 0:y.enclosure,"_blank")}function E(y,u){return y===0?"text-white bg-lime-500":y<1?"text-white bg-green-500":u!==1?"text-white bg-sky-500":"text-white bg-gray-500"}le(()=>{F()});const N=h([{title:"查看详情",value:1,props:{prependIcon:"mdi-information",click:B}},{title:"下载种子",value:2,props:{prependIcon:"mdi-download",click:P}}]);return(y,u)=>{const l=ue("IconBtn");return o(),m(oe,{width:v.width,height:v.height,onClick:L},de({default:a(()=>{var s;return[r(Z,{class:"py-1"},{append:a(()=>[U("div",Ee,[r(l,null,{default:a(()=>[r(X,{icon:"mdi-dots-vertical"}),r(pe,{activator:"parent","close-on-content-click":""},{default:a(()=>[r(fe,null,{default:a(()=>[(o(!0),z(G,null,K(t(N),(e,n)=>(o(),m(ve,{key:n,variant:"plain",onClick:e.props.click},{prepend:a(()=>[r(X,{icon:e.props.prependIcon},null,8,["icon"])]),default:a(()=>[r(ye,{textContent:w(e.title)},null,8,["textContent"])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1})])]),default:a(()=>[r(ge,null,{default:a(()=>{var e,n,p,c;return[V(w((e=t(b))==null?void 0:e.title)+" "+w((n=t(_))==null?void 0:n.season_episode)+" ",1),U("span",Be,"↑"+w((p=t(i))==null?void 0:p.seeders),1),U("span",Pe,"↓"+w((c=t(i))==null?void 0:c.peers),1)]}),_:1})]),_:1}),r(ee,{class:"text-subtitle-2"},{default:a(()=>{var e;return[V(w((e=t(i))==null?void 0:e.title),1)]}),_:1}),r(ee,null,{default:a(()=>{var e;return[V(w((e=t(i))==null?void 0:e.description),1)]}),_:1}),(s=t(i))!=null&&s.labels?(o(),m(Z,{key:0,class:"pb-3 pt-0 pe-12"},{default:a(()=>{var e,n,p,c,C,S,j,J,H,Q;return[(o(!0),z(G,null,K((e=t(i))==null?void 0:e.labels,(g,ne)=>(o(),m($,{key:ne,variant:"elevated",size:"small",color:"primary",class:"me-1 mb-1"},{default:a(()=>[V(w(g),1)]),_:2},1024))),128)),(n=t(_))!=null&&n.edition?(o(),m($,{key:0,variant:"elevated",size:"small",class:"me-1 mb-1 text-white bg-red-500"},{default:a(()=>{var g;return[V(w((g=t(_))==null?void 0:g.edition),1)]}),_:1})):f("",!0),(p=t(_))!=null&&p.resource_pix?(o(),m($,{key:1,variant:"elevated",size:"small",class:"me-1 mb-1 text-white bg-red-500"},{default:a(()=>{var g;return[V(w((g=t(_))==null?void 0:g.resource_pix),1)]}),_:1})):f("",!0),(c=t(_))!=null&&c.video_encode?(o(),m($,{key:2,variant:"elevated",size:"small",class:"me-1 mb-1 text-white bg-orange-500"},{default:a(()=>{var g;return[V(w((g=t(_))==null?void 0:g.video_encode),1)]}),_:1})):f("",!0),(C=t(i))!=null&&C.size?(o(),m($,{key:3,variant:"elevated",size:"small",class:"me-1 mb-1 text-white bg-yellow-500"},{default:a(()=>{var g;return[V(w(t(Le)((g=t(i))==null?void 0:g.size)),1)]}),_:1})):f("",!0),(S=t(_))!=null&&S.resource_team?(o(),m($,{key:4,variant:"elevated",size:"small",class:"me-1 mb-1 text-white bg-cyan-500"},{default:a(()=>{var g;return[V(w((g=t(_))==null?void 0:g.resource_team),1)]}),_:1})):f("",!0),((j=t(i))==null?void 0:j.downloadvolumefactor)!==1||((J=t(i))==null?void 0:J.uploadvolumefactor)!==1?(o(),m($,{key:5,class:he([E((H=t(i))==null?void 0:H.downloadvolumefactor,(Q=t(i))==null?void 0:Q.uploadvolumefactor),"me-1 mb-1"]),variant:"elevated",size:"small"},{default:a(()=>{var g;return[V(w((g=t(i))==null?void 0:g.volume_factor),1)]}),_:1},8,["class"])):f("",!0)]}),_:1})):f("",!0),r(we,null,{default:a(()=>[v.more&&v.more.length>0?(o(),m(_e,{key:0,onClick:u[0]||(u[0]=te(e=>k.value=!t(k),["stop"]))},{append:a(()=>[r(X,{icon:t(k)?"mdi-chevron-up":"mdi-chevron-down"},null,8,["icon"])]),default:a(()=>[V(" 更多来源 ")]),_:1})):f("",!0)]),_:1}),r(Ce,null,{default:a(()=>[ke(U("div",null,[r(xe),r(be,{class:"p-3"},{default:a(()=>[(o(!0),z(G,null,K(v.more,(e,n)=>(o(),m($,{key:n,onClick:te(p=>{var c;return L((c=e.torrent_info)==null?void 0:c.site_name,e.media_info,e.torrent_info)},["stop"])},{append:a(()=>{var p,c,C,S;return[r(se,{color:"primary",content:`↑${(p=e.torrent_info)==null?void 0:p.seeders}`,inline:"",size:"small"},null,8,["content"]),((c=e.torrent_info)==null?void 0:c.downloadvolumefactor)!==1||((C=e.torrent_info)==null?void 0:C.uploadvolumefactor)!==1?(o(),m(se,{key:0,content:(S=e.torrent_info)==null?void 0:S.volume_factor,inline:"",size:"small"},null,8,["content"])):f("",!0)]}),default:a(()=>[V(" "+w(e.torrent_info.site_name),1)]),_:2},1032,["onClick"]))),128))]),_:1})],512),[[Ve,t(k)]])]),_:1})]}),_:2},[t(k)?void 0:{name:"image",fn:a(()=>[r(me,{class:"absolute right-2 bottom-2 rounded",variant:"flat",rounded:"0"},{default:a(()=>[r(ce,{src:t(d)},null,8,["src"])]),_:1})]),key:"0"}]),1032,["width","height"])}}}),Ue={key:0,class:"mt-12 w-full text-center text-gray-500 text-sm flex flex-col items-center"},Ge={key:1,class:"grid gap-3 grid-torrent-card items-start"},Me=Y({__name:"TorrentCardListView",props:{keyword:String,type:String},setup(q){const v=q,x=h([]),D=h(),k=h(!1),i=h(""),b=h(0),_=h(),d=Se({site:[],season:[],releaseGroup:[],videoCode:[],freeState:[],edition:[],resolution:[]}),F=h([]),L=h([]),O=h([]),B=h([]),P=h([]),E=h([]),N=h([]);Te(()=>{var s;x.value.splice(0);const l=(e,n)=>e.length===0||n&&e.includes(n);(s=D.value)==null||s.forEach(e=>{if(e.length>0){const n=e.filter(p=>{const{meta_info:c,torrent_info:C}=p,{season_episode:S,resource_team:j,video_encode:J}=c;return l(d.site,C.site_name)&&l(d.freeState,C.volume_factor)&&l(d.season,S)&&l(d.releaseGroup,j)&&l(d.videoCode,J)&&l(d.resolution,c.resource_pix)&&l(d.edition,c.edition)});if(n.length>0){const p=n[0];n.length>1&&(p.more=n.slice(1)),x.value.push(p)}}})});async function A(){var l,s;try{let e;const n=v.keyword??"",p=v.type??"";return n?(y(),((l=v.keyword)==null?void 0:l.startsWith("tmdb:"))||((s=v.keyword)==null?void 0:s.startsWith("douban:"))?e=await M.get(`search/media/${v.keyword}`,{params:{mtype:p}}):e=await M.get(`search/title/${v.keyword}`),u()):e=await M.get("search/last"),k.value=!0,Promise.resolve(e)}catch(e){return console.error(e),Promise.reject(e)}}function R(){A().then(l=>{const s=new Map;l.forEach(e=>{const{torrent_info:n}=e;W(e);const p=`${n.title}_${n.size}`;if(s.has(p)){const c=s.get(p);c==null||c.push(e)}else s.set(p,[e])}),D.value=s})}function W(l){const{torrent_info:s,meta_info:e}=l,n=(p,c)=>{c&&!p.includes(c)&&p.push(c)};n(F.value,s==null?void 0:s.site_name),n(L.value,e==null?void 0:e.season_episode),n(O.value,e==null?void 0:e.resource_team),n(B.value,e==null?void 0:e.video_encode),n(P.value,s==null?void 0:s.volume_factor),n(E.value,e==null?void 0:e.edition),n(N.value,e==null?void 0:e.resource_pix)}function y(){i.value="正在搜索，请稍候...";const l=De.state.auth.token;_.value=new EventSource(`/api/v1/system/progress/search?token=${l}`),_.value.onmessage=s=>{const e=JSON.parse(s.data);e&&(i.value=e.text,b.value=e.value)}}function u(){var l;(l=_.value)==null||l.close()}return le(R),(l,s)=>(o(),z(G,null,[r(oe,{class:"bg-transparent mb-3 pt-2 shadow-none"},{default:a(()=>[r(Ie,null,{default:a(()=>[F.value.length>0?(o(),m(I,{key:0,cols:"6",md:""},{default:a(()=>[r(T,{modelValue:t(d).site,"onUpdate:modelValue":s[0]||(s[0]=e=>t(d).site=e),items:F.value,size:"small",density:"compact",chips:"",label:"站点",multiple:""},null,8,["modelValue","items"])]),_:1})):f("",!0),L.value.length>0?(o(),m(I,{key:1,cols:"6",md:""},{default:a(()=>[r(T,{modelValue:t(d).season,"onUpdate:modelValue":s[1]||(s[1]=e=>t(d).season=e),items:L.value,size:"small",density:"compact",chips:"",label:"季集",multiple:""},null,8,["modelValue","items"])]),_:1})):f("",!0),O.value.length>0?(o(),m(I,{key:2,cols:"6",md:""},{default:a(()=>[r(T,{modelValue:t(d).releaseGroup,"onUpdate:modelValue":s[2]||(s[2]=e=>t(d).releaseGroup=e),items:O.value,size:"small",density:"compact",chips:"",label:"制作组",multiple:""},null,8,["modelValue","items"])]),_:1})):f("",!0),E.value.length>0?(o(),m(I,{key:3,cols:"6",md:""},{default:a(()=>[r(T,{modelValue:t(d).edition,"onUpdate:modelValue":s[3]||(s[3]=e=>t(d).edition=e),items:E.value,size:"small",density:"compact",chips:"",label:"质量",multiple:""},null,8,["modelValue","items"])]),_:1})):f("",!0),N.value.length>0?(o(),m(I,{key:4,cols:"6",md:""},{default:a(()=>[r(T,{modelValue:t(d).resolution,"onUpdate:modelValue":s[4]||(s[4]=e=>t(d).resolution=e),items:N.value,size:"small",density:"compact",chips:"",label:"分辨率",multiple:""},null,8,["modelValue","items"])]),_:1})):f("",!0),B.value.length>0?(o(),m(I,{key:5,cols:"6",md:""},{default:a(()=>[r(T,{modelValue:t(d).videoCode,"onUpdate:modelValue":s[5]||(s[5]=e=>t(d).videoCode=e),items:B.value,size:"small",density:"compact",chips:"",label:"视频编码",multiple:""},null,8,["modelValue","items"])]),_:1})):f("",!0),P.value.length>0?(o(),m(I,{key:6,cols:"6",md:""},{default:a(()=>[r(T,{modelValue:t(d).freeState,"onUpdate:modelValue":s[6]||(s[6]=e=>t(d).freeState=e),items:P.value,size:"small",density:"compact",chips:"",label:"促销状态",multiple:""},null,8,["modelValue","items"])]),_:1})):f("",!0)]),_:1})]),_:1}),k.value?f("",!0):(o(),z("div",Ue,[v.keyword?f("",!0):(o(),m(ae,{key:0,size:"48",indeterminate:"",color:"primary"})),v.keyword?(o(),m(ae,{key:1,class:"mb-3",color:"primary","model-value":b.value,size:"64"},null,8,["model-value"])):f("",!0),U("span",null,w(i.value),1)])),x.value.length>0?(o(),z("div",Ge,[(o(!0),z(G,null,K(x.value,e=>(o(),m(Ne,{key:`${e.torrent_info.title}_${e.torrent_info.site}`,torrent:e,more:e.more},null,8,["torrent","more"]))),128))])):f("",!0),x.value.length===0&&k.value?(o(),m(Oe,{key:2,"error-code":"404","error-title":"没有资源","error-description":"没有搜索到符合条件的资源。"})):f("",!0)],64))}});const We=Y({__name:"resource",setup(q){var k,i,b,_;const v=Fe(),x=((i=(k=v.query)==null?void 0:k.keyword)==null?void 0:i.toString())??"",D=((_=(b=v.query)==null?void 0:b.type)==null?void 0:_.toString())??"";return(d,F)=>(o(),z("div",null,[r(Me,{keyword:t(x),type:t(D)},null,8,["keyword","type"])]))}});export{We as default};
