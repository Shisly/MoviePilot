import{d as z,ao as q,r as v,o,f as c,i as t,a as T,m as l,U as J,n as A,j as r,a3 as Q,aC as Z,K as k,t as I,Y as ee,B as F,P as ie,A as R,a1 as B,e as G,c as C,a2 as D,M as w,z as j,k as O,aD as ue,W as $,N as K,V as M,aa as ce,a9 as pe,a7 as de,a4 as ge,a6 as me,X as fe,G as W,I as S,H as N,F as E,L as H,p as X,az as _e,av as ve,aE as he,aF as ye,aG as Ve}from"./index-5c0d31d7.js";import{_ as Y}from"./NoDataFound.vue_vue_type_script_setup_true_lang-d5b1b26b.js";import{_ as le}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as Ce}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-675e96f8.js";import{i as ke}from"./index-d2c33d5a.js";const xe=["href"],$e=z({__name:"PluginAppCard",props:{plugin:Object,width:String,height:String},emits:["install"],setup(b,{emit:f}){const e=b,u=q.useToast(),x=v(!1);async function p(){var g,d,s;try{const a=await B.get(`plugin/install/${(g=e.plugin)==null?void 0:g.id}`);a.success?(u.success(`插件 ${(d=e.plugin)==null?void 0:d.plugin_name} 安装成功！`),f("install")):u.error(`插件 ${(s=e.plugin)==null?void 0:s.plugin_name} 安装失败：${a.message}}`)}catch(a){console.error(a)}}return(g,d)=>(o(),c(R,{width:e.width,height:e.height,onClick:p},{default:t(()=>{var s;return[T("div",{class:"relative pa-4 text-center card-cover-blurred",style:Z({background:`${(s=e.plugin)==null?void 0:s.plugin_color}`})},[l(Q,{size:"128",class:A({shadow:r(x)})},{default:t(()=>{var a;return[l(J,{src:`/plugin/${(a=e.plugin)==null?void 0:a.plugin_icon}`,"aspect-ratio":"4/3",cover:"",onLoad:d[0]||(d[0]=h=>x.value=!0)},null,8,["src"])]}),_:1},8,["class"])],4),l(ee,null,{default:t(()=>{var a;return[k(I((a=e.plugin)==null?void 0:a.plugin_name),1)]}),_:1}),l(F,null,{default:t(()=>{var a;return[k(I((a=e.plugin)==null?void 0:a.plugin_desc),1)]}),_:1}),l(F,null,{default:t(()=>{var a,h;return[k(" 作者："),T("a",{href:(a=e.plugin)==null?void 0:a.author_url,target:"_blank",onClick:d[1]||(d[1]=ie(()=>{},["stop"]))},I((h=e.plugin)==null?void 0:h.plugin_author),9,xe)]}),_:1})]}),_:1},8,["width","height"]))}});const we=le($e,[["__scopeId","data-v-fa0d9baf"]]),be=z({__name:"FormRender",props:{config:Object,form:Object},setup(b){const f=b,e=v(f.config||{component:"div",text:"",props:{},content:[]}),u=v(f.form||{});return(x,p)=>{var d;const g=G("FormRender",!0);return o(),c(O(e.value.component),j(e.value.props,{modelValue:u.value[((d=e.value.props)==null?void 0:d.model)||""],"onUpdate:modelValue":p[0]||(p[0]=s=>{var a;return u.value[((a=e.value.props)==null?void 0:a.model)||""]=s})}),{default:t(()=>[k(I(e.value.text)+" ",1),(o(!0),C(w,null,D(e.value.content||[],(s,a)=>{var h;return o(),c(g,{key:a,modelValue:u.value[((h=s.props)==null?void 0:h.model)||""],"onUpdate:modelValue":_=>{var U;return u.value[((U=s.props)==null?void 0:U.model)||""]=_},config:s,form:u.value},null,8,["modelValue","onUpdate:modelValue","config","form"])}),128))]),_:1},16,["modelValue"])}}}),Pe=z({__name:"PageRender",props:{config:Object,handler:Boolean},setup(b){const e=v(b.config||{component:"div",text:"",html:"",props:{},content:[]});return(u,x)=>{const p=G("PageRender",!0);return o(),C(w,null,[e.value.html?$("",!0):(o(),c(O(e.value.component),ue(j({key:0},e.value.props)),{default:t(()=>[k(I(e.value.text)+" ",1),(o(!0),C(w,null,D(e.value.content||[],(g,d)=>(o(),c(p,{key:d,config:g},null,8,["config"]))),128))]),_:1},16)),e.value.html?(o(),c(O(e.value.component),j({key:1},e.value.props,{innerHTML:e.value.html}),null,16,["innerHTML"])):$("",!0)],64)}}}),Ie={class:"me-n3 absolute top-0 right-3"},Le=z({__name:"PluginCard",props:{plugin:Object,width:String,height:String},emits:["remove","save"],setup(b,{emit:f}){const e=b,u=q.useToast(),x=v(!0),p=v(!1),g=v({});let d=K([]);const s=v(!1);let a=K([]);const h=v(!1);async function _(){var m,n,L;try{const y=await B.delete(`plugin/${(m=e.plugin)==null?void 0:m.id}`);y.success?(u.success(`插件 ${(n=e.plugin)==null?void 0:n.plugin_name} 已卸载`),f("remove")):u.error(`插件 ${(L=e.plugin)==null?void 0:L.plugin_name} 卸载失败：${y.message}}`)}catch(y){console.error(y)}}async function U(){var m;try{const n=await B.get(`plugin/form/${(m=e.plugin)==null?void 0:m.id}`);n&&(d=n.conf,n.model&&(g.value=n.model))}catch(n){console.error(n)}}async function te(){var m;try{const n=await B.get(`plugin/page/${(m=e.plugin)==null?void 0:m.id}`);n&&(a=n)}catch(n){console.error(n)}}async function ne(){var m;try{const n=await B.get(`plugin/${(m=e.plugin)==null?void 0:m.id}`);ke(n)||(g.value=n)}catch(n){console.error(n)}}async function ae(){var m,n,L;try{const y=await B.put(`plugin/${(m=e.plugin)==null?void 0:m.id}`,g.value);y.success?(u.success(`插件 ${(n=e.plugin)==null?void 0:n.plugin_name} 配置已保存`),p.value=!1,f("save")):u.error(`插件 ${(L=e.plugin)==null?void 0:L.plugin_name} 配置保存失败：${y.message}}`)}catch(y){console.error(y)}}async function oe(){p.value=!1,s.value=!0}async function se(){await U(),await ne(),await te(),p.value=!0}const re=v([{title:"卸载",value:1,props:{prependIcon:"mdi-trash-can-outline",color:"error",click:_}}]);return(m,n)=>{const L=G("IconBtn"),y=Ce;return o(),C(w,null,[r(x)?(o(),c(R,{key:0,width:e.width,height:e.height,onClick:se},{default:t(()=>{var V;return[T("div",{class:"relative pa-4 text-center card-cover-blurred",style:Z({background:`${(V=e.plugin)==null?void 0:V.plugin_color}`})},[T("div",Ie,[l(L,null,{default:t(()=>[l(M,{icon:"mdi-dots-vertical",class:"text-white"}),l(ce,{activator:"parent","close-on-content-click":""},{default:t(()=>[l(pe,null,{default:t(()=>[(o(!0),C(w,null,D(r(re),(i,P)=>(o(),c(de,{key:P,variant:"plain","base-color":i.props.color,onClick:i.props.click},{prepend:t(()=>[l(M,{icon:i.props.prependIcon},null,8,["icon"])]),default:t(()=>[l(ge,{textContent:I(i.title)},null,8,["textContent"])]),_:2},1032,["base-color","onClick"]))),128))]),_:1})]),_:1})]),_:1})]),l(Q,{size:"128",class:A({shadow:r(h)})},{default:t(()=>{var i;return[l(J,{src:`/plugin/${(i=e.plugin)==null?void 0:i.plugin_icon}`,"aspect-ratio":"4/3",cover:"",class:A({shadow:r(h)})},null,8,["src","class"])]}),_:1},8,["class"])],4),l(fe,{class:"py-2"},{default:t(()=>[l(ee,{class:"flex items-center flex-row"},{default:t(()=>{var i,P;return[(i=e.plugin)!=null&&i.state?(o(),c(me,{key:0,dot:"",inline:"",color:"success",class:"me-1 mb-1"})):$("",!0),k(" "+I((P=e.plugin)==null?void 0:P.plugin_name),1)]}),_:1})]),_:1}),l(F,null,{default:t(()=>{var i;return[k(I((i=e.plugin)==null?void 0:i.plugin_desc),1)]}),_:1})]}),_:1},8,["width","height"])):$("",!0),l(H,{modelValue:r(p),"onUpdate:modelValue":n[1]||(n[1]=V=>E(p)?p.value=V:null),"max-width":"800",scrollable:"",persistent:""},{default:t(()=>{var V;return[l(R,{title:(V=e.plugin)==null?void 0:V.plugin_name},{default:t(()=>[l(y,{onClick:n[0]||(n[0]=i=>p.value=!1)}),l(F,null,{default:t(()=>[(o(!0),C(w,null,D(r(d),(i,P)=>(o(),c(be,{key:P,config:i,form:r(g)},null,8,["config","form"]))),128))]),_:1}),l(W,null,{default:t(()=>[r(a).length>0?(o(),c(S,{key:0,onClick:oe},{default:t(()=>[k(" 详情 ")]),_:1})):$("",!0),l(N),l(S,{onClick:ae},{default:t(()=>[k(" 保存 ")]),_:1})]),_:1})]),_:1},8,["title"])]}),_:1},8,["modelValue"]),l(H,{modelValue:r(s),"onUpdate:modelValue":n[4]||(n[4]=V=>E(s)?s.value=V:null),"max-width":"1000",scrollable:"",persistent:""},{default:t(()=>{var V;return[l(R,{title:`${(V=e.plugin)==null?void 0:V.plugin_name} - 详情`},{default:t(()=>[l(y,{onClick:n[2]||(n[2]=i=>s.value=!1)}),l(F,null,{default:t(()=>[(o(!0),C(w,null,D(r(a),(i,P)=>(o(),c(Pe,{key:P,config:i},null,8,["config"]))),128))]),_:1}),l(W,null,{default:t(()=>[l(N),l(S,{onClick:n[3]||(n[3]=i=>s.value=!1)},{default:t(()=>[k(" 关闭 ")]),_:1})]),_:1})]),_:1},8,["title"])]}),_:1},8,["modelValue"])],64)}}});const Be=le(Le,[["__scopeId","data-v-ad4bfbb0"]]),Te={key:0,class:"mt-12 w-full text-center text-gray-500 text-sm flex flex-col items-center"},De={key:1,class:"grid gap-4 grid-plugin-card"},ze={class:"pa-4"},Fe={class:"grid gap-4 grid-plugin-card"},Re=z({__name:"PluginCardListView",setup(b){const f=v([]),e=v(!1),u=v(!1),x=X(()=>f.value.filter(a=>a.installed)),p=X(()=>f.value.filter(a=>!a.installed));function g(){u.value=!1}function d(){s(),g()}async function s(){try{f.value=await B.get("plugin"),e.value=!0}catch(a){console.error(a)}}return _e(s),(a,h)=>(o(),C(w,null,[r(e)?$("",!0):(o(),C("div",Te,[r(e)?$("",!0):(o(),c(ve,{key:0,size:"48",indeterminate:"",color:"primary"}))])),r(x).length>0?(o(),C("div",De,[(o(!0),C(w,null,D(r(x),_=>(o(),c(Be,{key:_.id,plugin:_,onRemove:s,onSave:s},null,8,["plugin"]))),128))])):$("",!0),r(x).length===0&&r(e)?(o(),c(Y,{key:2,"error-code":"404","error-title":"没有安装插件","error-description":"点击右下角按钮，前往插件市场安装插件。"})):$("",!0),l(H,{modelValue:r(u),"onUpdate:modelValue":h[0]||(h[0]=_=>E(u)?u.value=_:null),fullscreen:"",scrim:!1,transition:"dialog-bottom-transition"},{activator:t(({props:_})=>[l(S,j({icon:"mdi-plus"},_,{size:"x-large",class:"fixed right-5 bottom-5"}),null,16)]),default:t(()=>[l(R,null,{default:t(()=>[T("div",null,[l(he,{color:"primary"},{default:t(()=>[l(ye,null,{default:t(()=>[k("插件市场")]),_:1}),l(N),l(Ve,null,{default:t(()=>[l(S,{size:"x-large",onClick:g},{default:t(()=>[l(M,{color:"white",icon:"mdi-close"})]),_:1})]),_:1})]),_:1})]),T("div",ze,[T("div",Fe,[(o(!0),C(w,null,D(r(p),_=>(o(),c(we,{key:_.id,plugin:_,onInstall:d},null,8,["plugin"]))),128))]),r(p).length===0&&r(e)?(o(),c(Y,{key:0,"error-code":"404","error-title":"没有未安装插件","error-description":"所有可用插件均已安装。"})):$("",!0)])]),_:1})]),_:1},8,["modelValue"])],64))}});const Me=z({__name:"plugin",setup(b){return(f,e)=>(o(),c(Re))}});export{Me as default};
