import{d as J,r as y,p as M,e as ne,o as r,f as p,i as t,m as e,aa as pe,I as L,aC as ze,aU as Me,V,a9 as Q,c as N,a2 as G,a7 as X,j as l,a4 as Y,K as C,t as O,M as A,W as S,aF as Ne,z as fe,A as q,B as R,E as D,F as W,G as me,L as le,aD as he,aW as $e,aX as Ie,a as K,w as Z,q as Se,P as z,a8 as oe,an as Ae,ao as We,aY as Ue,N as qe,au as Ee,U as He,aZ as we,a5 as Ge,H as Je,Q as Ke,C as ae,D as F,av as ue,R as Qe,S as Xe,ai as Ye,aw as ce,a1 as ge,ay as je}from"./index-3b37923e.js";import{_ as ve}from"./_plugin-vue_export-helper-c27b6911.js";import{n as Ce}from"./index-705cb9e8.js";import{c as Ze}from"./formatters-79472207.js";const Pe=_=>($e("data-v-a8649fc5"),_=_(),Ie(),_),et=Pe(()=>K("div",{class:"flex-grow-1"},null,-1)),tt=Pe(()=>K("div",{class:"flex-grow-1"},null,-1)),lt=J({__name:"Toolbar",props:{storages:Array,storage:String,path:String,endpoints:Object,axios:Object},emits:["storagechanged","pathchanged","loading","foldercreated"],setup(_,{emit:k}){const a=_,U=y(!1),b=y(""),I=M(()=>{var c,f;let i="";const d=(c=a.path)==null?void 0:c.endsWith("/"),u=(f=a.path)==null?void 0:f.split("/").filter(h=>h);return(u==null?void 0:u.map((h,$)=>(i+=h+($<u.length-1||d?"/":""),{name:h,path:i})))??[]}),w=M(()=>{var i;return(i=a.storages)==null?void 0:i.find(d=>d.code===a.storage)});function P(i){a.storage!==i&&(k("storagechanged",i),k("pathchanged",""))}function j(i){k("pathchanged",i)}function B(){const i=I.value??[],d=(i==null?void 0:i.length)===1?"/":i[i.length-2].path;j(d)}async function T(){var u,c,f;k("loading",!0);const d={url:(u=a.endpoints)==null?void 0:u.mkdir.url.replace(/{storage}/g,a.storage).replace(/{path}/g,encodeURIComponent(a.path+b.value)),method:((c=a.endpoints)==null?void 0:c.mkdir.method)||"post"};await((f=a.axios)==null?void 0:f.request(d)),U.value=!1,b.value="",k("loading",!1),k("foldercreated")}return(i,d)=>{const u=ne("Icon"),c=ne("IconBtn");return r(),p(he,{flat:"",dense:""},{default:t(()=>[e(Ne,{class:"overflow-hidden"},{default:t(()=>{var f;return[(f=a.storages)!=null&&f.length||0>1?(r(),p(pe,{key:0,"offset-y":""},{activator:t(({props:h})=>[e(L,ze(Me(h)),{default:t(()=>[e(V,{icon:"mdi-arrow-down-drop-circle-outline"})]),_:2},1040)]),default:t(()=>[e(Q,null,{default:t(()=>[(r(!0),N(A,null,G(_.storages,(h,$)=>{var m;return r(),p(X,{key:$,disabled:h.code===((m=l(w))==null?void 0:m.code),onClick:ke=>P(h.code)},{prepend:t(()=>[e(u,{icon:h.icon},null,8,["icon"])]),default:t(()=>[e(Y,null,{default:t(()=>[C(O(h.name),1)]),_:2},1024)]),_:2},1032,["disabled","onClick"])}),128))]),_:1})]),_:1})):S("",!0),e(L,{variant:"text","input-value":_.path==="/",class:"px-1",onClick:d[0]||(d[0]=h=>j("/"))},{default:t(()=>{var h,$;return[e(V,{icon:(h=l(w))==null?void 0:h.icon,class:"mr-2"},null,8,["icon"]),C(" "+O(($=l(w))==null?void 0:$.name),1)]}),_:1},8,["input-value"]),(r(!0),N(A,null,G(l(I),(h,$)=>(r(),p(L,{key:$,variant:"text","input-value":$===l(I).length-1,class:"px-1 d-none d-md-block",onClick:m=>j(h.path)},{default:t(()=>[e(V,{icon:" mdi-chevron-right"}),C(" "+O(h.name),1)]),_:2},1032,["input-value","onClick"]))),128))]}),_:1}),et,l(I).length>0?(r(),p(c,{key:0,onClick:B},{default:t(()=>[e(V,{icon:"mdi-arrow-up-bold-outline"})]),_:1})):S("",!0),e(le,{modelValue:l(U),"onUpdate:modelValue":d[3]||(d[3]=f=>W(U)?U.value=f:null),"max-width":"600"},{activator:t(({props:f})=>[e(c,fe({title:"新建文件夹"},f),{default:t(()=>[e(V,{icon:"mdi-folder-plus-outline"})]),_:2},1040)]),default:t(()=>[e(q,{title:"新建文件夹"},{default:t(()=>[e(R,null,{default:t(()=>[e(D,{modelValue:l(b),"onUpdate:modelValue":d[1]||(d[1]=f=>W(b)?b.value=f:null),label:"名称"},null,8,["modelValue"])]),_:1}),e(me,null,{default:t(()=>[tt,e(L,{depressed:"",onClick:d[2]||(d[2]=f=>U.value=!1)},{default:t(()=>[C(" 取消 ")]),_:1}),e(L,{disabled:!l(b),depressed:"",onClick:T},{default:t(()=>[C(" 新建 ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}});const at=ve(lt,[["__scopeId","data-v-a8649fc5"]]),nt={class:"grow scroll-x"},ot=J({__name:"Tree",props:{icons:Object,storage:String,path:String,endpoints:Object,axios:Object,refreshpending:Boolean},emits:["pathchanged","loading","refreshed"],setup(_,{emit:k}){const a=_,U=y([]),b=y([]),I=y([]),w=y("");function P(){U.value=[],I.value=[{type:"dir",path:"/",basename:"root",extension:"",name:"root",children:[],size:0}]}async function j(i){var f,h,$;k("loading",!0);const u={url:(f=a.endpoints)==null?void 0:f.list.url.replace(/{storage}/g,a.storage).replace(/{path}/g,i.path),method:((h=a.endpoints)==null?void 0:h.list.method)||"get"},c=await(($=a.axios)==null?void 0:$.request(u))??[];i.children=c.map(m=>(m.type==="dir"&&(m.children=[]),m)),k("loading",!1)}function B(i){let d="";b.value.length&&(d=b.value[0]),a.path!==d&&k("pathchanged",d)}function T(i){const d=[];for(d.push(I.value[0]);d.length>0;){const u=d.pop();if((u==null?void 0:u.path)===i)return u;if(u!=null&&u.children&&u.children.length)for(const c of u.children)d.push(c)}return null}return Z(()=>a.storage,()=>{P()}),Z(()=>a.path,()=>{a.path&&(b.value=[a.path],U.value.includes(a.path)||U.value.push(a.path))}),Z(()=>a.refreshpending,async()=>{if(a.refreshpending&&a.path){const i=T(a.path);i&&(await j(i),k("refreshed"))}}),Se(()=>{P()}),(i,d)=>{const u=ne("VTreeview");return r(),p(q,{flat:"",width:"250","min-height":"500",class:"d-flex flex-column folders-tree-card"},{default:t(()=>[K("div",nt,[e(u,{open:l(U),active:l(b),items:l(I),search:l(w),"load-children":j,"item-key":"path","item-text":"basename",dense:"",activatable:"",transition:"",class:"folders-tree","onUpdate:active":B},{prepend:t(({item:c,open:f})=>[c.type==="dir"?(r(),p(V,{key:0},{default:t(()=>[C(O(f?"mdi-folder-open-outline":"mdi-folder-outline"),1)]),_:2},1024)):a.icons?(r(),p(V,{key:1,icon:a.icons[c.extension.toLowerCase()]||a.icons.other},null,8,["icon"])):S("",!0)]),label:t(({item:c})=>[C(O(c.basename)+" ",1),c.type==="dir"?(r(),p(L,{key:0,icon:"",class:"ml-1",onClick:z(f=>j(c),["stop"])},{default:t(()=>[e(V,{class:"pa-0 mdi-18px",color:"grey lighten-1"},{default:t(()=>[C(" mdi-refresh ")]),_:1})]),_:2},1032,["onClick"])):S("",!0)]),_:1},8,["open","active","items","search"])]),e(oe),e(he,{density:"compact"},{default:t(()=>[e(L,{icon:"",onClick:P},{default:t(()=>[e(V,{icon:"mdi-collapse-all-outline"})]),_:1})]),_:1})]),_:1})}}});const st=ve(ot,[["__scopeId","data-v-5e129369"]]),_e=_=>($e("data-v-2e223608"),_=_(),Ie(),_),rt=_e(()=>K("br",null,null,-1)),it=_e(()=>K("div",{class:"flex-grow-1"},null,-1)),dt=_e(()=>K("div",{class:"flex-grow-1"},null,-1)),ut=J({__name:"List",props:{icons:Object,storage:String,path:String,endpoints:Object,axios:Object,refreshpending:Boolean},emits:["loading","pathchanged","refreshed","filedeleted","renamed"],setup(_,{emit:k}){const a=_,U=Ae.useToast(),b=y(!0),I=We(),w=y(a.storage??""),P=y(a.axios??Ue),j=y([]),B=y(""),T=y(!1),i=y(!1),d=y(!1),u=y("请稍候 ..."),c=y(0),f=y(),h=y(""),$=y(),m=qe({path:"",target:"",tmdbid:null,season:null,type_name:"",transfer_type:"",episode_format:"",episode_detail:"",episode_part:"",episode_offset:null,min_filesize:0}),ke=y(Array.from({length:51},(s,n)=>n).map(s=>({title:`第 ${s} 季`,value:s}))),ee=M(()=>j.value.filter(s=>s.type==="dir"&&s.basename.includes(B.value))),te=M(()=>j.value.filter(s=>s.type==="file"&&s.basename.includes(B.value))),ye=M(()=>{var s;return(s=a.path)==null?void 0:s.endsWith("/")}),E=M(()=>!ye.value),xe=M(()=>{var n,v;const s=(v=(n=a.path)==null?void 0:n.split(".").pop())==null?void 0:v.toLowerCase();return["png","jpg","jpeg","gif","bmp"].includes(s??"")});async function H(){var s,n;if(b.value=!0,k("loading",!0),ye.value){const o={url:(s=a.endpoints)==null?void 0:s.list.url.replace(/{storage}/g,w.value).replace(/{path}/g,encodeURIComponent(a.path||"")),method:((n=a.endpoints)==null?void 0:n.list.method)||"get"};j.value=await P.value.request(o)??[]}k("loading",!1),b.value=!1}async function se(s){var v,o;if(await I({title:"确认",content:`是否确认删除${s.type==="dir"?"目录":"文件"} ${s.basename}？`,confirmationText:"确认",cancellationText:"取消",dialogProps:{maxWidth:600}})){k("loading",!0);const x={url:(v=a.endpoints)==null?void 0:v.delete.url.replace(/{storage}/g,w.value).replace(/{path}/g,encodeURIComponent(s.path)),method:((o=a.endpoints)==null?void 0:o.delete.method)||"post"};await P.value.request(x),k("filedeleted"),k("loading",!1),H()}}function Ve(s){k("pathchanged",s)}function Te(s){var g;if(!s)return;const n=ce.state.auth.token,o=`/api/v1/${((g=a.endpoints)==null?void 0:g.download.url.replace(/{storage}/g,w.value).replace(/{path}/g,encodeURIComponent(s))).slice(1)}&token=${n}`;window.open(o,"_blank")}function Le(s){var o;if(!s)return"";const n=ce.state.auth.token;return`/api/v1/${((o=a.endpoints)==null?void 0:o.image.url.replace(/{storage}/g,w.value).replace(/{path}/g,encodeURIComponent(s))).slice(1)}&token=${n}`}function re(s){$.value=s,h.value=s.name,T.value=!0}async function Be(){var v,o,g,x;k("loading",!0);const n={url:(o=a.endpoints)==null?void 0:o.rename.url.replace(/{storage}/g,a.storage).replace(/{path}/g,encodeURIComponent(((v=$.value)==null?void 0:v.path)||"")).replace(/{newname}/g,encodeURIComponent(h.value)),method:((g=a.endpoints)==null?void 0:g.mkdir.method)||"post"};await((x=a.axios)==null?void 0:x.request(n)),T.value=!1,h.value="",k("loading",!1),k("renamed")}function ie(s){$.value=s,i.value=!0}async function Fe(){var s;m.path=((s=$.value)==null?void 0:s.path)??"";try{i.value=!1,d.value=!0,Oe(),ge.post("transfer/manual",{},{params:m}).then(n=>{var v,o;d.value=!1,Re(),n.success?(U.success(`${(v=$.value)==null?void 0:v.name} 整理成功！`),H()):U.error(`${(o=$.value)==null?void 0:o.name} 整理失败：${n.message}！`)})}catch(n){console.log(n)}}Z(()=>a.path,async()=>{j.value=[],await H()}),Z(()=>a.refreshpending,async()=>{a.refreshpending&&(await H(),k("refreshed"))});function Oe(){u.value="请稍候 ...";const s=ce.state.auth.token;f.value=new EventSource(`/api/v1/system/progress/filetransfer?token=${s}`),f.value.onmessage=n=>{const v=JSON.parse(n.data);v&&(u.value=v.text,c.value=v.value)}}function Re(){var s;(s=f.value)==null||s.close()}const be=y([{title:"重命名",value:1,props:{prependIcon:"mdi-rename",click:re}},{title:"整理",value:2,props:{prependIcon:"mdi-folder-arrow-right",click:ie}},{title:"删除",value:3,props:{prependIcon:"mdi-delete-outline",color:"error",click:se}}]);return Se(()=>{H()}),(s,n)=>{const v=ne("IconBtn");return r(),N(A,null,[e(q,{class:"d-flex flex-column"},{default:t(()=>[l(b)?(r(),p(R,{key:0,class:"text-center flex flex-col items-center"},{default:t(()=>[e(Ee,{size:"48",indeterminate:"",color:"primary"})]),_:1})):S("",!0),_.path?l(E)&&!l(xe)?(r(),p(R,{key:2,class:"grow d-flex justify-center align-center break-all"},{default:t(()=>[C(" 文件: "+O(_.path),1),rt]),_:1})):l(E)&&l(xe)?(r(),p(R,{key:3,class:"grow d-flex justify-center align-center"},{default:t(()=>[e(He,{src:Le(_.path),"max-width":"100%","max-height":"100%"},null,8,["src"])]),_:1})):l(ee).length||l(te).length?(r(),p(R,{key:4,class:"p-0"},{default:t(()=>[l(ee).length?(r(),p(Q,{key:0,subheader:""},{default:t(()=>[e(we,null,{default:t(()=>[C("目录")]),_:1}),(r(!0),N(A,null,G(l(ee),(o,g)=>(r(),p(X,{key:g,class:"px-3 pe-1",onClick:x=>Ve(o.path)},{prepend:t(()=>[e(V,{icon:"mdi-folder-outline"})]),append:t(()=>[e(v,{class:"d-sm-none"},{default:t(()=>[e(V,{icon:"mdi-dots-vertical"}),e(pe,{activator:"parent","close-on-content-click":""},{default:t(()=>[e(Q,null,{default:t(()=>[(r(!0),N(A,null,G(l(be),(x,de)=>(r(),p(X,{key:de,variant:"plain","base-color":x.props.color,onClick:De=>x.props.click(o)},{prepend:t(()=>[e(V,{icon:x.props.prependIcon},null,8,["icon"])]),default:t(()=>[e(Y,{textContent:O(x.title)},null,8,["textContent"])]),_:2},1032,["base-color","onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024),e(v,{class:"d-none d-sm-block",onClick:z(x=>re(o),["stop"])},{default:t(()=>[e(V,{icon:"mdi-rename"})]),_:2},1032,["onClick"]),e(v,{class:"d-none d-sm-block",onClick:z(x=>ie(o),["stop"])},{default:t(()=>[e(V,{icon:"mdi-folder-arrow-right"})]),_:2},1032,["onClick"]),e(v,{class:"d-none d-sm-block",onClick:z(x=>se(o),["stop"])},{default:t(()=>[e(V,{icon:"mdi-delete-outline"})]),_:2},1032,["onClick"])]),default:t(()=>[e(Y,{textContent:O(o.name)},null,8,["textContent"])]),_:2},1032,["onClick"]))),128))]),_:1})):S("",!0),l(ee).length&&l(te).length?(r(),p(oe,{key:1})):S("",!0),l(te).length?(r(),p(Q,{key:2,subheader:""},{default:t(()=>[e(we,null,{default:t(()=>[C("文件")]),_:1}),(r(!0),N(A,null,G(l(te),(o,g)=>(r(),p(X,{key:g,class:"pl-3 pe-1",onClick:x=>Ve(o.path)},{prepend:t(()=>{var x;return[a.icons?(r(),p(V,{key:0,icon:a.icons[o.extension.toLowerCase()]||((x=a.icons)==null?void 0:x.other)},null,8,["icon"])):S("",!0)]}),append:t(()=>[e(v,{class:"d-sm-none"},{default:t(()=>[e(V,{icon:"mdi-dots-vertical"}),e(pe,{activator:"parent","close-on-content-click":""},{default:t(()=>[e(Q,null,{default:t(()=>[(r(!0),N(A,null,G(l(be),(x,de)=>(r(),p(X,{key:de,variant:"plain","base-color":x.props.color,onClick:De=>x.props.click(o)},{prepend:t(()=>[e(V,{icon:x.props.prependIcon},null,8,["icon"])]),default:t(()=>[e(Y,{textContent:O(x.title)},null,8,["textContent"])]),_:2},1032,["base-color","onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024),e(v,{class:"d-none d-sm-block",onClick:z(x=>re(o),["stop"])},{default:t(()=>[e(V,{icon:"mdi-rename"})]),_:2},1032,["onClick"]),e(v,{class:"d-none d-sm-block",onClick:z(x=>ie(o),["stop"])},{default:t(()=>[e(V,{icon:"mdi-folder-arrow-right"})]),_:2},1032,["onClick"]),e(v,{class:"d-none d-sm-block",onClick:z(x=>se(o),["stop"])},{default:t(()=>[e(V,{icon:"mdi-delete-outline"})]),_:2},1032,["onClick"])]),default:t(()=>[e(Y,{textContent:O(o.name)},null,8,["textContent"]),e(Ge,null,{default:t(()=>[C(O(l(Ze)(o.size)),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):S("",!0)]),_:1})):l(B)?(r(),p(R,{key:5,class:"grow d-flex justify-center align-center grey--text py-5"},{default:t(()=>[C(" 没有目录或文件 ")]),_:1})):l(b)?S("",!0):(r(),p(R,{key:6,class:"grow d-flex justify-center align-center grey--text py-5"},{default:t(()=>[C(" 空目录 ")]),_:1})):(r(),p(R,{key:1,class:"grow d-flex justify-center align-center grey--text"},{default:t(()=>[C(" 选择目录或文件 ")]),_:1})),_.path?(r(),p(oe,{key:7})):S("",!0),l(b)?S("",!0):(r(),p(he,{key:8,density:"compact",flat:"",color:"gray"},{default:t(()=>[l(E)?S("",!0):(r(),p(D,{key:0,modelValue:l(B),"onUpdate:modelValue":n[0]||(n[0]=o=>W(B)?B.value=o:null),"hide-details":"",flat:"",density:"compact",variant:"solo-filled",placeholder:"搜索 ...","prepend-inner-icon":"mdi-filter-outline",class:"me-2"},null,8,["modelValue"])),l(E)?(r(),p(Je,{key:1})):S("",!0),l(E)?(r(),p(L,{key:2,onClick:n[1]||(n[1]=o=>Te(a.path||""))},{default:t(()=>[e(V,null,{default:t(()=>[C("mdi-download")]),_:1})]),_:1})):S("",!0),l(E)?S("",!0):(r(),p(L,{key:3,onClick:H},{default:t(()=>[e(V,null,{default:t(()=>[C("mdi-refresh")]),_:1})]),_:1}))]),_:1}))]),_:1}),e(le,{modelValue:l(T),"onUpdate:modelValue":n[4]||(n[4]=o=>W(T)?T.value=o:null),"max-width":"600"},{activator:t(({props:o})=>[e(v,fe({title:"重命名"},o),{default:t(()=>[e(V,{icon:"mdi-rename-outline"})]),_:2},1040)]),default:t(()=>[e(q,{title:"重命名"},{default:t(()=>[e(R,null,{default:t(()=>[e(D,{modelValue:l(h),"onUpdate:modelValue":n[2]||(n[2]=o=>W(h)?h.value=o:null),label:"名称"},null,8,["modelValue"])]),_:1}),e(me,null,{default:t(()=>[it,e(L,{depressed:"",onClick:n[3]||(n[3]=o=>T.value=!1)},{default:t(()=>[C(" 取消 ")]),_:1}),e(L,{disabled:!l(h),depressed:"",onClick:Be},{default:t(()=>[C(" 重命名 ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(le,{modelValue:l(i),"onUpdate:modelValue":n[16]||(n[16]=o=>W(i)?i.value=o:null),"max-width":"800",scrollable:""},{activator:t(({props:o})=>[e(v,fe({title:"整理"},o),{default:t(()=>[e(V,{icon:"mdi-folder-arrow-right-outline"})]),_:2},1040)]),default:t(()=>{var o;return[e(q,{title:`文件整理 - ${(o=l($))==null?void 0:o.name}`},{default:t(()=>[e(R,{class:"pt-2"},{default:t(()=>[e(Ke,{onSubmit:z(()=>{},["prevent"])},{default:t(()=>[e(ae,null,{default:t(()=>[e(F,{cols:"12",md:"8"},{default:t(()=>[e(D,{modelValue:l(m).target,"onUpdate:modelValue":n[5]||(n[5]=g=>l(m).target=g),label:"目的路径"},null,8,["modelValue"])]),_:1}),e(F,{cols:"12",md:"4"},{default:t(()=>[e(ue,{modelValue:l(m).transfer_type,"onUpdate:modelValue":n[6]||(n[6]=g=>l(m).transfer_type=g),label:"整理方式",items:[{title:"默认",value:""},{title:"移动",value:"move"},{title:"复制",value:"copy"},{title:"硬链接",value:"link"},{title:"软链接",value:"softlink"}]},null,8,["modelValue"])]),_:1})]),_:1}),e(ae,null,{default:t(()=>[e(F,{cols:"12",md:"4"},{default:t(()=>[e(ue,{modelValue:l(m).type_name,"onUpdate:modelValue":n[7]||(n[7]=g=>l(m).type_name=g),label:"类型",items:[{title:"请选择",value:""},{title:"电影",value:"电影"},{title:"电视剧",value:"电视剧"}]},null,8,["modelValue"])]),_:1}),e(F,{cols:"12",md:"4"},{default:t(()=>[e(D,{modelValue:l(m).tmdbid,"onUpdate:modelValue":n[8]||(n[8]=g=>l(m).tmdbid=g),label:"TMDBID",placeholder:"留空自动识别",rules:[l(Ce)]},null,8,["modelValue","rules"])]),_:1}),e(F,{cols:"12",md:"4"},{default:t(()=>[Qe(e(ue,{modelValue:l(m).season,"onUpdate:modelValue":n[9]||(n[9]=g=>l(m).season=g),modelModifiers:{number:!0},label:"季",items:l(ke)},null,8,["modelValue","items"]),[[Xe,l(m).type_name==="电视剧"]])]),_:1})]),_:1}),e(ae,null,{default:t(()=>[e(F,{cols:"12",md:"8"},{default:t(()=>[e(D,{modelValue:l(m).episode_format,"onUpdate:modelValue":n[10]||(n[10]=g=>l(m).episode_format=g),label:"集数定位",placeholder:"使用{ep}定位集数"},null,8,["modelValue"])]),_:1}),e(F,{cols:"12",md:"4"},{default:t(()=>[e(D,{modelValue:l(m).episode_detail,"onUpdate:modelValue":n[11]||(n[11]=g=>l(m).episode_detail=g),label:"指定集数",placeholder:"起始集,终止集，如1或1,2"},null,8,["modelValue"])]),_:1}),e(F,{cols:"12",md:"4"},{default:t(()=>[e(D,{modelValue:l(m).episode_part,"onUpdate:modelValue":n[12]||(n[12]=g=>l(m).episode_part=g),label:"指定Part",placeholder:"如part1"},null,8,["modelValue"])]),_:1}),e(F,{cols:"12",md:"4"},{default:t(()=>[e(D,{modelValue:l(m).episode_offset,"onUpdate:modelValue":n[13]||(n[13]=g=>l(m).episode_offset=g),modelModifiers:{number:!0},label:"集数偏移",placeholder:"如-10"},null,8,["modelValue"])]),_:1}),e(F,{cols:"12",md:"4"},{default:t(()=>[e(D,{modelValue:l(m).min_filesize,"onUpdate:modelValue":n[14]||(n[14]=g=>l(m).min_filesize=g),modelModifiers:{number:!0},label:"最小文件大小（MB）",rules:[l(Ce)],placeholder:"0"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(me,null,{default:t(()=>[dt,e(L,{depressed:"",onClick:n[15]||(n[15]=g=>i.value=!1)},{default:t(()=>[C(" 取消 ")]),_:1}),e(L,{onClick:Fe},{default:t(()=>[C(" 开始整理 ")]),_:1})]),_:1})]),_:1},8,["title"])]}),_:1},8,["modelValue"]),e(le,{modelValue:l(d),"onUpdate:modelValue":n[17]||(n[17]=o=>W(d)?d.value=o:null),scrim:!1,width:"400"},{default:t(()=>[e(q,{color:"primary"},{default:t(()=>[e(R,{class:"text-center"},{default:t(()=>[C(O(l(u))+" ",1),e(Ye,{color:"white",class:"mb-0 mt-1",value:l(c)},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}});const ct=ve(ut,[["__scopeId","data-v-2e223608"]]),pt=J({__name:"FileBrowser",props:{storages:String,storage:String,path:String,tree:Boolean,endpoints:Object,axios:Object,axiosconfig:Object},emits:["pathchanged"],setup(_,{emit:k}){const a=_,U=[{name:"本地",code:"local",icon:"mdi-folder-multiple-outline"}],b={zip:"mdi-folder-zip-outline",rar:"mdi-folder-zip-outline",htm:"mdi-language-html5",html:"mdi-language-html5",js:"mdi-nodejs",json:"mdi-file-document-outline",md:"mdi-language-markdown-outline",pdf:"mdi-file-pdf",png:"mdi-file-image",jpg:"mdi-file-image",jpeg:"mdi-file-image",mp4:"mdi-filmstrip",mkv:"mdi-filmstrip",avi:"mdi-filmstrip",wmv:"mdi-filmstrip",mov:"mdi-filmstrip",txt:"mdi-file-document-outline",xls:"mdi-file-excel",other:"mdi-file-outline"},I=y(0),w=y("local"),P=y(!1),j=y(),B=M(()=>{var c;const u=(c=a.storages)==null?void 0:c.split(",");return U.filter(f=>u==null?void 0:u.includes(f.code))});function T(u){}function i(u){w.value=u}function d(u){k("pathchanged",u)}return je(()=>{w.value=a.storage??"local",j.value=a.axios??Ue.create(a.axiosconfig)}),(u,c)=>(r(),p(q,{class:"mx-auto",loading:l(I)>0},{default:t(()=>[e(at,{path:a.path,storages:l(B),storage:l(w),endpoints:a.endpoints,axios:l(j),onStoragechanged:i,onPathchanged:d,onFoldercreated:c[0]||(c[0]=f=>P.value=!0)},null,8,["path","storages","storage","endpoints","axios"]),e(ae,{"no-gutters":""},{default:t(()=>[_.tree?(r(),p(F,{key:0,sm:"auto",class:"d-none d-md-block"},{default:t(()=>[e(st,{path:a.path,storage:l(w),icons:b,endpoints:_.endpoints,axios:l(j),refreshpending:l(P),onPathchanged:d,onLoading:T,onRefreshed:c[1]||(c[1]=f=>P.value=!1)},null,8,["path","storage","endpoints","axios","refreshpending"])]),_:1})):S("",!0),_.tree?(r(),p(oe,{key:1,vertical:""})):S("",!0),e(F,null,{default:t(()=>[e(ct,{path:a.path,storage:l(w),icons:b,endpoints:_.endpoints,axios:l(j),refreshpending:l(P),onPathchanged:d,onLoading:T,onRefreshed:c[2]||(c[2]=f=>P.value=!1),onFiledeleted:c[3]||(c[3]=f=>P.value=!0),onRenamed:c[4]||(c[4]=f=>P.value=!0)},null,8,["path","storage","endpoints","axios","refreshpending"])]),_:1})]),_:1})]),_:1},8,["loading"]))}}),ft=J({__name:"FileBrowserView",setup(_){const k={list:{url:"/filebrowser/list?path={path}",method:"get"},mkdir:{url:"/filebrowser/mkdir?path={path}",method:"get"},delete:{url:"/filebrowser/delete?path={path}",method:"get"},download:{url:"/filebrowser/download?path={path}",method:"get"},image:{url:"/filebrowser/image?path={path}",method:"get"},rename:{url:"/filebrowser/rename?path={path}&new_name={newname}",method:"get"}},a=y("/");async function U(){var I;try{const w=await ge.get("system/env");w.success&&(a.value=((I=w.data)==null?void 0:I.DOWNLOAD_PATH)||"/"),a.value&&!a.value.endsWith("/")&&(a.value+="/")}catch(w){console.log(w)}}function b(I){a.value=I}return je(async()=>{await U()}),(I,w)=>(r(),N("div",null,[e(pt,{storages:"local",tree:!1,path:l(a),endpoints:k,axios:l(ge),onPathchanged:b},null,8,["path","axios"])]))}}),_t=J({__name:"filemanager",setup(_){return(k,a)=>(r(),p(ft))}});export{_t as default};
