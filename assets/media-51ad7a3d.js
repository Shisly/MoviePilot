import{d as B,r as x,q as ye,j as t,o as i,f as C,i as _,aC as ge,z as xe,W as l,a1 as w,c as o,a2 as $,M as b,an as ke,p as I,ay as we,e as A,m as c,au as G,a,U as L,t as d,I as U,V,aP as $e,aQ as Se,K as D,a9 as Ve,a7 as W,a4 as F,R as Ce,S as Ee,aa as Me,aR as je,_ as H,P as De,aS as Ie,aT as Pe,ar as K,as as Q,ae as Te,b as Le}from"./index-0265d51a.js";import{_ as Be}from"./PersonCard.vue_vue_type_style_index_0_lang-5f11ca9e.js";import{S as Ne,_ as J}from"./MediaCardSlideView.vue_vue_type_script_setup_true_lang-0ac13b08.js";import{_ as ze}from"./NoDataFound.vue_vue_type_style_index_0_lang-66cf72cc.js";import{b as Re}from"./formatters-79472207.js";import"./MediaCard.vue_vue_type_style_index_0_lang-4a30aaec.js";import"./ExistIcon-5f91a633.js";import"./_plugin-vue_export-helper-c27b6911.js";const qe=B({__name:"PersonCardSlideView",props:{apipath:String,linkurl:String,title:String},setup(P){const m=P,y=x(!1),e=x([]);async function h(){try{if(!m.apipath)return;e.value=await w.get(m.apipath),e.value.length>0&&(y.value=!0)}catch(f){console.error(f)}}return ye(h),(f,S)=>t(y)?(i(),C(Ne,ge(xe({key:0},m)),{content:_(()=>[(i(!0),o(b,null,$(t(e),v=>(i(),C(Be,{key:v.id,person:v,height:"15rem",width:"10rem"},null,8,["person"]))),128))]),_:1},16)):l("",!0)}}),Ae={key:0,class:"mt-12 w-full text-center text-gray-500 text-sm flex flex-col items-center"},Ge={key:1,class:"max-w-8xl mx-auto px-4"},Ue={class:"vue-media-back absolute left-0 top-0 w-full h-96"},We=a("div",{class:"vue-media-back absolute left-0 top-0 w-full h-96"},null,-1),Fe={class:"media-page"},He={class:"media-header"},Ke={class:"media-poster"},Qe={class:"w-full h-full"},Je={class:"media-title"},Oe={key:0,class:"media-status"},Xe=a("span",{class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full whitespace-nowrap transition !no-underline bg-green-500 bg-opacity-80 border border-green-500 !text-green-100 hover:bg-green-500 hover:bg-opacity-100 false overflow-hidden"},[a("div",{class:"relative z-20 flex items-center false"},[a("span",null,"已入库")])],-1),Ye=[Xe],Ze={class:"flex flex-row items-baseline justify-start lg:justify-center"},et={key:0,class:"text-lg"},tt={class:"media-attributes"},st={key:0},at={key:1,class:"mx-1"},nt={key:2},it={class:"media-actions"},rt={class:"media-overview"},ot={class:"media-overview-left"},lt={key:0,class:"tagline"},ct={key:1},dt={key:2,class:"media-crew"},ut=["href"],_t={key:3,class:"media-crew"},mt=["href"],pt=["href"],ft={class:"mt-6"},ht=["href"],vt={class:"inline-flex cursor-pointer items-center rounded-full bg-gray-600 px-2 py-1 text-sm text-gray-200 ring-1 ring-gray-500 transition hover:bg-gray-700"},bt=a("span",{class:"ms-1"},"TheMovieDb",-1),yt=["href"],gt={class:"inline-flex cursor-pointer items-center rounded-full bg-gray-600 px-2 py-1 text-sm text-gray-200 ring-1 ring-gray-500 transition hover:bg-gray-700"},xt=a("span",{class:"ms-1"},"豆瓣",-1),kt=["href"],wt={class:"inline-flex cursor-pointer items-center rounded-full bg-gray-600 px-2 py-1 text-sm text-gray-200 ring-1 ring-gray-500 transition hover:bg-gray-700"},$t=a("span",{class:"ms-1"},"IMDb",-1),St=["href"],Vt={class:"inline-flex cursor-pointer items-center rounded-full bg-gray-600 px-2 py-1 text-sm text-gray-200 ring-1 ring-gray-500 transition hover:bg-gray-700"},Ct=a("span",{class:"ms-1"},"TheTvDb",-1),Et={key:4,class:"py-4"},Mt={key:5,class:"flex w-full flex-col space-y-2"},jt={class:"flex flex-row items-center justify-between"},Dt={class:"font-weight-bold"},It={class:"absolute right-12"},Pt={key:0,class:"mt-3 w-full text-center text-gray-500 text-sm flex flex-col items-center"},Tt={class:"flex flex-col justify-center divide-y divide-gray-700"},Lt={class:"flex-1"},Bt={class:"flex flex-col space-y-2 lg:flex-row lg:items-center lg:space-y-0 lg:space-x-2"},Nt={class:"text-lg"},zt={class:"flex items-center space-x-2"},Rt={class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full whitespace-nowrap cursor-default bg-gray-700 !text-gray-300"},qt={key:0,class:"media-overview-right"},At={class:"media-facts"},Gt={key:0,class:"media-ratings"},Ut={key:1,class:"media-fact"},Wt=a("span",null,"原始标题",-1),Ft={class:"media-fact-value"},Ht={key:2,class:"media-fact"},Kt=a("span",null,"状态",-1),Qt={class:"media-fact-value"},Jt={key:3,class:"media-fact"},Ot=a("span",null,"上映日期",-1),Xt={class:"media-fact-value"},Yt={class:"flex items-center justify-end"},Zt=a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true",class:"h-4 w-4"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 15a4.5 4.5 0 004.5 4.5H18a3.75 3.75 0 001.332-7.257 3 3 0 00-3.758-3.848 5.25 5.25 0 00-10.233 2.33A4.502 4.502 0 002.25 15z"})],-1),es={class:"ml-1.5"},ts={key:4,class:"media-fact"},ss=a("span",null,"原始语言",-1),as={class:"media-fact-value"},ns={key:5,class:"media-fact"},is=a("span",null,"出品国家",-1),rs={class:"media-fact-value"},os={class:"media-fact border-b-0"},ls=a("span",null,"制作公司",-1),cs={class:"media-fact-value text-end"},ds={key:0},us={key:1},_s={key:2},ms=B({__name:"MediaDetailView",props:{mediaid:String,type:String},setup(P){const m=P,y=ke.useToast(),e=x({}),h=x(!1),f=x(!1),S=x(!1),v=x({}),E=x({}),M=x({});async function O(){if(m.mediaid&&m.type){if(e.value=await w.get(`media/${m.mediaid}`,{params:{type_name:m.type}}),S.value=!0,!e.value.tmdb_id&&!e.value.douban_id)return;e.value.type==="电影"?Y():Z(),e.value.type==="电影"?ee():se()}}async function X(s){if(!v.value[s])try{const n=await w.get(`tmdb/${e.value.tmdb_id}/${s}`);v.value[s]=n||[]}catch(n){console.error(n)}}async function Y(){try{(await w.get("media/exists",{params:{tmdbid:e.value.tmdb_id,title:e.value.title,year:e.value.year,season:e.value.season,mtype:e.value.type}})).success&&(h.value=!0)}catch(s){console.error(s)}}async function N(s=0){try{const n=`tmdb:${e.value.tmdb_id}`;if((await w.get(`subscribe/media/${n}`,{params:{season:s}})).id)return!0}catch(n){console.error(n)}return!1}async function Z(){if(e.value.type==="电视剧")try{const s=await w.post("download/notexists",e.value);s&&(s.length===0&&(h.value=!0),s.forEach(n=>{let u=0;n.episodes.length===0?u=2:n.episodes.length<n.total_episode&&(u=1),u!==2&&(h.value=!0),E.value[n.season]=u}))}catch(s){console.error(s)}}async function ee(){e.value.type==="电影"&&(f.value=await N())}const te=I(()=>{var s,n;return(n=(s=e.value)==null?void 0:s.season_info)==null?void 0:n.filter(u=>u.season_number!==0)});async function se(){var s,n;if(e.value.type==="电视剧")try{(n=(s=e.value)==null?void 0:s.season_info)==null||n.forEach(async u=>{M.value[u.season_number??0]=await N(u.season_number)})}catch(u){console.error(u)}}async function ae(s=0){var n,u,g,r,p,j;K();try{let k=h.value?1:0;s&&(k=E.value[s]?0:1);const T=await w.post("subscribe",{name:(n=e.value)==null?void 0:n.title,type:(u=e.value)==null?void 0:u.type,year:(g=e.value)==null?void 0:g.year,tmdbid:(r=e.value)==null?void 0:r.tmdb_id,doubanid:(p=e.value)==null?void 0:p.douban_id,season:s,best_version:k});T.success&&(f.value=!0,s&&(M.value[s]=!0)),ne(T.success,((j=e.value)==null?void 0:j.title)??"",s,T.message,k)}catch(k){console.error(k)}Q()}function ne(s,n,u,g,r){u&&(n=`${n} ${Re(u.toString())}`);let p="订阅";r>0&&(p="洗版订阅"),s?y.success(`${n} 添加${p}成功！`):y.error(`${n} 添加${p}失败：${g}！`)}async function ie(s){var n,u,g,r,p;K();try{const j=(n=e.value)!=null&&n.tmdb_id?`tmdb:${(u=e.value)==null?void 0:u.tmdb_id}`:`douban:${(g=e.value)==null?void 0:g.douban_id}`,k=await w.delete(`subscribe/media/${j}`,{params:{season:s}});k.success?(f.value=!1,s&&(M.value[s]=!1),y.success(`${(r=e.value)==null?void 0:r.title} 已取消订阅！`)):y.error(`${(p=e.value)==null?void 0:p.title} 取消订阅失败：${k.message}！`)}catch(j){console.error(j)}Q()}function z(s=0){f.value?ie(s):ae(s)}function re(s){return s.map(n=>n.name).join("、")}function oe(){return`https://www.themoviedb.org/${m.type==="电影"?"movie":"tv"}/${e.value.tmdb_id}`}function le(){return`https://movie.douban.com/subject/${e.value.douban_id}`}function ce(){return`https://www.imdb.com/title/${e.value.imdb_id}`}function de(){return`https://www.thetvdb.com/series/${e.value.tvdb_id}`}function ue(s){return s?`https://image.tmdb.org/t/p/w500${s}`:""}function _e(s=""){return s?s.replace("original","w500"):""}const me=I(()=>{var s;return(s=e.value.production_countries)==null?void 0:s.map(n=>n.name)}),pe=I(()=>{var s;return(s=e.value.production_companies)==null?void 0:s.map(n=>n.name)});function fe(s){const n=E.value[s];return n?n===1?"warning":n===2?"error":"success":"success"}function he(s){const n=E.value[s];return n?n===1?"部分缺失":n===2?"缺失":"已存在":"已存在"}const ve=I(()=>f.value?"mdi-heart":"mdi-heart-outline"),be=I(()=>f.value?"error":"warning");function R(s){return s.join("、")}function q(s){Te.push({path:"/resource",query:{keyword:`tmdb:${e.value.tmdb_id}`,type:e.value.type,area:s}})}return we(()=>{O()}),(s,n)=>{const u=A("VSkeletonLoader"),g=A("IconBtn");return i(),o(b,null,[t(S)?l("",!0):(i(),o("div",Ae,[c(G,{size:"48",indeterminate:"",color:"primary"})])),t(e).tmdb_id||t(e).douban_id?(i(),o("div",Ge,[t(e).backdrop_path?(i(),o(b,{key:0},[a("div",Ue,[c(L,{class:"h-96",src:t(e).backdrop_path,cover:""},null,8,["src"])]),We],64)):l("",!0),a("div",Fe,[a("div",He,[a("div",Ke,[c(L,{src:_e(t(e).poster_path),cover:"",class:"object-cover aspect-w-2 aspect-h-3 ring-1 ring-gray-500"},{placeholder:_(()=>[a("div",Qe,[c(u,{class:"object-cover aspect-w-2 aspect-h-3"})])]),_:1},8,["src"])]),a("div",Je,[t(h)?(i(),o("div",Oe,Ye)):l("",!0),a("h1",Ze,[a("span",null,d(t(e).title),1),t(e).year?(i(),o("span",et,"（"+d(t(e).year)+"）",1)):l("",!0)]),a("span",tt,[t(e).runtime||t(e).episode_run_time[0]?(i(),o("span",st,d(t(e).runtime||t(e).episode_run_time[0])+" 分钟",1)):l("",!0),(t(e).runtime||t(e).episode_run_time[0])&&t(e).genres?(i(),o("span",at," | ")):l("",!0),t(e).genres?(i(),o("span",nt,d(re(t(e).genres||[])),1)):l("",!0)])]),a("div",it,[t(e).tmdb_id?(i(),C(U,{key:0,variant:"tonal",color:"info"},{prepend:_(()=>[c(V,{icon:"mdi-magnify"})]),default:_(()=>[D(" 搜索资源 "),c(Me,{activator:"parent","close-on-content-click":""},{default:_(()=>[c(Ve,null,{default:_(()=>[c(W,{variant:"plain",onClick:n[0]||(n[0]=r=>q("title"))},{default:_(()=>[c(F,null,{default:_(()=>[D("标题")]),_:1})]),_:1}),Ce(c(W,{variant:"plain",onClick:n[1]||(n[1]=r=>q("imdbid"))},{default:_(()=>[c(F,null,{default:_(()=>[D("IMDB链接")]),_:1})]),_:1},512),[[Ee,t(e).imdb_id]])]),_:1})]),_:1})]),_:1})):l("",!0),t(e).type==="电影"?(i(),C(U,{key:1,class:"ms-2",color:t(be),variant:"tonal",onClick:n[2]||(n[2]=r=>z(0))},{prepend:_(()=>[c(V,{icon:t(ve)},null,8,["icon"])]),default:_(()=>[D(" "+d(t(f)?"已订阅":"订阅"),1)]),_:1},8,["color"])):l("",!0)])]),a("div",rt,[a("div",ot,[t(e).tagline?(i(),o("div",lt,d(t(e).tagline),1)):l("",!0),t(e).overview?(i(),o("h2",ct," 简介 ")):l("",!0),a("p",null,d(t(e).overview),1),t(e).tmdb_id?(i(),o("ul",dt,[(i(!0),o(b,null,$(t(e).directors,r=>(i(),o("li",{key:r.id},[a("span",null,d(r.job),1),a("a",{class:"crew-name",href:`person?personid=${r.id}`,target:"_blank"},d(r.name),9,ut)]))),128))])):l("",!0),!t(e).tmdb_id&&t(e).douban_id?(i(),o("ul",_t,[(i(!0),o(b,null,$(t(e).directors,r=>(i(),o("li",{key:r.id},[a("span",null,d(R(r.roles)),1),a("a",{class:"crew-name",href:`${r.url}`,target:"_blank"},d(r.name),9,mt)]))),128)),(i(!0),o(b,null,$(t(e).actors,r=>(i(),o("li",{key:r.id},[a("span",null,d(R(r.roles)),1),a("a",{class:"crew-name",href:`${r.url}`,target:"_blank"},d(r.name),9,pt)]))),128))])):l("",!0),a("div",ft,[t(e).tmdb_id?(i(),o("a",{key:0,class:"mb-2 mr-2 inline-flex last:mr-0",href:oe(),target:"_blank"},[a("div",vt,[c(V,{icon:"mdi-link"}),bt])],8,ht)):l("",!0),t(e).douban_id?(i(),o("a",{key:1,class:"mb-2 mr-2 inline-flex last:mr-0",href:le(),target:"_blank"},[a("div",gt,[c(V,{icon:"mdi-link"}),xt])],8,yt)):l("",!0),t(e).imdb_id?(i(),o("a",{key:2,class:"mb-2 mr-2 inline-flex last:mr-0",href:ce(),target:"_blank"},[a("div",wt,[c(V,{icon:"mdi-link"}),$t])],8,kt)):l("",!0),t(e).tvdb_id?(i(),o("a",{key:3,class:"mb-2 mr-2 inline-flex last:mr-0",href:de(),target:"_blank"},[a("div",Vt,[c(V,{icon:"mdi-link"}),Ct])],8,St)):l("",!0)]),t(e).type==="电视剧"&&t(e).tmdb_id?(i(),o("h2",Et," 季 ")):l("",!0),t(e).type==="电视剧"&&t(e).tmdb_id?(i(),o("div",Mt,[c($e,null,{default:_(()=>[(i(!0),o(b,null,$(t(te),r=>(i(),C(Pe,{key:r.season_number,"onGroup:selected":p=>X(r.season_number||0)},{default:_(()=>[c(je,null,{default:_(()=>[a("div",jt,[a("span",Dt,"第 "+d(r.season_number)+" 季",1),c(H,{size:"small",class:"ms-1"},{default:_(()=>[D(d(r.episode_count)+"集 ",1)]),_:2},1024),a("div",It,[t(E)?(i(),C(H,{key:0,color:fe(r.season_number||0),flat:""},{default:_(()=>[D(d(he(r.season_number||0)),1)]),_:2},1032,["color"])):l("",!0),c(g,{class:"ms-1",color:t(M)[r.season_number||0]?"error":"warning",variant:"text",onClick:De(p=>z(r.season_number),["stop"])},{default:_(()=>[c(V,{icon:t(M)[r.season_number||0]?"mdi-heart":"mdi-heart-outline"},null,8,["icon"])]),_:2},1032,["color","onClick"])])])]),_:2},1024),c(Ie,null,{default:_(()=>[t(v)[r.season_number||0]?l("",!0):(i(),o("div",Pt,[c(G,{size:"48",indeterminate:"",color:"primary"})])),a("div",Tt,[(i(!0),o(b,null,$(t(v)[r.season_number||0],p=>(i(),o("div",{key:p.episode_number,class:"flex flex-col space-y-4 py-4 xl:flex-row xl:space-y-4 xl:space-x-4"},[a("div",Lt,[a("div",Bt,[a("h3",Nt,d(p.episode_number)+" - "+d(p.name),1),a("div",zt,[a("span",Rt,d(p.air_date),1)])]),a("p",null,d(p.overview),1)]),c(L,{cover:"",class:"rounded-lg","max-width":"15rem",src:ue(p.still_path||""),alt:""},null,8,["src"])]))),128))])]),_:2},1024)]),_:2},1032,["onGroup:selected"]))),128))]),_:1})])):l("",!0)]),t(e).tmdb_id?(i(),o("div",qt,[a("div",At,[t(e).vote_average?(i(),o("div",Gt,[c(Se,{modelValue:t(e).vote_average,"onUpdate:modelValue":n[3]||(n[3]=r=>t(e).vote_average=r),density:"compact",length:"10",class:"ma-2",readonly:""},null,8,["modelValue"])])):l("",!0),t(e).original_title||t(e).original_name?(i(),o("div",Ut,[Wt,a("span",Ft,d(t(e).original_title||t(e).original_name),1)])):l("",!0),t(e).status?(i(),o("div",Ht,[Kt,a("span",Qt,d(t(e).status),1)])):l("",!0),t(e).release_date||t(e).first_air_date?(i(),o("div",Jt,[Ot,a("span",Xt,[a("span",Yt,[Zt,a("span",es,d(t(e).release_date||t(e).first_air_date),1)])])])):l("",!0),t(e).original_language?(i(),o("div",ts,[ss,a("span",as,d(t(e).original_language),1)])):l("",!0),t(e).production_countries?(i(),o("div",ns,[is,a("span",rs,[(i(!0),o(b,null,$(t(me),r=>(i(),o("span",{key:r,class:"flex items-center justify-end text-end"},d(r),1))),128))])])):l("",!0),a("div",os,[ls,a("span",cs,[(i(!0),o(b,null,$(t(pe),r=>(i(),o("span",{key:r,class:"block"},d(r),1))),128))])])])])):l("",!0)]),t(e).tmdb_id?(i(),o("div",ds,[c(qe,{apipath:`tmdb/credits/${t(e).tmdb_id}/${m.type}`,linkurl:`/credits/tmdb/credits/${t(e).tmdb_id}/${m.type}?title=演员阵容`,title:"演员阵容"},null,8,["apipath","linkurl"])])):l("",!0),t(e).tmdb_id?(i(),o("div",us,[c(J,{apipath:`tmdb/recommend/${t(e).tmdb_id}/${m.type}`,linkurl:`/browse/tmdb/recommend/${t(e).tmdb_id}/${m.type}?title=推荐`,title:"推荐"},null,8,["apipath","linkurl"])])):l("",!0),t(e).tmdb_id?(i(),o("div",_s,[c(J,{apipath:`tmdb/similar/${t(e).tmdb_id}/${m.type}`,linkurl:`/browse/tmdb/similar/${t(e).tmdb_id}/${m.type}?title=类似`,title:"类似"},null,8,["apipath","linkurl"])])):l("",!0)])])):l("",!0),!t(e).tmdb_id&&!t(e).douban_id&&t(S)?(i(),C(ze,{key:2,"error-code":"500","error-title":"出错啦！","error-description":"未识别到TMDB媒体信息。"})):l("",!0)],64)}}});const ks=B({__name:"media",setup(P){var h,f,S,v;const m=Le(),y=(f=(h=m.query)==null?void 0:h.mediaid)==null?void 0:f.toString(),e=(v=(S=m.query)==null?void 0:S.type)==null?void 0:v.toString();return(E,M)=>(i(),o("div",null,[c(ms,{mediaid:t(y),type:t(e)},null,8,["mediaid","type"])]))}});export{ks as default};
